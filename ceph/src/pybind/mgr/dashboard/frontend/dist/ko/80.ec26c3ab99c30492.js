"use strict";(self.webpackChunkceph_dashboard=self.webpackChunkceph_dashboard||[]).push([[80],{47080:(st,Ee,m)=>{m.r(Ee),m.d(Ee,{BlockModule:()=>Qt,RoutedBlockModule:()=>Hl});var c=m(88692),a=m(20092),p=m(54247),se=m(35512),P=m(51389),Ie=m(37496),E=m(79512),q=m(4222),U=m(54462),_e=m(44466),W=m(23815),S=m.n(W),ge=m(35758),Q=m(64762),Te=m(35732),fe=m(93523),e=m(64537);let J=class{constructor(s){this.http=s}listTargets(){return this.http.get("api/iscsi/target")}getTarget(s){return this.http.get(`api/iscsi/target/${s}`)}updateTarget(s,t){return this.http.put(`api/iscsi/target/${s}`,t,{observe:"response"})}status(){return this.http.get("ui-api/iscsi/status")}settings(){return this.http.get("ui-api/iscsi/settings")}version(){return this.http.get("ui-api/iscsi/version")}portals(){return this.http.get("ui-api/iscsi/portals")}createTarget(s){return this.http.post("api/iscsi/target",s,{observe:"response"})}deleteTarget(s){return this.http.delete(`api/iscsi/target/${s}`,{observe:"response"})}getDiscovery(){return this.http.get("api/iscsi/discoveryauth")}updateDiscovery(s){return this.http.put("api/iscsi/discoveryauth",s)}overview(){return this.http.get("ui-api/iscsi/overview")}};J.\u0275fac=function(s){return new(s||J)(e.LFG(Te.eN))},J.\u0275prov=e.Yz7({token:J,factory:J.\u0275fac,providedIn:"root"}),J=(0,Q.gn)([fe.o,(0,Q.w6)("design:paramtypes",[Te.eN])],J);var j=m(23170),Me=m(7022),ee=m(14745),C=m(65862),$e=m(93614),A=m(95463),v=m(82723),$=m(48168),N=m(76111),G=m(32337),Y=m(60312),R=m(30839),L=m(87925),g=m(94276),T=m(56310),b=m(41582);function y(n,s){if(1&n&&(e.TgZ(0,"option",6),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("ngValue",t),e.xp6(1),e.Oqu(t)}}function K(n,s){if(1&n&&(e.TgZ(0,"select",5),e._UZ(1,"option",6),e.YNc(2,y,2,2,"option",7),e.qZA()),2&n){const t=e.oxw();e.s9C("id",t.setting),e.s9C("name",t.setting),e.Q6J("formControlName",t.setting),e.xp6(1),e.Q6J("ngValue",null),e.xp6(1),e.Q6J("ngForOf",t.limits.values)}}function ye(n,s){if(1&n&&e._UZ(0,"input",10),2&n){const t=e.oxw(2);e.Q6J("formControlName",t.setting)}}function To(n,s){if(1&n&&e._UZ(0,"input",11),2&n){const t=e.oxw(2);e.Q6J("formControlName",t.setting)}}function fo(n,s){if(1&n&&(e.ynx(0),e._UZ(1,"br"),e.TgZ(2,"div",12),e._UZ(3,"input",13),e.TgZ(4,"label",14),e._uU(5,"Yes"),e.qZA()(),e.TgZ(6,"div",12),e._UZ(7,"input",13),e.TgZ(8,"label",14),e._uU(9,"No"),e.qZA()(),e.BQk()),2&n){const t=e.oxw(2);e.xp6(3),e.Q6J("id",t.setting+"True")("value",!0)("formControlName",t.setting),e.xp6(1),e.Q6J("for",t.setting+"True"),e.xp6(3),e.Q6J("id",t.setting+"False")("value",!1)("formControlName",t.setting),e.xp6(1),e.Q6J("for",t.setting+"False")}}function So(n,s){if(1&n&&(e.TgZ(0,"span"),e.YNc(1,ye,1,1,"input",8),e.YNc(2,To,1,1,"input",9),e.YNc(3,fo,10,8,"ng-container",3),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf","int"===t.limits.type),e.xp6(1),e.Q6J("ngIf","str"===t.limits.type),e.xp6(1),e.Q6J("ngIf","bool"===t.limits.type)}}function Co(n,s){if(1&n&&(e.TgZ(0,"span",15),e.ynx(1),e.SDv(2,16),e.BQk(),e.qZA()),2&n){const t=e.oxw();e.xp6(2),e.pQV(t.limits.min),e.QtT(2)}}function Eo(n,s){if(1&n&&(e.TgZ(0,"span",15),e.ynx(1),e.SDv(2,17),e.BQk(),e.qZA()),2&n){const t=e.oxw();e.xp6(2),e.pQV(t.limits.max),e.QtT(2)}}let Ct=(()=>{class n{ngOnInit(){const t=[];"min"in this.limits&&t.push(a.kI.min(Number(this.limits.min))),"max"in this.limits&&t.push(a.kI.max(Number(this.limits.max))),this.settingsForm.get(this.setting).setValidators(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-iscsi-setting"]],inputs:{settingsForm:"settingsForm",formDir:"formDir",setting:"setting",limits:"limits"},decls:7,vars:7,consts:function(){let s,t;return s="Must be greater than or equal to \n          " + "\ufffd0\ufffd" + ".\n        ",t="Must be less than or equal to \n          " + "\ufffd0\ufffd" + ".\n        ",[[1,"form-group",3,"formGroup"],[1,"col-form-label",3,"for"],["class","form-control",3,"id","name","formControlName",4,"ngIf"],[4,"ngIf"],["class","invalid-feedback",4,"ngIf"],[1,"form-control",3,"id","name","formControlName"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","number","class","form-control",3,"formControlName",4,"ngIf"],["type","text","class","form-control",3,"formControlName",4,"ngIf"],["type","number",1,"form-control",3,"formControlName"],["type","text",1,"form-control",3,"formControlName"],[1,"custom-control","custom-radio","custom-control-inline"],["type","radio",1,"custom-control-input",3,"id","value","formControlName"],[1,"custom-control-label",3,"for"],[1,"invalid-feedback"],s,t]},template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"label",1),e._uU(2),e.qZA(),e.YNc(3,K,3,5,"select",2),e.YNc(4,So,4,3,"span",3),e.YNc(5,Co,3,1,"span",4),e.YNc(6,Eo,3,1,"span",4),e.qZA()),2&t&&(e.Q6J("formGroup",o.settingsForm),e.xp6(1),e.s9C("for",o.setting),e.xp6(1),e.Oqu(o.setting),e.xp6(1),e.Q6J("ngIf","enum"===o.limits.type),e.xp6(1),e.Q6J("ngIf","enum"!==o.limits.type),e.xp6(1),e.Q6J("ngIf",o.settingsForm.showError(o.setting,o.formDir,"min")),e.xp6(1),e.Q6J("ngIf",o.settingsForm.showError(o.setting,o.formDir,"max")))},dependencies:[c.sg,c.O5,a.YN,a.Kr,a.Fj,a.wV,a.EJ,a._,a.JJ,a.JL,a.sg,a.u,L.o,g.b,T.P,b.V]}),n})();var je=m(88820);function Mo(n,s){1&n&&(e.TgZ(0,"span",29),e.SDv(1,30),e.qZA())}function Oo(n,s){if(1&n&&(e.TgZ(0,"span")(1,"legend",10),e.SDv(2,21),e.qZA(),e.TgZ(3,"div",12)(4,"div",13)(5,"label",22),e.SDv(6,23),e.qZA(),e._UZ(7,"input",24),e.YNc(8,Mo,2,0,"span",25),e.qZA()(),e.TgZ(9,"div",12)(10,"div",13)(11,"label",26),e.SDv(12,27),e.qZA(),e._UZ(13,"input",28),e.qZA()()()),2&n){const t=e.oxw(),o=e.MAs(9);e.xp6(8),e.Q6J("ngIf",t.settingsForm.showError("lun",o,"required"))}}function Ro(n,s){if(1&n&&(e.TgZ(0,"option",31),e._uU(1),e.ALo(2,"iscsiBackstore"),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(e.lcZ(2,2,t))}}function ho(n,s){if(1&n&&(e.TgZ(0,"div",12)(1,"div",13),e._UZ(2,"cd-iscsi-setting",33),e.qZA()()),2&n){const t=s.$implicit,o=e.oxw(2).$implicit,i=e.oxw(),_=e.MAs(9);e.xp6(2),e.Q6J("settingsForm",i.settingsForm)("formDir",_)("setting",t.key)("limits",i.getDiskControlLimits(o,t.key))}}function Ao(n,s){if(1&n&&(e.ynx(0),e.YNc(1,ho,3,4,"div",32),e.ALo(2,"keyvalue"),e.BQk()),2&n){const t=e.oxw().$implicit,o=e.oxw();e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,o.disk_default_controls[t]))}}function No(n,s){if(1&n&&(e.ynx(0),e.YNc(1,Ao,3,3,"ng-container",9),e.BQk()),2&n){const t=s.$implicit,o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.settingsForm.value.backstore===t)}}let Po=(()=>{class n{constructor(t,o,i){this.activeModal=t,this.iscsiService=o,this.actionLabels=i}ngOnInit(){const t={backstore:new a.p4(this.imagesSettings[this.image].backstore),lun:new a.p4(this.imagesSettings[this.image].lun),wwn:new a.p4(this.imagesSettings[this.image].wwn)};S().forEach(this.backstores,o=>{const i=this.imagesSettings[this.image][o]||{};S().forIn(this.disk_default_controls[o],(_,r)=>{t[r]=new a.p4(i[r])})}),this.settingsForm=new A.d(t)}getDiskControlLimits(t,o){return this.disk_controls_limits?this.disk_controls_limits[t][o]:{type:"int"}}save(){const t=this.settingsForm.controls.backstore.value,o=this.settingsForm.controls.lun.value,i=this.settingsForm.controls.wwn.value,_={};S().forIn(this.settingsForm.controls,(r,l)=>{""!==r.value&&null!==r.value&&l in this.disk_default_controls[this.settingsForm.value.backstore]&&(_[l]=r.value,S().forEach(this.backstores,d=>{d!==t&&l in(this.imagesSettings[this.image][d]||{})&&(this.imagesSettings[this.image][d][l]=r.value)}))}),this.imagesSettings[this.image].backstore=t,this.imagesSettings[this.image].lun=o,this.imagesSettings[this.image].wwn=i,this.imagesSettings[this.image][t]=_,this.imagesSettings={...this.imagesSettings},this.control.updateValueAndValidity({emitEvent:!1}),this.activeModal.close()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(P.Kz),e.Y36(J),e.Y36(E.p4))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-iscsi-target-image-settings-modal"]],decls:25,vars:8,consts:function(){let s,t,o,i,_,r,l,d;return s="Configure",t="\uAE30\uBCF8\uC124\uC815 \uAC12\uB4E4\uB85C \uBD80\uD130 \uC778\uC790\uB97C \uBCC0\uACBD\uD558\uB294 \uAC83\uC740 \uC77C\uBC18\uC801\uC73C\uB85C \uD544\uC694\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.",o="\uC124\uC815\uB4E4",i="Backstore",_="Identifier",r="lun",l="wwn",d="This field is required.",[[3,"modalRef"],[1,"modal-title"],s,[1,"modal-content"],["name","settingsForm","novalidate","",1,"form",3,"formGroup"],["formDir","ngForm"],[1,"modal-body"],[1,"alert-warning"],t,[4,"ngIf"],[1,"cd-header"],o,[1,"form-group","row"],[1,"col-sm-12"],[1,"col-form-label"],i,["id","backstore","name","backstore","formControlName","backstore",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"modal-footer"],[3,"form","submitText","submitActionEvent"],_,["for","lun",1,"col-form-label","required"],r,["type","number","id","lun","name","lun","formControlName","lun",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","wwn",1,"col-form-label"],l,["type","text","id","wwn","name","wwn","formControlName","wwn",1,"form-control"],[1,"invalid-feedback"],d,[3,"value"],["class","form-group row",4,"ngFor","ngForOf"],[3,"settingsForm","formDir","setting","limits"]]},template:function(t,o){1&t&&(e.TgZ(0,"cd-modal",0),e.ynx(1,1)(2),e.SDv(3,2),e.BQk(),e._uU(4,"\xa0 "),e.TgZ(5,"small"),e._uU(6),e.qZA(),e.BQk(),e.ynx(7,3),e.TgZ(8,"form",4,5)(10,"div",6)(11,"p",7),e.SDv(12,8),e.qZA(),e.YNc(13,Oo,14,1,"span",9),e.TgZ(14,"legend",10),e.SDv(15,11),e.qZA(),e.TgZ(16,"div",12)(17,"div",13)(18,"label",14),e.SDv(19,15),e.qZA(),e.TgZ(20,"select",16),e.YNc(21,Ro,3,4,"option",17),e.qZA()()(),e.YNc(22,No,2,1,"ng-container",18),e.qZA(),e.TgZ(23,"div",19)(24,"cd-form-button-panel",20),e.NdJ("submitActionEvent",function(){return o.save()}),e.qZA()()(),e.BQk(),e.qZA()),2&t&&(e.Q6J("modalRef",o.activeModal),e.xp6(6),e.Oqu(o.image),e.xp6(2),e.Q6J("formGroup",o.settingsForm),e.xp6(5),e.Q6J("ngIf",o.api_version>=1),e.xp6(8),e.Q6J("ngForOf",o.backstores),e.xp6(1),e.Q6J("ngForOf",o.backstores),e.xp6(2),e.Q6J("form",o.settingsForm)("submitText",o.actionLabels.UPDATE))},dependencies:[c.sg,c.O5,a._Y,a.YN,a.Kr,a.Fj,a.wV,a.EJ,a.JJ,a.JL,a.sg,a.u,Y.z,R.p,L.o,g.b,T.P,b.V,Ct,c.Nd,je.V]}),n})();function bo(n,s){if(1&n&&(e.TgZ(0,"div",12)(1,"div",13),e._UZ(2,"cd-iscsi-setting",14),e.qZA()()),2&n){const t=s.$implicit,o=e.oxw(),i=e.MAs(5);e.xp6(2),e.Q6J("settingsForm",o.settingsForm)("formDir",i)("setting",t.key)("limits",o.getTargetControlLimits(t.key))}}let Io=(()=>{class n{constructor(t,o,i){this.activeModal=t,this.iscsiService=o,this.actionLabels=i}ngOnInit(){const t={};S().forIn(this.target_default_controls,(o,i)=>{t[i]=new a.p4(this.target_controls.value[i])}),this.settingsForm=new A.d(t)}save(){const t={};S().forIn(this.settingsForm.controls,(o,i)=>{""===o.value||null===o.value||(t[i]=o.value)}),this.target_controls.setValue(t),this.activeModal.close()}getTargetControlLimits(t){return this.target_controls_limits?this.target_controls_limits[t]:["Yes","No"].includes(this.target_default_controls[t])?{type:"bool"}:{type:"int"}}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(P.Kz),e.Y36(J),e.Y36(E.p4))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-iscsi-target-iqn-settings-modal"]],decls:13,vars:7,consts:function(){let s,t;return s="\uACE0\uAE09\uC124\uC815\uB4E4",t="\uAE30\uBCF8\uC124\uC815 \uAC12\uB4E4\uB85C \uBD80\uD130 \uC778\uC790\uB97C \uBCC0\uACBD\uD558\uB294 \uAC83\uC740 \uC77C\uBC18\uC801\uC73C\uB85C \uD544\uC694\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.",[[3,"modalRef"],[1,"modal-title"],s,[1,"modal-content"],["name","settingsForm","novalidate","",3,"formGroup"],["formDir","ngForm"],[1,"modal-body"],[1,"alert-warning"],t,["class","form-group row",4,"ngFor","ngForOf"],[1,"modal-footer"],[3,"form","submitText","submitActionEvent"],[1,"form-group","row"],[1,"col-sm-12"],[3,"settingsForm","formDir","setting","limits"]]},template:function(t,o){1&t&&(e.TgZ(0,"cd-modal",0),e.ynx(1,1),e.SDv(2,2),e.BQk(),e.ynx(3,3),e.TgZ(4,"form",4,5)(6,"div",6)(7,"p",7),e.SDv(8,8),e.qZA(),e.YNc(9,bo,3,4,"div",9),e.ALo(10,"keyvalue"),e.qZA(),e.TgZ(11,"div",10)(12,"cd-form-button-panel",11),e.NdJ("submitActionEvent",function(){return o.save()}),e.qZA()()(),e.BQk(),e.qZA()),2&t&&(e.Q6J("modalRef",o.activeModal),e.xp6(4),e.Q6J("formGroup",o.settingsForm),e.xp6(5),e.Q6J("ngForOf",e.lcZ(10,5,o.settingsForm.controls)),e.xp6(3),e.Q6J("form",o.settingsForm)("submitText",o.actionLabels.UPDATE))},dependencies:[c.sg,a._Y,a.JL,a.sg,Y.z,R.p,T.P,b.V,Ct,c.Nd]}),n})();var ae=m(63285),Fo=m(39092),We=m(58039),Et=m(4416),vo=m(12594),Mt=m(63622),Fe=m(10545);function Lo(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,41),e.qZA())}function Do(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,42),e.qZA())}function $o(n,s){1&n&&(e.TgZ(0,"span",40),e.ynx(1),e.SDv(2,43),e.BQk(),e._UZ(3,"br"),e.ynx(4),e.SDv(5,44),e.BQk(),e._UZ(6,"br"),e.TgZ(7,"a",45),e.SDv(8,46),e.qZA()())}function Bo(n,s){1&n&&(e.TgZ(0,"span",47),e.SDv(1,48),e.qZA())}const te=function(n){return[n]};function Go(n,s){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",49),e._UZ(2,"input",50),e.TgZ(3,"button",51),e.NdJ("click",function(){const i=e.CHM(t),_=i.index,r=i.$implicit,l=e.oxw(2);return e.KtG(l.removePortal(_,r))}),e._UZ(4,"i",15),e.qZA()(),e.BQk()}if(2&n){const t=s.$implicit,o=e.oxw(2);e.xp6(2),e.Q6J("value",t),e.xp6(2),e.Q6J("ngClass",e.VKq(2,te,o.icons.destroy))}}function yo(n,s){if(1&n&&(e.TgZ(0,"span",40),e.SDv(1,52),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.pQV(t.minimum_gateways),e.QtT(1)}}function xo(n,s){if(1&n&&(e.TgZ(0,"div",55),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit,o=e.oxw(2);e.xp6(1),e.hij("lun: ",o.imagesSettings[t].lun,"")}}function Zo(n,s){if(1&n&&(e.ynx(0),e.SDv(1,56),e.ALo(2,"iscsiBackstore"),e.BQk()),2&n){const t=e.oxw().$implicit,o=e.oxw(2);e.xp6(2),e.pQV(e.lcZ(2,1,o.imagesSettings[t].backstore)),e.QtT(1)}}function wo(n,s){1&n&&(e.ynx(0),e.SDv(1,57),e.BQk())}function Ho(n,s){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",49),e._UZ(2,"input",50),e.YNc(3,xo,2,1,"div",53),e.TgZ(4,"button",51),e.NdJ("click",function(){const _=e.CHM(t).$implicit,r=e.oxw(2);return e.KtG(r.imageSettingsModal(_))}),e._UZ(5,"i",15),e.qZA(),e.TgZ(6,"button",51),e.NdJ("click",function(){const i=e.CHM(t),_=i.index,r=i.$implicit,l=e.oxw(2);return e.KtG(l.removeImage(_,r))}),e._UZ(7,"i",15),e.qZA()(),e.TgZ(8,"span",47),e.YNc(9,Zo,3,3,"ng-container",54),e.YNc(10,wo,2,0,"ng-container",54),e.qZA(),e.BQk()}if(2&n){const t=s.$implicit,o=e.oxw(2);e.xp6(2),e.Q6J("value",t),e.xp6(1),e.Q6J("ngIf",o.api_version>=1),e.xp6(2),e.Q6J("ngClass",e.VKq(6,te,o.icons.deepCheck)),e.xp6(2),e.Q6J("ngClass",e.VKq(8,te,o.icons.destroy)),e.xp6(2),e.Q6J("ngIf",o.backstores.length>1),e.xp6(1),e.Q6J("ngIf",o.hasAdvancedSettings(o.imagesSettings[t][o.imagesSettings[t].backstore]))}}function qo(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,58),e.qZA())}function Ko(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,59),e.qZA())}function ko(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,77),e.qZA())}function Vo(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,78),e.qZA())}function Qo(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,79),e.qZA())}function Xo(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,80),e.qZA())}function Yo(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,81),e.qZA())}function zo(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,82),e.qZA())}function Jo(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,83),e.qZA())}function Uo(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,84),e.qZA())}function jo(n,s){if(1&n&&(e.TgZ(0,"div",60)(1,"div",8)(2,"label",61),e.ynx(3),e.SDv(4,62),e.BQk(),e.qZA(),e.TgZ(5,"div",11),e._UZ(6,"input",63),e.YNc(7,ko,2,0,"span",16),e.YNc(8,Vo,2,0,"span",16),e.qZA()(),e.TgZ(9,"div",8)(10,"label",64),e.ynx(11),e.SDv(12,65),e.BQk(),e.qZA(),e.TgZ(13,"div",11)(14,"div",12),e._UZ(15,"input",66)(16,"button",67)(17,"cd-copy-2-clipboard-button",68),e.qZA(),e.YNc(18,Qo,2,0,"span",16),e.YNc(19,Xo,2,0,"span",16),e.qZA()(),e.TgZ(20,"div",8)(21,"label",69),e.ynx(22),e.SDv(23,70),e.BQk(),e.qZA(),e.TgZ(24,"div",11),e._UZ(25,"input",71),e.YNc(26,Yo,2,0,"span",16),e.YNc(27,zo,2,0,"span",16),e.qZA()(),e.TgZ(28,"div",8)(29,"label",72),e.ynx(30),e.SDv(31,73),e.BQk(),e.qZA(),e.TgZ(32,"div",11)(33,"div",12),e._UZ(34,"input",74)(35,"button",75)(36,"cd-copy-2-clipboard-button",76),e.qZA(),e.YNc(37,Jo,2,0,"span",16),e.YNc(38,Uo,2,0,"span",16),e.qZA()()()),2&n){e.oxw();const t=e.MAs(2),o=e.oxw();e.xp6(7),e.Q6J("ngIf",o.targetForm.showError("user",t,"required")),e.xp6(1),e.Q6J("ngIf",o.targetForm.showError("user",t,"pattern")),e.xp6(10),e.Q6J("ngIf",o.targetForm.showError("password",t,"required")),e.xp6(1),e.Q6J("ngIf",o.targetForm.showError("password",t,"pattern")),e.xp6(7),e.Q6J("ngIf",o.targetForm.showError("mutual_user",t,"required")),e.xp6(1),e.Q6J("ngIf",o.targetForm.showError("mutual_user",t,"pattern")),e.xp6(10),e.Q6J("ngIf",o.targetForm.showError("mutual_password",t,"required")),e.xp6(1),e.Q6J("ngIf",o.targetForm.showError("mutual_password",t,"pattern"))}}function Wo(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,114),e.qZA())}function en(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,115),e.qZA())}function tn(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,116),e.qZA())}function on(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,117),e.qZA())}function nn(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,118),e.qZA())}function sn(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,119),e.qZA())}function _n(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,120),e.qZA())}function an(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,121),e.qZA())}function rn(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,122),e.qZA())}function ln(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,123),e.qZA())}function cn(n,s){1&n&&(e.TgZ(0,"span",40),e.SDv(1,124),e.qZA())}function dn(n,s){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",49),e._UZ(2,"input",50),e.TgZ(3,"button",51),e.NdJ("click",function(){const i=e.CHM(t),_=i.index,r=i.$implicit,l=e.oxw(),d=l.$implicit,u=l.index,f=e.oxw(3);return e.KtG(f.removeInitiatorImage(d,_,u,r))}),e._UZ(4,"i",15),e.qZA()(),e.BQk()}if(2&n){const t=s.$implicit,o=e.oxw(4);e.xp6(2),e.Q6J("value",t),e.xp6(2),e.Q6J("ngClass",e.VKq(2,te,o.icons.destroy))}}function mn(n,s){1&n&&(e.TgZ(0,"span"),e.SDv(1,125),e.qZA())}function pn(n,s){if(1&n&&(e.TgZ(0,"div",21)(1,"div",22)(2,"cd-select",126),e._UZ(3,"i",24),e.ynx(4),e.SDv(5,127),e.BQk(),e.qZA()()()),2&n){const t=e.oxw(),o=t.$implicit,i=t.index,_=e.oxw(3);e.xp6(2),e.Q6J("data",o.getValue("luns"))("options",_.imagesInitiatorSelections[i])("messages",_.messages.initiatorImage),e.xp6(1),e.Q6J("ngClass",e.VKq(4,te,_.icons.add))}}function un(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",91)(1,"div",5),e.ynx(2),e.SDv(3,92),e.BQk(),e._uU(4),e.TgZ(5,"button",93),e.NdJ("click",function(){const _=e.CHM(t).index,r=e.oxw(3);return e.KtG(r.removeInitiator(_))}),e.qZA()(),e.TgZ(6,"div",7)(7,"div",8)(8,"label",94),e.SDv(9,95),e.qZA(),e.TgZ(10,"div",11)(11,"input",96),e.NdJ("blur",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.updatedInitiatorSelector())}),e.qZA(),e.YNc(12,Wo,2,0,"span",16),e.YNc(13,en,2,0,"span",16),e.YNc(14,tn,2,0,"span",16),e.qZA()(),e.ynx(15,60),e.TgZ(16,"div",8)(17,"label",97),e.SDv(18,98),e.qZA(),e.TgZ(19,"div",11),e._UZ(20,"input",99),e.YNc(21,on,2,0,"span",16),e.YNc(22,nn,2,0,"span",16),e.qZA()(),e.TgZ(23,"div",8)(24,"label",100),e.SDv(25,101),e.qZA(),e.TgZ(26,"div",11)(27,"div",12),e._UZ(28,"input",102)(29,"button",103)(30,"cd-copy-2-clipboard-button",104),e.qZA(),e.YNc(31,sn,2,0,"span",16),e.YNc(32,_n,2,0,"span",16),e.qZA()(),e.TgZ(33,"div",8)(34,"label",105),e.ynx(35),e.SDv(36,106),e.BQk(),e.qZA(),e.TgZ(37,"div",11),e._UZ(38,"input",107),e.YNc(39,an,2,0,"span",16),e.YNc(40,rn,2,0,"span",16),e.qZA()(),e.TgZ(41,"div",8)(42,"label",108),e.SDv(43,109),e.qZA(),e.TgZ(44,"div",11)(45,"div",12),e._UZ(46,"input",110)(47,"button",103)(48,"cd-copy-2-clipboard-button",104),e.qZA(),e.YNc(49,ln,2,0,"span",16),e.YNc(50,cn,2,0,"span",16),e.qZA()(),e.BQk(),e.TgZ(51,"div",8)(52,"label",111),e.SDv(53,112),e.qZA(),e.TgZ(54,"div",11),e.YNc(55,dn,5,4,"ng-container",20),e.YNc(56,mn,2,0,"span",54),e.YNc(57,pn,6,6,"div",113),e.qZA()()()()}if(2&n){const t=s.$implicit,o=s.index;e.oxw(2);const i=e.MAs(2);e.Q6J("formGroup",t),e.xp6(4),e.hij(": ",t.getValue("client_iqn")," "),e.xp6(8),e.Q6J("ngIf",t.showError("client_iqn",i,"notUnique")),e.xp6(1),e.Q6J("ngIf",t.showError("client_iqn",i,"required")),e.xp6(1),e.Q6J("ngIf",t.showError("client_iqn",i,"pattern")),e.xp6(6),e.Q6J("id","user"+o),e.xp6(1),e.Q6J("ngIf",t.showError("user",i,"required")),e.xp6(1),e.Q6J("ngIf",t.showError("user",i,"pattern")),e.xp6(6),e.Q6J("id","password"+o),e.xp6(1),e.Q6J("cdPasswordButton","password"+o),e.xp6(1),e.Q6J("source","password"+o),e.xp6(1),e.Q6J("ngIf",t.showError("password",i,"required")),e.xp6(1),e.Q6J("ngIf",t.showError("password",i,"pattern")),e.xp6(6),e.Q6J("id","mutual_user"+o),e.xp6(1),e.Q6J("ngIf",t.showError("mutual_user",i,"required")),e.xp6(1),e.Q6J("ngIf",t.showError("mutual_user",i,"pattern")),e.xp6(6),e.Q6J("id","mutual_password"+o),e.xp6(1),e.Q6J("cdPasswordButton","mutual_password"+o),e.xp6(1),e.Q6J("source","mutual_password"+o),e.xp6(1),e.Q6J("ngIf",t.showError("mutual_password",i,"required")),e.xp6(1),e.Q6J("ngIf",t.showError("mutual_password",i,"pattern")),e.xp6(5),e.Q6J("ngForOf",t.getValue("luns")),e.xp6(1),e.Q6J("ngIf",t.getValue("cdIsInGroup")),e.xp6(1),e.Q6J("ngIf",!t.getValue("cdIsInGroup"))}}function gn(n,s){1&n&&(e.TgZ(0,"span",47),e.SDv(1,128),e.qZA())}function Tn(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",8)(1,"label",85),e.SDv(2,86),e.qZA(),e.TgZ(3,"div",87),e.YNc(4,un,58,24,"div",88),e.TgZ(5,"div",21)(6,"div",22),e.YNc(7,gn,2,0,"span",17),e.TgZ(8,"button",89),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).addInitiator(),e.KtG(!1)}),e._UZ(9,"i",24),e.ynx(10),e.SDv(11,90),e.BQk(),e.qZA()()(),e._UZ(12,"hr"),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(4),e.Q6J("ngForOf",t.initiators.controls),e.xp6(3),e.Q6J("ngIf",0===t.initiators.controls.length),e.xp6(2),e.Q6J("ngClass",e.VKq(3,te,t.icons.add))}}function fn(n,s){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",49),e._UZ(2,"input",50),e.TgZ(3,"button",51),e.NdJ("click",function(){const _=e.CHM(t).index,r=e.oxw(),l=r.$implicit,d=r.index,u=e.oxw(3);return e.KtG(u.removeGroupInitiator(l,_,d))}),e._UZ(4,"i",15),e.qZA()(),e.BQk()}if(2&n){const t=s.$implicit,o=e.oxw(4);e.xp6(2),e.Q6J("value",t),e.xp6(2),e.Q6J("ngClass",e.VKq(2,te,o.icons.destroy))}}function Sn(n,s){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",49),e._UZ(2,"input",50),e.TgZ(3,"button",51),e.NdJ("click",function(){const _=e.CHM(t).index,r=e.oxw(),l=r.$implicit,d=r.index,u=e.oxw(3);return e.KtG(u.removeGroupDisk(l,_,d))}),e._UZ(4,"i",15),e.qZA()(),e.BQk()}if(2&n){const t=s.$implicit,o=e.oxw(4);e.xp6(2),e.Q6J("value",t),e.xp6(2),e.Q6J("ngClass",e.VKq(2,te,o.icons.destroy))}}function Cn(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",91)(1,"div",5),e.ynx(2),e.SDv(3,132),e.BQk(),e._uU(4),e.TgZ(5,"button",93),e.NdJ("click",function(){const _=e.CHM(t).index,r=e.oxw(3);return e.KtG(r.removeGroup(_))}),e.qZA()(),e.TgZ(6,"div",7)(7,"div",8)(8,"label",133),e.SDv(9,134),e.qZA(),e.TgZ(10,"div",11),e._UZ(11,"input",135),e.qZA()(),e.TgZ(12,"div",8)(13,"label",136),e.ynx(14),e.SDv(15,137),e.BQk(),e.qZA(),e.TgZ(16,"div",11),e.YNc(17,fn,5,4,"ng-container",20),e.TgZ(18,"div",21)(19,"div",22)(20,"cd-select",23),e.NdJ("selection",function(i){const r=e.CHM(t).index,l=e.oxw(3);return e.KtG(l.onGroupMemberSelection(i,r))}),e._UZ(21,"i",24),e.ynx(22),e.SDv(23,138),e.BQk(),e.qZA()()(),e._UZ(24,"hr"),e.qZA()(),e.TgZ(25,"div",8)(26,"label",27),e.ynx(27),e.SDv(28,139),e.BQk(),e.qZA(),e.TgZ(29,"div",11),e.YNc(30,Sn,5,4,"ng-container",20),e.TgZ(31,"div",21)(32,"div",22)(33,"cd-select",126),e._UZ(34,"i",24),e.ynx(35),e.SDv(36,140),e.BQk(),e.qZA()()(),e._UZ(37,"hr"),e.qZA()()()()}if(2&n){const t=s.$implicit,o=s.index,i=e.oxw(3);e.Q6J("formGroup",t),e.xp6(4),e.hij(": ",t.getValue("group_id")," "),e.xp6(13),e.Q6J("ngForOf",t.getValue("members")),e.xp6(3),e.Q6J("data",t.getValue("members"))("options",i.groupMembersSelections[o])("messages",i.messages.groupInitiator),e.xp6(1),e.Q6J("ngClass",e.VKq(12,te,i.icons.add)),e.xp6(9),e.Q6J("ngForOf",t.getValue("disks")),e.xp6(3),e.Q6J("data",t.getValue("disks"))("options",i.groupDiskSelections[o])("messages",i.messages.initiatorImage),e.xp6(1),e.Q6J("ngClass",e.VKq(14,te,i.icons.add))}}function En(n,s){1&n&&(e.TgZ(0,"span",47),e.SDv(1,141),e.qZA())}function Mn(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",8)(1,"label",85),e.SDv(2,129),e.qZA(),e.TgZ(3,"div",130),e.YNc(4,Cn,38,16,"div",88),e.TgZ(5,"div",21)(6,"div",22),e.YNc(7,En,2,0,"span",17),e.TgZ(8,"button",89),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).addGroup(),e.KtG(!1)}),e._UZ(9,"i",24),e.ynx(10),e.SDv(11,131),e.BQk(),e.qZA()()()()()}if(2&n){const t=e.oxw(2);e.xp6(4),e.Q6J("ngForOf",t.groups.controls),e.xp6(3),e.Q6J("ngIf",0===t.groups.controls.length),e.xp6(2),e.Q6J("ngClass",e.VKq(3,te,t.icons.add))}}function On(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",1)(1,"form",2,3)(3,"div",4)(4,"div",5),e.SDv(5,6),e.ALo(6,"titlecase"),e.ALo(7,"upperFirst"),e.qZA(),e.TgZ(8,"div",7)(9,"div",8)(10,"label",9),e.SDv(11,10),e.qZA(),e.TgZ(12,"div",11)(13,"div",12),e._UZ(14,"input",13),e.TgZ(15,"button",14),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.targetSettingsModal())}),e._UZ(16,"i",15),e.qZA()(),e.YNc(17,Lo,2,0,"span",16),e.YNc(18,Do,2,0,"span",16),e.YNc(19,$o,9,0,"span",16),e.YNc(20,Bo,2,0,"span",17),e._UZ(21,"hr"),e.qZA()(),e.TgZ(22,"div",8)(23,"label",18),e.SDv(24,19),e.qZA(),e.TgZ(25,"div",11),e.YNc(26,Go,5,4,"ng-container",20),e.TgZ(27,"div",21)(28,"div",22)(29,"cd-select",23),e.NdJ("selection",function(i){e.CHM(t);const _=e.oxw();return e.KtG(_.onPortalSelection(i))}),e._UZ(30,"i",24),e.ynx(31),e.SDv(32,25),e.BQk(),e.qZA()()(),e._UZ(33,"input",26),e.YNc(34,yo,2,1,"span",16),e._UZ(35,"hr"),e.qZA()(),e.TgZ(36,"div",8)(37,"label",27),e.SDv(38,28),e.qZA(),e.TgZ(39,"div",11),e.YNc(40,Ho,11,10,"ng-container",20),e._UZ(41,"input",29),e.YNc(42,qo,2,0,"span",16),e.YNc(43,Ko,2,0,"span",16),e.TgZ(44,"div",21)(45,"div",22)(46,"cd-select",23),e.NdJ("selection",function(i){e.CHM(t);const _=e.oxw();return e.KtG(_.onImageSelection(i))}),e._UZ(47,"i",24),e.ynx(48),e.SDv(49,30),e.BQk(),e.qZA()()(),e._UZ(50,"hr"),e.qZA()(),e.TgZ(51,"div",8)(52,"div",31)(53,"div",32),e._UZ(54,"input",33),e.TgZ(55,"label",34),e.SDv(56,35),e.qZA()(),e._UZ(57,"hr"),e.qZA()(),e.YNc(58,jo,39,8,"div",36),e.YNc(59,Tn,13,5,"div",37),e.YNc(60,Mn,12,5,"div",37),e.qZA(),e.TgZ(61,"div",38)(62,"cd-form-button-panel",39),e.NdJ("submitActionEvent",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.submit())}),e.ALo(63,"titlecase"),e.ALo(64,"upperFirst"),e.qZA()()()()()}if(2&n){const t=e.MAs(2),o=e.oxw();e.xp6(1),e.Q6J("formGroup",o.targetForm),e.xp6(6),e.pQV(e.lcZ(6,26,o.action))(e.lcZ(7,28,o.resource)),e.QtT(5),e.xp6(9),e.Q6J("ngClass",e.VKq(34,te,o.icons.deepCheck)),e.xp6(1),e.Q6J("ngIf",o.targetForm.showError("target_iqn",t,"required")),e.xp6(1),e.Q6J("ngIf",o.targetForm.showError("target_iqn",t,"pattern")),e.xp6(1),e.Q6J("ngIf",o.targetForm.showError("target_iqn",t,"iqn")),e.xp6(1),e.Q6J("ngIf",o.hasAdvancedSettings(o.targetForm.getValue("target_controls"))),e.xp6(6),e.Q6J("ngForOf",o.portals.value),e.xp6(3),e.Q6J("data",o.portals.value)("options",o.portalsSelections)("messages",o.messages.portals),e.xp6(1),e.Q6J("ngClass",e.VKq(36,te,o.icons.add)),e.xp6(4),e.Q6J("ngIf",o.targetForm.showError("portals",t,"minGateways")),e.xp6(6),e.Q6J("ngForOf",o.targetForm.getValue("disks")),e.xp6(2),e.Q6J("ngIf",o.targetForm.showError("disks",t,"dupLunId")),e.xp6(1),e.Q6J("ngIf",o.targetForm.showError("disks",t,"dupWwn")),e.xp6(3),e.Q6J("data",o.disks.value)("options",o.imagesSelections)("messages",o.messages.images),e.xp6(1),e.Q6J("ngClass",e.VKq(38,te,o.icons.add)),e.xp6(11),e.Q6J("ngIf",o.cephIscsiConfigVersion>10&&!o.targetForm.getValue("acl_enabled")),e.xp6(1),e.Q6J("ngIf",o.targetForm.getValue("acl_enabled")),e.xp6(1),e.Q6J("ngIf",o.targetForm.getValue("acl_enabled")),e.xp6(2),e.Q6J("form",o.targetForm)("submitText",e.lcZ(63,30,o.action)+" "+e.lcZ(64,32,o.resource))}}let Ot=(()=>{class n extends $e.E{constructor(t,o,i,_,r,l,d){super(),this.iscsiService=t,this.modalService=o,this.rbdService=i,this.router=_,this.route=r,this.taskWrapper=l,this.actionLabels=d,this.api_version=0,this.minimum_gateways=1,this.icons=C.P,this.isEdit=!1,this.portalsSelections=[],this.imagesInitiatorSelections=[],this.groupDiskSelections=[],this.groupMembersSelections=[],this.imagesSettings={},this.messages={portals:new Me.a({noOptions:"There are no portals available."}),images:new Me.a({noOptions:"There are no images available."}),initiatorImage:new Me.a({noOptions:"There are no images available. Please make sure you add an image to the target."}),groupInitiator:new Me.a({noOptions:"There are no initiators available. Please make sure you add an initiator to the target."})},this.IQN_REGEX=/^iqn\.(19|20)\d\d-(0[1-9]|1[0-2])\.\D{2,3}(\.[A-Za-z0-9-]+)+(:[A-Za-z0-9-\.]+)*$/,this.USER_REGEX=/^[\w\.:@_-]{8,64}$/,this.PASSWORD_REGEX=/^[\w@\-_\/]{12,16}$/,this.resource="target"}ngOnInit(){const t=new $.E(()=>{});t.pageInfo.limit=-1;const o=[this.iscsiService.listTargets(),this.rbdService.list(t.toParams()),this.iscsiService.portals(),this.iscsiService.settings(),this.iscsiService.version()];this.router.url.startsWith("/block/iscsi/targets/edit")&&(this.isEdit=!0,this.route.params.subscribe(i=>{this.target_iqn=decodeURIComponent(i.target_iqn),o.push(this.iscsiService.getTarget(this.target_iqn))})),this.action=this.isEdit?this.actionLabels.EDIT:this.actionLabels.CREATE,(0,ge.D)(o).subscribe(i=>{const _=S()(i[0]).filter(l=>l.target_iqn!==this.target_iqn).flatMap(l=>l.disks).map(l=>`${l.pool}/${l.image}`).value();"api_version"in i[3]&&(this.api_version=i[3].api_version),this.minimum_gateways=i[3].config.minimum_gateways,this.target_default_controls=i[3].target_default_controls,this.target_controls_limits=i[3].target_controls_limits,this.disk_default_controls=i[3].disk_default_controls,this.disk_controls_limits=i[3].disk_controls_limits,this.backstores=i[3].backstores,this.default_backstore=i[3].default_backstore,this.unsupported_rbd_features=i[3].unsupported_rbd_features,this.required_rbd_features=i[3].required_rbd_features,this.imagesAll=S()(i[1]).flatMap(l=>l.value).filter(l=>!l.namespace&&!(-1!==_.indexOf(`${l.pool_name}/${l.name}`)||0===this.getValidBackstores(l).length)).value(),this.imagesSelections=this.imagesAll.map(l=>new ee.$(!1,`${l.pool_name}/${l.name}`,""));const r=[];i[2].forEach(l=>{l.ip_addresses.forEach(d=>{r.push(new ee.$(!1,l.name+":"+d,""))})}),this.portalsSelections=[...r],this.cephIscsiConfigVersion=i[4].ceph_iscsi_config_version,this.createForm(),i[5]&&this.resolveModel(i[5]),this.loadingReady()})}createForm(){if(this.targetForm=new A.d({target_iqn:new a.p4("iqn.2001-07.com.ceph:"+Date.now(),{validators:[a.kI.required,a.kI.pattern(this.IQN_REGEX)]}),target_controls:new a.p4({}),portals:new a.p4([],{validators:[v.hq.custom("minGateways",t=>S().uniq(t.map(i=>i.split(":")[0])).length<Math.max(1,this.minimum_gateways))]}),disks:new a.p4([],{validators:[v.hq.custom("dupLunId",t=>{const o=this.getLunIds(t);return o.length!==S().uniq(o).length}),v.hq.custom("dupWwn",t=>{const o=this.getWwns(t);return o.length!==S().uniq(o).length})]}),initiators:new a.vC([]),groups:new a.vC([]),acl_enabled:new a.p4(!1)}),this.cephIscsiConfigVersion>10){const t=new A.d({user:new a.p4(""),password:new a.p4(""),mutual_user:new a.p4(""),mutual_password:new a.p4("")});this.setAuthValidator(t),this.targetForm.addControl("auth",t)}}resolveModel(t){this.targetForm.patchValue({target_iqn:t.target_iqn,target_controls:t.target_controls,acl_enabled:t.acl_enabled}),this.cephIscsiConfigVersion>10&&this.targetForm.patchValue({auth:t.auth});const o=[];S().forEach(t.portals,_=>{o.push(`${_.host}:${_.ip}`)}),this.targetForm.patchValue({portals:o});const i=[];S().forEach(t.disks,_=>{const r=`${_.pool}/${_.image}`;i.push(r),this.imagesSettings[r]={backstore:_.backstore},this.imagesSettings[r][_.backstore]=_.controls,"lun"in _&&(this.imagesSettings[r].lun=_.lun),"wwn"in _&&(this.imagesSettings[r].wwn=_.wwn),this.onImageSelection({option:{name:r,selected:!0}})}),this.targetForm.patchValue({disks:i}),S().forEach(t.clients,_=>{const r=this.addInitiator();_.luns=S().map(_.luns,l=>`${l.pool}/${l.image}`),r.patchValue(_)}),t.groups.forEach((_,r)=>{const l=this.addGroup();_.disks=S().map(_.disks,d=>`${d.pool}/${d.image}`),l.patchValue(_),S().forEach(_.members,d=>{this.onGroupMemberSelection({option:new ee.$(!0,d,"")},r)})})}hasAdvancedSettings(t){return Object.values(t).length>0}get portals(){return this.targetForm.get("portals")}onPortalSelection(){this.portals.setValue(this.portals.value)}removePortal(t,o){return this.portalsSelections.forEach(i=>{i.name===o&&(i.selected=!1)}),this.portals.value.splice(t,1),this.portals.setValue(this.portals.value),!1}get disks(){return this.targetForm.get("disks")}removeImage(t,o){return this.imagesSelections.forEach(i=>{i.name===o&&(i.selected=!1)}),this.disks.value.splice(t,1),this.removeImageRefs(o),this.targetForm.get("disks").updateValueAndValidity({emitEvent:!1}),!1}removeImageRefs(t){this.initiators.controls.forEach(o=>{const i=o.value.luns.filter(_=>_!==t);o.get("luns").setValue(i)}),this.groups.controls.forEach(o=>{const i=o.value.disks.filter(_=>_!==t);o.get("disks").setValue(i)}),S().forEach(this.imagesInitiatorSelections,(o,i)=>{this.imagesInitiatorSelections[i]=o.filter(_=>_.name!==t)}),S().forEach(this.groupDiskSelections,(o,i)=>{this.groupDiskSelections[i]=o.filter(_=>_.name!==t)})}getDefaultBackstore(t){let o=this.default_backstore;const i=this.getImageById(t);return this.validFeatures(i,this.default_backstore)||this.backstores.forEach(_=>{_!==this.default_backstore&&this.validFeatures(i,_)&&(o=_)}),o}isLunIdInUse(t,o){const i=this.disks.value.filter(_=>_!==o);return this.getLunIds(i).includes(t)}getLunIds(t){return S().map(t,o=>this.imagesSettings[o].lun)}nextLunId(t){const o=this.disks.value.filter(r=>r!==t),i=this.getLunIds(o);let _=0;for(;i.includes(_);)_++;return _}getWwns(t){return S().map(t,i=>this.imagesSettings[i].wwn).filter(i=>S().isString(i)&&""!==i)}onImageSelection(t){const o=t.option;if(o.selected){if(this.imagesSettings[o.name])this.isLunIdInUse(this.imagesSettings[o.name].lun,o.name)&&(this.imagesSettings[o.name].lun=this.nextLunId(o.name));else{const i=this.getDefaultBackstore(o.name);this.imagesSettings[o.name]={backstore:i,lun:this.nextLunId(o.name)},this.imagesSettings[o.name][i]={}}S().forEach(this.imagesInitiatorSelections,(i,_)=>{i.push(new ee.$(!1,o.name,"")),this.imagesInitiatorSelections[_]=[...i]}),S().forEach(this.groupDiskSelections,(i,_)=>{i.push(new ee.$(!1,o.name,"")),this.groupDiskSelections[_]=[...i]})}else this.removeImageRefs(o.name);this.targetForm.get("disks").updateValueAndValidity({emitEvent:!1})}get initiators(){return this.targetForm.get("initiators")}addInitiator(){const t=new A.d({client_iqn:new a.p4("",{validators:[a.kI.required,v.hq.custom("notUnique",i=>{const _=this.initiators.controls.reduce(function(r,l){return r.concat(l.value.client_iqn)},[]);return _.indexOf(i)!==_.lastIndexOf(i)}),a.kI.pattern(this.IQN_REGEX)]}),auth:new A.d({user:new a.p4(""),password:new a.p4(""),mutual_user:new a.p4(""),mutual_password:new a.p4("")}),luns:new a.p4([]),cdIsInGroup:new a.p4(!1)});this.setAuthValidator(t),this.initiators.push(t),S().forEach(this.groupMembersSelections,(i,_)=>{i.push(new ee.$(!1,"","")),this.groupMembersSelections[_]=[...i]});const o=S().map(this.targetForm.getValue("disks"),i=>new ee.$(!1,i,""));return this.imagesInitiatorSelections.push(o),t}setAuthValidator(t){v.hq.validateIf(t.get("user"),()=>t.getValue("password")||t.getValue("mutual_user")||t.getValue("mutual_password"),[a.kI.required],[a.kI.pattern(this.USER_REGEX)],[t.get("password"),t.get("mutual_user"),t.get("mutual_password")]),v.hq.validateIf(t.get("password"),()=>t.getValue("user")||t.getValue("mutual_user")||t.getValue("mutual_password"),[a.kI.required],[a.kI.pattern(this.PASSWORD_REGEX)],[t.get("user"),t.get("mutual_user"),t.get("mutual_password")]),v.hq.validateIf(t.get("mutual_user"),()=>t.getValue("mutual_password"),[a.kI.required],[a.kI.pattern(this.USER_REGEX)],[t.get("user"),t.get("password"),t.get("mutual_password")]),v.hq.validateIf(t.get("mutual_password"),()=>t.getValue("mutual_user"),[a.kI.required],[a.kI.pattern(this.PASSWORD_REGEX)],[t.get("user"),t.get("password"),t.get("mutual_user")])}removeInitiator(t){const o=this.initiators.value[t];this.initiators.removeAt(t),S().forEach(this.groupMembersSelections,(i,_)=>{i.splice(t,1),this.groupMembersSelections[_]=[...i]}),this.groups.controls.forEach(i=>{const _=i.value.members.filter(r=>r!==o.client_iqn);i.get("members").setValue(_)}),this.imagesInitiatorSelections.splice(t,1)}updatedInitiatorSelector(){this.initiators.controls.forEach(t=>{t.get("client_iqn").updateValueAndValidity({emitEvent:!1})}),S().forEach(this.groupMembersSelections,(t,o)=>{S().forEach(t,(i,_)=>{const r=i.name;i.name=this.initiators.controls[_].value.client_iqn,this.groups.controls.forEach(l=>{const d=l.value.members,u=d.indexOf(r);-1!==u&&(d[u]=i.name),l.get("members").setValue(d)})}),this.groupMembersSelections[o]=[...this.groupMembersSelections[o]]})}removeInitiatorImage(t,o,i,_){const r=t.getValue("luns");return r.splice(o,1),t.patchValue({luns:r}),this.imagesInitiatorSelections[i].forEach(l=>{l.name===_&&(l.selected=!1)}),!1}get groups(){return this.targetForm.get("groups")}addGroup(){const t=new A.d({group_id:new a.p4("",{validators:[a.kI.required]}),members:new a.p4([]),disks:new a.p4([])});this.groups.push(t);const o=S().map(this.targetForm.getValue("disks"),_=>new ee.$(!1,_,""));this.groupDiskSelections.push(o);const i=S().map(this.initiators.value,_=>new ee.$(!1,_.client_iqn,"",!_.cdIsInGroup));return this.groupMembersSelections.push(i),t}removeGroup(t){this.groups.removeAt(t),this.groupMembersSelections[t].filter(i=>i.selected).forEach(i=>{i.selected=!1,this.onGroupMemberSelection({option:i},t)}),this.groupMembersSelections.splice(t,1),this.groupDiskSelections.splice(t,1)}onGroupMemberSelection(t,o){const i=t.option;let _=[];i.selected||(_=this.groupDiskSelections[o].filter(l=>l.selected).map(l=>l.name)),this.initiators.controls.forEach((r,l)=>{r.value.client_iqn===i.name&&(r.patchValue({luns:_}),r.get("cdIsInGroup").setValue(i.selected),S().forEach(this.groupMembersSelections,d=>{d[l].enabled=!i.selected}),this.imagesInitiatorSelections[l].forEach(d=>{d.selected=_.includes(d.name)}))})}removeGroupInitiator(t,o,i){const _=t.getValue("members")[o];t.getValue("members").splice(o,1),this.onGroupMemberSelection({option:new ee.$(!1,_,"")},i)}removeGroupDisk(t,o,i){const _=t.getValue("disks")[o];t.getValue("disks").splice(o,1),this.groupDiskSelections[i].forEach(r=>{r.name===_&&(r.selected=!1)}),this.groupDiskSelections[i]=[...this.groupDiskSelections[i]]}submit(){const t=S().cloneDeep(this.targetForm.value),o={target_iqn:this.targetForm.getValue("target_iqn"),target_controls:this.targetForm.getValue("target_controls"),acl_enabled:this.targetForm.getValue("acl_enabled"),portals:[],disks:[],clients:[],groups:[]};if(this.cephIscsiConfigVersion>10){const _=this.targetForm.get("auth");_.getValue("user")||_.get("user").setValue(""),_.getValue("password")||_.get("password").setValue(""),_.getValue("mutual_user")||_.get("mutual_user").setValue(""),_.getValue("mutual_password")||_.get("mutual_password").setValue("");const r=this.targetForm.getValue("acl_enabled");o.auth={user:r?"":_.getValue("user"),password:r?"":_.getValue("password"),mutual_user:r?"":_.getValue("mutual_user"),mutual_password:r?"":_.getValue("mutual_password")}}let i;t.disks.forEach(_=>{const r=_.split("/"),l=this.imagesSettings[_].backstore;o.disks.push({pool:r[0],image:r[1],backstore:l,controls:this.imagesSettings[_][l],lun:this.imagesSettings[_].lun,wwn:this.imagesSettings[_].wwn})}),t.portals.forEach(_=>{const r=_.indexOf(":");o.portals.push({host:_.substring(0,r),ip:_.substring(r+1)})}),o.acl_enabled&&(t.initiators.forEach(_=>{_.auth.user||(_.auth.user=""),_.auth.password||(_.auth.password=""),_.auth.mutual_user||(_.auth.mutual_user=""),_.auth.mutual_password||(_.auth.mutual_password=""),delete _.cdIsInGroup;const r=[];_.luns.forEach(l=>{const d=l.split("/");r.push({pool:d[0],image:d[1]})}),_.luns=r}),o.clients=t.initiators),o.acl_enabled&&(t.groups.forEach(_=>{const r=[];_.disks.forEach(l=>{const d=l.split("/");r.push({pool:d[0],image:d[1]})}),_.disks=r}),o.groups=t.groups),this.isEdit?(o.new_target_iqn=o.target_iqn,o.target_iqn=this.target_iqn,i=this.taskWrapper.wrapTaskAroundCall({task:new N.R("iscsi/target/edit",{target_iqn:o.target_iqn}),call:this.iscsiService.updateTarget(this.target_iqn,o)})):i=this.taskWrapper.wrapTaskAroundCall({task:new N.R("iscsi/target/create",{target_iqn:o.target_iqn}),call:this.iscsiService.createTarget(o)}),i.subscribe({error:()=>{this.targetForm.setErrors({cdSubmitButton:!0})},complete:()=>this.router.navigate(["/block/iscsi/targets"])})}targetSettingsModal(){const t={target_controls:this.targetForm.get("target_controls"),target_default_controls:this.target_default_controls,target_controls_limits:this.target_controls_limits};this.modalRef=this.modalService.show(Io,t)}imageSettingsModal(t){const o={imagesSettings:this.imagesSettings,image:t,api_version:this.api_version,disk_default_controls:this.disk_default_controls,disk_controls_limits:this.disk_controls_limits,backstores:this.getValidBackstores(this.getImageById(t)),control:this.targetForm.get("disks")};this.modalRef=this.modalService.show(Po,o)}validFeatures(t,o){const i=t.features,_=this.required_rbd_features[o];return(i&_)===_&&0==(i&this.unsupported_rbd_features[o])}getImageById(t){return this.imagesAll.find(o=>t===`${o.pool_name}/${o.name}`)}getValidBackstores(t){return this.backstores.filter(o=>this.validFeatures(t,o))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(J),e.Y36(ae.Z),e.Y36(j.U),e.Y36(p.F0),e.Y36(p.gz),e.Y36(G.P),e.Y36(E.p4))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-iscsi-target-form"]],features:[e.qOj],decls:1,vars:1,consts:function(){let s,t,o,i,_,r,l,d,u,f,M,O,I,B,V,Z,ne,ie,H,pe,ue,F,Oe,Re,he,Ae,Ne,Pe,be,x,Ke,ke,Ve,Qe,Xe,Ye,ze,Je,Ue,D,Xt,Yt,zt,Jt,Ut,jt,Wt,eo,to,oo,no,io,so,_o,ao,ro,lo,co,mo,po,uo,go;return s="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",t="\uD0C0\uAC9F IQN",o="Portals",i="\uD3EC\uD138 \uCD94\uAC00",_="Images",r="\uC774\uBBF8\uC9C0 \uCD94\uAC00",l="ACL \uC778\uC99D",d="This field is required.",u="IQN\uC774 \uC798\uBABB\uB41C \uD328\uD134\uC744 \uAC00\uC9C0\uACE0 \uC788\uC2B5\uB2C8\uB2E4.",f="An IQN has the following notation 'iqn.$year-$month.$reversedAddress:$definedName'",M="Key\n\uC608\uB97C\uB4E4\uBA74: iqn.2016-06.org.dashboard:storage:disk.sn-a8675309",O="\uCD94\uAC00 \uC815\uBCF4",I="\uC774 \uD0C0\uAC9F\uC740 \uACE0\uAE09\uC124\uC815\uB4E4\uC744 \uC218\uC815\uD588\uC2B5\uB2C8\uB2E4.",B="At least \n          " + "\ufffd0\ufffd" + " gateways are required.\n        ",V="Backstore: \n          " + "\ufffd0\ufffd" + ".\xA0\n        ",Z="\uC774 \uC774\uBBF8\uC9C0\uB294 \uC124\uC815\uB4E4\uC744 \uC218\uC815\uD588\uC2B5\uB2C8\uB2E4. ",ne="Duplicated LUN numbers.",ie="Duplicated WWN.",H="\uC0AC\uC6A9\uC790",pe="\uC554\uD638",ue="\uACF5\uB3D9 \uC0AC\uC6A9\uC790",F="\uACF5\uD1B5 \uC554\uD638",Oe="This field is required.",Re="User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.",he="This field is required.",Ae="Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.",Ne="This field is required.",Pe="User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.",be="This field is required.",x="Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.",Ke="\uAC1C\uC2DC\uC790\uB4E4",ke="\uAC8C\uC2DC\uC790 \uCD94\uAC00",Ve="\uAC1C\uC2DC\uC790\uB4E4",Qe="\uD074\uB77C\uC774\uC5B8\uD2B8 IQN",Xe="\uC0AC\uC6A9\uC790",Ye="\uC554\uD638",ze="\uACF5\uB3D9 \uC0AC\uC6A9\uC790",Je="\uACF5\uD1B5 \uC554\uD638",Ue="Images",D="\uAC1C\uC2DC\uC790 IQN\uC740 \uC720\uC77C\uD574\uC57C \uD569\uB2C8\uB2E4.",Xt="This field is required.",Yt="IQN\uC774 \uC798\uBABB\uB41C \uD328\uD134\uC744 \uAC00\uC9C0\uACE0 \uC788\uC2B5\uB2C8\uB2E4.",zt="This field is required.",Jt="User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.",Ut="This field is required.",jt="Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.",Wt="This field is required.",eo="User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.",to="This field is required.",oo="Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.",no="\uAC1C\uC2DC\uC790\uB294 \uD558\uB098\uC758 \uADF8\uB8F9\uC5D0 \uC18D\uD574\uC57C \uD558\uACE0, \uC774\uBBF8\uC9C0\uB294 \uADF8\uB8F9\uC548\uC5D0\uC11C \uC124\uC815\uD569\uB2C8\uB2E4.",io="\uC774\uBBF8\uC9C0 \uCD94\uAC00",so="\uCD94\uAC00\uB41C \uC544\uC774\uD15C\uB4E4\uC774 \uC5C6\uC74C",_o="\uADF8\uB8F9\uB4E4",ao="\uADF8\uB8F9\uCD94\uAC00",ro="Group",lo="Name",co="\uAC1C\uC2DC\uC790\uB4E4",mo="\uAC8C\uC2DC\uC790 \uCD94\uAC00",po="Images",uo="\uC774\uBBF8\uC9C0 \uCD94\uAC00",go="\uCD94\uAC00\uB41C \uC544\uC774\uD15C\uB4E4\uC774 \uC5C6\uC74C",[["class","cd-col-form",4,"cdFormLoading"],[1,"cd-col-form"],["name","targetForm","novalidate","",3,"formGroup"],["formDir","ngForm"],[1,"card"],[1,"card-header"],s,[1,"card-body"],[1,"form-group","row"],["for","target_iqn",1,"cd-col-form-label","required"],t,[1,"cd-col-form-input"],[1,"input-group"],["type","text","id","target_iqn","name","target_iqn","formControlName","target_iqn","cdTrim","",1,"form-control"],["id","ecp-info-button","type","button",1,"btn","btn-light",3,"click"],["aria-hidden","true",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["class","form-text text-muted",4,"ngIf"],["for","portals",1,"cd-col-form-label","required"],o,[4,"ngFor","ngForOf"],[1,"row"],[1,"col-md-12"],["elemClass","btn btn-light float-end",3,"data","options","messages","selection"],[3,"ngClass"],i,["type","hidden","id","portals","name","portals","formControlName","portals",1,"form-control"],["for","disks",1,"cd-col-form-label"],_,["type","hidden","id","disks","name","disks","formControlName","disks",1,"form-control"],r,[1,"cd-col-form-offset"],[1,"custom-control","custom-checkbox"],["type","checkbox","formControlName","acl_enabled","name","acl_enabled","id","acl_enabled",1,"custom-control-input"],["for","acl_enabled",1,"custom-control-label"],l,["formGroupName","auth",4,"ngIf"],["class","form-group row",4,"ngIf"],[1,"card-footer"],["wrappingClass","text-right",3,"form","submitText","submitActionEvent"],[1,"invalid-feedback"],d,u,f,M,["target","_blank","href","https://en.wikipedia.org/wiki/ISCSI#Addressing"],O,[1,"form-text","text-muted"],I,[1,"input-group","cd-mb"],["type","text","disabled","",1,"cd-form-control",3,"value"],["type","button",1,"btn","btn-light",3,"click"],B,["class","input-group-text",4,"ngIf"],[4,"ngIf"],[1,"input-group-text"],V,Z,ne,ie,["formGroupName","auth"],["for","target_user",1,"cd-col-form-label"],H,["type","text","autocomplete","off","id","target_user","name","target_user","formControlName","user",1,"form-control"],["for","target_password",1,"cd-col-form-label"],pe,["type","password","autocomplete","new-password","id","target_password","name","target_password","formControlName","password",1,"form-control"],["type","button","cdPasswordButton","target_password",1,"btn","btn-light"],["source","target_password"],["for","target_mutual_user",1,"cd-col-form-label"],ue,["type","text","autocomplete","off","id","target_mutual_user","name","target_mutual_user","formControlName","mutual_user",1,"form-control"],["for","target_mutual_password",1,"cd-col-form-label"],F,["type","password","autocomplete","new-password","id","target_mutual_password","name","target_mutual_password","formControlName","mutual_password",1,"form-control"],["type","button","cdPasswordButton","target_mutual_password",1,"btn","btn-light"],["source","target_mutual_password"],Oe,Re,he,Ae,Ne,Pe,be,x,["for","initiators",1,"cd-col-form-label"],Ke,["formArrayName","initiators",1,"cd-col-form-input"],["class","card mb-2",3,"formGroup",4,"ngFor","ngForOf"],[1,"btn","btn-light","float-end",3,"click"],ke,[1,"card","mb-2",3,"formGroup"],Ve,["type","button",1,"btn-close","float-end",3,"click"],["for","client_iqn",1,"cd-col-form-label","required"],Qe,["type","text","formControlName","client_iqn","cdTrim","",1,"form-control",3,"blur"],["for","user",1,"cd-col-form-label"],Xe,["formControlName","user","autocomplete","off","type","text",1,"form-control",3,"id"],["for","password",1,"cd-col-form-label"],Ye,["formControlName","password","autocomplete","new-password","type","password",1,"form-control",3,"id"],["type","button",1,"btn","btn-light",3,"cdPasswordButton"],[3,"source"],["for","mutual_user",1,"cd-col-form-label"],ze,["formControlName","mutual_user","autocomplete","off","type","text",1,"form-control",3,"id"],["for","mutual_password",1,"cd-col-form-label"],Je,["formControlName","mutual_password","autocomplete","new-password","type","password",1,"form-control",3,"id"],["for","luns",1,"cd-col-form-label"],Ue,["class","row",4,"ngIf"],D,Xt,Yt,zt,Jt,Ut,jt,Wt,eo,to,oo,no,["elemClass","btn btn-light float-end",3,"data","options","messages"],io,so,_o,["formArrayName","groups",1,"cd-col-form-input"],ao,ro,["for","group_id",1,"cd-col-form-label","required"],lo,["type","text","formControlName","group_id",1,"form-control"],["for","members",1,"cd-col-form-label"],co,mo,po,uo,go]},template:function(t,o){1&t&&e.YNc(0,On,65,40,"div",0),2&t&&e.Q6J("cdFormLoading",o.loading)},dependencies:[c.mk,c.sg,c.O5,a._Y,a.Fj,a.Wl,a.JJ,a.JL,a.sg,a.u,a.x0,a.CE,Fo.H,We.s,R.p,Et.C,vo.$,Mt.y,L.o,g.b,T.P,b.V,c.rS,je.V,Fe.m],styles:[".cd-mb[_ngcontent-%COMP%]{margin-bottom:10px}"]}),n})();var _t=m(68136),re=m(30982),z=m(83697),Be=m(99466),le=m(68774),Rt=m(55657),Se=m(38047),at=m(18001),xe=m(97161),k=m(47640);function Rn(n,s){1&n&&(e.TgZ(0,"span",29),e.SDv(1,30),e.qZA())}function hn(n,s){1&n&&(e.TgZ(0,"span",29),e.SDv(1,31),e.qZA())}function An(n,s){1&n&&(e.TgZ(0,"span",29),e.SDv(1,32),e.qZA())}function Nn(n,s){1&n&&(e.TgZ(0,"span",29),e.SDv(1,33),e.qZA())}function Pn(n,s){1&n&&(e.TgZ(0,"span",29),e.SDv(1,34),e.qZA())}function bn(n,s){1&n&&(e.TgZ(0,"span",29),e.SDv(1,35),e.qZA())}function In(n,s){1&n&&(e.TgZ(0,"span",29),e.SDv(1,36),e.qZA())}function Fn(n,s){1&n&&(e.TgZ(0,"span",29),e.SDv(1,37),e.qZA())}let vn=(()=>{class n{constructor(t,o,i,_,r){this.authStorageService=t,this.activeModal=o,this.actionLabels=i,this.iscsiService=_,this.notificationService=r,this.USER_REGEX=/^[\w\.:@_-]{8,64}$/,this.PASSWORD_REGEX=/^[\w@\-_\/]{12,16}$/,this.permission=this.authStorageService.getPermissions().iscsi}ngOnInit(){this.hasPermission=this.permission.update,this.createForm(),this.iscsiService.getDiscovery().subscribe(t=>{this.discoveryForm.patchValue(t)})}createForm(){this.discoveryForm=new A.d({user:new a.p4({value:"",disabled:!this.hasPermission}),password:new a.p4({value:"",disabled:!this.hasPermission}),mutual_user:new a.p4({value:"",disabled:!this.hasPermission}),mutual_password:new a.p4({value:"",disabled:!this.hasPermission})}),v.hq.validateIf(this.discoveryForm.get("user"),()=>this.discoveryForm.getValue("password")||this.discoveryForm.getValue("mutual_user")||this.discoveryForm.getValue("mutual_password"),[a.kI.required],[a.kI.pattern(this.USER_REGEX)],[this.discoveryForm.get("password"),this.discoveryForm.get("mutual_user"),this.discoveryForm.get("mutual_password")]),v.hq.validateIf(this.discoveryForm.get("password"),()=>this.discoveryForm.getValue("user")||this.discoveryForm.getValue("mutual_user")||this.discoveryForm.getValue("mutual_password"),[a.kI.required],[a.kI.pattern(this.PASSWORD_REGEX)],[this.discoveryForm.get("user"),this.discoveryForm.get("mutual_user"),this.discoveryForm.get("mutual_password")]),v.hq.validateIf(this.discoveryForm.get("mutual_user"),()=>this.discoveryForm.getValue("mutual_password"),[a.kI.required],[a.kI.pattern(this.USER_REGEX)],[this.discoveryForm.get("user"),this.discoveryForm.get("password"),this.discoveryForm.get("mutual_password")]),v.hq.validateIf(this.discoveryForm.get("mutual_password"),()=>this.discoveryForm.getValue("mutual_user"),[a.kI.required],[a.kI.pattern(this.PASSWORD_REGEX)],[this.discoveryForm.get("user"),this.discoveryForm.get("password"),this.discoveryForm.get("mutual_user")])}submitAction(){this.iscsiService.updateDiscovery(this.discoveryForm.value).subscribe(()=>{this.notificationService.show(at.k.success,"Updated discovery authentication"),this.activeModal.close()},()=>{this.discoveryForm.setErrors({cdSubmitButton:!0})})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(k.j),e.Y36(P.Kz),e.Y36(E.p4),e.Y36(J),e.Y36(xe.g))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-iscsi-target-discovery-modal"]],decls:44,vars:13,consts:function(){let s,t,o,i,_,r,l,d,u,f,M,O,I;return s="\uC778\uC99D \uD0D0\uC0C9",t="\uC0AC\uC6A9\uC790",o="\uC554\uD638",i="\uACF5\uB3D9 \uC0AC\uC6A9\uC790",_="\uACF5\uD1B5 \uC554\uD638",r="This field is required.",l="User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.",d="This field is required.",u="Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.",f="This field is required.",M="User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.",O="This field is required.",I="Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.",[[3,"modalRef"],[1,"modal-title"],s,[1,"modal-content"],["name","discoveryForm","novalidate","",3,"formGroup"],["formDir","ngForm"],[1,"modal-body"],[1,"form-group","row"],["for","user",1,"cd-col-form-label"],t,[1,"cd-col-form-input"],["id","user","formControlName","user","type","text","autocomplete","off",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","password",1,"cd-col-form-label"],o,[1,"input-group"],["id","password","formControlName","password","type","password","autocomplete","new-password",1,"form-control"],["type","button","cdPasswordButton","password",1,"btn","btn-light"],["source","password"],["for","mutual_user",1,"cd-col-form-label"],i,["id","mutual_user","formControlName","mutual_user","type","text","autocomplete","off",1,"form-control"],["for","mutual_password",1,"cd-col-form-label"],_,["id","mutual_password","formControlName","mutual_password","type","password","autocomplete","new-password",1,"form-control"],["type","button","cdPasswordButton","mutual_password",1,"btn","btn-light"],["source","mutual_password"],[1,"modal-footer"],[3,"form","showSubmit","submitText","submitActionEvent"],[1,"invalid-feedback"],r,l,d,u,f,M,O,I]},template:function(t,o){if(1&t&&(e.TgZ(0,"cd-modal",0),e.ynx(1,1),e.SDv(2,2),e.BQk(),e.ynx(3,3),e.TgZ(4,"form",4,5)(6,"div",6)(7,"div",7)(8,"label",8),e.SDv(9,9),e.qZA(),e.TgZ(10,"div",10),e._UZ(11,"input",11),e.YNc(12,Rn,2,0,"span",12),e.YNc(13,hn,2,0,"span",12),e.qZA()(),e.TgZ(14,"div",7)(15,"label",13),e.SDv(16,14),e.qZA(),e.TgZ(17,"div",10)(18,"div",15),e._UZ(19,"input",16)(20,"button",17)(21,"cd-copy-2-clipboard-button",18),e.qZA(),e.YNc(22,An,2,0,"span",12),e.YNc(23,Nn,2,0,"span",12),e.qZA()(),e.TgZ(24,"div",7)(25,"label",19),e.ynx(26),e.SDv(27,20),e.BQk(),e.qZA(),e.TgZ(28,"div",10),e._UZ(29,"input",21),e.YNc(30,Pn,2,0,"span",12),e.YNc(31,bn,2,0,"span",12),e.qZA()(),e.TgZ(32,"div",7)(33,"label",22),e.SDv(34,23),e.qZA(),e.TgZ(35,"div",10)(36,"div",15),e._UZ(37,"input",24)(38,"button",25)(39,"cd-copy-2-clipboard-button",26),e.qZA(),e.YNc(40,In,2,0,"span",12),e.YNc(41,Fn,2,0,"span",12),e.qZA()()(),e.TgZ(42,"div",27)(43,"cd-form-button-panel",28),e.NdJ("submitActionEvent",function(){return o.submitAction()}),e.qZA()()(),e.BQk(),e.qZA()),2&t){const i=e.MAs(5);e.Q6J("modalRef",o.activeModal),e.xp6(4),e.Q6J("formGroup",o.discoveryForm),e.xp6(8),e.Q6J("ngIf",o.discoveryForm.showError("user",i,"required")),e.xp6(1),e.Q6J("ngIf",o.discoveryForm.showError("user",i,"pattern")),e.xp6(9),e.Q6J("ngIf",o.discoveryForm.showError("password",i,"required")),e.xp6(1),e.Q6J("ngIf",o.discoveryForm.showError("password",i,"pattern")),e.xp6(7),e.Q6J("ngIf",o.discoveryForm.showError("mutual_user",i,"required")),e.xp6(1),e.Q6J("ngIf",o.discoveryForm.showError("mutual_user",i,"pattern")),e.xp6(9),e.Q6J("ngIf",o.discoveryForm.showError("mutual_password",i,"required")),e.xp6(1),e.Q6J("ngIf",o.discoveryForm.showError("mutual_password",i,"pattern")),e.xp6(2),e.Q6J("form",o.discoveryForm)("showSubmit",o.hasPermission)("submitText",o.actionLabels.SUBMIT)}},dependencies:[c.O5,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,Y.z,We.s,R.p,Et.C,L.o,g.b,T.P,b.V]}),n})();var Ln=m(86969),Ze=m(34501),Dn=m(30490),ce=m(94928);let ht=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-iscsi-tabs"]],decls:7,vars:0,consts:function(){let s,t;return s="\uAC1C\uAD00",t="\uD0C0\uAC9F\uB4E4",[[1,"nav","nav-tabs"],[1,"nav-item"],["routerLink","/block/iscsi/overview","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link"],s,["routerLink","/block/iscsi/targets","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link"],t]},template:function(t,o){1&t&&(e.TgZ(0,"ul",0)(1,"li",1)(2,"a",2),e.SDv(3,3),e.qZA()(),e.TgZ(4,"li",1)(5,"a",4),e.SDv(6,5),e.qZA()()())},dependencies:[p.rH,p.Od]}),n})();var $n=m(68962);const Bn=["highlightTpl"],Gn=["detailTable"],yn=["tree"],xn=function(){return["logged_in"]},Zn=function(){return["logged_out"]},wn=function(n,s){return{"badge-success":n,"badge-danger":s}};function Hn(n,s){if(1&n&&(e._UZ(0,"i"),e.TgZ(1,"span"),e._uU(2),e.qZA(),e._uU(3," \xa0 "),e.TgZ(4,"span",8),e._uU(5),e.qZA()),2&n){const t=s.$implicit;e.Tol(t.data.cdIcon),e.xp6(2),e.Oqu(t.data.name),e.xp6(2),e.Q6J("ngClass",e.WLB(7,wn,e.DdM(5,xn).includes(t.data.status),e.DdM(6,Zn).includes(t.data.status))),e.xp6(1),e.hij(" ",t.data.status," ")}}function qn(n,s){if(1&n&&(e.TgZ(0,"div",9)(1,"legend"),e._uU(2),e.qZA(),e._UZ(3,"cd-table",10,11),e.qZA()),2&n){const t=e.oxw();e.xp6(2),e.Oqu(t.title),e.xp6(1),e.Q6J("data",t.data)("columns",t.columns)("limit",0)}}function Kn(n,s){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw().value;e.xp6(1),e.Oqu(t)}}function kn(n,s){if(1&n&&(e.TgZ(0,"strong"),e._uU(1),e.qZA()),2&n){const t=e.oxw().value;e.xp6(1),e.Oqu(t)}}function Vn(n,s){if(1&n&&(e.YNc(0,Kn,2,1,"span",12),e.YNc(1,kn,2,1,"strong",12)),2&n){const t=s.row;e.Q6J("ngIf",void 0===t.default||t.default===t.current),e.xp6(1),e.Q6J("ngIf",void 0!==t.default&&t.default!==t.current)}}let Qn=(()=>{class n{set content(t){this.detailTable=t,t&&t.updateColumns()}constructor(t,o){this.iscsiBackstorePipe=t,this.booleanTextPipe=o,this.icons=C.P,this.metadata={},this.nodes=[],this.treeOptions={useVirtualScroll:!0,actionMapping:{mouse:{click:this.onNodeSelected.bind(this)}}}}ngOnInit(){this.columns=[{prop:"displayName",name:"Name",flexGrow:1,cellTemplate:this.highlightTpl},{prop:"current",name:"Current",flexGrow:1,cellTemplate:this.highlightTpl},{prop:"default",name:"Default",flexGrow:1,cellTemplate:this.highlightTpl}]}ngOnChanges(){this.selection&&(this.selectedItem=this.selection,this.generateTree()),this.data=void 0}generateTree(){const t=S().cloneDeep(this.selectedItem.target_controls);this.cephIscsiConfigVersion>10&&S().extend(t,S().cloneDeep(this.selectedItem.auth)),this.metadata={root:t};const o={target:{expanded:S().join(this.selectedItem.cdExecuting?[C.P.large,C.P.spinner,C.P.spin]:[C.P.large,C.P.bullseye]," ")},initiators:{expanded:S().join([C.P.large,C.P.user]," "),leaf:S().join([C.P.user]," ")},groups:{expanded:S().join([C.P.large,C.P.users]," "),leaf:S().join([C.P.users]," ")},disks:{expanded:S().join([C.P.large,C.P.disk]," "),leaf:S().join([C.P.disk]," ")},portals:{expanded:S().join([C.P.large,C.P.server]," "),leaf:S().join([C.P.server]," ")}},i=[];S().forEach(this.selectedItem.disks,d=>{const u="disk_"+d.pool+"_"+d.image;this.metadata[u]={controls:d.controls,backstore:d.backstore},["wwn","lun"].forEach(f=>{f in d&&(this.metadata[u][f]=d[f])}),i.push({name:`${d.pool}/${d.image}`,cdId:u,cdIcon:o.disks.leaf})});const _=[];S().forEach(this.selectedItem.portals,d=>{_.push({name:`${d.host}:${d.ip}`,cdIcon:o.portals.leaf})});const r=[];S().forEach(this.selectedItem.clients,d=>{const u=S().cloneDeep(d.auth);d.info&&(S().extend(u,d.info),delete u.state,S().forEach(Object.keys(d.info.state),O=>{u[O.toLowerCase()]=d.info.state[O]})),this.metadata["client_"+d.client_iqn]=u;const f=[];d.luns.forEach(O=>{f.push({name:`${O.pool}/${O.image}`,cdId:"disk_"+O.pool+"_"+O.image,cdIcon:o.disks.leaf})});let M="";d.info&&(M=Object.keys(d.info.state).includes("LOGGED_IN")?"logged_in":"logged_out"),r.push({name:d.client_iqn,status:M,cdId:"client_"+d.client_iqn,children:f,cdIcon:o.initiators.leaf})});const l=[];S().forEach(this.selectedItem.groups,d=>{const u=[];d.disks.forEach(M=>{u.push({name:`${M.pool}/${M.image}`,cdId:"disk_"+M.pool+"_"+M.image,cdIcon:o.disks.leaf})});const f=[];d.members.forEach(M=>{f.push({name:M,cdId:"client_"+M})}),l.push({name:d.group_id,cdIcon:o.groups.leaf,children:[{name:"Disks",children:u,cdIcon:o.disks.expanded},{name:"Initiators",children:f,cdIcon:o.initiators.expanded}]})}),this.nodes=[{name:this.selectedItem.target_iqn,cdId:"root",isExpanded:!0,cdIcon:o.target.expanded,children:[{name:"Disks",isExpanded:!0,children:i,cdIcon:o.disks.expanded},{name:"Portals",isExpanded:!0,children:_,cdIcon:o.portals.expanded},{name:"Initiators",isExpanded:!0,children:r,cdIcon:o.initiators.expanded},{name:"Groups",isExpanded:!0,children:l,cdIcon:o.groups.expanded}]}]}format(t){return"boolean"==typeof t?this.booleanTextPipe.transform(t):t}onNodeSelected(t,o){if(se.iM.ACTIVATE(t,o,!0),o.data.cdId){this.title=o.data.name;const i=this.metadata[o.data.cdId]||{};"root"===o.data.cdId?(this.detailTable?.toggleColumn({prop:"default",isHidden:!0}),this.data=S().map(this.settings.target_default_controls,(_,r)=>({displayName:r,default:_=this.format(_),current:S().isUndefined(i[r])?_:this.format(i[r])})),this.cephIscsiConfigVersion>10&&["user","password","mutual_user","mutual_password"].forEach(_=>{this.data.push({displayName:_,default:null,current:i[_]})})):o.data.cdId.toString().startsWith("disk_")?(this.detailTable?.toggleColumn({prop:"default",isHidden:!0}),this.data=S().map(this.settings.disk_default_controls[i.backstore],(_,r)=>({displayName:r,default:_=this.format(_),current:S().isUndefined(i.controls[r])?_:this.format(i.controls[r])})),this.data.push({displayName:"backstore",default:this.iscsiBackstorePipe.transform(this.settings.default_backstore),current:this.iscsiBackstorePipe.transform(i.backstore)}),["wwn","lun"].forEach(_=>{_ in i&&this.data.push({displayName:_,default:void 0,current:i[_]})})):(this.detailTable?.toggleColumn({prop:"default",isHidden:!1}),this.data=S().map(i,(_,r)=>({displayName:r,default:void 0,current:this.format(_)})))}else this.data=void 0;this.detailTable?.updateColumns()}onUpdateData(){this.tree.treeModel.expandAll()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(je.V),e.Y36($n.T))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-iscsi-target-details"]],viewQuery:function(t,o){if(1&t&&(e.Gf(Bn,7),e.Gf(Gn,5),e.Gf(yn,5)),2&t){let i;e.iGM(i=e.CRH())&&(o.highlightTpl=i.first),e.iGM(i=e.CRH())&&(o.content=i.first),e.iGM(i=e.CRH())&&(o.tree=i.first)}},inputs:{selection:"selection",settings:"settings",cephIscsiConfigVersion:"cephIscsiConfigVersion"},features:[e.TTD],decls:11,vars:3,consts:function(){let s;return s="iSCSI \uD1A0\uD3F4\uB85C\uC9C0",[[1,"row"],[1,"col-6"],s,[3,"nodes","options","updateData"],["tree",""],["treeNodeTemplate",""],["class","col-6 metadata",4,"ngIf"],["highlightTpl",""],[1,"badge",3,"ngClass"],[1,"col-6","metadata"],["columnMode","flex",3,"data","columns","limit"],["detailTable",""],[4,"ngIf"]]},template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"legend"),e.SDv(3,2),e.qZA(),e.TgZ(4,"tree-root",3,4),e.NdJ("updateData",function(){return o.onUpdateData()}),e.YNc(6,Hn,6,10,"ng-template",null,5,e.W1O),e.qZA()(),e.YNc(8,qn,5,4,"div",6),e.qZA(),e.YNc(9,Vn,2,2,"ng-template",null,7,e.W1O)),2&t&&(e.xp6(4),e.Q6J("nodes",o.nodes)("options",o.treeOptions),e.xp6(4),e.Q6J("ngIf",o.data))},dependencies:[c.mk,c.O5,z.a,se.qr]}),n})();function Xn(n,s){if(1&n&&(e.ynx(0),e._UZ(1,"br"),e.TgZ(2,"span"),e.SDv(3,6),e.qZA(),e.TgZ(4,"pre"),e._uU(5),e.qZA(),e.BQk()),2&n){const t=e.oxw(2);e.xp6(5),e.Oqu(t.status)}}function Yn(n,s){if(1&n&&(e.TgZ(0,"cd-alert-panel",2),e.ynx(1),e.tHW(2,3),e._UZ(3,"cd-doc",4),e.N_p(),e.BQk(),e.YNc(4,Xn,6,1,"ng-container",5),e.qZA()),2&n){const t=e.oxw();e.xp6(4),e.Q6J("ngIf",t.status)}}function zn(n,s){if(1&n&&e._UZ(0,"cd-iscsi-target-details",15),2&n){const t=e.oxw(2);e.Q6J("cephIscsiConfigVersion",t.cephIscsiConfigVersion)("selection",t.expandedRow)("settings",t.settings)}}const Jn=function(n){return[n]};function Un(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"cd-table",7,8),e.NdJ("fetchData",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.getTargets())})("setExpandedRow",function(i){e.CHM(t);const _=e.oxw();return e.KtG(_.setExpandedRow(i))})("updateSelection",function(i){e.CHM(t);const _=e.oxw();return e.KtG(_.updateSelection(i))}),e.TgZ(2,"div",9),e._UZ(3,"cd-table-actions",10),e.TgZ(4,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.configureDiscoveryAuth())}),e._UZ(5,"i",12),e.ynx(6),e.SDv(7,13),e.BQk(),e.qZA()(),e.YNc(8,zn,1,3,"cd-iscsi-target-details",14),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("data",t.targets)("columns",t.columns)("hasDetails",!0)("autoReload",!1)("status",t.tableStatus),e.xp6(3),e.Q6J("permission",t.permission)("selection",t.selection)("tableActions",t.tableActions),e.xp6(2),e.Q6J("ngClass",e.VKq(10,Jn,t.icons.key)),e.xp6(3),e.Q6J("ngIf",t.expandedRow)}}let jn=(()=>{class n extends _t.o{constructor(t,o,i,_,r,l,d,u,f){super(f),this.authStorageService=t,this.iscsiService=o,this.joinPipe=i,this.taskListService=_,this.notAvailablePipe=r,this.modalService=l,this.taskWrapper=d,this.actionLabels=u,this.ngZone=f,this.available=void 0,this.selection=new le.r,this.targets=[],this.icons=C.P,this.builders={"iscsi/target/create":M=>({target_iqn:M.target_iqn})},this.permission=this.authStorageService.getPermissions().iscsi,this.tableActions=[{permission:"create",icon:C.P.add,routerLink:()=>"/block/iscsi/targets/create",name:this.actionLabels.CREATE},{permission:"update",icon:C.P.edit,routerLink:()=>`/block/iscsi/targets/edit/${this.selection.first().target_iqn}`,name:this.actionLabels.EDIT,disable:()=>this.getEditDisableDesc()},{permission:"delete",icon:C.P.destroy,click:()=>this.deleteIscsiTargetModal(),name:this.actionLabels.DELETE,disable:()=>this.getDeleteDisableDesc()}]}ngOnInit(){this.columns=[{name:"Target",prop:"target_iqn",flexGrow:2,cellTransformation:Be.e.executing},{name:"Portals",prop:"cdPortals",pipe:this.joinPipe,flexGrow:2},{name:"Images",prop:"cdImages",pipe:this.joinPipe,flexGrow:2},{name:"# Sessions",prop:"info.num_sessions",pipe:this.notAvailablePipe,flexGrow:1}],this.iscsiService.status().subscribe(t=>{this.available=t.available,t.available||(this.status=t.message)})}getTargets(){this.available&&(this.setTableRefreshTimeout(),this.iscsiService.version().subscribe(t=>{this.cephIscsiConfigVersion=t.ceph_iscsi_config_version}),this.taskListService.init(()=>this.iscsiService.listTargets(),t=>this.prepareResponse(t),t=>this.targets=t,()=>this.onFetchError(),this.taskFilter,this.itemFilter,this.builders),this.iscsiService.settings().subscribe(t=>{this.settings=t}))}ngOnDestroy(){this.summaryDataSubscription&&this.summaryDataSubscription.unsubscribe()}getEditDisableDesc(){const t=this.selection.first();return t&&t?.cdExecuting?t.cdExecuting:t&&S().isUndefined(t?.info)?"Unavailable gateway(s)":!t}getDeleteDisableDesc(){const t=this.selection.first();return t?.cdExecuting?t.cdExecuting:t&&S().isUndefined(t?.info)?"Unavailable gateway(s)":t&&t?.info?.num_sessions?"Target has active sessions":!t}prepareResponse(t){return t.forEach(o=>{o.cdPortals=o.portals.map(i=>`${i.host}:${i.ip}`),o.cdImages=o.disks.map(i=>`${i.pool}/${i.image}`)}),t}onFetchError(){this.table.reset()}itemFilter(t,o){return t.target_iqn===o.metadata.target_iqn}taskFilter(t){return["iscsi/target/create","iscsi/target/edit","iscsi/target/delete"].includes(t.name)}updateSelection(t){this.selection=t}deleteIscsiTargetModal(){const t=this.selection.first().target_iqn;this.modalRef=this.modalService.show(re.M,{itemDescription:"iSCSI target",itemNames:[t],submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new N.R("iscsi/target/delete",{target_iqn:t}),call:this.iscsiService.deleteTarget(t)})})}configureDiscoveryAuth(){this.modalService.show(vn)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(k.j),e.Y36(J),e.Y36(Ln.A),e.Y36(Se.j),e.Y36(Rt.g),e.Y36(ae.Z),e.Y36(G.P),e.Y36(E.p4),e.Y36(e.R0b))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-iscsi-target-list"]],viewQuery:function(t,o){if(1&t&&e.Gf(z.a,5),2&t){let i;e.iGM(i=e.CRH())&&(o.table=i.first)}},features:[e._Bn([Se.j]),e.qOj],decls:3,vars:2,consts:function(){let s,t,o,i;return s="iSCSI \uD0C0\uAC9F\uC774 \uC774\uC6A9 \uBD88\uAC00\uB2A5\uD569\uB2C8\uB2E4.",t="Please consult the \n          " + "\ufffd#3\ufffd" + "\n          " + "\ufffd/#3\ufffd" + " on how to configure and enable the iSCSI Targets management functionality.\n        ",o="\uC774\uC6A9\uAC00\uB2A5\uD55C \uC815\uBCF4:",i="Discovery authentication",[["type","info","title",s,4,"ngIf"],["columnMode","flex","identifier","target_iqn","forceIdentifier","true","selectionType","single",3,"data","columns","hasDetails","autoReload","status","fetchData","setExpandedRow","updateSelection",4,"ngIf"],["type","info","title",s],t,["section","iscsi"],[4,"ngIf"],o,["columnMode","flex","identifier","target_iqn","forceIdentifier","true","selectionType","single",3,"data","columns","hasDetails","autoReload","status","fetchData","setExpandedRow","updateSelection"],["table",""],[1,"table-actions","btn-toolbar"],[1,"btn-group",3,"permission","selection","tableActions"],["type","button",1,"btn","btn-light",3,"click"],["aria-hidden","true",3,"ngClass"],i,["cdTableDetail","",3,"cephIscsiConfigVersion","selection","settings",4,"ngIf"],["cdTableDetail","",3,"cephIscsiConfigVersion","selection","settings"]]},template:function(t,o){1&t&&(e._UZ(0,"cd-iscsi-tabs"),e.YNc(1,Yn,5,1,"cd-alert-panel",0),e.YNc(2,Un,9,12,"cd-table",1)),2&t&&(e.xp6(1),e.Q6J("ngIf",!1===o.available),e.xp6(1),e.Q6J("ngIf",!0===o.available))},dependencies:[c.mk,c.O5,Ze.G,Dn.K,z.a,ce.K,L.o,ht,Qn]}),n})();var rt=m(66369),Wn=m(76446),ei=m(90068);const ti=["iscsiSparklineTpl"],oi=["iscsiPerSecondTpl"],ni=["iscsiRelativeDateTpl"];function ii(n,s){if(1&n&&(e.TgZ(0,"span"),e._UZ(1,"cd-sparkline",9),e.qZA()),2&n){const t=e.oxw(),o=t.value,i=t.row;e.xp6(1),e.Q6J("data",o)("isBinary",i.cdIsBinary)}}function si(n,s){1&n&&(e.TgZ(0,"span",10),e._uU(1," n/a "),e.qZA())}function _i(n,s){if(1&n&&(e.YNc(0,ii,2,2,"span",7),e.YNc(1,si,2,0,"span",8)),2&n){const t=s.row;e.Q6J("ngIf","user:rbd"===t.backstore),e.xp6(1),e.Q6J("ngIf","user:rbd"!==t.backstore)}}function ai(n,s){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw().value;e.xp6(1),e.hij(" ",t," /s ")}}function ri(n,s){1&n&&(e.TgZ(0,"span",10),e._uU(1," n/a "),e.qZA())}function li(n,s){if(1&n&&(e.YNc(0,ai,2,1,"span",7),e.YNc(1,ri,2,0,"span",8)),2&n){const t=s.row;e.Q6J("ngIf","user:rbd"===t.backstore),e.xp6(1),e.Q6J("ngIf","user:rbd"!==t.backstore)}}function ci(n,s){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"notAvailable"),e.ALo(3,"relativeDate"),e.qZA()),2&n){const t=e.oxw().value;e.xp6(1),e.hij(" ",e.lcZ(2,1,e.lcZ(3,3,t))," ")}}function di(n,s){1&n&&(e.TgZ(0,"span",10),e._uU(1," n/a "),e.qZA())}function mi(n,s){if(1&n&&(e.YNc(0,ci,4,5,"span",7),e.YNc(1,di,2,0,"span",8)),2&n){const t=s.row;e.Q6J("ngIf","user:rbd"===t.backstore),e.xp6(1),e.Q6J("ngIf","user:rbd"!==t.backstore)}}let pi=(()=>{class n{constructor(t,o,i){this.iscsiService=t,this.dimlessPipe=o,this.iscsiBackstorePipe=i,this.gateways=[],this.images=[]}ngOnInit(){this.gatewaysColumns=[{name:"Name",prop:"name"},{name:"State",prop:"state",flexGrow:1,cellTransformation:Be.e.badge,customTemplateConfig:{map:{up:{class:"badge-success"},down:{class:"badge-danger"}}}},{name:"# Targets",prop:"num_targets"},{name:"# Sessions",prop:"num_sessions"}],this.imagesColumns=[{name:"Pool",prop:"pool"},{name:"Image",prop:"image"},{name:"Backstore",prop:"backstore",pipe:this.iscsiBackstorePipe},{name:"Read Bytes",prop:"stats_history.rd_bytes",cellTemplate:this.iscsiSparklineTpl},{name:"Write Bytes",prop:"stats_history.wr_bytes",cellTemplate:this.iscsiSparklineTpl},{name:"Read Ops",prop:"stats.rd",pipe:this.dimlessPipe,cellTemplate:this.iscsiPerSecondTpl},{name:"Write Ops",prop:"stats.wr",pipe:this.dimlessPipe,cellTemplate:this.iscsiPerSecondTpl},{name:"A/O Since",prop:"optimized_since",cellTemplate:this.iscsiRelativeDateTpl}]}refresh(){this.iscsiService.overview().subscribe(t=>{this.gateways=t.gateways,this.images=t.images,this.images.map(o=>(o.stats_history&&(o.stats_history.rd_bytes=o.stats_history.rd_bytes.map(i=>i[1]),o.stats_history.wr_bytes=o.stats_history.wr_bytes.map(i=>i[1])),o.cdIsBinary=!0,o))})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(J),e.Y36(rt.n),e.Y36(je.V))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-iscsi"]],viewQuery:function(t,o){if(1&t&&(e.Gf(ti,7),e.Gf(oi,7),e.Gf(ni,7)),2&t){let i;e.iGM(i=e.CRH())&&(o.iscsiSparklineTpl=i.first),e.iGM(i=e.CRH())&&(o.iscsiPerSecondTpl=i.first),e.iGM(i=e.CRH())&&(o.iscsiRelativeDateTpl=i.first)}},decls:15,vars:4,consts:function(){let s,t;return s="Gateways",t="Images",[s,[3,"data","columns","fetchData"],t,[3,"data","columns"],["iscsiSparklineTpl",""],["iscsiPerSecondTpl",""],["iscsiRelativeDateTpl",""],[4,"ngIf"],["class","text-muted",4,"ngIf"],[3,"data","isBinary"],[1,"text-muted"]]},template:function(t,o){1&t&&(e._UZ(0,"cd-iscsi-tabs"),e.TgZ(1,"legend"),e.SDv(2,0),e.qZA(),e.TgZ(3,"div")(4,"cd-table",1),e.NdJ("fetchData",function(){return o.refresh()}),e.qZA()(),e.TgZ(5,"legend"),e.SDv(6,2),e.qZA(),e.TgZ(7,"div"),e._UZ(8,"cd-table",3),e.qZA(),e.YNc(9,_i,2,2,"ng-template",null,4,e.W1O),e.YNc(11,li,2,2,"ng-template",null,5,e.W1O),e.YNc(13,mi,2,2,"ng-template",null,6,e.W1O)),2&t&&(e.xp6(4),e.Q6J("data",o.gateways)("columns",o.gatewaysColumns),e.xp6(4),e.Q6J("data",o.images)("columns",o.imagesColumns))},dependencies:[c.O5,Wn.l,z.a,ht,ei.h,Rt.g]}),n})(),ui=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[c.ez,_e.m,P.Oz,p.Bz,a.u5,a.UX,P.ZQ,P.HK]}),n})();var gi=m(13464),Ti=m(26215),fi=m(45435),At=m(36848);let X=class{constructor(s,t){this.http=s,this.timerService=t,this.REFRESH_INTERVAL=3e4,this.summaryDataSource=new Ti.X(null),this.summaryData$=this.summaryDataSource.asObservable()}startPolling(){return this.timerService.get(()=>this.retrieveSummaryObservable(),this.REFRESH_INTERVAL).subscribe(this.retrieveSummaryObserver())}refresh(){return this.retrieveSummaryObservable().subscribe(this.retrieveSummaryObserver())}retrieveSummaryObservable(){return this.http.get("api/block/mirroring/summary")}retrieveSummaryObserver(){return s=>{this.summaryDataSource.next(s)}}subscribeSummary(s,t){return this.summaryData$.pipe((0,fi.h)(o=>!!o)).subscribe(s,t)}getPool(s){return this.http.get(`api/block/mirroring/pool/${s}`)}updatePool(s,t){return this.http.put(`api/block/mirroring/pool/${s}`,t,{observe:"response"})}getSiteName(){return this.http.get("api/block/mirroring/site_name")}setSiteName(s){return this.http.put("api/block/mirroring/site_name",{site_name:s},{observe:"response"})}createBootstrapToken(s){return this.http.post(`api/block/mirroring/pool/${s}/bootstrap/token`,{})}importBootstrapToken(s,t,o){return this.http.post(`api/block/mirroring/pool/${s}/bootstrap/peer`,{direction:t,token:o},{observe:"response"})}getPeer(s,t){return this.http.get(`api/block/mirroring/pool/${s}/peer/${t}`)}getPeerForPool(s){return this.http.get(`api/block/mirroring/pool/${s}/peer`)}addPeer(s,t){return this.http.post(`api/block/mirroring/pool/${s}/peer`,t,{observe:"response"})}updatePeer(s,t,o){return this.http.put(`api/block/mirroring/pool/${s}/peer/${t}`,o,{observe:"response"})}deletePeer(s,t){return this.http.delete(`api/block/mirroring/pool/${s}/peer/${t}`,{observe:"response"})}};X.\u0275fac=function(s){return new(s||X)(e.LFG(Te.eN),e.LFG(At.f))},X.\u0275prov=e.Yz7({token:X,factory:X.\u0275fac,providedIn:"root"}),(0,Q.gn)([(0,Q.fM)(0,fe.G),(0,Q.w6)("design:type",Function),(0,Q.w6)("design:paramtypes",[String]),(0,Q.w6)("design:returntype",void 0)],X.prototype,"setSiteName",null),(0,Q.gn)([(0,Q.fM)(1,fe.G),(0,Q.fM)(2,fe.G),(0,Q.w6)("design:type",Function),(0,Q.w6)("design:paramtypes",[String,String,String]),(0,Q.w6)("design:returntype",void 0)],X.prototype,"importBootstrapToken",null),X=(0,Q.gn)([fe.o,(0,Q.w6)("design:paramtypes",[Te.eN,At.f])],X);var lt=m(6481),Si=m(68307),Nt=m(12627),Ci=m(39749),Ei=m(13472),ve=m(82945);function Mi(n,s){1&n&&(e.TgZ(0,"span",25),e.SDv(1,26),e.qZA())}function Oi(n,s){if(1&n&&(e.TgZ(0,"div",27),e._UZ(1,"input",28),e.TgZ(2,"label",29),e._uU(3),e.qZA()()),2&n){const t=s.$implicit;e.xp6(1),e.s9C("id",t.name),e.s9C("name",t.name),e.s9C("formControlName",t.name),e.xp6(1),e.s9C("for",t.name),e.xp6(1),e.Oqu(t.name)}}function Ri(n,s){1&n&&(e.TgZ(0,"span",25),e.SDv(1,30),e.qZA())}let hi=(()=>{class n{constructor(t,o,i){this.activeModal=t,this.rbdMirroringService=o,this.taskWrapper=i,this.pools=[],this.createForm()}createForm(){this.createBootstrapForm=new A.d({siteName:new a.p4("",{validators:[a.kI.required]}),pools:new a.nJ({},{validators:[this.validatePools()]}),token:new a.p4("",{})})}ngOnInit(){this.createBootstrapForm.get("siteName").setValue(this.siteName),this.rbdMirroringService.getSiteName().subscribe(t=>{this.createBootstrapForm.get("siteName").setValue(t.site_name)}),this.subs=this.rbdMirroringService.subscribeSummary(t=>{this.pools=t.content_data.pools.reduce((_,r)=>(_.push({name:r.name,mirror_mode:r.mirror_mode}),_),[]);const i=this.createBootstrapForm.get("pools");S().each(this.pools,_=>{const r=_.name,l="disabled"===_.mirror_mode,d=i.controls[r];d?l&&d.disabled?d.enable():!l&&d.enabled&&(d.disable(),d.setValue(!0)):i.addControl(r,new a.p4({value:!l,disabled:!l}))})})}ngOnDestroy(){this.subs&&this.subs.unsubscribe()}validatePools(){return t=>{let o=0;return S().each(t.controls,i=>{!0===i.value&&++o}),o>0?null:{requirePool:!0}}}generate(){this.createBootstrapForm.get("token").setValue("");let t="";const o=[],i=this.createBootstrapForm.get("pools");S().each(i.controls,(u,f)=>{!0===u.value&&(t=f,u.disabled||o.push(f))});const _={mirror_mode:"image"},r=(0,lt.z)(this.rbdMirroringService.setSiteName(this.createBootstrapForm.getValue("siteName")),(0,ge.D)(o.map(u=>this.rbdMirroringService.updatePool(u,_))),this.rbdMirroringService.createBootstrapToken(t).pipe((0,Si.b)(u=>this.createBootstrapForm.get("token").setValue(u.token)))).pipe((0,Nt.Z)()),l=()=>{this.rbdMirroringService.refresh(),this.createBootstrapForm.setErrors({cdSubmitButton:!0})};this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/mirroring/bootstrap/create",{}),call:r}).subscribe({error:l,complete:l})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(P.Kz),e.Y36(X),e.Y36(G.P))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-bootstrap-create-modal"]],decls:32,vars:6,consts:function(){let s,t,o,i,_,r,l,d,u,f,M;return s="Create Bootstrap Token",t="To create a bootstrap token which can be imported by a peer site cluster, provide the local site's name, select which pools will have mirroring enabled, and click\xA0 \n          " + "\ufffd#10\ufffd" + "Generate\n          " + "\ufffd/#10\ufffd" + ".\n        ",o="Site Name",i="\uC774\uB984...",_="\uD480\uB4E4",r="Generate",l="Token",d="Generated token...",u="\uB2EB\uAE30",f="This field is required.",M="At least one pool is required.",[[3,"modalRef"],[1,"modal-title"],s,[1,"modal-content"],["name","createBootstrapForm","novalidate","",1,"form",3,"formGroup"],["formDir","ngForm"],[1,"modal-body"],t,[1,"form-group"],["for","siteName",1,"col-form-label","required"],o,["type","text","placeholder",i,"id","siteName","name","siteName","formControlName","siteName","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["formGroupName","pools",1,"form-group"],["for","pools",1,"col-form-label","required"],_,["class","custom-control custom-checkbox",4,"ngFor","ngForOf"],[1,"mb-4","float-end",3,"form","submitAction"],r,["for","token",1,"col-form-label"],l,["placeholder",d,"id","token","formControlName","token","readonly","",1,"form-control","resize-vertical"],["source","token",1,"float-end"],[1,"modal-footer"],["name",u,3,"backAction"],[1,"invalid-feedback"],f,[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"id","name","formControlName"],[1,"custom-control-label",3,"for"],M]},template:function(t,o){if(1&t&&(e.TgZ(0,"cd-modal",0),e.ynx(1,1),e.SDv(2,2),e.BQk(),e.ynx(3,3),e.TgZ(4,"form",4,5)(6,"div",6)(7,"p"),e.ynx(8),e.tHW(9,7),e._UZ(10,"kbd"),e.N_p(),e.BQk(),e.qZA(),e.TgZ(11,"div",8)(12,"label",9),e.SDv(13,10),e.qZA(),e._UZ(14,"input",11),e.YNc(15,Mi,2,0,"span",12),e.qZA(),e.TgZ(16,"div",13)(17,"label",14),e.SDv(18,15),e.qZA(),e.YNc(19,Oi,4,5,"div",16),e.YNc(20,Ri,2,0,"span",12),e.qZA(),e.TgZ(21,"cd-submit-button",17),e.NdJ("submitAction",function(){return o.generate()}),e.SDv(22,18),e.qZA(),e.TgZ(23,"div",8)(24,"label",19)(25,"span"),e.SDv(26,20),e.qZA()(),e.TgZ(27,"textarea",21),e._uU(28,"          "),e.qZA()(),e._UZ(29,"cd-copy-2-clipboard-button",22),e.qZA(),e.TgZ(30,"div",23)(31,"cd-back-button",24),e.NdJ("backAction",function(){return o.activeModal.close()}),e.qZA()()(),e.BQk(),e.qZA()),2&t){const i=e.MAs(5);e.Q6J("modalRef",o.activeModal),e.xp6(4),e.Q6J("formGroup",o.createBootstrapForm),e.xp6(11),e.Q6J("ngIf",o.createBootstrapForm.showError("siteName",i,"required")),e.xp6(4),e.Q6J("ngForOf",o.pools),e.xp6(1),e.Q6J("ngIf",o.createBootstrapForm.showError("pools",i,"requirePool")),e.xp6(1),e.Q6J("form",o.createBootstrapForm)}},dependencies:[c.sg,c.O5,Ci.w,Ei.W,Y.z,We.s,ve.U,L.o,g.b,T.P,b.V,a._Y,a.Fj,a.Wl,a.JJ,a.JL,a.sg,a.u,a.x0],styles:[".form-group.ng-invalid[_ngcontent-%COMP%]   .invalid-feedback[_ngcontent-%COMP%]{display:block}"]}),n})();function Ai(n,s){1&n&&(e.TgZ(0,"span",26),e.SDv(1,27),e.qZA())}function Ni(n,s){if(1&n&&(e.TgZ(0,"option",28),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t.key),e.xp6(1),e.Oqu(t.desc)}}function Pi(n,s){if(1&n&&(e.TgZ(0,"div",29),e._UZ(1,"input",30),e.TgZ(2,"label",31),e._uU(3),e.qZA()()),2&n){const t=s.$implicit;e.xp6(1),e.s9C("id",t.name),e.s9C("name",t.name),e.s9C("formControlName",t.name),e.xp6(1),e.s9C("for",t.name),e.xp6(1),e.Oqu(t.name)}}function bi(n,s){1&n&&(e.TgZ(0,"span",26),e.SDv(1,32),e.qZA())}function Ii(n,s){1&n&&(e.TgZ(0,"span",26),e.SDv(1,33),e.qZA())}function Fi(n,s){1&n&&(e.TgZ(0,"span",26),e.SDv(1,34),e.qZA())}let vi=(()=>{class n{constructor(t,o,i,_){this.activeModal=t,this.actionLabels=o,this.rbdMirroringService=i,this.taskWrapper=_,this.pools=[],this.directions=[{key:"rx-tx",desc:"Bidirectional"},{key:"rx",desc:"Unidirectional (receive-only)"}],this.createForm()}createForm(){this.importBootstrapForm=new A.d({siteName:new a.p4("",{validators:[a.kI.required]}),direction:new a.p4("rx-tx",{}),pools:new a.nJ({},{validators:[this.validatePools()]}),token:new a.p4("",{validators:[a.kI.required,this.validateToken()]})})}ngOnInit(){this.rbdMirroringService.getSiteName().subscribe(t=>{this.importBootstrapForm.get("siteName").setValue(t.site_name)}),this.subs=this.rbdMirroringService.subscribeSummary(t=>{this.pools=t.content_data.pools.reduce((_,r)=>(_.push({name:r.name,mirror_mode:r.mirror_mode}),_),[]);const i=this.importBootstrapForm.get("pools");S().each(this.pools,_=>{const r=_.name,l="disabled"===_.mirror_mode,d=i.controls[r];d?l&&d.disabled?d.enable():!l&&d.enabled&&(d.disable(),d.setValue(!0)):i.addControl(r,new a.p4({value:!l,disabled:!l}))})})}ngOnDestroy(){this.subs&&this.subs.unsubscribe()}validatePools(){return t=>{let o=0;return S().each(t.controls,i=>{!0===i.value&&++o}),o>0?null:{requirePool:!0}}}validateToken(){return t=>{try{if(JSON.parse(atob(t.value)))return null}catch{}return{invalidToken:!0}}}import(){const t=[],o=[],i=this.importBootstrapForm.get("pools");S().each(i.controls,(u,f)=>{!0===u.value&&(t.push(f),u.disabled||o.push(f))});const _={mirror_mode:"image"};let r=(0,lt.z)(this.rbdMirroringService.setSiteName(this.importBootstrapForm.getValue("siteName")),(0,ge.D)(o.map(u=>this.rbdMirroringService.updatePool(u,_))));r=t.reduce((u,f)=>(0,lt.z)(u,this.rbdMirroringService.importBootstrapToken(f,this.importBootstrapForm.getValue("direction"),this.importBootstrapForm.getValue("token"))),r).pipe((0,Nt.Z)());const l=()=>{this.rbdMirroringService.refresh(),this.importBootstrapForm.setErrors({cdSubmitButton:!0})};this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/mirroring/bootstrap/import",{}),call:r}).subscribe({error:l,complete:()=>{l(),this.activeModal.close()}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(P.Kz),e.Y36(E.p4),e.Y36(X),e.Y36(G.P))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-bootstrap-import-modal"]],decls:36,vars:10,consts:function(){let s,t,o,i,_,r,l,d,u,f,M,O;return s="Import Bootstrap Token",t="To import a bootstrap token which was created by a peer site cluster, provide the local site's name, select which pools will have mirroring enabled, provide the generated token, and click\xA0\n          " + "\ufffd#10\ufffd" + "Import\n          " + "\ufffd/#10\ufffd" + ".\n        ",o="Site Name",i="\uC774\uB984...",_="Direction",r="\uD480\uB4E4",l="Token",d="Generated token...",u="This field is required.",f="At least one pool is required.",M="This field is required.",O="The token is invalid.",[[3,"modalRef"],[1,"modal-title"],s,[1,"modal-content"],["name","importBootstrapForm","novalidate","",1,"form",3,"formGroup"],["formDir","ngForm"],[1,"modal-body"],t,[1,"form-group"],["for","siteName",1,"col-form-label","required"],o,["type","text","placeholder",i,"id","siteName","name","siteName","formControlName","siteName","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","direction",1,"col-form-label"],_,["id","direction","name","direction","formControlName","direction",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],["formGroupName","pools",1,"form-group"],["for","pools",1,"col-form-label","required"],r,["class","custom-control custom-checkbox",4,"ngFor","ngForOf"],["for","token",1,"col-form-label","required"],l,["placeholder",d,"id","token","formControlName","token",1,"form-control","resize-vertical"],[1,"modal-footer"],[3,"form","submitText","submitActionEvent"],[1,"invalid-feedback"],u,[3,"value"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"id","name","formControlName"],[1,"custom-control-label",3,"for"],f,M,O]},template:function(t,o){if(1&t&&(e.TgZ(0,"cd-modal",0),e.ynx(1,1),e.SDv(2,2),e.BQk(),e.ynx(3,3),e.TgZ(4,"form",4,5)(6,"div",6)(7,"p"),e.ynx(8),e.tHW(9,7),e._UZ(10,"kbd"),e.N_p(),e.BQk(),e.qZA(),e.TgZ(11,"div",8)(12,"label",9),e.SDv(13,10),e.qZA(),e._UZ(14,"input",11),e.YNc(15,Ai,2,0,"span",12),e.qZA(),e.TgZ(16,"div",8)(17,"label",13)(18,"span"),e.SDv(19,14),e.qZA()(),e.TgZ(20,"select",15),e.YNc(21,Ni,2,2,"option",16),e.qZA()(),e.TgZ(22,"div",17)(23,"label",18),e.SDv(24,19),e.qZA(),e.YNc(25,Pi,4,5,"div",20),e.YNc(26,bi,2,0,"span",12),e.qZA(),e.TgZ(27,"div",8)(28,"label",21),e.SDv(29,22),e.qZA(),e.TgZ(30,"textarea",23),e._uU(31,"          "),e.qZA(),e.YNc(32,Ii,2,0,"span",12),e.YNc(33,Fi,2,0,"span",12),e.qZA()(),e.TgZ(34,"div",24)(35,"cd-form-button-panel",25),e.NdJ("submitActionEvent",function(){return o.import()}),e.qZA()()(),e.BQk(),e.qZA()),2&t){const i=e.MAs(5);e.Q6J("modalRef",o.activeModal),e.xp6(4),e.Q6J("formGroup",o.importBootstrapForm),e.xp6(11),e.Q6J("ngIf",o.importBootstrapForm.showError("siteName",i,"required")),e.xp6(6),e.Q6J("ngForOf",o.directions),e.xp6(4),e.Q6J("ngForOf",o.pools),e.xp6(1),e.Q6J("ngIf",o.importBootstrapForm.showError("pools",i,"requirePool")),e.xp6(6),e.Q6J("ngIf",o.importBootstrapForm.showError("token",i,"required")),e.xp6(1),e.Q6J("ngIf",o.importBootstrapForm.showError("token",i,"invalidToken")),e.xp6(2),e.Q6J("form",o.importBootstrapForm)("submitText",o.actionLabels.SUBMIT)}},dependencies:[c.sg,c.O5,Y.z,R.p,ve.U,L.o,g.b,T.P,b.V,a._Y,a.YN,a.Kr,a.Fj,a.Wl,a.EJ,a.JJ,a.JL,a.sg,a.u,a.x0]}),n})();var de=m(69158),Li=m(58111);let ct=(()=>{class n{transform(t){return"warning"===t?"badge badge-warning":"error"===t?"badge badge-danger":"success"===t?"badge badge-success":"badge badge-info"}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275pipe=e.Yjl({name:"mirrorHealthColor",type:n,pure:!0}),n})();const Di=["healthTmpl"];function $i(n,s){if(1&n&&(e.TgZ(0,"span",2),e.ALo(1,"mirrorHealthColor"),e._uU(2),e.qZA()),2&n){const o=s.value;e.Q6J("ngClass",e.lcZ(1,2,s.row.health_color)),e.xp6(2),e.Oqu(o)}}let Bi=(()=>{class n{constructor(t,o){this.rbdMirroringService=t,this.cephShortVersionPipe=o,this.tableStatus=new de.E}ngOnInit(){this.columns=[{prop:"instance_id",name:"Instance",flexGrow:2},{prop:"id",name:"ID",flexGrow:2},{prop:"server_hostname",name:"Hostname",flexGrow:2},{prop:"version",name:"Version",pipe:this.cephShortVersionPipe,flexGrow:2},{prop:"health",name:"Health",cellTemplate:this.healthTmpl,flexGrow:1}],this.subs=this.rbdMirroringService.subscribeSummary(t=>{this.data=t.content_data.daemons,this.tableStatus=new de.E(t.status)})}ngOnDestroy(){this.subs.unsubscribe()}refresh(){this.rbdMirroringService.refresh()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(X),e.Y36(Li.F))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-mirroring-daemons"]],viewQuery:function(t,o){if(1&t&&e.Gf(Di,7),2&t){let i;e.iGM(i=e.CRH())&&(o.healthTmpl=i.first)}},decls:3,vars:4,consts:[["columnMode","flex",3,"data","columns","autoReload","status","fetchData"],["healthTmpl",""],[3,"ngClass"]],template:function(t,o){1&t&&(e.TgZ(0,"cd-table",0),e.NdJ("fetchData",function(){return o.refresh()}),e.qZA(),e.YNc(1,$i,3,4,"ng-template",null,1,e.W1O)),2&t&&e.Q6J("data",o.data)("columns",o.columns)("autoReload",-1)("status",o.tableStatus)},dependencies:[c.mk,z.a,ct]}),n})();var dt=m(59376);const Gi=["stateTmpl"],yi=["syncTmpl"],xi=["progressTmpl"],Zi=["entriesBehindPrimaryTpl"];function wi(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"cd-table",14),e.NdJ("fetchData",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.refresh())}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("data",t.image_error.data)("columns",t.image_error.columns)("autoReload",-1)("status",t.tableStatus)}}function Hi(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"cd-table",14),e.NdJ("fetchData",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.refresh())}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("data",t.image_syncing.data)("columns",t.image_syncing.columns)("autoReload",-1)("status",t.tableStatus)}}function qi(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"cd-table",14),e.NdJ("fetchData",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.refresh())}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("data",t.image_ready.data)("columns",t.image_ready.columns)("autoReload",-1)("status",t.tableStatus)}}function Ki(n,s){if(1&n&&(e.TgZ(0,"span",15),e.ALo(1,"mirrorHealthColor"),e._uU(2),e.qZA()),2&n){const o=s.value;e.Q6J("ngClass",e.lcZ(1,2,s.row.state_color)),e.xp6(2),e.Oqu(o)}}function ki(n,s){1&n&&e._UZ(0,"div")}function Vi(n,s){if(1&n&&e._UZ(0,"ngb-progressbar",19),2&n){const t=e.oxw().value;e.Q6J("value",t)("showValue",!0)}}function Qi(n,s){if(1&n&&(e.YNc(0,ki,1,0,"div",16),e.TgZ(1,"div",17),e.YNc(2,Vi,1,2,"ngb-progressbar",18),e.qZA()),2&n){const t=s.row;e.Q6J("ngIf","Replaying"===t.state),e.xp6(2),e.Q6J("ngIf","Replaying"===t.state)}}function Xi(n,s){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw().value;e.xp6(1),e.hij(" ",t," ")}}function Yi(n,s){1&n&&(e.TgZ(0,"span",21),e._uU(1,"-"),e.qZA())}function zi(n,s){if(1&n&&(e.YNc(0,Xi,2,1,"span",16),e.YNc(1,Yi,2,0,"span",20)),2&n){const t=s.row;e.Q6J("ngIf","journal"===t.mirror_mode),e.xp6(1),e.Q6J("ngIf","snapshot"===t.mirror_mode)}}let Ji=(()=>{class n{constructor(t){this.rbdMirroringService=t,this.image_error={data:[],columns:{}},this.image_syncing={data:[],columns:{}},this.image_ready={data:[],columns:{}},this.tableStatus=new de.E}ngOnInit(){this.image_error.columns=[{prop:"pool_name",name:"Pool",flexGrow:2},{prop:"name",name:"Image",flexGrow:2},{prop:"state",name:"State",cellTemplate:this.stateTmpl,flexGrow:1},{prop:"description",name:"Issue",flexGrow:4}],this.image_syncing.columns=[{prop:"pool_name",name:"Pool",flexGrow:2},{prop:"name",name:"Image",flexGrow:2},{prop:"state",name:"State",cellTemplate:this.stateTmpl,flexGrow:1},{prop:"syncing_percent",name:"Progress",cellTemplate:this.progressTmpl,flexGrow:2},{prop:"bytes_per_second",name:"Bytes per second",flexGrow:2},{prop:"entries_behind_primary",name:"Entries behind primary",cellTemplate:this.entriesBehindPrimaryTpl,flexGrow:2}],this.image_ready.columns=[{prop:"pool_name",name:"Pool",flexGrow:2},{prop:"name",name:"Image",flexGrow:2},{prop:"state",name:"State",cellTemplate:this.stateTmpl,flexGrow:1},{prop:"description",name:"Description",flexGrow:4}],this.subs=this.rbdMirroringService.subscribeSummary(t=>{this.image_error.data=t.content_data.image_error,this.image_syncing.data=t.content_data.image_syncing,this.image_ready.data=t.content_data.image_ready,this.tableStatus=new de.E(t.status)})}ngOnDestroy(){this.subs.unsubscribe()}refresh(){this.rbdMirroringService.refresh()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(X))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-mirroring-images"]],viewQuery:function(t,o){if(1&t&&(e.Gf(Gi,7),e.Gf(yi,7),e.Gf(xi,7),e.Gf(Zi,7)),2&t){let i;e.iGM(i=e.CRH())&&(o.stateTmpl=i.first),e.iGM(i=e.CRH())&&(o.syncTmpl=i.first),e.iGM(i=e.CRH())&&(o.progressTmpl=i.first),e.iGM(i=e.CRH())&&(o.entriesBehindPrimaryTpl=i.first)}},decls:21,vars:4,consts:function(){let s,t,o;return s="Issues (" + "\ufffd0\ufffd" + ")",t="Syncing (" + "\ufffd0\ufffd" + ")",o="Ready (" + "\ufffd0\ufffd" + ")",[["ngbNav","","cdStatefulTab","image-list",1,"nav-tabs"],["nav","ngbNav"],["ngbNavItem","issues"],["ngbNavLink",""],s,["ngbNavContent",""],["ngbNavItem","syncing"],t,["ngbNavItem","ready"],o,[3,"ngbNavOutlet"],["stateTmpl",""],["progressTmpl",""],["entriesBehindPrimaryTpl",""],["columnMode","flex",3,"data","columns","autoReload","status","fetchData"],[3,"ngClass"],[4,"ngIf"],[1,"w-100","h-100","d-flex","justify-content-center","align-items-center"],["type","info","class","w-100",3,"value","showValue",4,"ngIf"],["type","info",1,"w-100",3,"value","showValue"],["ngbTooltip","Not available with mirroring snapshot mode",4,"ngIf"],["ngbTooltip","Not available with mirroring snapshot mode"]]},template:function(t,o){if(1&t&&(e.TgZ(0,"nav",0,1),e.ynx(2,2),e.TgZ(3,"a",3),e.SDv(4,4),e.qZA(),e.YNc(5,wi,1,4,"ng-template",5),e.BQk(),e.ynx(6,6),e.TgZ(7,"a",3),e.SDv(8,7),e.qZA(),e.YNc(9,Hi,1,4,"ng-template",5),e.BQk(),e.ynx(10,8),e.TgZ(11,"a",3),e.SDv(12,9),e.qZA(),e.YNc(13,qi,1,4,"ng-template",5),e.BQk(),e.qZA(),e._UZ(14,"div",10),e.YNc(15,Ki,3,4,"ng-template",null,11,e.W1O),e.YNc(17,Qi,3,2,"ng-template",null,12,e.W1O),e.YNc(19,zi,2,2,"ng-template",null,13,e.W1O)),2&t){const i=e.MAs(1);e.xp6(4),e.pQV(o.image_error.data.length),e.QtT(4),e.xp6(4),e.pQV(o.image_syncing.data.length),e.QtT(8),e.xp6(4),e.pQV(o.image_ready.data.length),e.QtT(12),e.xp6(2),e.Q6J("ngbNavOutlet",i)}},dependencies:[c.mk,c.O5,z.a,dt.m,P.uN,P.Pz,P.nv,P.Vx,P.tO,P.Dy,P.Ly,P._L,ct]}),n})();var Pt=m(70882);class Ui{}function ji(n,s){1&n&&(e.TgZ(0,"span",24),e.SDv(1,25),e.qZA())}function Wi(n,s){1&n&&(e.TgZ(0,"span",24),e.SDv(1,26),e.qZA())}function es(n,s){1&n&&(e.TgZ(0,"span",24),e.SDv(1,27),e.qZA())}function ts(n,s){1&n&&(e.TgZ(0,"span",24),e.SDv(1,28),e.qZA())}function os(n,s){1&n&&(e.TgZ(0,"span",24),e.SDv(1,29),e.qZA())}function ns(n,s){1&n&&(e.TgZ(0,"span",24),e.SDv(1,30),e.qZA())}let is=(()=>{class n{constructor(t,o,i,_){this.activeModal=t,this.actionLabels=o,this.rbdMirroringService=i,this.taskWrapper=_,this.bsConfig={containerClass:"theme-default"},this.createForm()}createForm(){this.editPeerForm=new A.d({clusterName:new a.p4("",{validators:[a.kI.required,this.validateClusterName]}),clientID:new a.p4("",{validators:[a.kI.required,this.validateClientID]}),monAddr:new a.p4("",{validators:[this.validateMonAddr]}),key:new a.p4("",{validators:[this.validateKey]})})}ngOnInit(){this.pattern=`${this.poolName}/${this.peerUUID}`,"edit"===this.mode&&this.rbdMirroringService.getPeer(this.poolName,this.peerUUID).subscribe(t=>{this.setResponse(t)})}validateClusterName(t){if(!t.value.match(/^[\w\-_]*$/))return{invalidClusterName:{value:t.value}}}validateClientID(t){if(!t.value.match(/^(?!client\.)[\w\-_.]*$/))return{invalidClientID:{value:t.value}}}validateMonAddr(t){if(!t.value.match(/^[,; ]*([\w.\-_\[\]]+(:[\d]+)?[,; ]*)*$/))return{invalidMonAddr:{value:t.value}}}validateKey(t){try{if(""===t.value||atob(t.value))return null}catch{}return{invalidKey:{value:t.value}}}setResponse(t){this.response=t,this.editPeerForm.get("clusterName").setValue(t.cluster_name),this.editPeerForm.get("clientID").setValue(t.client_id),this.editPeerForm.get("monAddr").setValue(t.mon_host),this.editPeerForm.get("key").setValue(t.key)}update(){const t=new Ui;let o;t.cluster_name=this.editPeerForm.getValue("clusterName"),t.client_id=this.editPeerForm.getValue("clientID"),t.mon_host=this.editPeerForm.getValue("monAddr"),t.key=this.editPeerForm.getValue("key"),o=this.taskWrapper.wrapTaskAroundCall("edit"===this.mode?{task:new N.R("rbd/mirroring/peer/edit",{pool_name:this.poolName}),call:this.rbdMirroringService.updatePeer(this.poolName,this.peerUUID,t)}:{task:new N.R("rbd/mirroring/peer/add",{pool_name:this.poolName}),call:this.rbdMirroringService.addPeer(this.poolName,t)}),o.subscribe({error:()=>this.editPeerForm.setErrors({cdSubmitButton:!0}),complete:()=>{this.rbdMirroringService.refresh(),this.activeModal.close()}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(P.Kz),e.Y36(E.p4),e.Y36(X),e.Y36(G.P))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-pool-edit-peer-modal"]],decls:38,vars:13,consts:function(){let s,t,o,i,_,r,l,d,u,f,M,O,I,B,V,Z,ne,ie;return s="{VAR_SELECT, select, edit {Edit} other {Add}}",s=e.Zx4(s,{VAR_SELECT:"\ufffd0\ufffd"}),t="\n          " + s + " pool mirror peer\n        ",o="{VAR_SELECT, select, edit {Edit} other {Add}}",o=e.Zx4(o,{VAR_SELECT:"\ufffd0\ufffd"}),i="\n          " + o + " the pool mirror peer attributes for pool \n          " + "[\ufffd#10\ufffd|\ufffd#11\ufffd]" + "\n          " + "\ufffd1\ufffd" + "\n          " + "[\ufffd/#10\ufffd|\ufffd/#11\ufffd]" + " and click \n          " + "[\ufffd#10\ufffd|\ufffd#11\ufffd]" + "Submit\n          " + "[\ufffd/#10\ufffd|\ufffd/#11\ufffd]" + ".\n        ",i=e.Zx4(i),_="\uD074\uB7EC\uC2A4\uD130 \uC774\uB984",r="\uC774\uB984...",l="CephX \uC544\uC774\uB514",d="CephX \uC544\uC774\uB514...",u="\uBAA8\uB2C8\uD130 \uC8FC\uC18C\uB4E4",f="\uCF64\uB9C8\uB85C \uBD84\uB9AC\uB41C \uC8FC\uC18C\uB4E4...",M="CephX \uD0A4",O="Base64\uB85C \uC778\uCF54\uB529 \uB41C \uD0A4 ...",I="This field is required.",B="\uD074\uB7EC\uC2A4\uD130 \uC774\uB984\uC774 \uC720\uD6A8\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.",V="This field is required.",Z="CephX \uC544\uC774\uB514\uAC00 \uC720\uD6A8\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.",ne="\uBAA8\uB2C8\uD130 \uC8FC\uC18C\uAC00 \uC720\uD6A8\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.",ie="CephX \uD0A4\uB294 \uBC18\uB4DC\uC2DC base64\uB85C \uC778\uCF54\uB4DC \uB418\uC5B4\uC57C \uD569\uB2C8\uB2E4.",[[3,"modalRef"],[1,"modal-title"],t,[1,"modal-content"],["name","editPeerForm","novalidate","",1,"form",3,"formGroup"],["formDir","ngForm"],[1,"modal-body"],i,[1,"form-group"],["for","clusterName",1,"col-form-label","required"],_,["type","text","placeholder",r,"id","clusterName","name","clusterName","formControlName","clusterName","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","clientID",1,"col-form-label","required"],l,["type","text","placeholder",d,"id","clientID","name","clientID","formControlName","clientID",1,"form-control"],["for","monAddr",1,"col-form-label"],u,["type","text","placeholder",f,"id","monAddr","name","monAddr","formControlName","monAddr",1,"form-control"],["for","key",1,"col-form-label"],M,["type","text","placeholder",O,"id","key","name","key","formControlName","key",1,"form-control"],[1,"modal-footer"],[3,"form","submitText","submitActionEvent"],[1,"invalid-feedback"],I,B,V,Z,ne,ie]},template:function(t,o){if(1&t&&(e.TgZ(0,"cd-modal",0)(1,"span",1),e.SDv(2,2),e.qZA(),e.ynx(3,3),e.TgZ(4,"form",4,5)(6,"div",6)(7,"p")(8,"span"),e.tHW(9,7),e._UZ(10,"kbd")(11,"kbd"),e.N_p(),e.qZA()(),e.TgZ(12,"div",8)(13,"label",9),e.SDv(14,10),e.qZA(),e._UZ(15,"input",11),e.YNc(16,ji,2,0,"span",12),e.YNc(17,Wi,2,0,"span",12),e.qZA(),e.TgZ(18,"div",8)(19,"label",13),e.SDv(20,14),e.qZA(),e._UZ(21,"input",15),e.YNc(22,es,2,0,"span",12),e.YNc(23,ts,2,0,"span",12),e.qZA(),e.TgZ(24,"div",8)(25,"label",16)(26,"span"),e.SDv(27,17),e.qZA()(),e._UZ(28,"input",18),e.YNc(29,os,2,0,"span",12),e.qZA(),e.TgZ(30,"div",8)(31,"label",19)(32,"span"),e.SDv(33,20),e.qZA()(),e._UZ(34,"input",21),e.YNc(35,ns,2,0,"span",12),e.qZA()(),e.TgZ(36,"div",22)(37,"cd-form-button-panel",23),e.NdJ("submitActionEvent",function(){return o.update()}),e.qZA()()(),e.BQk(),e.qZA()),2&t){const i=e.MAs(5);e.Q6J("modalRef",o.activeModal),e.xp6(2),e.pQV(o.mode),e.QtT(2),e.xp6(2),e.Q6J("formGroup",o.editPeerForm),e.xp6(7),e.pQV(o.mode)(o.poolName),e.QtT(9),e.xp6(5),e.Q6J("ngIf",o.editPeerForm.showError("clusterName",i,"required")),e.xp6(1),e.Q6J("ngIf",o.editPeerForm.showError("clusterName",i,"invalidClusterName")),e.xp6(5),e.Q6J("ngIf",o.editPeerForm.showError("clientID",i,"required")),e.xp6(1),e.Q6J("ngIf",o.editPeerForm.showError("clientID",i,"invalidClientID")),e.xp6(6),e.Q6J("ngIf",o.editPeerForm.showError("monAddr",i,"invalidMonAddr")),e.xp6(6),e.Q6J("ngIf",o.editPeerForm.showError("key",i,"invalidKey")),e.xp6(2),e.Q6J("form",o.editPeerForm)("submitText",o.actionLabels.SUBMIT)}},dependencies:[c.O5,Y.z,R.p,ve.U,L.o,g.b,T.P,b.V,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u]}),n})();const ss=["healthTmpl"],_s=["localTmpl"],as=["remoteTmpl"];function rs(n,s){if(1&n&&(e.TgZ(0,"span",6),e.ALo(1,"mirrorHealthColor"),e._uU(2),e.qZA()),2&n){const o=s.value;e.Q6J("ngClass",e.lcZ(1,2,s.row.health_color)),e.xp6(2),e.Oqu(o)}}function ls(n,s){1&n&&(e.TgZ(0,"span",7),e.SDv(1,8),e.qZA())}function cs(n,s){1&n&&(e.TgZ(0,"span",9),e.SDv(1,10),e.qZA())}let ms=(()=>{class n{constructor(t,o,i,_,r){this.authStorageService=t,this.rbdMirroringService=o,this.modalService=i,this.taskWrapper=_,this.router=r,this.selection=new le.r,this.tableStatus=new de.E,this.data=[],this.permission=this.authStorageService.getPermissions().rbdMirroring;const l={permission:"update",icon:C.P.edit,click:()=>this.editModeModal(),name:"Edit Mode",canBePrimary:()=>!0},d={permission:"create",icon:C.P.add,name:"Add Peer",click:()=>this.editPeersModal("add"),disable:()=>!this.selection.first()||"disabled"===this.selection.first().mirror_mode,visible:()=>!this.getPeerUUID(),canBePrimary:()=>!1},u={permission:"update",icon:C.P.exchange,name:"Edit Peer",click:()=>this.editPeersModal("edit"),visible:()=>!!this.getPeerUUID()},f={permission:"delete",icon:C.P.destroy,name:"Delete Peer",click:()=>this.deletePeersModal(),visible:()=>!!this.getPeerUUID()};this.tableActions=[l,d,u,f]}ngOnInit(){this.columns=[{prop:"name",name:"Name",flexGrow:2},{prop:"mirror_mode",name:"Mode",flexGrow:2},{prop:"leader_id",name:"Leader",flexGrow:2},{prop:"image_local_count",name:"# Local",headerTemplate:this.localTmpl,flexGrow:2},{prop:"image_remote_count",name:"# Remote",headerTemplate:this.remoteTmpl,flexGrow:2},{prop:"health",name:"Health",cellTemplate:this.healthTmpl,flexGrow:1}],this.subs=this.rbdMirroringService.subscribeSummary(t=>{this.data=t.content_data.pools,this.tableStatus=new de.E(t.status)})}ngOnDestroy(){this.subs.unsubscribe()}refresh(){this.rbdMirroringService.refresh()}editModeModal(){this.router.navigate(["/block/mirroring",{outlets:{modal:[E.MQ.EDIT,this.selection.first().name]}}])}editPeersModal(t){const o={poolName:this.selection.first().name,mode:t};"edit"===t&&(o.peerUUID=this.getPeerUUID()),this.modalRef=this.modalService.show(is,o)}deletePeersModal(){const t=this.selection.first().name,o=this.getPeerUUID();this.modalRef=this.modalService.show(re.M,{itemDescription:"mirror peer",itemNames:[`${t} (${o})`],submitActionObservable:()=>new Pt.y(i=>{this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/mirroring/peer/delete",{pool_name:t}),call:this.rbdMirroringService.deletePeer(t,o)}).subscribe({error:_=>i.error(_),complete:()=>{this.rbdMirroringService.refresh(),i.complete()}})})})}getPeerUUID(){const t=this.selection.first(),o=this.data.find(i=>t&&t.name===i.name);if(o&&o.peer_uuids)return o.peer_uuids[0]}updateSelection(t){this.selection=t}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(k.j),e.Y36(X),e.Y36(ae.Z),e.Y36(G.P),e.Y36(p.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-mirroring-pools"]],viewQuery:function(t,o){if(1&t&&(e.Gf(ss,7),e.Gf(_s,7),e.Gf(as,7)),2&t){let i;e.iGM(i=e.CRH())&&(o.healthTmpl=i.first),e.iGM(i=e.CRH())&&(o.localTmpl=i.first),e.iGM(i=e.CRH())&&(o.remoteTmpl=i.first)}},decls:9,vars:7,consts:function(){let s,t,o,i;return s="Local image count",t="# Local",o="Remote image count",i="# Remote",[["columnMode","flex","identifier","name","forceIdentifier","true","selectionType","single",3,"data","columns","autoReload","status","fetchData","updateSelection"],[1,"table-actions",3,"permission","selection","tableActions"],["healthTmpl",""],["localTmpl",""],["remoteTmpl",""],["name","modal"],[3,"ngClass"],["ngbTooltip",s],t,["ngbTooltip",o],i]},template:function(t,o){1&t&&(e.TgZ(0,"cd-table",0),e.NdJ("fetchData",function(){return o.refresh()})("updateSelection",function(_){return o.updateSelection(_)}),e._UZ(1,"cd-table-actions",1),e.qZA(),e.YNc(2,rs,3,4,"ng-template",null,2,e.W1O),e.YNc(4,ls,2,0,"ng-template",null,3,e.W1O),e.YNc(6,cs,2,0,"ng-template",null,4,e.W1O),e._UZ(8,"router-outlet",5)),2&t&&(e.Q6J("data",o.data)("columns",o.columns)("autoReload",-1)("status",o.tableStatus),e.xp6(1),e.Q6J("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[c.mk,z.a,ce.K,p.lC,P._L,ct]}),n})();function ps(n,s){if(1&n&&e._UZ(0,"i",19),2&n){const t=e.oxw();e.Q6J("ngClass",t.icons.edit)}}function us(n,s){if(1&n&&e._UZ(0,"i",19),2&n){const t=e.oxw();e.Q6J("ngClass",t.icons.check)}}let gs=(()=>{class n{constructor(t,o,i,_){this.authStorageService=t,this.rbdMirroringService=o,this.modalService=i,this.taskWrapper=_,this.selection=new le.r,this.peersExist=!0,this.subs=new gi.w,this.editing=!1,this.icons=C.P,this.permission=this.authStorageService.getPermissions().rbdMirroring;const r={permission:"update",icon:C.P.upload,click:()=>this.createBootstrapModal(),name:"Create Bootstrap Token",canBePrimary:()=>!0,disable:()=>!1},l={permission:"update",icon:C.P.download,click:()=>this.importBootstrapModal(),name:"Import Bootstrap Token",disable:()=>!1};this.tableActions=[r,l]}ngOnInit(){this.createForm(),this.subs.add(this.rbdMirroringService.startPolling()),this.subs.add(this.rbdMirroringService.subscribeSummary(t=>{this.status=t.content_data.status,this.peersExist=!!t.content_data.pools.find(o=>o.peer_uuids.length>0)})),this.rbdMirroringService.getSiteName().subscribe(t=>{this.siteName=t.site_name,this.rbdmirroringForm.get("siteName").setValue(this.siteName)})}createForm(){this.rbdmirroringForm=new A.d({siteName:new a.p4({value:"",disabled:!0})})}ngOnDestroy(){this.subs.unsubscribe()}updateSiteName(){this.editing&&this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/mirroring/site_name/edit",{}),call:this.rbdMirroringService.setSiteName(this.rbdmirroringForm.getValue("siteName"))}).subscribe({complete:()=>{this.rbdMirroringService.refresh()}}),this.editing=!this.editing}createBootstrapModal(){this.modalRef=this.modalService.show(hi,{siteName:this.siteName})}importBootstrapModal(){this.modalRef=this.modalService.show(vi,{siteName:this.siteName})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(k.j),e.Y36(X),e.Y36(ae.Z),e.Y36(G.P))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-mirroring"]],decls:31,vars:10,consts:function(){let s,t,o,i;return s="Site Name",t="Daemons",o="\uD480\uB4E4",i="Images",[["name","rbdmirroringForm","novalidate","",3,"formGroup"],["formDir","ngForm"],[1,"row","mb-3"],[1,"col-md-auto"],["for","siteName",1,"col-form-label"],s,[1,"col-sm-4","d-flex"],["type","text","id","siteName","name","siteName","formControlName","siteName",1,"form-control"],["id","editSiteName",1,"btn","btn-light",3,"click"],[3,"ngClass",4,"ngIf"],[3,"source","byId"],[1,"col"],[1,"table-actions","float-end",3,"permission","selection","tableActions"],[1,"row"],[1,"col-sm-6"],t,o,[1,"col-md-12"],i,[3,"ngClass"]]},template:function(t,o){1&t&&(e.TgZ(0,"form",0,1)(2,"div",2)(3,"div",3)(4,"label",4),e.SDv(5,5),e.qZA()(),e.TgZ(6,"div",6),e._UZ(7,"input",7),e.TgZ(8,"button",8),e.NdJ("click",function(){return o.updateSiteName()}),e.YNc(9,ps,1,1,"i",9),e.YNc(10,us,1,1,"i",9),e.qZA(),e._UZ(11,"cd-copy-2-clipboard-button",10),e.qZA(),e.TgZ(12,"div",11),e._UZ(13,"cd-table-actions",12),e.qZA()()(),e.TgZ(14,"div",13)(15,"div",14)(16,"legend"),e.SDv(17,15),e.qZA(),e.TgZ(18,"div"),e._UZ(19,"cd-mirroring-daemons"),e.qZA()(),e.TgZ(20,"div",14)(21,"legend"),e.SDv(22,16),e.qZA(),e.TgZ(23,"div"),e._UZ(24,"cd-mirroring-pools"),e.qZA()()(),e.TgZ(25,"div",13)(26,"div",17)(27,"legend"),e.SDv(28,18),e.qZA(),e.TgZ(29,"div"),e._UZ(30,"cd-mirroring-images"),e.qZA()()()),2&t&&(e.Q6J("formGroup",o.rbdmirroringForm),e.xp6(7),e.uIk("disabled",!o.editing||null),e.xp6(1),e.uIk("title",o.editing?"Save":"Edit"),e.xp6(1),e.Q6J("ngIf",!o.editing),e.xp6(1),e.Q6J("ngIf",o.editing),e.xp6(1),e.Q6J("source",o.siteName)("byId",!1),e.xp6(2),e.Q6J("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[c.mk,c.O5,We.s,ce.K,L.o,g.b,b.V,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,Bi,Ji,ms]}),n})();class Ts{}function fs(n,s){if(1&n&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function Ss(n,s){1&n&&(e.TgZ(0,"span",17),e.SDv(1,18),e.qZA())}let Cs=(()=>{class n{constructor(t,o,i,_,r,l){this.activeModal=t,this.actionLabels=o,this.rbdMirroringService=i,this.taskWrapper=_,this.route=r,this.location=l,this.bsConfig={containerClass:"theme-default"},this.peerExists=!1,this.mirrorModes=[{id:"disabled",name:"Disabled"},{id:"pool",name:"Pool"},{id:"image",name:"Image"}],this.createForm()}createForm(){this.editModeForm=new A.d({mirrorMode:new a.p4("",{validators:[a.kI.required,this.validateMode.bind(this)]})})}ngOnInit(){this.route.params.subscribe(t=>{this.poolName=t.pool_name}),this.pattern=`${this.poolName}`,this.rbdMirroringService.getPool(this.poolName).subscribe(t=>{this.setResponse(t)}),this.subs=this.rbdMirroringService.subscribeSummary(t=>{this.peerExists=!1;const i=t.content_data.pools.find(_=>this.poolName===_.name);this.peerExists=i&&i.peer_uuids.length})}ngOnDestroy(){this.subs.unsubscribe()}validateMode(t){return"disabled"===t.value&&this.peerExists?{cannotDisable:{value:t.value}}:null}setResponse(t){this.editModeForm.get("mirrorMode").setValue(t.mirror_mode)}update(){const t=new Ts;t.mirror_mode=this.editModeForm.getValue("mirrorMode"),this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/mirroring/pool/edit",{pool_name:this.poolName}),call:this.rbdMirroringService.updatePool(this.poolName,t)}).subscribe({error:()=>this.editModeForm.setErrors({cdSubmitButton:!0}),complete:()=>{this.rbdMirroringService.refresh(),this.location.back()}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(P.Kz),e.Y36(E.p4),e.Y36(X),e.Y36(G.P),e.Y36(p.gz),e.Y36(c.Ye))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-pool-edit-mode-modal"]],decls:21,vars:7,consts:function(){let s,t,o,i;return s="\uD480 \uBBF8\uB7EC\uBAA8\uB4DC\uB97C \uD3B8\uC9D1\uD558\uAE30",t="To edit the mirror mode for pool\xA0 \n          " + "[\ufffd#10\ufffd|\ufffd#11\ufffd]" + "\n          " + "\ufffd0\ufffd" + "\n          " + "[\ufffd/#10\ufffd|\ufffd/#11\ufffd]" + ", select a new mode from the list and click\xA0 \n          " + "[\ufffd#10\ufffd|\ufffd#11\ufffd]" + "Update\n          " + "[\ufffd/#10\ufffd|\ufffd/#11\ufffd]" + ".\n        ",t=e.Zx4(t),o="Mode",i="\uC0C1\uB300\uBC29 \uD074\uB7EC\uC2A4\uD130\uB4E4\uC740 \uBBF8\uB7EC\uB97C \uB2E8\uC808\uD558\uAE30 \uC804\uC5D0 \uBC18\uB4DC\uC2DC \uC81C\uAC70\uB418\uC5B4\uC57C \uD569\uB2C8\uB2E4.",[["pageURL","mirroring",3,"modalRef"],[1,"modal-title"],s,[1,"modal-content"],["name","editModeForm","novalidate","",1,"form",3,"formGroup"],["formDir","ngForm"],[1,"modal-body"],t,[1,"form-group"],["for","mirrorMode",1,"col-form-label"],o,["id","mirrorMode","name","mirrorMode","formControlName","mirrorMode",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],[1,"modal-footer"],[3,"form","submitText","submitActionEvent"],[3,"value"],[1,"invalid-feedback"],i]},template:function(t,o){if(1&t&&(e.TgZ(0,"cd-modal",0),e.ynx(1,1),e.SDv(2,2),e.BQk(),e.ynx(3,3),e.TgZ(4,"form",4,5)(6,"div",6)(7,"p"),e.ynx(8),e.tHW(9,7),e._UZ(10,"kbd")(11,"kbd"),e.N_p(),e.BQk(),e.qZA(),e.TgZ(12,"div",8)(13,"label",9)(14,"span"),e.SDv(15,10),e.qZA()(),e.TgZ(16,"select",11),e.YNc(17,fs,2,2,"option",12),e.qZA(),e.YNc(18,Ss,2,0,"span",13),e.qZA()(),e.TgZ(19,"div",14)(20,"cd-form-button-panel",15),e.NdJ("submitActionEvent",function(){return o.update()}),e.qZA()()(),e.BQk(),e.qZA()),2&t){const i=e.MAs(5);e.Q6J("modalRef",o.activeModal),e.xp6(4),e.Q6J("formGroup",o.editModeForm),e.xp6(7),e.pQV(o.poolName),e.QtT(9),e.xp6(6),e.Q6J("ngForOf",o.mirrorModes),e.xp6(1),e.Q6J("ngIf",o.editModeForm.showError("mirrorMode",i,"cannotDisable")),e.xp6(2),e.Q6J("form",o.editModeForm)("submitText",o.actionLabels.UPDATE)}},dependencies:[c.sg,c.O5,Y.z,R.p,L.o,T.P,b.V,a._Y,a.YN,a.Kr,a.EJ,a.JJ,a.JL,a.sg,a.u]}),n})();var bt=m(7357),Es=m(28049),Ms=m(43190),we=m(80842),mt=m(30633),w=m(19358),Le=m(47557),pt=m(28211);class Os{}var Ge=(()=>{return(n=Ge||(Ge={}))[n.V1=1]="V1",n[n.V2=2]="V2",Ge;var n})();class Rs{constructor(){this.features=[]}}class hs{constructor(){this.features=[]}}class As{}class Ns extends As{constructor(){super(...arguments),this.features=[]}}class ut{constructor(){this.features=[],this.remove_scheduling=!1}}var et=(()=>{return(n=et||(et={})).editing="editing",n.cloning="cloning",n.copying="copying",et;var n})(),It=m(18372),me=m(32966),Ps=m(1372),bs=m(17932),Is=m(60950);function Fs(n,s){if(1&n&&(e.TgZ(0,"div",9)(1,"label",51),e.SDv(2,52),e.ALo(3,"titlecase"),e.qZA(),e.TgZ(4,"div",12),e._UZ(5,"input",53)(6,"hr"),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(3),e.pQV(e.lcZ(3,1,t.action)),e.QtT(2)}}function vs(n,s){1&n&&(e.TgZ(0,"span",54),e.ynx(1),e.SDv(2,55),e.BQk(),e.qZA())}function Ls(n,s){1&n&&(e.TgZ(0,"span",54),e.ynx(1),e.SDv(2,56),e.BQk(),e.qZA())}function Ds(n,s){1&n&&e._UZ(0,"input",57)}function $s(n,s){1&n&&(e.TgZ(0,"option",43),e.SDv(1,60),e.qZA()),2&n&&e.Q6J("ngValue",null)}function Bs(n,s){1&n&&(e.TgZ(0,"option",43),e.SDv(1,61),e.qZA()),2&n&&e.Q6J("ngValue",null)}function Gs(n,s){1&n&&(e.TgZ(0,"option",43),e.SDv(1,62),e.qZA()),2&n&&e.Q6J("ngValue",null)}function ys(n,s){if(1&n&&(e.TgZ(0,"option",63),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t.pool_name),e.xp6(1),e.Oqu(t.pool_name)}}function xs(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"select",58),e.NdJ("change",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.setPoolMirrorMode())}),e.YNc(1,$s,2,1,"option",59),e.YNc(2,Bs,2,1,"option",59),e.YNc(3,Gs,2,1,"option",59),e.YNc(4,ys,2,2,"option",39),e.qZA()}if(2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",null===t.pools),e.xp6(1),e.Q6J("ngIf",null!==t.pools&&0===t.pools.length),e.xp6(1),e.Q6J("ngIf",null!==t.pools&&t.pools.length>0),e.xp6(1),e.Q6J("ngForOf",t.pools)}}function Zs(n,s){1&n&&(e.TgZ(0,"span",54),e.SDv(1,64),e.qZA())}function ws(n,s){1&n&&(e.TgZ(0,"cd-alert-panel",65),e._uU(1,"Mirroring can not be disabled on "),e.TgZ(2,"b"),e._uU(3,"Pool"),e.qZA(),e._uU(4," mirror mode. You need to change the mirror mode to enable this option. "),e.qZA()),2&n&&e.Q6J("showTitle",!1)}const Ft=function(n){return["edit",n]},vt=function(n){return{modal:n}},Lt=function(n){return{outlets:n}},Dt=function(n){return["/block/mirroring",n]};function Hs(n,s){if(1&n&&(e.TgZ(0,"cd-alert-panel",65),e.tHW(1,66),e._UZ(2,"b")(3,"button",67),e.N_p(),e.qZA()),2&n){const t=e.oxw(2);e.Q6J("showTitle",!1),e.xp6(3),e.Q6J("routerLink",e.VKq(8,Dt,e.VKq(6,Lt,e.VKq(4,vt,e.VKq(2,Ft,t.rbdForm.getValue("pool"))))))}}function qs(n,s){if(1&n&&(e.TgZ(0,"cd-alert-panel",65),e.tHW(1,72),e._UZ(2,"b")(3,"button",73),e.N_p(),e.qZA()),2&n){const t=e.oxw(4);e.Q6J("showTitle",!1),e.xp6(3),e.Q6J("routerLink",e.VKq(8,Dt,e.VKq(6,Lt,e.VKq(4,vt,e.VKq(2,Ft,t.rbdForm.getValue("pool"))))))}}function Ks(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",69)(1,"input",70),e.NdJ("change",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.setExclusiveLock())}),e.qZA(),e.TgZ(2,"label",71),e._uU(3),e.ALo(4,"titlecase"),e.qZA(),e.TgZ(5,"cd-help-text"),e._uU(6),e.qZA(),e.YNc(7,qs,4,10,"cd-alert-panel",24),e.qZA()}if(2&n){const t=s.$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("id",t.value)("value",t.value),e.uIk("disabled",o.shouldDisable(t.value)),e.xp6(1),e.Q6J("for",t.value),e.xp6(1),e.Oqu(e.lcZ(4,7,t.value)),e.xp6(3),e.hij(" ",t.text," "),e.xp6(1),e.Q6J("ngIf",o.shouldDisable(t.value)&&"editing"!==o.mode)}}function ks(n,s){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,Ks,8,9,"div",68),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.mirroringOptions)}}function Vs(n,s){1&n&&(e.TgZ(0,"span",54),e.SDv(1,78),e.qZA())}const tt=function(n){return{required:n}};function Qs(n,s){if(1&n&&(e.TgZ(0,"div",9)(1,"label",74),e.SDv(2,75),e.qZA(),e.TgZ(3,"div",12),e._UZ(4,"input",76),e.TgZ(5,"cd-help-text")(6,"span"),e.SDv(7,77),e.qZA()(),e.YNc(8,Vs,2,0,"span",14),e.qZA()()),2&n){e.oxw();const t=e.MAs(2),o=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(3,tt,"editing"!==o.mode)),e.xp6(3),e.uIk("disabled",!1===o.peerConfigured||null),e.xp6(4),e.Q6J("ngIf",o.rbdForm.showError("schedule",t,"required"))}}function Xs(n,s){1&n&&(e.TgZ(0,"cd-helper")(1,"span"),e.SDv(2,82),e.qZA()())}function Ys(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",21)(1,"input",79),e.NdJ("change",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.onUseDataPoolChange())}),e.qZA(),e.TgZ(2,"label",80),e.SDv(3,81),e.qZA(),e.TgZ(4,"cd-help-text"),e._uU(5,"Use a dedicated pool to store the mirror data. If not selected, the mirror data will be stored in the same pool as the image data."),e.qZA(),e.YNc(6,Xs,3,0,"cd-helper",25),e.qZA()}if(2&n){const t=e.oxw(2);e.xp6(6),e.Q6J("ngIf",t.allDataPools.length<=1&&"editing"!==t.mode)}}function zs(n,s){1&n&&e._UZ(0,"input",86)}function Js(n,s){1&n&&(e.TgZ(0,"option",43),e.SDv(1,88),e.qZA()),2&n&&e.Q6J("ngValue",null)}function Us(n,s){1&n&&(e.TgZ(0,"option",43),e.SDv(1,89),e.qZA()),2&n&&e.Q6J("ngValue",null)}function js(n,s){1&n&&(e.TgZ(0,"option",43),e._uU(1,"-- Select a data pool -- "),e.qZA()),2&n&&e.Q6J("ngValue",null)}function Ws(n,s){if(1&n&&(e.TgZ(0,"option",63),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t.pool_name),e.xp6(1),e.Oqu(t.pool_name)}}function e_(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"select",87),e.NdJ("change",function(i){e.CHM(t);const _=e.oxw(3);return e.KtG(_.onDataPoolChange(i.target.value))}),e.YNc(1,Js,2,1,"option",59),e.YNc(2,Us,2,1,"option",59),e.YNc(3,js,2,1,"option",59),e.YNc(4,Ws,2,2,"option",39),e.qZA()}if(2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",null===t.dataPools),e.xp6(1),e.Q6J("ngIf",null!==t.dataPools&&0===t.dataPools.length),e.xp6(1),e.Q6J("ngIf",null!==t.dataPools&&t.dataPools.length>0),e.xp6(1),e.Q6J("ngForOf",t.dataPools)}}function t_(n,s){1&n&&(e.TgZ(0,"span",54),e.SDv(1,90),e.qZA())}function o_(n,s){if(1&n&&(e.TgZ(0,"div",9)(1,"div",83),e.YNc(2,zs,1,0,"input",84),e.YNc(3,e_,5,4,"select",85),e.TgZ(4,"cd-help-text"),e._uU(5,"Dedicated pool that stores the object-data of the RBD."),e.qZA(),e.YNc(6,t_,2,0,"span",14),e.qZA()()),2&n){e.oxw();const t=e.MAs(2),o=e.oxw();e.xp6(2),e.Q6J("ngIf","editing"===o.mode||!o.poolPermission.read),e.xp6(1),e.Q6J("ngIf","editing"!==o.mode&&o.poolPermission.read),e.xp6(3),e.Q6J("ngIf",o.rbdForm.showError("dataPool",t,"required"))}}const n_=function(n,s){return[n,s]};function i_(n,s){if(1&n&&(e.TgZ(0,"div",9)(1,"div",20),e._UZ(2,"i",91),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngClass",e.WLB(1,n_,t.icons.spinner,t.icons.spin))}}function s_(n,s){1&n&&e._UZ(0,"input",95)}function __(n,s){1&n&&(e.TgZ(0,"option",43),e.SDv(1,97),e.qZA()),2&n&&e.Q6J("ngValue",null)}function a_(n,s){1&n&&(e.TgZ(0,"option",43),e.SDv(1,98),e.qZA()),2&n&&e.Q6J("ngValue",null)}function r_(n,s){1&n&&(e.TgZ(0,"option",43),e.SDv(1,99),e.qZA()),2&n&&e.Q6J("ngValue",null)}function l_(n,s){if(1&n&&(e.TgZ(0,"option",63),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function c_(n,s){if(1&n&&(e.TgZ(0,"select",96),e.YNc(1,__,2,1,"option",59),e.YNc(2,a_,2,1,"option",59),e.YNc(3,r_,2,1,"option",59),e.YNc(4,l_,2,2,"option",39),e.qZA()),2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",null===t.pools),e.xp6(1),e.Q6J("ngIf",null!==t.pools&&0===t.pools.length),e.xp6(1),e.Q6J("ngIf",null!==t.pools&&t.pools.length>0),e.xp6(1),e.Q6J("ngForOf",t.namespaces)}}function d_(n,s){if(1&n&&(e.TgZ(0,"div",9)(1,"label",92),e._uU(2," Namespace "),e.qZA(),e.TgZ(3,"div",12),e.YNc(4,s_,1,0,"input",93),e.YNc(5,c_,5,4,"select",94),e.TgZ(6,"cd-help-text"),e._uU(7,"Namespace allows you to logically group RBD images within your Ceph Cluster. Choosing a namespace makes it easier to locate and manage related RBD images efficiently"),e.qZA()()()),2&n){const t=e.oxw(2);e.xp6(4),e.Q6J("ngIf","editing"===t.mode||!t.poolPermission.read),e.xp6(1),e.Q6J("ngIf","editing"!==t.mode&&t.poolPermission.read)}}function m_(n,s){1&n&&(e.TgZ(0,"span",54),e.SDv(1,100),e.qZA())}function p_(n,s){1&n&&(e.TgZ(0,"span",54),e.SDv(1,101),e.qZA())}function u_(n,s){1&n&&(e.TgZ(0,"span",54),e.SDv(1,102),e.qZA())}function g_(n,s){if(1&n&&(e.TgZ(0,"cd-help-text"),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.helperText," ")}}function T_(n,s){if(1&n&&(e.TgZ(0,"cd-alert-panel",106),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.helperHtml," ")}}function f_(n,s){if(1&n&&(e.TgZ(0,"div",21),e._UZ(1,"input",103),e.TgZ(2,"label",104),e._uU(3),e.qZA(),e._UZ(4,"br"),e.YNc(5,g_,2,1,"cd-help-text",25),e.YNc(6,T_,2,1,"cd-alert-panel",105),e.qZA()),2&n){const t=s.$implicit,o=e.oxw(2);e.xp6(1),e.s9C("id",t.key),e.s9C("name",t.key),e.s9C("formControlName",t.key),e.xp6(1),e.s9C("for",t.key),e.xp6(1),e.Oqu(t.desc),e.xp6(2),e.Q6J("ngIf",t.helperText),e.xp6(1),e.Q6J("ngIf",t.helperHtml&&!1===o.rbdForm.getValue(t.key))}}function S_(n,s){if(1&n&&(e.TgZ(0,"option",63),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function C_(n,s){if(1&n&&(e.TgZ(0,"option",63),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function E_(n,s){1&n&&(e.TgZ(0,"span",54),e.SDv(1,107),e.qZA())}function M_(n,s){1&n&&(e.TgZ(0,"span",54),e.SDv(1,108),e.qZA())}function O_(n,s){1&n&&(e.TgZ(0,"span",54),e.SDv(1,109),e.qZA())}function R_(n,s){1&n&&(e.TgZ(0,"span",54),e.SDv(1,110),e.qZA())}function h_(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",1)(1,"form",2,3)(3,"div",4)(4,"div",5),e.SDv(5,6),e.ALo(6,"titlecase"),e.ALo(7,"upperFirst"),e.qZA(),e.TgZ(8,"div",7),e.YNc(9,Fs,7,3,"div",8),e.TgZ(10,"div",9)(11,"label",10),e.SDv(12,11),e.qZA(),e.TgZ(13,"div",12),e._UZ(14,"input",13),e.YNc(15,vs,3,0,"span",14),e.YNc(16,Ls,3,0,"span",14),e.qZA()(),e.TgZ(17,"div",15),e.NdJ("change",function(i){e.CHM(t);const _=e.oxw();return e.KtG(_.onPoolChange(i.target.value))}),e.TgZ(18,"label",16),e.SDv(19,17),e.qZA(),e.TgZ(20,"div",12),e.YNc(21,Ds,1,0,"input",18),e.YNc(22,xs,5,4,"select",19),e.YNc(23,Zs,2,0,"span",14),e.qZA()(),e.TgZ(24,"div",9)(25,"div",20)(26,"div",21)(27,"input",22),e.NdJ("change",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.setMirrorMode())})("ngModelChange",function(i){e.CHM(t);const _=e.oxw();return e.KtG(_.mirroring&&(_.currentPoolName=i))}),e.qZA(),e.TgZ(28,"label",23),e._uU(29,"Mirroring"),e.qZA(),e.TgZ(30,"cd-help-text"),e._uU(31,"Allow data to be asynchronously mirrored between two Ceph clusters"),e.qZA(),e.YNc(32,ws,5,1,"cd-alert-panel",24),e.YNc(33,Hs,4,10,"cd-alert-panel",24),e.qZA(),e.YNc(34,ks,2,1,"div",25),e._UZ(35,"br"),e.YNc(36,Qs,9,5,"div",8),e.YNc(37,Ys,7,1,"div",26),e.YNc(38,o_,7,3,"div",8),e.qZA()(),e.YNc(39,i_,3,4,"div",8),e.YNc(40,d_,8,2,"div",8),e.TgZ(41,"div",9)(42,"label",27),e.SDv(43,28),e.qZA(),e.TgZ(44,"div",12),e._UZ(45,"input",29),e.YNc(46,m_,2,0,"span",14),e.YNc(47,p_,2,0,"span",14),e.YNc(48,u_,2,0,"span",14),e.TgZ(49,"cd-help-text"),e._uU(50,"Supported Units: KiB, MiB, GiB, TiB, PiB etc"),e.qZA()()(),e.TgZ(51,"cd-form-advanced-fieldset")(52,"div",30)(53,"label",31),e.SDv(54,32),e.qZA(),e.TgZ(55,"div",12),e.YNc(56,f_,7,7,"div",33),e.qZA()(),e.TgZ(57,"h4",34),e.SDv(58,35),e.qZA(),e.TgZ(59,"div",9)(60,"label",36),e.tHW(61,37),e._UZ(62,"cd-helper"),e.N_p(),e.qZA(),e.TgZ(63,"div",12)(64,"select",38),e.YNc(65,S_,2,2,"option",39),e.qZA()()(),e.TgZ(66,"div",9)(67,"label",40),e.tHW(68,41),e._UZ(69,"cd-helper"),e.N_p(),e.qZA(),e.TgZ(70,"div",12)(71,"select",42)(72,"option",43),e.SDv(73,44),e.qZA(),e.YNc(74,C_,2,2,"option",39),e.qZA(),e.YNc(75,E_,2,0,"span",14),e.YNc(76,M_,2,0,"span",14),e.qZA()(),e.TgZ(77,"div",9)(78,"label",45),e.tHW(79,46),e._UZ(80,"cd-helper"),e.N_p(),e.qZA(),e.TgZ(81,"div",12),e._UZ(82,"input",47),e.YNc(83,O_,2,0,"span",14),e.YNc(84,R_,2,0,"span",14),e.qZA()(),e.TgZ(85,"cd-rbd-configuration-form",48),e.NdJ("changes",function(i){e.CHM(t);const _=e.oxw();return e.KtG(_.getDirtyConfigurationValues=i)}),e.qZA()()(),e.TgZ(86,"div",49)(87,"cd-form-button-panel",50),e.NdJ("submitActionEvent",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.submit())}),e.ALo(88,"titlecase"),e.ALo(89,"upperFirst"),e.qZA()()()()()}if(2&n){const t=e.MAs(2),o=e.oxw();e.xp6(1),e.Q6J("formGroup",o.rbdForm),e.xp6(6),e.pQV(e.lcZ(6,36,o.action))(e.lcZ(7,38,o.resource)),e.QtT(5),e.xp6(2),e.Q6J("ngIf",o.rbdForm.getValue("parent")),e.xp6(6),e.Q6J("ngIf",o.rbdForm.showError("name",t,"required")),e.xp6(1),e.Q6J("ngIf",o.rbdForm.showError("name",t,"pattern")),e.xp6(2),e.Q6J("ngClass",e.VKq(44,tt,"editing"!==o.mode)),e.xp6(3),e.Q6J("ngIf","editing"===o.mode||!o.poolPermission.read),e.xp6(1),e.Q6J("ngIf","editing"!==o.mode&&o.poolPermission.read),e.xp6(1),e.Q6J("ngIf",o.rbdForm.showError("pool",t,"required")),e.xp6(4),e.Q6J("ngModel",o.mirroring&&o.currentPoolName),e.xp6(5),e.Q6J("ngIf",o.showMirrorDisableMessage),e.xp6(1),e.Q6J("ngIf","disabled"===o.currentPoolMirrorMode),e.xp6(1),e.Q6J("ngIf",o.mirroring&&"disabled"!==o.currentPoolMirrorMode),e.xp6(2),e.Q6J("ngIf","snapshot"===o.rbdForm.getValue("mirroringMode")&&o.mirroring),e.xp6(1),e.Q6J("ngIf",o.allDataPools.length>1||"editing"===o.mode),e.xp6(1),e.Q6J("ngIf",o.rbdForm.getValue("useDataPool")),e.xp6(1),e.Q6J("ngIf","editing"!==o.mode&&o.rbdForm.getValue("pool")&&null===o.namespaces),e.xp6(1),e.Q6J("ngIf","editing"===o.mode&&o.rbdForm.getValue("namespace")||"editing"!==o.mode&&(o.namespaces&&o.namespaces.length>0||!o.poolPermission.read)),e.xp6(6),e.Q6J("ngIf",o.rbdForm.showError("size",t,"required")),e.xp6(1),e.Q6J("ngIf",o.rbdForm.showError("size",t,"invalidSizeObject")),e.xp6(1),e.Q6J("ngIf",o.rbdForm.showError("size",t,"pattern")),e.xp6(8),e.Q6J("ngForOf",o.featuresList),e.xp6(9),e.Q6J("ngForOf",o.objectSizes),e.xp6(2),e.Q6J("ngClass",e.VKq(46,tt,o.rbdForm.getValue("stripingCount"))),e.xp6(5),e.Q6J("ngValue",null),e.xp6(2),e.Q6J("ngForOf",o.objectSizes),e.xp6(1),e.Q6J("ngIf",o.rbdForm.showError("stripingUnit",t,"required")),e.xp6(1),e.Q6J("ngIf",o.rbdForm.showError("stripingUnit",t,"invalidStripingUnit")),e.xp6(2),e.Q6J("ngClass",e.VKq(48,tt,o.rbdForm.getValue("stripingUnit"))),e.xp6(5),e.Q6J("ngIf",o.rbdForm.showError("stripingCount",t,"required")),e.xp6(1),e.Q6J("ngIf",o.rbdForm.showError("stripingCount",t,"min")),e.xp6(1),e.Q6J("form",o.rbdForm)("initializeData",o.initializeConfigData),e.xp6(2),e.Q6J("form",t)("submitText",e.lcZ(88,40,o.action)+" "+e.lcZ(89,42,o.resource))}}let He=(()=>{class n extends $e.E{constructor(t,o,i,_,r,l,d,u,f,M){super(),this.authStorageService=t,this.route=o,this.poolService=i,this.rbdService=_,this.formatter=r,this.taskWrapper=l,this.dimlessBinaryPipe=d,this.actionLabels=u,this.router=f,this.rbdMirroringService=M,this.namespaces=[],this.namespacesByPoolCache={},this.pools=null,this.allPools=null,this.dataPools=null,this.allDataPools=[],this.featuresList=[],this.initializeConfigData=new bt.t(1),this.peerConfigured=!1,this.advancedEnabled=!1,this.rbdFormMode=et,this.defaultObjectSize="4 MiB",this.mirroringOptions=[{value:"journal",text:"Ensures reliable replication by logging changes before updating the image, but doubles write time, impacting performance. Not recommended for high-speed data processing tasks."},{value:"snapshot",text:"This mode replicates RBD images between clusters using snapshots, efficiently copying data changes but requiring complete delta syncing during failover. Ideal for less demanding tasks due to its less granular approach compared to journaling."}],this.mirroring=!1,this.currentPoolName="",this.currentPoolMirrorMode="",this.objectSizes=["4 KiB","8 KiB","16 KiB","32 KiB","64 KiB","128 KiB","256 KiB","512 KiB","1 MiB","2 MiB","4 MiB","8 MiB","16 MiB","32 MiB"],this.defaultStripingUnit="4 MiB",this.defaultStripingCount=1,this.rbdImage=new bt.t(1),this.icons=C.P,this.currentImageMirrorMode="",this.showMirrorDisableMessage=!1,this.routerUrl=this.router.url,this.poolPermission=this.authStorageService.getPermissions().pool,this.resource="RBD",this.features={"deep-flatten":{desc:"Deep flatten",requires:null,allowEnable:!1,allowDisable:!0,helperHtml:"Feature can be disabled but can't be re-enabled later",helperText:"Speeds up the process of deleting a clone by removing the dependency on the parent image."},layering:{desc:"Layering",requires:null,allowEnable:!1,allowDisable:!1,helperHtml:"Feature flag can't be manipulated after the image is created. Disabling this option will also disable the Protect and Clone actions on Snapshot",helperText:"Allows the creation of snapshots and clones of an image."},"exclusive-lock":{desc:"Exclusive lock",requires:null,allowEnable:!0,allowDisable:!0,helperText:"Ensures that only one client can write to the image at a time."},"object-map":{desc:"Object map (requires exclusive-lock)",requires:"exclusive-lock",allowEnable:!0,allowDisable:!0,initDisabled:!0,helperText:"Tracks which objects actually exist (have data stored on a device). Enabling object map support speeds up I/O operations for cloning, importing and exporting a sparsely populated image, and deleting."},"fast-diff":{desc:"Fast diff (interlocked with object-map)",requires:"object-map",allowEnable:!0,allowDisable:!0,interlockedWith:"object-map",initDisabled:!0,helperText:"Speeds up the process of comparing two images."}},this.featuresList=this.objToArray(this.features),this.createForm()}objToArray(t){return S().map(t,(o,i)=>Object.assign(o,{key:i}))}createForm(){this.rbdForm=new A.d({parent:new a.p4(""),name:new a.p4("",{validators:[a.kI.required,a.kI.pattern(/^[^@/]+?$/)]}),pool:new a.p4(null,{validators:[a.kI.required]}),namespace:new a.p4(null),useDataPool:new a.p4(!1),dataPool:new a.p4(null),size:new a.p4(null,{updateOn:"blur"}),obj_size:new a.p4(this.defaultObjectSize),features:new A.d(this.featuresList.reduce((t,o)=>(t[o.key]=new a.p4({value:!1,disabled:!!o.initDisabled}),t),{})),mirroring:new a.p4(!1),schedule:new a.p4("",{validators:[a.kI.pattern(/^([0-9]+)d|([0-9]+)h|([0-9]+)m$/),v.hq.requiredIf({mirroringMode:"snapshot",mirroring:!0})]}),mirroringMode:new a.p4(""),stripingUnit:new a.p4(this.defaultStripingUnit),stripingCount:new a.p4(this.defaultStripingCount,{updateOn:"blur"})},this.validateRbdForm(this.formatter))}disableForEdit(){this.rbdForm.get("parent").disable(),this.rbdForm.get("pool").disable(),this.rbdForm.get("namespace").disable(),this.rbdForm.get("useDataPool").disable(),this.rbdForm.get("dataPool").disable(),this.rbdForm.get("obj_size").disable(),this.rbdForm.get("stripingUnit").disable(),this.rbdForm.get("stripingCount").disable(),this.rbdImage.subscribe(t=>{t.image_format===Ge.V1?(this.rbdForm.get("deep-flatten").disable(),this.rbdForm.get("layering").disable(),this.rbdForm.get("exclusive-lock").disable()):(this.rbdForm.get("deep-flatten").value||this.rbdForm.get("deep-flatten").disable(),this.rbdForm.get("layering").disable())})}disableForClone(){this.rbdForm.get("parent").disable(),this.rbdForm.get("size").disable()}disableForCopy(){this.rbdForm.get("parent").disable(),this.rbdForm.get("size").disable()}ngOnInit(){this.prepareFormForAction(),this.gatherNeededData().subscribe(this.handleExternalData.bind(this))}setExclusiveLock(){this.mirroring&&"journal"===this.rbdForm.get("mirroringMode").value?(this.rbdForm.get("exclusive-lock").setValue(!0),this.rbdForm.get("exclusive-lock").disable()):this.rbdForm.get("exclusive-lock").enable()}setMirrorMode(){this.mirroring=!this.mirroring,this.mirroring&&this.rbdForm.get("mirroringMode").setValue(this.mirroringOptions[0].value),this.setExclusiveLock(),this.checkPeersConfigured()}checkPeersConfigured(t){var o=t||this.rbdForm.get("pool").value;this.rbdMirroringService.getPeerForPool(o).subscribe(i=>{i.length>0&&(this.peerConfigured=!0)})}setPoolMirrorMode(){this.currentPoolName=this.mode===this.rbdFormMode.editing?this.response?.pool_name:this.rbdForm.getValue("pool"),this.currentPoolName?(this.rbdMirroringService.refresh(),this.rbdMirroringService.subscribeSummary(t=>{const o=t.content_data.pools.find(i=>i.name===this.currentPoolName);this.currentPoolMirrorMode=o.mirror_mode,this.mode===this.rbdFormMode.editing?(this.showMirrorDisableMessage="pool"===this.currentPoolMirrorMode,"image"!==this.currentPoolMirrorMode&&(this.rbdForm.get("mirroring").disable(),this.rbdForm.get("mirroringMode").disable())):"disabled"===o.mirror_mode?(this.mirroring=!1,this.rbdForm.get("mirroring").setValue(this.mirroring),this.rbdForm.get("mirroring").disable()):(this.mirroring=!0,this.rbdForm.get("mirroring").enable(),this.rbdForm.get("mirroring").setValue(this.mirroring),this.rbdForm.get("mirroringMode").setValue(this.mirroringOptions[0].value))})):this.mode!==this.rbdFormMode.editing&&this.rbdForm.get("mirroring").disable(),this.setExclusiveLock()}prepareFormForAction(){const t=this.routerUrl;t.startsWith("/block/rbd/edit")?(this.mode=this.rbdFormMode.editing,this.action=this.actionLabels.EDIT,this.disableForEdit()):t.startsWith("/block/rbd/clone")?(this.mode=this.rbdFormMode.cloning,this.disableForClone(),this.action=this.actionLabels.CLONE):t.startsWith("/block/rbd/copy")?(this.mode=this.rbdFormMode.copying,this.action=this.actionLabels.COPY,this.disableForCopy()):this.action=this.actionLabels.CREATE,S().each(this.features,o=>{this.rbdForm.get("features").get(o.key).valueChanges.subscribe(i=>this.featureFormUpdate(o.key,i))})}gatherNeededData(){const t={};return this.mode?this.route.params.subscribe(o=>{const i=w.N.fromString(decodeURIComponent(o.image_spec));o.snap&&(this.snapName=decodeURIComponent(o.snap)),t.rbd=this.rbdService.get(i),this.checkPeersConfigured(i.poolName)}):t.defaultFeatures=this.rbdService.defaultFeatures(),this.mode!==this.rbdFormMode.editing&&this.poolPermission.read&&(t.pools=this.poolService.list(["pool_name","type","flags_names","application_metadata"])),(0,ge.D)(t)}handleExternalData(t){if(this.handlePoolData(t.pools),this.setPoolMirrorMode(),t.defaultFeatures&&this.setFeatures(t.defaultFeatures),t.rbd){const o=t.rbd;this.setResponse(o,this.snapName),this.rbdImage.next(o)}this.loadingReady()}handlePoolData(t){if(!t)return;const o=[],i=[];for(const _ of t)this.rbdService.isRBDPool(_)&&("replicated"===_.type?(o.push(_),i.push(_)):"erasure"===_.type&&-1!==_.flags_names.indexOf("ec_overwrites")&&i.push(_));if(this.pools=o,this.allPools=o,this.dataPools=i,this.allDataPools=i,this.pools.length>=1){const r=this.pools.map(l=>l.pool_name).includes("rbd")?"rbd":this.pools[0].pool_name;this.rbdForm.get("pool").setValue(r),this.onPoolChange(r)}this.allDataPools.length<=1&&this.rbdForm.get("useDataPool").disable()}onPoolChange(t){const o=this.rbdForm.get("dataPool");o.value===t&&o.setValue(null),this.dataPools=this.allDataPools?this.allDataPools.filter(i=>i.pool_name!==t):[],this.namespaces=null,t in this.namespacesByPoolCache?this.namespaces=this.namespacesByPoolCache[t]:this.rbdService.listNamespaces(t).subscribe(i=>{i=i.map(_=>_.namespace),this.namespacesByPoolCache[t]=i,this.namespaces=i}),this.rbdForm.get("namespace").setValue(null)}onUseDataPoolChange(){this.rbdForm.getValue("useDataPool")||(this.rbdForm.get("dataPool").setValue(null),this.onDataPoolChange(null))}onDataPoolChange(t){const o=this.allPools.filter(i=>i.pool_name!==t);this.rbdForm.getValue("pool")===t&&this.rbdForm.get("pool").setValue(null),this.pools=o}validateRbdForm(t){return o=>{const i=o.get("useDataPool"),_=o.get("dataPool");let r=null;i.value&&null==_.value&&(r={required:!0}),_.setErrors(r);const l=o.get("size"),d=o.get("obj_size"),u=t.toBytes(null!=d.value?d.value:this.defaultObjectSize),f=o.get("stripingCount"),M=null!=f.value?f.value:this.defaultStripingCount;let O=null;null===l.value?O={required:!0}:M*u>=t.toBytes(l.value)&&(O={invalidSizeObject:!0}),l.setErrors(O);const I=o.get("stripingUnit");let B=null;null===I.value&&null!==f.value?B={required:!0}:null!==I.value&&t.toBytes(I.value)>u&&(B={invalidStripingUnit:!0}),I.setErrors(B);let V=null;return null===f.value&&null!==I.value?V={required:!0}:M<1&&(V={min:!0}),f.setErrors(V),null}}deepBoxCheck(t,o){this.getDependentChildFeatures(t).forEach(_=>{const r=this.rbdForm.get(_.key);o?r.enable({emitEvent:!1}):(r.disable({emitEvent:!1}),r.setValue(!1,{emitEvent:!1}),this.deepBoxCheck(_.key,o));const l=this.rbdForm.get("features");this.mode===this.rbdFormMode.editing&&l.get(_.key).enabled&&(-1!==this.response.features_name.indexOf(_.key)&&!_.allowDisable||-1===this.response.features_name.indexOf(_.key)&&!_.allowEnable)&&l.get(_.key).disable()})}getDependentChildFeatures(t){return S().filter(this.features,o=>o.requires===t)||[]}interlockCheck(t,o){const i=this.featuresList.find(_=>_.key===t);if(this.response){const _=null!=i.interlockedWith,r=this.featuresList.find(d=>d.interlockedWith===i.key),l=!!this.response.features_name.find(d=>d===i.key);if(_){if(l!==!!this.response.features_name.find(u=>u===i.interlockedWith))return}else if(r&&!!this.response.features_name.find(u=>u===r.key)!==l)return}o?S().filter(this.features,_=>_.interlockedWith===t).forEach(_=>this.rbdForm.get(_.key).setValue(!0,{emitEvent:!1})):i.interlockedWith&&this.rbdForm.get("features").get(i.interlockedWith).setValue(!1)}featureFormUpdate(t,o){if(o){const i=this.features[t].requires;if(i&&!this.rbdForm.getValue(i))return void this.rbdForm.get(`features.${t}`).setValue(!1)}this.deepBoxCheck(t,o),this.interlockCheck(t,o)}setFeatures(t){const o=this.rbdForm.get("features");S().forIn(this.features,i=>{-1!==t.indexOf(i.key)&&o.get(i.key).setValue(!0),this.featureFormUpdate(i.key,o.get(i.key).value)})}setResponse(t,o){this.response=t;const i=new w.N(t.pool_name,t.namespace,t.name).toString();if(this.mode===this.rbdFormMode.cloning)this.rbdForm.get("parent").setValue(`${i}@${o}`);else if(this.mode===this.rbdFormMode.copying)o?this.rbdForm.get("parent").setValue(`${i}@${o}`):this.rbdForm.get("parent").setValue(`${i}`);else if(t.parent){const _=t.parent;this.rbdForm.get("parent").setValue(`${_.pool_name}/${_.image_name}@${_.snap_name}`)}this.mode===this.rbdFormMode.editing&&(this.rbdForm.get("name").setValue(t.name),"snapshot"===t?.mirror_mode||t.features_name.includes("journaling")?(this.mirroring=!0,this.rbdForm.get("mirroring").setValue(this.mirroring),this.rbdForm.get("mirroringMode").setValue(t?.mirror_mode),this.currentImageMirrorMode=t?.mirror_mode,this.rbdForm.get("schedule").setValue(t?.schedule_interval)):(this.mirroring=!1,this.rbdForm.get("mirroring").setValue(this.mirroring)),this.setPoolMirrorMode()),this.rbdForm.get("pool").setValue(t.pool_name),this.onPoolChange(t.pool_name),this.rbdForm.get("namespace").setValue(t.namespace),t.data_pool&&(this.rbdForm.get("useDataPool").setValue(!0),this.rbdForm.get("dataPool").setValue(t.data_pool)),this.rbdForm.get("size").setValue(this.dimlessBinaryPipe.transform(t.size)),this.rbdForm.get("obj_size").setValue(this.dimlessBinaryPipe.transform(t.obj_size)),this.setFeatures(t.features_name),this.rbdForm.get("stripingUnit").setValue(this.dimlessBinaryPipe.transform(t.stripe_unit)),this.rbdForm.get("stripingCount").setValue(t.stripe_count),this.initializeConfigData.next({initialData:this.response.configuration,sourceType:mt.h.image})}createRequest(){const t=new Ns;return t.pool_name=this.rbdForm.getValue("pool"),t.namespace=this.rbdForm.getValue("namespace"),t.name=this.rbdForm.getValue("name"),t.schedule_interval=this.rbdForm.getValue("schedule"),t.size=this.formatter.toBytes(this.rbdForm.getValue("size")),this.addObjectSizeAndStripingToRequest(t),t.configuration=this.getDirtyConfigurationValues(),this.mirroring&&"image"===this.currentPoolMirrorMode&&(t.mirror_mode=this.rbdForm.getValue("mirroringMode")),t}addObjectSizeAndStripingToRequest(t){t.obj_size=this.formatter.toBytes(this.rbdForm.getValue("obj_size")),S().forIn(this.features,o=>{this.rbdForm.getValue(o.key)&&t.features.push(o.key)}),this.mirroring&&"journal"===this.rbdForm.getValue("mirroringMode")&&t.features.push("journaling"),t.stripe_unit=this.formatter.toBytes(this.rbdForm.getValue("stripingUnit")),t.stripe_count=this.rbdForm.getValue("stripingCount"),t.data_pool=this.rbdForm.getValue("dataPool")}createAction(){const t=this.createRequest();return this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/create",{pool_name:t.pool_name,namespace:t.namespace,image_name:t.name,schedule_interval:t.schedule_interval,start_time:t.start_time,mirror_mode:t.mirror_mode}),call:this.rbdService.create(t)})}editRequest(){const t=new ut;if(t.name=this.rbdForm.getValue("name"),t.schedule_interval=this.rbdForm.getValue("schedule"),t.enable_mirror=this.mirroring,t.size=this.formatter.toBytes(this.rbdForm.getValue("size")),S().forIn(this.features,o=>{this.rbdForm.getValue(o.key)&&t.features.push(o.key)}),t.enable_mirror)t.image_mirror_mode=this.currentImageMirrorMode,"journal"===this.rbdForm.getValue("mirroringMode")&&(t.mirror_mode="journal",t.features.push("journaling")),"image"===this.currentPoolMirrorMode&&(t.mirror_mode=this.rbdForm.getValue("mirroringMode"));else{const o=t.features.indexOf("journaling",0);o>-1&&t.features.splice(o,1)}return t.configuration=this.getDirtyConfigurationValues(),t}cloneRequest(){const t=new Rs;return t.child_pool_name=this.rbdForm.getValue("pool"),t.child_namespace=this.rbdForm.getValue("namespace"),t.child_image_name=this.rbdForm.getValue("name"),this.addObjectSizeAndStripingToRequest(t),t.configuration=this.getDirtyConfigurationValues(!0,mt.h.image),t}editAction(){const t=new w.N(this.response.pool_name,this.response.namespace,this.response.name);return this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/edit",{image_spec:t.toString()}),call:this.rbdService.update(t,this.editRequest())})}cloneAction(){const t=this.cloneRequest(),o=new w.N(this.response.pool_name,this.response.namespace,this.response.name);return this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/clone",{parent_image_spec:o.toString(),parent_snap_name:this.snapName,child_pool_name:t.child_pool_name,child_namespace:t.child_namespace,child_image_name:t.child_image_name}),call:this.rbdService.cloneSnapshot(o,this.snapName,t)})}copyRequest(){const t=new hs;return this.snapName&&(t.snapshot_name=this.snapName),t.dest_pool_name=this.rbdForm.getValue("pool"),t.dest_namespace=this.rbdForm.getValue("namespace"),t.dest_image_name=this.rbdForm.getValue("name"),this.addObjectSizeAndStripingToRequest(t),t.configuration=this.getDirtyConfigurationValues(!0,mt.h.image),t}copyAction(){const t=this.copyRequest(),o=new w.N(this.response.pool_name,this.response.namespace,this.response.name);return this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/copy",{src_image_spec:o.toString(),dest_pool_name:t.dest_pool_name,dest_namespace:t.dest_namespace,dest_image_name:t.dest_image_name}),call:this.rbdService.copy(o,t)})}shouldDisable(t){return"pool"===this.currentPoolMirrorMode&&"snapshot"===t||null}submit(){this.mode||this.rbdImage.next("create"),this.rbdImage.pipe((0,Es.P)(),(0,Ms.w)(()=>this.mode===this.rbdFormMode.editing?this.editAction():this.mode===this.rbdFormMode.cloning?this.cloneAction():this.mode===this.rbdFormMode.copying?this.copyAction():this.createAction())).subscribe(()=>{},()=>this.rbdForm.setErrors({cdSubmitButton:!0}),()=>this.router.navigate(["/block/rbd"]))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(k.j),e.Y36(p.gz),e.Y36(we.q),e.Y36(j.U),e.Y36(pt.H),e.Y36(G.P),e.Y36(Le.$),e.Y36(E.p4),e.Y36(p.F0),e.Y36(X))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-rbd-form"]],features:[e.qOj],decls:1,vars:1,consts:function(){let s,t,o,i,_,r,l,d,u,f,M,O,I,B,V,Z,ne,ie,H,pe,ue,F,Oe,Re,he,Ae,Ne,Pe,be,x,Ke,ke,Ve,Qe,Xe,Ye,ze,Je,Ue;return s="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",t="Name",o="Pool",i="Size",_="10 GiB",r="\uD2B9\uC9D5\uB4E4",l="\uBD84\uC0B0\uC800\uC7A5",d="Object size" + "\ufffd#62\ufffd" + "Objects in the Ceph Storage Cluster have a maximum configurable size (e.g., 2MB, 4MB, etc.). The object size should be large enough to accommodate many stripe units, and should be a multiple of the stripe unit." + "\ufffd/#62\ufffd" + "",u="Stripe unit" + "\ufffd#69\ufffd" + "Stripes have a configurable unit size (e.g., 64kb). The Ceph Client divides the data it will write to objects into equally sized stripe units, except for the last stripe unit. A stripe width, should be a fraction of the Object Size so that an object may contain many stripe units." + "\ufffd/#69\ufffd" + "",f="-- \uBD84\uC0B0\uC800\uC7A5\uB2E8\uC704 \uC120\uD0DD --",M="Stripe count" + "\ufffd#80\ufffd" + "The Ceph Client writes a sequence of stripe units over a series of objects determined by the stripe count. The series of objects is called an object set. After the Ceph Client writes to the last object in the object set, it returns to the first object in the object set." + "\ufffd/#80\ufffd" + "",O="\n          " + "\ufffd0\ufffd" + " from\n        ",I="This field is required.",B="'/' \uC640 '@' \uBB38\uC790\uB294 \uC0AC\uC6A9\uBD88\uAC00\uC785\uB2C8\uB2E4.",V="\uB85C\uB529\uC911...",Z="-- No block pools available --",ne="-- \uD480 \uC120\uD0DD --",ie="This field is required.",H="You need to set " + "\ufffd#2\ufffd" + "mirror mode" + "\ufffd/#2\ufffd" + " in the selected pool to enable mirroring. " + "\ufffd#3\ufffd" + "Set Mode" + "\ufffd/#3\ufffd" + "",pe="You need to set mode as " + "\ufffd#2\ufffd" + "Image" + "\ufffd/#2\ufffd" + " in the selected pool to enable snapshot mirroring. " + "\ufffd#3\ufffd" + "Set Mode" + "\ufffd/#3\ufffd" + "",ue="Schedule Interval",F="12h or 1d or 10m",Oe="Specify the interval to create mirror snapshots automatically. The interval can be specified in days, hours, or minutes using d, h, m suffix respectively",Re="This field is required.",he="Dedicated data pool",Ae="You need more than one pool with the rbd application label use to use a dedicated data pool.",Ne="\uB85C\uB529\uC911...",Pe="-- \uC774\uC6A9\uAC00\uB2A5\uD55C \uB370\uC774\uD0C0\uD480 \uC5C6\uC74C --",be="This field is required.",x="\uB85C\uB529\uC911...",Ke="-- No namespaces available --",ke="-- Select a namespace --",Ve="This field is required.",Qe="\uC0AC\uC774\uC988\uB97C \uC99D\uAC00\uC2DC\uCF1C\uC57C \uD569\uB2C8\uB2E4.",Xe="Size must be a number or in a valid format. eg: 5 GiB",Ye="\uBD84\uC0B0\uC800\uC7A5 \uAC1C\uC218\uAC00 \uC815\uC758\uB418\uC5B4 \uC788\uC73C\uBBC0\uB85C \uC774 \uD544\uB4DC\uB294 \uD544\uC218\uC785\uB2C8\uB2E4!",ze="\uBD84\uC0B0\uC800\uC7A5\uB2E8\uC704\uB294 \uAC1D\uCCB4\uD06C\uAE30\uBCF4\uB2E4 \uCEE4\uC57C \uD569\uB2C8\uB2E4.",Je="\uBD84\uC0B0\uC800\uC7A5 \uB2E8\uC704\uAC00 \uC815\uC758\uB418\uC5B4 \uC788\uC73C\uBBC0\uB85C \uC774 \uD544\uB4DC\uB294 \uD544\uC218\uC785\uB2C8\uB2E4!",Ue="\uBD84\uC0B0\uC800\uC7A5 \uAC2F\uC218\uB294 \uBC18\uB4DC\uC2DC 0\uBCF4\uB2E4 \uCEE4\uC57C \uD569\uB2C8\uB2E4.",[["class","cd-col-form",4,"cdFormLoading"],[1,"cd-col-form"],["name","rbdForm","novalidate","",3,"formGroup"],["formDir","ngForm"],[1,"card"],[1,"card-header"],s,[1,"card-body"],["class","form-group row",4,"ngIf"],[1,"form-group","row"],["for","name",1,"cd-col-form-label","required"],t,[1,"cd-col-form-input"],["type","text","placeholder","Name...","id","name","name","name","formControlName","name","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],[1,"form-group","row",3,"change"],["for","pool",1,"cd-col-form-label",3,"ngClass"],o,["class","form-control","type","text","placeholder","Pool name...","id","pool","name","pool","formControlName","pool",4,"ngIf"],["id","pool","name","pool","class","form-select","formControlName","pool",3,"change",4,"ngIf"],[1,"cd-col-form-offset"],[1,"custom-control","custom-checkbox"],["type","checkbox","id","mirroring","name","mirroring","formControlName","mirroring",1,"custom-control-input",3,"ngModel","change","ngModelChange"],["for","mirroring",1,"custom-control-label"],["type","info",3,"showTitle",4,"ngIf"],[4,"ngIf"],["class","custom-control custom-checkbox",4,"ngIf"],["for","size",1,"cd-col-form-label","required"],i,["id","size","name","size","type","text","formControlName","size","placeholder",_,"defaultUnit","GiB","cdDimlessBinary","",1,"form-control"],["formGroupName","features",1,"form-group","row"],["for","features",1,"cd-col-form-label"],r,["class","custom-control custom-checkbox",4,"ngFor","ngForOf"],[1,"cd-header"],l,["for","size",1,"cd-col-form-label"],d,["id","obj_size","name","obj_size","formControlName","obj_size",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],["for","stripingUnit",1,"cd-col-form-label",3,"ngClass"],u,["id","stripingUnit","name","stripingUnit","formControlName","stripingUnit",1,"form-select"],[3,"ngValue"],f,["for","stripingCount",1,"cd-col-form-label",3,"ngClass"],M,["id","stripingCount","name","stripingCount","formControlName","stripingCount","type","number",1,"form-control"],[3,"form","initializeData","changes"],[1,"card-footer"],["wrappingClass","text-right",3,"form","submitText","submitActionEvent"],["for","name",1,"cd-col-form-label"],O,["type","text","id","parent","name","parent","formControlName","parent",1,"form-control"],[1,"invalid-feedback"],I,B,["type","text","placeholder","Pool name...","id","pool","name","pool","formControlName","pool",1,"form-control"],["id","pool","name","pool","formControlName","pool",1,"form-select",3,"change"],[3,"ngValue",4,"ngIf"],V,Z,ne,[3,"value"],ie,["type","info",3,"showTitle"],H,["type","button",1,"btn","btn-light",3,"routerLink"],["class","custom-control custom-radio ms-2",4,"ngFor","ngForOf"],[1,"custom-control","custom-radio","ms-2"],["type","radio","name","mirroringMode","formControlName","mirroringMode",1,"form-check-input",3,"id","value","change"],[1,"form-check-label",3,"for"],pe,["type","button",1,"btn","btn-light","mx-2",3,"routerLink"],[1,"cd-col-form-label","required",3,"ngClass"],ue,["id","schedule","name","schedule","type","text","formControlName","schedule","placeholder",F,1,"form-control"],Oe,Re,["type","checkbox","id","useDataPool","name","useDataPool","formControlName","useDataPool",1,"custom-control-input",3,"change"],["for","useDataPool",1,"custom-control-label"],he,Ae,[1,"cd-col-form-input","pt-2","ms-4"],["class","form-control","type","text","placeholder","Data pool name...","id","dataPool","name","dataPool","formControlName","dataPool",4,"ngIf"],["id","dataPool","name","dataPool","class","form-select","formControlName","dataPool",3,"change",4,"ngIf"],["type","text","placeholder","Data pool name...","id","dataPool","name","dataPool","formControlName","dataPool",1,"form-control"],["id","dataPool","name","dataPool","formControlName","dataPool",1,"form-select",3,"change"],Ne,Pe,be,[3,"ngClass"],["for","pool",1,"cd-col-form-label"],["class","form-control","type","text","placeholder","Namespace...","id","namespace","name","namespace","formControlName","namespace",4,"ngIf"],["id","namespace","name","namespace","class","form-select","formControlName","namespace",4,"ngIf"],["type","text","placeholder","Namespace...","id","namespace","name","namespace","formControlName","namespace",1,"form-control"],["id","namespace","name","namespace","formControlName","namespace",1,"form-select"],x,Ke,ke,Ve,Qe,Xe,["type","checkbox",1,"custom-control-input",3,"id","name","formControlName"],[1,"custom-control-label",3,"for"],["type","warning",4,"ngIf"],["type","warning"],Ye,ze,Je,Ue]},template:function(t,o){1&t&&e.YNc(0,h_,90,50,"div",0),2&t&&e.Q6J("cdFormLoading",o.loading)},dependencies:[c.mk,c.sg,c.O5,a._Y,a.YN,a.Kr,a.Fj,a.wV,a.Wl,a.EJ,a._,a.JJ,a.JL,a.sg,a.u,a.x0,It.S,Ze.G,R.p,me.t,Ps.B,ve.U,bs.Q,Mt.y,L.o,g.b,T.P,b.V,p.rH,Is.d,c.rS,Fe.m]}),n})();var $t=m(71225),gt=m(36169),A_=m(72427),Tt=m(51847),N_=m(16738),De=m.n(N_),ot=m(62862),P_=m(52266);function b_(n,s){1&n&&(e.TgZ(0,"div",18)(1,"span"),e.SDv(2,19),e.qZA()())}function I_(n,s){1&n&&(e.TgZ(0,"span",20),e.SDv(1,21),e.qZA())}function F_(n,s){1&n&&(e.TgZ(0,"span",20),e.SDv(1,22),e.qZA())}function v_(n,s){if(1&n&&e._UZ(0,"cd-date-time-picker",23),2&n){const t=e.oxw();e.Q6J("control",t.moveForm.get("expiresAt"))}}let L_=(()=>{class n{constructor(t,o,i,_,r){this.rbdService=t,this.activeModal=o,this.actionLabels=i,this.fb=_,this.taskWrapper=r,this.createForm()}createForm(){this.moveForm=this.fb.group({expiresAt:["",[v.hq.custom("format",t=>!(""===t||De()(t,"YYYY-MM-DD HH:mm:ss").isValid())),v.hq.custom("expired",t=>De()().isAfter(t))]]})}ngOnInit(){this.imageSpec=new w.N(this.poolName,this.namespace,this.imageName),this.imageSpecStr=this.imageSpec.toString(),this.pattern=`${this.poolName}/${this.imageName}`}moveImage(){let t=0;const o=this.moveForm.getValue("expiresAt");o&&(t=De()(o,"YYYY-MM-DD HH:mm:ss").diff(De()(),"seconds",!0)),t<0&&(t=0),this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/trash/move",{image_spec:this.imageSpecStr}),call:this.rbdService.moveTrash(this.imageSpec,t)}).subscribe({complete:()=>{this.activeModal.close()}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(j.U),e.Y36(P.Kz),e.Y36(E.p4),e.Y36(ot.O),e.Y36(G.P))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-rbd-trash-move-modal"]],decls:23,vars:9,consts:function(){let s,t,o,i,_,r,l;return s="\uC774\uBBF8\uC9C0\uB97C \uD734\uC9C0\uD1B5\uC5D0 \uC774\uB3D9",t="To move " + "[\ufffd#10\ufffd|\ufffd#11\ufffd]" + "" + "\ufffd0\ufffd" + "" + "[\ufffd/#10\ufffd|\ufffd/#11\ufffd]" + " to trash, click " + "[\ufffd#10\ufffd|\ufffd#11\ufffd]" + "Move" + "[\ufffd/#10\ufffd|\ufffd/#11\ufffd]" + ". Optionally, you can pick an expiration date.",t=e.Zx4(t),o="\uBCF4\uD638\uAC00 \uB9CC\uB8CC\uB418\uB294 ",i="\uBCF4\uD638\uB418\uC9C0 \uC54A\uC74C",_="This image contains snapshot(s), which will prevent it from being removed after moved to trash.",r="\uB0A0\uC9DC \uD615\uC2DD \uC624\uB958. \"YYYY-MM-DD HH:mm:ss\" \uD615\uC2DD\uC73C\uB85C \uC9C0\uC815\uD558\uC138\uC694.",l="\uBCF4\uD638\uAE30\uAC04\uC774 \uC774\uBBF8 \uB9CC\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uB354 \uBBF8\uB798\uC758 \uB0A0\uC9DC\uB97C \uC120\uD0DD\uD558\uAC70\uB098 \uACF5\uB780\uC73C\uB85C \uB0A8\uACA8\uB450\uC138\uC694.",[[3,"modalRef"],[1,"modal-title"],s,[1,"modal-content"],["name","moveForm","novalidate","",1,"form",3,"formGroup"],["formDir","ngForm"],[1,"modal-body"],["class","alert alert-warning","role","alert",4,"ngIf"],t,[1,"form-group"],["for","expiresAt",1,"col-form-label"],o,["type","text","placeholder",i,"formControlName","expiresAt","triggers","manual",1,"form-control",3,"ngbPopover","click","keypress"],["p","ngbPopover"],["class","invalid-feedback",4,"ngIf"],[1,"modal-footer"],[3,"form","submitText","submitActionEvent"],["popContent",""],["role","alert",1,"alert","alert-warning"],_,[1,"invalid-feedback"],r,l,[3,"control"]]},template:function(t,o){if(1&t){const i=e.EpF();e.TgZ(0,"cd-modal",0),e.ynx(1,1),e.SDv(2,2),e.BQk(),e.ynx(3,3),e.TgZ(4,"form",4,5)(6,"div",6),e.YNc(7,b_,3,0,"div",7),e.TgZ(8,"p"),e.tHW(9,8),e._UZ(10,"kbd")(11,"kbd"),e.N_p(),e.qZA(),e.TgZ(12,"div",9)(13,"label",10),e.SDv(14,11),e.qZA(),e.TgZ(15,"input",12,13),e.NdJ("click",function(){e.CHM(i);const r=e.MAs(16);return e.KtG(r.open())})("keypress",function(){e.CHM(i);const r=e.MAs(16);return e.KtG(r.close())}),e.qZA(),e.YNc(17,I_,2,0,"span",14),e.YNc(18,F_,2,0,"span",14),e.qZA()(),e.TgZ(19,"div",15)(20,"cd-form-button-panel",16),e.NdJ("submitActionEvent",function(){return o.moveImage()}),e.qZA()()(),e.BQk(),e.qZA(),e.YNc(21,v_,1,1,"ng-template",null,17,e.W1O)}if(2&t){const i=e.MAs(5),_=e.MAs(22);e.Q6J("modalRef",o.activeModal),e.xp6(4),e.Q6J("formGroup",o.moveForm),e.xp6(3),e.Q6J("ngIf",o.hasSnapshots),e.xp6(4),e.pQV(o.imageSpecStr),e.QtT(9),e.xp6(4),e.Q6J("ngbPopover",_),e.xp6(2),e.Q6J("ngIf",o.moveForm.showError("expiresAt",i,"format")),e.xp6(1),e.Q6J("ngIf",o.moveForm.showError("expiresAt",i,"expired")),e.xp6(2),e.Q6J("form",o.moveForm)("submitText",o.actionLabels.MOVE)}},dependencies:[c.O5,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,P.o8,Y.z,P_.J,R.p,L.o,g.b,T.P,b.V]}),n})();var D_=m(60251),Bt=m(76317),Gt=m(25917),yt=m(51295),ft=m(60737),qe=m(96102),$_=m(74255),xt=m(71099),Zt=m(79765);function B_(n,s){1&n&&(e.TgZ(0,"span",16),e.SDv(1,17),e.qZA())}function G_(n,s){if(1&n&&(e.TgZ(0,"span"),e.tHW(1,18),e._UZ(2,"b"),e.N_p(),e.qZA()),2&n){const t=e.oxw();e.xp6(2),e.pQV(t.imageName),e.QtT(1)}}function y_(n,s){1&n&&(e.TgZ(0,"cd-helper"),e.SDv(1,25),e.qZA())}function x_(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",7)(1,"div",20)(2,"div",21)(3,"input",22),e.NdJ("change",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.onMirrorCheckBoxChange())}),e.qZA(),e.TgZ(4,"label",23),e.SDv(5,24),e.qZA(),e.YNc(6,y_,2,0,"cd-helper",13),e.qZA()()()}if(2&n){const t=s.ngIf;e.xp6(3),e.uIk("disabled",!(t.length>0)||null),e.xp6(3),e.Q6J("ngIf",!t.length>0)}}function Z_(n,s){if(1&n&&(e.ynx(0),e.YNc(1,x_,7,2,"div",19),e.ALo(2,"async"),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.peerConfigured$))}}let w_=(()=>{class n{constructor(t,o,i,_,r,l){this.activeModal=t,this.rbdService=o,this.taskManagerService=i,this.notificationService=_,this.actionLabels=r,this.rbdMirrorService=l,this.editing=!1,this.onSubmit=new Zt.xQ,this.action=this.actionLabels.CREATE,this.resource="RBD Snapshot",this.createForm()}createForm(){this.snapshotForm=new A.d({snapshotName:new a.p4("",{validators:[a.kI.required]}),mirrorImageSnapshot:new a.p4(!1,{})})}ngOnInit(){this.peerConfigured$=this.rbdMirrorService.getPeerForPool(this.poolName)}setSnapName(t){this.snapName=t,this.snapshotForm.get("snapshotName").setValue(t)}onMirrorCheckBoxChange(){!0===this.snapshotForm.getValue("mirrorImageSnapshot")?(this.snapshotForm.get("snapshotName").setValue(""),this.snapshotForm.get("snapshotName").clearValidators()):(this.snapshotForm.get("snapshotName").setValue(this.snapName),this.snapshotForm.get("snapshotName").setValidators([a.kI.required]),this.snapshotForm.get("snapshotName").updateValueAndValidity())}setEditing(t=!0){this.editing=t,this.action=this.editing?this.actionLabels.RENAME:this.actionLabels.CREATE}editAction(){const t=this.snapshotForm.getValue("snapshotName"),o=new w.N(this.poolName,this.namespace,this.imageName),i=new N.R;i.name="rbd/snap/edit",i.metadata={image_spec:o.toString(),snapshot_name:t},this.rbdService.renameSnapshot(o,this.snapName,t).toPromise().then(()=>{this.taskManagerService.subscribe(i.name,i.metadata,_=>{this.notificationService.notifyTask(_)}),this.activeModal.close(),this.onSubmit.next(this.snapName)}).catch(()=>{this.snapshotForm.setErrors({cdSubmitButton:!0})})}createAction(){const t=this.snapshotForm.getValue("snapshotName"),o=this.snapshotForm.getValue("mirrorImageSnapshot"),i=new w.N(this.poolName,this.namespace,this.imageName),_=new N.R;_.name="rbd/snap/create",_.metadata={image_spec:i.toString(),snapshot_name:t},this.rbdService.createSnapshot(i,t,o).toPromise().then(()=>{this.taskManagerService.subscribe(_.name,_.metadata,r=>{this.notificationService.notifyTask(r)}),this.activeModal.close(),this.onSubmit.next(t)}).catch(()=>{this.snapshotForm.setErrors({cdSubmitButton:!0})})}submit(){this.editing?this.editAction():this.createAction()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(P.Kz),e.Y36(j.U),e.Y36(xt.k),e.Y36(xe.g),e.Y36(E.p4),e.Y36(X))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-rbd-snapshot-form-modal"]],decls:21,vars:18,consts:function(){let s,t,o,i,_,r;return s="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",t="Name",o="This field is required.",i="Snapshot mode is enabled on image " + "\ufffd#2\ufffd" + "" + "\ufffd0\ufffd" + "" + "\ufffd/#2\ufffd" + ": snapshot names are auto generated",_="Mirror Image Snapshot",r="The peer must be registered to do this action.",[[3,"modalRef"],[1,"modal-title"],s,[1,"modal-content"],["name","snapshotForm","novalidate","",3,"formGroup"],["formDir","ngForm"],[1,"modal-body"],[1,"form-group","row"],["for","snapshotName",1,"cd-col-form-label","required"],t,[1,"cd-col-form-input"],["type","text","placeholder","Snapshot name...","id","snapshotName","name","snapshotName","formControlName","snapshotName","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],[4,"ngIf"],[1,"modal-footer"],[3,"form","submitText","submitActionEvent"],[1,"invalid-feedback"],o,i,["class","form-group row",4,"ngIf"],[1,"cd-col-form-offset"],[1,"custom-control","custom-checkbox"],["type","checkbox","formControlName","mirrorImageSnapshot","name","mirrorImageSnapshot","id","mirrorImageSnapshot",1,"custom-control-input",3,"change"],["for","mirrorImageSnapshot",1,"custom-control-label"],_,r]},template:function(t,o){if(1&t&&(e.TgZ(0,"cd-modal",0),e.ynx(1,1),e.SDv(2,2),e.ALo(3,"titlecase"),e.ALo(4,"upperFirst"),e.BQk(),e.ynx(5,3),e.TgZ(6,"form",4,5)(8,"div",6)(9,"div",7)(10,"label",8),e.SDv(11,9),e.qZA(),e.TgZ(12,"div",10),e._UZ(13,"input",11),e.YNc(14,B_,2,0,"span",12),e.YNc(15,G_,3,1,"span",13),e.qZA()(),e.YNc(16,Z_,3,3,"ng-container",13),e.qZA(),e.TgZ(17,"div",14)(18,"cd-form-button-panel",15),e.NdJ("submitActionEvent",function(){return o.submit()}),e.ALo(19,"titlecase"),e.ALo(20,"upperFirst"),e.qZA()()(),e.BQk(),e.qZA()),2&t){const i=e.MAs(7);e.Q6J("modalRef",o.activeModal),e.xp6(4),e.pQV(e.lcZ(3,10,o.action))(e.lcZ(4,12,o.resource)),e.QtT(2),e.xp6(2),e.Q6J("formGroup",o.snapshotForm),e.xp6(7),e.uIk("disabled","snapshot"===o.mirroring&&!0===o.snapshotForm.getValue("mirrorImageSnapshot")||null),e.xp6(1),e.Q6J("ngIf",o.snapshotForm.showError("snapshotName",i,"required")),e.xp6(1),e.Q6J("ngIf","snapshot"===o.mirroring&&!0===o.snapshotForm.getValue("mirrorImageSnapshot")||null),e.xp6(1),e.Q6J("ngIf","snapshot"===o.mirroring||null),e.xp6(2),e.Q6J("form",o.snapshotForm)("submitText",e.lcZ(19,14,o.action)+" "+e.lcZ(20,16,o.resource))}},dependencies:[c.O5,a._Y,a.Fj,a.Wl,a.JJ,a.JL,a.sg,a.u,It.S,Y.z,R.p,ve.U,L.o,g.b,T.P,b.V,c.Ov,c.rS,Fe.m]}),n})();class H_{constructor(s,t,o){this.featuresName=t,this.cloneFormatVersion=1,o.cloneFormatVersion().subscribe(i=>{this.cloneFormatVersion=i}),this.create={permission:"create",icon:C.P.add,name:s.CREATE},this.rename={permission:"update",icon:C.P.edit,name:s.RENAME,disable:i=>this.disableForMirrorSnapshot(i)||!i.hasSingleSelection},this.protect={permission:"update",icon:C.P.lock,visible:i=>i.hasSingleSelection&&!i.first().is_protected,name:s.PROTECT,disable:i=>this.disableForMirrorSnapshot(i)||this.getProtectDisableDesc(i,this.featuresName)},this.unprotect={permission:"update",icon:C.P.unlock,visible:i=>i.hasSingleSelection&&i.first().is_protected,name:s.UNPROTECT,disable:i=>this.disableForMirrorSnapshot(i)},this.clone={permission:"create",canBePrimary:i=>i.hasSingleSelection,disable:i=>this.getCloneDisableDesc(i)||this.disableForMirrorSnapshot(i),icon:C.P.clone,name:s.CLONE},this.copy={permission:"create",canBePrimary:i=>i.hasSingleSelection,disable:i=>!i.hasSingleSelection||i.first().cdExecuting||this.disableForMirrorSnapshot(i),icon:C.P.copy,name:s.COPY},this.rollback={permission:"update",icon:C.P.undo,name:s.ROLLBACK,disable:i=>this.disableForMirrorSnapshot(i)||!i.hasSingleSelection},this.deleteSnap={permission:"delete",icon:C.P.destroy,disable:i=>{const _=i.first();return!i.hasSingleSelection||_.cdExecuting||_.is_protected||this.disableForMirrorSnapshot(i)},name:s.DELETE},this.ordering=[this.create,this.rename,this.protect,this.unprotect,this.clone,this.copy,this.rollback,this.deleteSnap]}getProtectDisableDesc(s,t){return!(s.hasSingleSelection&&!s.first().cdExecuting)||!t?.includes("layering")&&"The layering feature needs to be enabled on parent image"}getCloneDisableDesc(s){return!(s.hasSingleSelection&&!s.first().cdExecuting)||1===this.cloneFormatVersion&&!s.first().is_protected&&"Snapshot must be protected in order to clone."}disableForMirrorSnapshot(s){return s.hasSingleSelection&&"snapshot"===s.first().mirror_mode&&s.first().name.includes(".mirror.")}}class q_{}const K_=["nameTpl"],k_=["rollbackTpl"];function V_(n,s){if(1&n&&(e.ynx(0),e.SDv(1,3),e.BQk(),e.TgZ(2,"strong"),e._uU(3),e.qZA(),e._uU(4,".\n")),2&n){const t=s.$implicit;e.xp6(3),e.hij(" ",t.snapName,"")}}let Q_=(()=>{class n{constructor(t,o,i,_,r,l,d,u,f,M,O){this.authStorageService=t,this.modalService=o,this.dimlessBinaryPipe=i,this.cdDatePipe=_,this.rbdService=r,this.taskManagerService=l,this.notificationService=d,this.summaryService=u,this.taskListService=f,this.actionLabels=M,this.cdr=O,this.snapshots=[],this.selection=new le.r,this.builders={"rbd/snap/create":I=>{const B=new q_;return B.name=I.snapshot_name,B}},this.permission=this.authStorageService.getPermissions().rbdImage}ngOnInit(){this.columns=[{name:"Name",prop:"name",cellTransformation:Be.e.executing,flexGrow:2},{name:"Size",prop:"size",flexGrow:1,cellClass:"text-right",pipe:this.dimlessBinaryPipe},{name:"Used",prop:"disk_usage",flexGrow:1,cellClass:"text-right",pipe:this.dimlessBinaryPipe},{name:"State",prop:"is_protected",flexGrow:1,cellTransformation:Be.e.badge,customTemplateConfig:{map:{true:{value:"PROTECTED",class:"badge-success"},false:{value:"UNPROTECTED",class:"badge-info"}}}},{name:"Created",prop:"timestamp",flexGrow:1,pipe:this.cdDatePipe}],this.imageSpec=new w.N(this.poolName,this.namespace,this.rbdName),this.rbdTableActions=new H_(this.actionLabels,this.featuresName,this.rbdService),this.rbdTableActions.create.click=()=>this.openCreateSnapshotModal(),this.rbdTableActions.rename.click=()=>this.openEditSnapshotModal(),this.rbdTableActions.protect.click=()=>this.toggleProtection(),this.rbdTableActions.unprotect.click=()=>this.toggleProtection();const t=()=>this.selection.first()&&`${this.imageSpec.toStringEncoded()}/${encodeURIComponent(this.selection.first().name)}`;this.rbdTableActions.clone.routerLink=()=>`/block/rbd/clone/${t()}`,this.rbdTableActions.copy.routerLink=()=>`/block/rbd/copy/${t()}`,this.rbdTableActions.rollback.click=()=>this.rollbackModal(),this.rbdTableActions.deleteSnap.click=()=>this.deleteSnapshotModal(),this.tableActions=this.rbdTableActions.ordering,this.taskListService.init(()=>(0,Gt.of)(this.snapshots),null,_=>{yt.T.updateChanged(this,{data:_})&&(this.cdr.detectChanges(),this.data=[...this.data])},()=>{yt.T.updateChanged(this,{data:this.snapshots})&&(this.cdr.detectChanges(),this.data=[...this.data])},_=>["rbd/snap/create","rbd/snap/delete","rbd/snap/edit","rbd/snap/rollback"].includes(_.name)&&this.imageSpec.toString()===_.metadata.image_spec,(_,r)=>_.name===r.metadata.snapshot_name,this.builders)}ngOnChanges(){this.columns&&(this.imageSpec=new w.N(this.poolName,this.namespace,this.rbdName),this.rbdTableActions&&(this.rbdTableActions.featuresName=this.featuresName),this.taskListService.fetch())}openSnapshotModal(t,o=null){this.modalRef=this.modalService.show(w_,{mirroring:this.mirroring}),this.modalRef.componentInstance.poolName=this.poolName,this.modalRef.componentInstance.imageName=this.rbdName,this.modalRef.componentInstance.namespace=this.namespace,o?this.modalRef.componentInstance.setEditing():o=`${this.rbdName}_${De()().toISOString(!0)}`,this.modalRef.componentInstance.setSnapName(o),this.modalRef.componentInstance.onSubmit.subscribe(_=>{const r=new ft.o;r.name=t,r.metadata={image_spec:this.imageSpec.toString(),snapshot_name:_},this.summaryService.addRunningTask(r)})}openCreateSnapshotModal(){this.openSnapshotModal("rbd/snap/create")}openEditSnapshotModal(){this.openSnapshotModal("rbd/snap/edit",this.selection.first().name)}toggleProtection(){const t=this.selection.first().name,o=this.selection.first().is_protected,i=new N.R;i.name="rbd/snap/edit";const _=new w.N(this.poolName,this.namespace,this.rbdName);i.metadata={image_spec:_.toString(),snapshot_name:t},this.rbdService.protectSnapshot(_,t,!o).toPromise().then(()=>{const r=new ft.o;r.name=i.name,r.metadata=i.metadata,this.summaryService.addRunningTask(r),this.taskManagerService.subscribe(i.name,i.metadata,l=>{this.notificationService.notifyTask(l)})})}_asyncTask(t,o,i){const _=new N.R;_.name=o,_.metadata={image_spec:new w.N(this.poolName,this.namespace,this.rbdName).toString(),snapshot_name:i};const r=new w.N(this.poolName,this.namespace,this.rbdName);this.rbdService[t](r,i).toPromise().then(()=>{const l=new ft.o;l.name=_.name,l.metadata=_.metadata,this.summaryService.addRunningTask(l),this.modalRef.close(),this.taskManagerService.subscribe(l.name,l.metadata,d=>{this.notificationService.notifyTask(d)})}).catch(()=>{this.modalRef.componentInstance.stopLoadingSpinner()})}rollbackModal(){const t=this.selection.selected[0].name,o=new w.N(this.poolName,this.namespace,this.rbdName).toString(),i={titleText:"RBD snapshot rollback",buttonText:"Rollback",bodyTpl:this.rollbackTpl,bodyData:{snapName:`${o}@${t}`},onSubmit:()=>{this._asyncTask("rollbackSnapshot","rbd/snap/rollback",t)}};this.modalRef=this.modalService.show(gt.Y,i)}deleteSnapshotModal(){const t=this.selection.selected[0].name;this.modalRef=this.modalService.show(re.M,{itemDescription:"RBD snapshot",itemNames:[t],submitAction:()=>this._asyncTask("deleteSnapshot","rbd/snap/delete",t)})}updateSelection(t){this.selection=t}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(k.j),e.Y36(ae.Z),e.Y36(Le.$),e.Y36(qe.N),e.Y36(j.U),e.Y36(xt.k),e.Y36(xe.g),e.Y36($_.J),e.Y36(Se.j),e.Y36(E.p4),e.Y36(e.sBO))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-rbd-snapshot-list"]],viewQuery:function(t,o){if(1&t&&(e.Gf(K_,5),e.Gf(k_,7)),2&t){let i;e.iGM(i=e.CRH())&&(o.nameTpl=i.first),e.iGM(i=e.CRH())&&(o.rollbackTpl=i.first)}},inputs:{snapshots:"snapshots",featuresName:"featuresName",poolName:"poolName",namespace:"namespace",mirroring:"mirroring",primary:"primary",rbdName:"rbdName"},features:[e._Bn([Se.j]),e.TTD],decls:4,vars:5,consts:function(){let s;return s="\uB864\uBC31\uD558\uB824\uACE0 \uD569\uB2C8\uB2E4.",[["columnMode","flex","selectionType","single",3,"data","columns","updateSelection"],[1,"table-actions",3,"permission","selection","tableActions"],["rollbackTpl",""],s]},template:function(t,o){1&t&&(e.TgZ(0,"cd-table",0),e.NdJ("updateSelection",function(_){return o.updateSelection(_)}),e._UZ(1,"cd-table-actions",1),e.qZA(),e.YNc(2,V_,5,1,"ng-template",null,2,e.W1O)),2&t&&(e.Q6J("data",o.data)("columns",o.columns),e.xp6(1),e.Q6J("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[z.a,ce.K],changeDetection:0}),n})();var X_=m(42176),Y_=m(41039);const z_=["poolConfigurationSourceTpl"];function J_(n,s){1&n&&(e.ynx(0),e.tHW(1,3),e._UZ(2,"strong"),e.N_p(),e.BQk())}function U_(n,s){if(1&n&&(e.TgZ(0,"span")(1,"span",38),e._uU(2),e.qZA()()),2&n){const t=s.$implicit;e.xp6(2),e.Oqu(t)}}function j_(n,s){if(1&n&&(e.TgZ(0,"span")(1,"span",39),e.SDv(2,40),e.qZA()()),2&n){e.oxw(3);const t=e.MAs(1);e.xp6(1),e.Q6J("ngbTooltip",t)}}function W_(n,s){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"dimlessBinary"),e.qZA()),2&n){const t=e.oxw(3);e.xp6(1),e.hij(" ",e.lcZ(2,1,t.selection.disk_usage)," ")}}function ea(n,s){if(1&n&&(e.TgZ(0,"span")(1,"span",39),e.SDv(2,41),e.qZA()()),2&n){e.oxw(3);const t=e.MAs(1);e.xp6(1),e.Q6J("ngbTooltip",t)}}function ta(n,s){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"dimlessBinary"),e.qZA()),2&n){const t=e.oxw(3);e.xp6(1),e.hij(" ",e.lcZ(2,1,t.selection.total_disk_usage)," ")}}function oa(n,s){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw(4);e.xp6(1),e.hij("/",t.selection.parent.pool_namespace,"")}}function na(n,s){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.YNc(2,oa,2,1,"span",1),e._uU(3),e.qZA()),2&n){const t=e.oxw(3);e.xp6(1),e.Oqu(t.selection.parent.pool_name),e.xp6(1),e.Q6J("ngIf",t.selection.parent.pool_namespace),e.xp6(1),e.AsE("/",t.selection.parent.image_name,"@",t.selection.parent.snap_name,"")}}function ia(n,s){1&n&&(e.TgZ(0,"span"),e._uU(1,"-"),e.qZA())}function sa(n,s){if(1&n&&(e.TgZ(0,"table",17)(1,"tbody")(2,"tr")(3,"td",18),e.SDv(4,19),e.qZA(),e.TgZ(5,"td",20),e._uU(6),e.qZA()(),e.TgZ(7,"tr")(8,"td",21),e.SDv(9,22),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.qZA()(),e.TgZ(12,"tr")(13,"td",21),e.SDv(14,23),e.qZA(),e.TgZ(15,"td"),e._uU(16),e.ALo(17,"empty"),e.qZA()(),e.TgZ(18,"tr")(19,"td",21),e.SDv(20,24),e.qZA(),e.TgZ(21,"td"),e._uU(22),e.ALo(23,"cdDate"),e.qZA()(),e.TgZ(24,"tr")(25,"td",21),e.SDv(26,25),e.qZA(),e.TgZ(27,"td"),e._uU(28),e.ALo(29,"dimlessBinary"),e.qZA()(),e.TgZ(30,"tr")(31,"td",21),e.SDv(32,26),e.qZA(),e.TgZ(33,"td"),e._uU(34),e.ALo(35,"dimless"),e.qZA()(),e.TgZ(36,"tr")(37,"td",21),e.SDv(38,27),e.qZA(),e.TgZ(39,"td"),e._uU(40),e.ALo(41,"dimlessBinary"),e.qZA()(),e.TgZ(42,"tr")(43,"td",21),e.SDv(44,28),e.qZA(),e.TgZ(45,"td"),e.YNc(46,U_,3,1,"span",29),e.qZA()(),e.TgZ(47,"tr")(48,"td",21),e.SDv(49,30),e.qZA(),e.TgZ(50,"td"),e.YNc(51,j_,3,1,"span",1),e.YNc(52,W_,3,3,"span",1),e.qZA()(),e.TgZ(53,"tr")(54,"td",21),e.SDv(55,31),e.qZA(),e.TgZ(56,"td"),e.YNc(57,ea,3,1,"span",1),e.YNc(58,ta,3,3,"span",1),e.qZA()(),e.TgZ(59,"tr")(60,"td",21),e.SDv(61,32),e.qZA(),e.TgZ(62,"td"),e._uU(63),e.ALo(64,"dimlessBinary"),e.qZA()(),e.TgZ(65,"tr")(66,"td",21),e.SDv(67,33),e.qZA(),e.TgZ(68,"td"),e._uU(69),e.qZA()(),e.TgZ(70,"tr")(71,"td",21),e.SDv(72,34),e.qZA(),e.TgZ(73,"td"),e.YNc(74,na,4,4,"span",1),e.YNc(75,ia,2,0,"span",1),e.qZA()(),e.TgZ(76,"tr")(77,"td",21),e.SDv(78,35),e.qZA(),e.TgZ(79,"td"),e._uU(80),e.qZA()(),e.TgZ(81,"tr")(82,"td",21),e.SDv(83,36),e.qZA(),e.TgZ(84,"td"),e._uU(85),e.qZA()(),e.TgZ(86,"tr")(87,"td",21),e.SDv(88,37),e.qZA(),e.TgZ(89,"td"),e._uU(90),e.qZA()()()()),2&n){const t=e.oxw(2);e.xp6(6),e.Oqu(t.selection.name),e.xp6(5),e.Oqu(t.selection.pool_name),e.xp6(5),e.Oqu(e.lcZ(17,19,t.selection.data_pool)),e.xp6(6),e.Oqu(e.lcZ(23,21,t.selection.timestamp)),e.xp6(6),e.Oqu(e.lcZ(29,23,t.selection.size)),e.xp6(6),e.Oqu(e.lcZ(35,25,t.selection.num_objs)),e.xp6(6),e.Oqu(e.lcZ(41,27,t.selection.obj_size)),e.xp6(6),e.Q6J("ngForOf",t.selection.features_name),e.xp6(5),e.Q6J("ngIf",-1===(null==t.selection.features_name?null:t.selection.features_name.indexOf("fast-diff"))),e.xp6(1),e.Q6J("ngIf",-1!==(null==t.selection.features_name?null:t.selection.features_name.indexOf("fast-diff"))),e.xp6(5),e.Q6J("ngIf",-1===(null==t.selection.features_name?null:t.selection.features_name.indexOf("fast-diff"))),e.xp6(1),e.Q6J("ngIf",-1!==(null==t.selection.features_name?null:t.selection.features_name.indexOf("fast-diff"))),e.xp6(5),e.Oqu(e.lcZ(64,29,t.selection.stripe_unit)),e.xp6(6),e.Oqu(t.selection.stripe_count),e.xp6(5),e.Q6J("ngIf",t.selection.parent),e.xp6(1),e.Q6J("ngIf",!t.selection.parent),e.xp6(5),e.Oqu(t.selection.block_name_prefix),e.xp6(5),e.Oqu(t.selection.order),e.xp6(5),e.Oqu(t.selection.image_format)}}function _a(n,s){if(1&n&&e._UZ(0,"cd-rbd-snapshot-list",42),2&n){const t=e.oxw(2);e.Q6J("snapshots",t.selection.snapshots)("featuresName",t.selection.features_name)("poolName",t.selection.pool_name)("primary",t.selection.primary)("namespace",t.selection.namespace)("mirroring",t.selection.mirror_mode)("rbdName",t.selection.name)}}function aa(n,s){if(1&n&&e._UZ(0,"cd-rbd-configuration-table",43),2&n){const t=e.oxw(2);e.Q6J("data",t.selection.configuration)}}function ra(n,s){if(1&n&&e._UZ(0,"cd-grafana",44),2&n){const t=e.oxw(2);e.Q6J("grafanaPath",t.rbdDashboardUrl)("type","metrics")}}function la(n,s){if(1&n&&(e.ynx(0),e.TgZ(1,"nav",4,5),e.ynx(3,6),e.TgZ(4,"a",7),e.SDv(5,8),e.qZA(),e.YNc(6,sa,91,31,"ng-template",9),e.BQk(),e.ynx(7,10),e.TgZ(8,"a",7),e.SDv(9,11),e.qZA(),e.YNc(10,_a,1,7,"ng-template",9),e.BQk(),e.ynx(11,12),e.TgZ(12,"a",7),e.SDv(13,13),e.qZA(),e.YNc(14,aa,1,1,"ng-template",9),e.BQk(),e.ynx(15,14),e.TgZ(16,"a",7),e.SDv(17,15),e.qZA(),e.YNc(18,ra,1,2,"ng-template",9),e.BQk(),e.qZA(),e._UZ(19,"div",16),e.BQk()),2&n){const t=e.MAs(2);e.xp6(19),e.Q6J("ngbNavOutlet",t)}}function ca(n,s){1&n&&(e.ynx(0),e.TgZ(1,"cd-alert-panel",45),e.SDv(2,46),e.qZA(),e.BQk())}function da(n,s){1&n&&(e.ynx(0),e.TgZ(1,"strong",49),e.SDv(2,50),e.qZA(),e.BQk())}function ma(n,s){1&n&&(e.TgZ(0,"span",51),e.SDv(1,52),e.qZA())}function pa(n,s){if(1&n&&(e.YNc(0,da,3,0,"ng-container",47),e.YNc(1,ma,2,0,"ng-template",null,48,e.W1O)),2&n){const t=s.value,o=e.MAs(2);e.Q6J("ngIf",+t)("ngIfElse",o)}}let ua=(()=>{class n{ngOnChanges(){this.selection&&(this.rbdDashboardUrl=`rbd-details?var-Pool=${this.selection.pool_name}&var-Image=${this.selection.name}`)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-rbd-details"]],viewQuery:function(t,o){if(1&t&&(e.Gf(z_,7),e.Gf(P.Pz,7)),2&t){let i;e.iGM(i=e.CRH())&&(o.poolConfigurationSourceTpl=i.first),e.iGM(i=e.CRH())&&(o.nav=i.first)}},inputs:{selection:"selection",images:"images"},features:[e.TTD],decls:6,vars:2,consts:function(){let s,t,o,i,_,r,l,d,u,f,M,O,I,B,V,Z,ne,ie,H,pe,ue,F,Oe,Re,he,Ae,Ne,Pe,be;return s="Only available for RBD images with \n          " + "\ufffd#2\ufffd" + "fast-diff\n          " + "\ufffd/#2\ufffd" + " enabled\n        ",t="\uC138\uBD80\uC124\uBA85",o="\uC2A4\uB0C5\uC0BF",i="\uC124\uC815",_="\uC131\uB2A5",r="Name",l="Pool",d="\uB370\uC774\uD0C0 \uD480",u="Created",f="Size",M="Objects",O="Object size",I="\uD2B9\uC9D5\uB4E4",B="Provisioned",V="Total provisioned",Z="\uC2A4\uD2B8\uB77C\uC774\uD551 \uB2E8\uC704",ne="\uC2A4\uD2B8\uB77C\uC774\uD551 \uD69F\uC218",ie="Parent",H="\uBE14\uB85D \uC774\uB984 \uC811\uB450\uC0AC",pe="\uC21C\uC11C",ue="Format Version",F="\uC774\uC6A9\uBD88\uAC00",Oe="\uC774\uC6A9\uBD88\uAC00",Re="RBD details",he="Information can not be displayed for RBD in status 'Removing'.",Ae="\uC774 \uC124\uC815\uC740 \uC804\uC5ED \uAC12\uC744 \uB36E\uC5B4\uC501\uB2C8\uB2E4.",Ne="Image",Pe="\uC774\uAC83\uC740 \uC804\uC5ED \uAC12\uC785\uB2C8\uB2E4. \uC774 \uC774\uBBF8\uC9C0\uC5D0 \uB300\uD574 \uC774 \uC635\uC158\uC758 \uAC12\uC774 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.",be="\uAE00\uB85C\uBC8C",[["usageNotAvailableTooltipTpl",""],[4,"ngIf"],["poolConfigurationSourceTpl",""],s,["ngbNav","","cdStatefulTab","rbd-details",1,"nav-tabs"],["nav","ngbNav"],["ngbNavItem","details"],["ngbNavLink",""],t,["ngbNavContent",""],["ngbNavItem","snapshots"],o,["ngbNavItem","configuration"],i,["ngbNavItem","performance"],_,[3,"ngbNavOutlet"],[1,"table","table-striped","table-bordered"],[1,"bold","w-25"],r,[1,"w-75"],[1,"bold"],l,d,u,f,M,O,I,[4,"ngFor","ngForOf"],B,V,Z,ne,ie,H,pe,ue,[1,"badge","badge-dark","me-2"],["placement","top",1,"form-text","text-muted",3,"ngbTooltip"],F,Oe,[3,"snapshots","featuresName","poolName","primary","namespace","mirroring","rbdName"],[3,"data"],["title",Re,"uid","YhCYGcuZz","grafanaStyle","one",3,"grafanaPath","type"],["type","warning"],he,[4,"ngIf","ngIfElse"],["global",""],["ngbTooltip",Ae],Ne,["ngbTooltip",Pe],be]},template:function(t,o){1&t&&(e.YNc(0,J_,3,0,"ng-template",null,0,e.W1O),e.YNc(2,la,20,1,"ng-container",1),e.YNc(3,ca,3,0,"ng-container",1),e.YNc(4,pa,3,2,"ng-template",null,2,e.W1O)),2&t&&(e.xp6(2),e.Q6J("ngIf",o.selection&&"REMOVING"!==o.selection.source),e.xp6(1),e.Q6J("ngIf",o.selection&&"REMOVING"===o.selection.source))},dependencies:[c.sg,c.O5,P.uN,P.Pz,P.nv,P.Vx,P.tO,P.Dy,P._L,Bt.F,Ze.G,dt.m,Q_,X_.P,Le.$,rt.n,qe.N,Y_.W]}),n})();const nt=function(){return{exact:!0}};function ga(n,s){1&n&&(e.TgZ(0,"li",1)(1,"a",9),e.SDv(2,10),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("routerLinkActiveOptions",e.DdM(1,nt)))}let it=(()=>{class n{constructor(t){this.authStorageService=t,this.grafanaPermission=this.authStorageService.getPermissions().grafana}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(k.j))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-rbd-tabs"]],decls:11,vars:7,consts:function(){let s,t,o,i;return s="Images",t="Namespaces",o="\uD734\uC9C0\uD1B5",i="\uD1B5\uD569 \uC131\uB2A5\uCE58",[[1,"nav","nav-tabs"],[1,"nav-item"],["routerLink","/block/rbd","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link",3,"routerLinkActiveOptions"],s,["routerLink","/block/rbd/namespaces","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link",3,"routerLinkActiveOptions"],t,["routerLink","/block/rbd/trash","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link",3,"routerLinkActiveOptions"],o,["class","nav-item",4,"ngIf"],["routerLink","/block/rbd/performance","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link",3,"routerLinkActiveOptions"],i]},template:function(t,o){1&t&&(e.TgZ(0,"ul",0)(1,"li",1)(2,"a",2),e.SDv(3,3),e.qZA()(),e.TgZ(4,"li",1)(5,"a",4),e.SDv(6,5),e.qZA()(),e.TgZ(7,"li",1)(8,"a",6),e.SDv(9,7),e.qZA()(),e.YNc(10,ga,3,2,"li",8),e.qZA()),2&t&&(e.xp6(2),e.Q6J("routerLinkActiveOptions",e.DdM(4,nt)),e.xp6(3),e.Q6J("routerLinkActiveOptions",e.DdM(5,nt)),e.xp6(3),e.Q6J("routerLinkActiveOptions",e.DdM(6,nt)),e.xp6(2),e.Q6J("ngIf",o.grafanaPermission.read))},dependencies:[c.O5,p.rH,p.Od]}),n})();const Ta=["usageTpl"],fa=["parentTpl"],Sa=["nameTpl"],Ca=["ScheduleTpl"],Ea=["mirroringTpl"],Ma=["flattenTpl"],Oa=["deleteTpl"],Ra=["removingStatTpl"],ha=["forcePromoteConfirmation"],Aa=["usedTmpl"],Na=["totalUsedTmpl"],Pa=["imageUsageTpl"];function ba(n,s){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).value;e.xp6(1),e.hij("/",t.pool_namespace,"")}}function Ia(n,s){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.YNc(2,ba,2,1,"span",13),e._uU(3),e.qZA()),2&n){const t=e.oxw().value;e.xp6(1),e.Oqu(t.pool_name),e.xp6(1),e.Q6J("ngIf",t.pool_namespace),e.xp6(1),e.AsE("/",t.image_name,"@",t.snap_name,"")}}function Fa(n,s){1&n&&(e.TgZ(0,"span"),e._uU(1,"-"),e.qZA())}function va(n,s){if(1&n&&(e.YNc(0,Ia,4,4,"span",13),e.YNc(1,Fa,2,0,"span",13)),2&n){const t=s.value;e.Q6J("ngIf",t),e.xp6(1),e.Q6J("ngIf",!t)}}function La(n,s){if(1&n&&(e.TgZ(0,"span",17),e._uU(1),e.qZA()),2&n){const t=e.oxw().value;e.xp6(1),e.Oqu(t[0])}}function Da(n,s){if(1&n&&(e.TgZ(0,"span",17),e._uU(1),e.qZA()),2&n){const t=e.oxw().value;e.xp6(1),e.Oqu(t[1])}}function $a(n,s){1&n&&(e.TgZ(0,"span",17),e.SDv(1,18),e.qZA())}function Ba(n,s){1&n&&(e.TgZ(0,"span",17),e.SDv(1,19),e.qZA())}function Ga(n,s){if(1&n&&(e.TgZ(0,"span",17),e._uU(1),e.qZA()),2&n){const t=e.oxw().value;e.xp6(1),e.Oqu(t)}}function ya(n,s){if(1&n&&(e.YNc(0,La,2,1,"span",14),e._uU(1,"\xa0 "),e.YNc(2,Da,2,1,"span",15),e._uU(3,"\xa0 "),e.YNc(4,$a,2,0,"span",15),e.YNc(5,Ba,2,0,"span",15),e.YNc(6,Ga,2,1,"ng-template",null,16,e.W1O)),2&n){const t=s.value,o=s.row,i=e.MAs(7);e.Q6J("ngIf",3===t.length)("ngIfElse",i),e.xp6(2),e.Q6J("ngIf",3===t.length),e.xp6(2),e.Q6J("ngIf",!0===o.primary),e.xp6(1),e.Q6J("ngIf",!1===o.primary)}}function xa(n,s){if(1&n&&(e.TgZ(0,"span",17),e._uU(1),e.ALo(2,"cdDate"),e.qZA()),2&n){const t=e.oxw().value;e.xp6(1),e.Oqu(e.lcZ(2,1,t[2]))}}function Za(n,s){1&n&&e.YNc(0,xa,3,3,"span",15),2&n&&e.Q6J("ngIf",3===s.value.length)}function wa(n,s){if(1&n&&(e._uU(0," You are about to flatten "),e.TgZ(1,"strong"),e._uU(2),e.qZA(),e._uU(3,". "),e._UZ(4,"br")(5,"br"),e._uU(6," All blocks will be copied from parent "),e.TgZ(7,"strong"),e._uU(8),e.qZA(),e._uU(9," to child "),e.TgZ(10,"strong"),e._uU(11),e.qZA(),e._uU(12,".\n")),2&n){const t=s.$implicit;e.xp6(2),e.Oqu(t.child),e.xp6(6),e.Oqu(t.parent),e.xp6(3),e.Oqu(t.child)}}function Ha(n,s){if(1&n&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.xp6(1),e.Oqu(t)}}function qa(n,s){if(1&n&&(e.ynx(0),e.TgZ(1,"span"),e.SDv(2,23),e.qZA(),e.TgZ(3,"ul"),e.YNc(4,Ha,2,1,"li",24),e.qZA(),e.BQk()),2&n){const t=e.oxw(2).snapshots;e.xp6(4),e.Q6J("ngForOf",t)}}function Ka(n,s){if(1&n&&(e.TgZ(0,"div",21)(1,"span"),e.SDv(2,22),e.qZA(),e._UZ(3,"br"),e.YNc(4,qa,5,1,"ng-container",13),e.qZA()),2&n){const t=e.oxw().snapshots;e.xp6(4),e.Q6J("ngIf",t.length>0)}}function ka(n,s){1&n&&e.YNc(0,Ka,5,1,"div",20),2&n&&e.Q6J("ngIf",s.hasSnapshots)}const Va=function(n,s){return[n,s]};function Qa(n,s){if(1&n&&e._UZ(0,"i",26),2&n){const t=e.oxw(2);e.Q6J("ngClass",e.WLB(1,Va,t.icons.spinner,t.icons.spin))}}function Xa(n,s){if(1&n&&(e.TgZ(0,"span",26),e._uU(1),e.qZA()),2&n){const t=e.oxw(),o=t.column,i=t.row;e.Q6J("ngClass",null!=o&&null!=o.customTemplateConfig&&o.customTemplateConfig.executingClass?o.customTemplateConfig.executingClass:"text-muted italic"),e.xp6(1),e.hij(" (",i.cdExecuting,") ")}}function Ya(n,s){if(1&n&&e._UZ(0,"i",28),2&n){const t=e.oxw(2);e.Gre("",t.icons.warning," warn")}}function za(n,s){if(1&n&&(e.YNc(0,Qa,1,4,"i",25),e.TgZ(1,"span",26),e._uU(2),e.qZA(),e.YNc(3,Xa,2,2,"span",25),e.YNc(4,Ya,1,3,"i",27)),2&n){const t=s.column,o=s.value,i=s.row;e.Q6J("ngIf",i.cdExecuting),e.xp6(1),e.Q6J("ngClass",null==t||null==t.customTemplateConfig?null:t.customTemplateConfig.valueClass),e.xp6(1),e.hij(" ",o," "),e.xp6(1),e.Q6J("ngIf",i.cdExecuting),e.xp6(1),e.Q6J("ngIf",i.source&&"REMOVING"===i.source)}}function Ja(n,s){if(1&n&&(e.TgZ(0,"cd-alert-panel",29),e._uU(1),e.qZA(),e.TgZ(2,"div",30),e.tHW(3,31),e._UZ(4,"strong"),e.N_p(),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(t.errorMessage)}}function Ua(n,s){if(1&n&&(e.TgZ(0,"span",34)(1,"span"),e._uU(2,"-"),e.qZA()()),2&n){e.oxw(2);const t=e.MAs(22);e.Q6J("ngbTooltip",t)}}function ja(n,s){if(1&n&&e._UZ(0,"cd-usage-bar",36),2&n){const t=e.oxw(2).row;e.Q6J("total",t.size)("used",t.disk_usage)("title",t.name)}}function Wa(n,s){if(1&n&&e.YNc(0,ja,1,3,"cd-usage-bar",35),2&n){const t=e.oxw().row;e.Q6J("ngIf",t)}}function er(n,s){if(1&n&&(e.YNc(0,Ua,3,1,"span",32),e.YNc(1,Wa,1,1,"ng-template",null,33,e.W1O)),2&n){const t=s.row,o=e.MAs(2);e.Q6J("ngIf",t.features_name&&(!t.features_name.includes("fast-diff")||"snapshot"===t.mirror_mode))("ngIfElse",o)}}function tr(n,s){1&n&&e._UZ(0,"div",37),2&n&&e.Q6J("innerHtml","Only available for RBD images with <strong>fast-diff</strong> enabled and without snapshot mirroring",e.oJD)}let nr=(()=>{class n extends _t.o{createRbdFromTaskImageSpec(t){const o=w.N.fromString(t);return this.createRbdFromTask(o.poolName,o.namespace,o.imageName)}createRbdFromTask(t,o,i){const _=new Os;return _.id="-1",_.unique_id="-1",_.name=i,_.namespace=o,_.pool_name=t,_.image_format=Ge.V2,_}constructor(t,o,i,_,r,l,d,u,f){super(),this.authStorageService=t,this.rbdService=o,this.dimlessBinaryPipe=i,this.dimlessPipe=_,this.modalService=r,this.taskWrapper=l,this.taskListService=d,this.urlBuilder=u,this.actionLabels=f,this.tableStatus=new $t.c("light"),this.selection=new le.r,this.icons=C.P,this.count=0,this.tableContext=null,this.builders={"rbd/create":F=>this.createRbdFromTask(F.pool_name,F.namespace,F.image_name),"rbd/delete":F=>this.createRbdFromTaskImageSpec(F.image_spec),"rbd/clone":F=>this.createRbdFromTask(F.child_pool_name,F.child_namespace,F.child_image_name),"rbd/copy":F=>this.createRbdFromTask(F.dest_pool_name,F.dest_namespace,F.dest_image_name)},this.permission=this.authStorageService.getPermissions().rbdImage;const M=()=>this.selection.first()&&new w.N(this.selection.first().pool_name,this.selection.first().namespace,this.selection.first().name).toStringEncoded();this.tableActions=[{permission:"create",icon:C.P.add,routerLink:()=>this.urlBuilder.getCreate(),canBePrimary:F=>!F.hasSingleSelection,name:this.actionLabels.CREATE},{permission:"update",icon:C.P.edit,routerLink:()=>this.urlBuilder.getEdit(M()),name:this.actionLabels.EDIT,disable:F=>this.getRemovingStatusDesc(F)||this.getInvalidNameDisable(F)},{permission:"create",canBePrimary:F=>F.hasSingleSelection,disable:F=>this.getRemovingStatusDesc(F)||this.getInvalidNameDisable(F)||!!F.first().cdExecuting,icon:C.P.copy,routerLink:()=>`/block/rbd/copy/${M()}`,name:this.actionLabels.COPY},{permission:"update",disable:F=>this.getRemovingStatusDesc(F)||this.getInvalidNameDisable(F)||F.first().cdExecuting||!F.first().parent,icon:C.P.flatten,click:()=>this.flattenRbdModal(),name:this.actionLabels.FLATTEN},{permission:"update",icon:C.P.refresh,click:()=>this.resyncRbdModal(),name:this.actionLabels.RESYNC,disable:F=>this.getResyncDisableDesc(F)},{permission:"delete",icon:C.P.destroy,click:()=>this.deleteRbdModal(),name:this.actionLabels.DELETE,disable:F=>this.getDeleteDisableDesc(F)},{permission:"delete",icon:C.P.trash,click:()=>this.trashRbdModal(),name:this.actionLabels.TRASH,disable:F=>this.getRemovingStatusDesc(F)||this.getInvalidNameDisable(F)||F.first().image_format===Ge.V1},{permission:"update",icon:C.P.edit,click:()=>this.removeSchedulingModal(),name:this.actionLabels.REMOVE_SCHEDULING,disable:F=>this.getRemovingStatusDesc(F)||this.getInvalidNameDisable(F)||void 0===F.first().schedule_info},{permission:"update",icon:C.P.edit,click:()=>this.actionPrimary(!0),name:this.actionLabels.PROMOTE,visible:()=>null!=this.selection.first()&&!this.selection.first().primary,disable:()=>"Disabled"===this.selection.first().mirror_mode?"Mirroring needs to be enabled on the image to perform this action":""},{permission:"update",icon:C.P.edit,click:()=>this.actionPrimary(!1),name:this.actionLabels.DEMOTE,visible:()=>null!=this.selection.first()&&this.selection.first().primary,disable:()=>"Disabled"===this.selection.first().mirror_mode?"Mirroring needs to be enabled on the image to perform this action":""}]}ngOnInit(){this.columns=[{name:"Name",prop:"name",flexGrow:2,cellTemplate:this.removingStatTpl},{name:"Pool",prop:"pool_name",flexGrow:2},{name:"Namespace",prop:"namespace",flexGrow:2},{name:"Size",prop:"size",flexGrow:1,cellClass:"text-right",sortable:!1,pipe:this.dimlessBinaryPipe},{name:"Usage",prop:"usage",cellTemplate:this.imageUsageTpl,flexGrow:1.5},{name:"Objects",prop:"num_objs",flexGrow:1,cellClass:"text-right",sortable:!1,pipe:this.dimlessPipe},{name:"Object size",prop:"obj_size",flexGrow:1,cellClass:"text-right",sortable:!1,pipe:this.dimlessBinaryPipe},{name:"Parent",prop:"parent",flexGrow:2,sortable:!1,cellTemplate:this.parentTpl},{name:"Mirroring",prop:"mirror_mode",flexGrow:3,sortable:!1,cellTemplate:this.mirroringTpl},{name:"Next Scheduled Snapshot",prop:"mirror_mode",flexGrow:3,sortable:!1,cellTemplate:this.ScheduleTpl}],this.taskListService.init(i=>this.getRbdImages(i),i=>this.prepareResponse(i),i=>this.images=i,()=>this.onFetchError(),i=>["rbd/clone","rbd/copy","rbd/create","rbd/delete","rbd/edit","rbd/flatten","rbd/trash/move"].includes(i.name),(i,_)=>{let r;switch(_.name){case"rbd/copy":r=new w.N(_.metadata.dest_pool_name,_.metadata.dest_namespace,_.metadata.dest_image_name).toString();break;case"rbd/clone":r=new w.N(_.metadata.child_pool_name,_.metadata.child_namespace,_.metadata.child_image_name).toString();break;case"rbd/create":r=new w.N(_.metadata.pool_name,_.metadata.namespace,_.metadata.image_name).toString();break;default:r=_.metadata.image_spec}return r===new w.N(i.pool_name,i.namespace,i.name).toString()},this.builders)}onFetchError(){this.table.reset(),this.tableStatus=new $t.c("danger")}getRbdImages(t){return null!==t&&(this.tableContext=t),null==this.tableContext&&(this.tableContext=new $.E(()=>{})),this.rbdService.list(this.tableContext?.toParams())}prepareResponse(t){let o=[];return t.forEach(i=>{o=o.concat(i.value)}),o.forEach(i=>{if(void 0!==i.schedule_info){let _=[];const r="scheduled";let l=+new Date(i.schedule_info.schedule_time);const d=(new Date).getTimezoneOffset();l+=6e4*Math.abs(d),_.push(i.mirror_mode,r,l),i.mirror_mode=_,_=[]}}),this.count=o.length>0?A_.v.getCount(t[0]):0,o}updateSelection(t){this.selection=t}deleteRbdModal(){const t=this.selection.first().pool_name,o=this.selection.first().namespace,i=this.selection.first().name,_=new w.N(t,o,i);this.modalRef=this.modalService.show(re.M,{itemDescription:"RBD",itemNames:[_],bodyTemplate:this.deleteTpl,bodyContext:{hasSnapshots:this.hasSnapshots(),snapshots:this.listProtectedSnapshots()},submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/delete",{image_spec:_.toString()}),call:this.rbdService.delete(_)})})}resyncRbdModal(){const t=this.selection.first().pool_name,o=this.selection.first().namespace,i=this.selection.first().name,_=new w.N(t,o,i);this.modalRef=this.modalService.show(re.M,{itemDescription:"RBD",itemNames:[_],actionDescription:"resync",submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/edit",{image_spec:_.toString()}),call:this.rbdService.update(_,{resync:!0})})})}trashRbdModal(){const t={poolName:this.selection.first().pool_name,namespace:this.selection.first().namespace,imageName:this.selection.first().name,hasSnapshots:this.hasSnapshots()};this.modalRef=this.modalService.show(L_,t)}flattenRbd(t){this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/flatten",{image_spec:t.toString()}),call:this.rbdService.flatten(t)}).subscribe({complete:()=>{this.modalRef.close()}})}flattenRbdModal(){const t=this.selection.first().pool_name,o=this.selection.first().namespace,i=this.selection.first().name,_=this.selection.first().parent,r=new w.N(_.pool_name,_.pool_namespace,_.image_name),l=new w.N(t,o,i),d={titleText:"RBD flatten",buttonText:"Flatten",bodyTpl:this.flattenTpl,bodyData:{parent:`${r}@${_.snap_name}`,child:l.toString()},onSubmit:()=>{this.flattenRbd(l)}};this.modalRef=this.modalService.show(gt.Y,d)}editRequest(){const t=new ut;return t.remove_scheduling=!t.remove_scheduling,t}removeSchedulingModal(){const t=this.selection.first().name,o=new w.N(this.selection.first().pool_name,this.selection.first().namespace,this.selection.first().name);this.modalRef=this.modalService.show(re.M,{actionDescription:"remove scheduling on",itemDescription:"image",itemNames:[`${t}`],submitActionObservable:()=>new Pt.y(i=>{this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/edit",{image_spec:o.toString()}),call:this.rbdService.update(o,this.editRequest())}).subscribe({error:_=>i.error(_),complete:()=>{this.modalRef.close()}})})})}actionPrimary(t){const o=new ut;o.primary=t,o.features=null;const i=new w.N(this.selection.first().pool_name,this.selection.first().namespace,this.selection.first().name);this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/edit",{image_spec:i.toString()}),call:this.rbdService.update(i,o)}).subscribe(()=>{},_=>{_.preventDefault(),t&&(this.errorMessage=_.error.detail.replace(/\[.*?\]\s*/,""),o.force=!0,this.modalRef=this.modalService.show(gt.Y,{titleText:"Warning",buttonText:"Enforce",warning:!0,bodyTpl:this.forcePromoteConfirmation,onSubmit:()=>{this.rbdService.update(i,o).subscribe(()=>{this.modalRef.close()},()=>{this.modalRef.close()})}}))})}hasSnapshots(){return(this.selection.first().snapshots||[]).length>0}hasClonedSnapshots(t){return(t.snapshots||[]).some(i=>i.children&&i.children.length>0)}listProtectedSnapshots(){return this.selection.first().snapshots.reduce((i,_)=>(_.is_protected&&i.push(_.name),i),[])}getDeleteDisableDesc(t){const o=t.first();return o&&this.hasClonedSnapshots(o)?"This RBD has cloned snapshots. Please delete related RBDs before deleting this RBD.":this.getInvalidNameDisable(t)||this.hasClonedSnapshots(t.first())}getResyncDisableDesc(t){const o=t.first();return o&&this.imageIsPrimary(o)?"Primary RBD images cannot be resynced":this.getInvalidNameDisable(t)}imageIsPrimary(t){return t.primary}getInvalidNameDisable(t){return t.first()?.name?.match(/[@/]/)?"This RBD image has an invalid name and can't be managed by ceph.":!t.first()||!t.hasSingleSelection}getRemovingStatusDesc(t){return"REMOVING"===t.first()?.source&&"Action not possible for an RBD in status 'Removing'"}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(k.j),e.Y36(j.U),e.Y36(Le.$),e.Y36(rt.n),e.Y36(ae.Z),e.Y36(G.P),e.Y36(Se.j),e.Y36(Tt.F),e.Y36(E.p4))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-rbd-list"]],viewQuery:function(t,o){if(1&t&&(e.Gf(z.a,7),e.Gf(Ta,5),e.Gf(fa,7),e.Gf(Sa,5),e.Gf(Ca,7),e.Gf(Ea,7),e.Gf(Ma,7),e.Gf(Oa,7),e.Gf(Ra,7),e.Gf(ha,7),e.Gf(Aa,7),e.Gf(Na,7),e.Gf(Pa,7)),2&t){let i;e.iGM(i=e.CRH())&&(o.table=i.first),e.iGM(i=e.CRH())&&(o.usageTpl=i.first),e.iGM(i=e.CRH())&&(o.parentTpl=i.first),e.iGM(i=e.CRH())&&(o.nameTpl=i.first),e.iGM(i=e.CRH())&&(o.ScheduleTpl=i.first),e.iGM(i=e.CRH())&&(o.mirroringTpl=i.first),e.iGM(i=e.CRH())&&(o.flattenTpl=i.first),e.iGM(i=e.CRH())&&(o.deleteTpl=i.first),e.iGM(i=e.CRH())&&(o.removingStatTpl=i.first),e.iGM(i=e.CRH())&&(o.forcePromoteConfirmation=i.first),e.iGM(i=e.CRH())&&(o.usedTmpl=i.first),e.iGM(i=e.CRH())&&(o.totalUsedTmpl=i.first),e.iGM(i=e.CRH())&&(o.imageUsageTpl=i.first)}},features:[e._Bn([Se.j,{provide:Tt.F,useValue:new Tt.F("block/rbd")}]),e.qOj],decls:23,vars:13,consts:function(){let s,t,o,i,_,r;return s="primary",t="secondary",o="Deleting this image will also delete all its snapshots.",i="The following snapshots are currently protected and will be removed:",_="RBD in status 'Removing'",r="" + "\ufffd#4\ufffd" + " Do you want to force the operation? " + "\ufffd/#4\ufffd" + "",[["columnMode","flex","identifier","unique_id","forceIdentifier","true","selectionType","single",3,"data","columns","searchableObjects","serverSide","count","hasDetails","status","maxLimit","autoReload","fetchData","setExpandedRow","updateSelection"],["table",""],[1,"table-actions",3,"permission","selection","tableActions"],["cdTableDetail","",3,"selection"],["parentTpl",""],["mirroringTpl",""],["ScheduleTpl",""],["flattenTpl",""],["deleteTpl",""],["removingStatTpl",""],["forcePromoteConfirmation",""],["imageUsageTpl",""],["usageTooltip",""],[4,"ngIf"],["class","badge badge-info",4,"ngIf","ngIfElse"],["class","badge badge-info",4,"ngIf"],["probb",""],[1,"badge","badge-info"],s,t,["class","alert alert-warning","role","alert",4,"ngIf"],["role","alert",1,"alert","alert-warning"],o,i,[4,"ngFor","ngForOf"],[3,"ngClass",4,"ngIf"],[3,"ngClass"],["title",_,3,"class",4,"ngIf"],["title",_],["type","warning"],[1,"m-4"],r,[3,"ngbTooltip",4,"ngIf","ngIfElse"],["usageBar",""],[3,"ngbTooltip"],["decimals","2",3,"total","used","title",4,"ngIf"],["decimals","2",3,"total","used","title"],[3,"innerHtml"]]},template:function(t,o){1&t&&(e._UZ(0,"cd-rbd-tabs"),e.TgZ(1,"cd-table",0,1),e.NdJ("fetchData",function(_){return o.taskListService.fetch(_)})("setExpandedRow",function(_){return o.setExpandedRow(_)})("updateSelection",function(_){return o.updateSelection(_)}),e._UZ(3,"cd-table-actions",2)(4,"cd-rbd-details",3),e.qZA(),e.YNc(5,va,2,2,"ng-template",null,4,e.W1O),e.YNc(7,ya,8,5,"ng-template",null,5,e.W1O),e.YNc(9,Za,1,1,"ng-template",null,6,e.W1O),e.YNc(11,wa,13,3,"ng-template",null,7,e.W1O),e.YNc(13,ka,1,1,"ng-template",null,8,e.W1O),e.YNc(15,za,5,5,"ng-template",null,9,e.W1O),e.YNc(17,Ja,5,1,"ng-template",null,10,e.W1O),e.YNc(19,er,3,2,"ng-template",null,11,e.W1O),e.YNc(21,tr,1,1,"ng-template",null,12,e.W1O)),2&t&&(e.xp6(1),e.Q6J("data",o.images)("columns",o.columns)("searchableObjects",!0)("serverSide",!0)("count",o.count)("hasDetails",!0)("status",o.tableStatus)("maxLimit",25)("autoReload",-1),e.xp6(2),e.Q6J("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions),e.xp6(1),e.Q6J("selection",o.expandedRow))},dependencies:[c.mk,c.sg,c.O5,P._L,D_.O,Ze.G,z.a,ce.K,ua,it,qe.N],styles:[".warn[_ngcontent-%COMP%]{color:#d48200}"]}),n})();function ir(n,s){1&n&&e._UZ(0,"input",19)}function sr(n,s){1&n&&(e.TgZ(0,"option",23),e.SDv(1,24),e.qZA()),2&n&&e.Q6J("ngValue",null)}function _r(n,s){1&n&&(e.TgZ(0,"option",23),e.SDv(1,25),e.qZA()),2&n&&e.Q6J("ngValue",null)}function ar(n,s){1&n&&(e.TgZ(0,"option",23),e.SDv(1,26),e.qZA()),2&n&&e.Q6J("ngValue",null)}function rr(n,s){if(1&n&&(e.TgZ(0,"option",27),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t.pool_name),e.xp6(1),e.Oqu(t.pool_name)}}function lr(n,s){if(1&n&&(e.TgZ(0,"select",20),e.YNc(1,sr,2,1,"option",21),e.YNc(2,_r,2,1,"option",21),e.YNc(3,ar,2,1,"option",21),e.YNc(4,rr,2,2,"option",22),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",null===t.pools),e.xp6(1),e.Q6J("ngIf",null!==t.pools&&0===t.pools.length),e.xp6(1),e.Q6J("ngIf",null!==t.pools&&t.pools.length>0),e.xp6(1),e.Q6J("ngForOf",t.pools)}}function cr(n,s){1&n&&(e.TgZ(0,"span",28),e.SDv(1,29),e.qZA())}function dr(n,s){1&n&&(e.TgZ(0,"span",28),e.SDv(1,30),e.qZA())}function mr(n,s){1&n&&(e.TgZ(0,"span",28),e.SDv(1,31),e.qZA())}let pr=(()=>{class n{constructor(t,o,i,_,r,l){this.activeModal=t,this.actionLabels=o,this.authStorageService=i,this.notificationService=_,this.poolService=r,this.rbdService=l,this.pools=null,this.editing=!1,this.poolPermission=this.authStorageService.getPermissions().pool,this.createForm()}createForm(){this.namespaceForm=new A.d({pool:new a.p4(""),namespace:new a.p4("")},this.validator(),this.asyncValidator())}validator(){return t=>{const o=t.get("pool"),i=t.get("namespace");let _=null;o.value||(_={required:!0}),o.setErrors(_);let r=null;return i.value||(r={required:!0}),i.setErrors(r),null}}asyncValidator(){return t=>new Promise(o=>{const i=t.get("pool"),_=t.get("namespace");this.rbdService.listNamespaces(i.value).subscribe(r=>{if(r.some(l=>l.namespace===_.value)){const l={namespaceExists:!0};_.setErrors(l),o(l)}else o(null)})})}ngOnInit(){this.onSubmit=new Zt.xQ,this.poolPermission.read&&this.poolService.list(["pool_name","type","application_metadata"]).then(t=>{const o=[];for(const i of t)this.rbdService.isRBDPool(i)&&"replicated"===i.type&&o.push(i);if(this.pools=o,1===this.pools.length){const i=this.pools[0].pool_name;this.namespaceForm.get("pool").setValue(i)}})}submit(){const t=this.namespaceForm.getValue("pool"),o=this.namespaceForm.getValue("namespace"),i=new N.R;i.name="rbd/namespace/create",i.metadata={pool:t,namespace:o},this.rbdService.createNamespace(t,o).toPromise().then(()=>{this.notificationService.show(at.k.success,"Created namespace '\n          " + t + "/\n          " + o + "'\n        "),this.activeModal.close(),this.onSubmit.next()}).catch(()=>{this.namespaceForm.setErrors({cdSubmitButton:!0})})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(P.Kz),e.Y36(E.p4),e.Y36(k.j),e.Y36(xe.g),e.Y36(we.q),e.Y36(j.U))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-rbd-namespace-form-modal"]],decls:23,vars:9,consts:function(){let s,t,o,i,_,r,l,d,u;return s="Create Namespace",t="Pool",o="Name",i="\uB85C\uB529\uC911...",_="-- \uC774\uC6A9\uAC00\uB2A5\uD55C rbd\uD480 \uC5C6\uC74C --",r="-- \uD480 \uC120\uD0DD --",l="This field is required.",d="This field is required.",u="Namespace already exists.",[[3,"modalRef"],[1,"modal-title"],s,[1,"modal-content"],["name","namespaceForm","novalidate","",3,"formGroup"],["formDir","ngForm"],[1,"modal-body"],[1,"form-group","row"],["for","pool",1,"cd-col-form-label","required"],t,[1,"cd-col-form-input"],["class","form-control","type","text","placeholder","Pool name...","id","pool","name","pool","formControlName","pool",4,"ngIf"],["id","pool","name","pool","class","form-select","formControlName","pool",4,"ngIf"],["class","invalid-feedback",4,"ngIf"],["for","namespace",1,"cd-col-form-label","required"],o,["type","text","placeholder","Namespace name...","id","namespace","name","namespace","formControlName","namespace","autofocus","",1,"form-control"],[1,"modal-footer"],[3,"form","submitText","submitActionEvent"],["type","text","placeholder","Pool name...","id","pool","name","pool","formControlName","pool",1,"form-control"],["id","pool","name","pool","formControlName","pool",1,"form-select"],[3,"ngValue",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[3,"ngValue"],i,_,r,[3,"value"],[1,"invalid-feedback"],l,d,u]},template:function(t,o){if(1&t&&(e.TgZ(0,"cd-modal",0),e.ynx(1,1),e.SDv(2,2),e.BQk(),e.ynx(3,3),e.TgZ(4,"form",4,5)(6,"div",6)(7,"div",7)(8,"label",8),e.SDv(9,9),e.qZA(),e.TgZ(10,"div",10),e.YNc(11,ir,1,0,"input",11),e.YNc(12,lr,5,4,"select",12),e.YNc(13,cr,2,0,"span",13),e.qZA()(),e.TgZ(14,"div",7)(15,"label",14),e.SDv(16,15),e.qZA(),e.TgZ(17,"div",10),e._UZ(18,"input",16),e.YNc(19,dr,2,0,"span",13),e.YNc(20,mr,2,0,"span",13),e.qZA()()(),e.TgZ(21,"div",17)(22,"cd-form-button-panel",18),e.NdJ("submitActionEvent",function(){return o.submit()}),e.qZA()()(),e.BQk(),e.qZA()),2&t){const i=e.MAs(5);e.Q6J("modalRef",o.activeModal),e.xp6(4),e.Q6J("formGroup",o.namespaceForm),e.xp6(7),e.Q6J("ngIf",!o.poolPermission.read),e.xp6(1),e.Q6J("ngIf",o.poolPermission.read),e.xp6(1),e.Q6J("ngIf",o.namespaceForm.showError("pool",i,"required")),e.xp6(6),e.Q6J("ngIf",o.namespaceForm.showError("namespace",i,"required")),e.xp6(1),e.Q6J("ngIf",o.namespaceForm.showError("namespace",i,"namespaceExists")),e.xp6(2),e.Q6J("form",o.namespaceForm)("submitText",o.actionLabels.CREATE)}},dependencies:[c.sg,c.O5,a._Y,a.YN,a.Kr,a.Fj,a.EJ,a.JJ,a.JL,a.sg,a.u,Y.z,R.p,ve.U,L.o,g.b,T.P,b.V]}),n})(),ur=(()=>{class n{constructor(t,o,i,_,r,l){this.authStorageService=t,this.rbdService=o,this.poolService=i,this.modalService=_,this.notificationService=r,this.actionLabels=l,this.selection=new le.r,this.permission=this.authStorageService.getPermissions().rbdImage,this.tableActions=[{permission:"create",icon:C.P.add,click:()=>this.createModal(),name:this.actionLabels.CREATE},{permission:"delete",icon:C.P.destroy,click:()=>this.deleteModal(),name:this.actionLabels.DELETE,disable:()=>this.getDeleteDisableDesc()}]}ngOnInit(){this.columns=[{name:"Namespace",prop:"namespace",flexGrow:1},{name:"Pool",prop:"pool",flexGrow:1},{name:"Total images",prop:"num_images",flexGrow:1}],this.refresh()}refresh(){this.poolService.list(["pool_name","type","application_metadata"]).then(t=>{t=t.filter(i=>this.rbdService.isRBDPool(i)&&"replicated"===i.type);const o=[];t.forEach(i=>{o.push(this.rbdService.listNamespaces(i.pool_name))}),o.length>0?(0,ge.D)(o).subscribe(i=>{const _=[];for(let r=0;r<i.length;r++){const d=t[r].pool_name;i[r].forEach(u=>{_.push({id:`${d}/${u.namespace}`,pool:d,namespace:u.namespace,num_images:u.num_images})})}this.namespaces=_}):this.namespaces=[]})}updateSelection(t){this.selection=t}createModal(){this.modalRef=this.modalService.show(pr),this.modalRef.componentInstance.onSubmit.subscribe(()=>{this.refresh()})}deleteModal(){const t=this.selection.first().pool,o=this.selection.first().namespace;this.modalRef=this.modalService.show(re.M,{itemDescription:"Namespace",itemNames:[`${t}/${o}`],submitAction:()=>this.rbdService.deleteNamespace(t,o).subscribe(()=>{this.notificationService.show(at.k.success,"Deleted namespace '\n          " + t + "/\n          " + o + "'\n        "),this.modalRef.close(),this.refresh()},()=>{this.modalRef.componentInstance.stopLoadingSpinner()})})}getDeleteDisableDesc(){return this.selection.first()?.num_images>0?"Namespace contains images":!this.selection?.first()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(k.j),e.Y36(j.U),e.Y36(we.q),e.Y36(ae.Z),e.Y36(xe.g),e.Y36(E.p4))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-rbd-namespace-list"]],features:[e._Bn([Se.j])],decls:4,vars:5,consts:[["columnMode","flex","identifier","id","forceIdentifier","true","selectionType","single",3,"data","columns","fetchData","updateSelection"],[1,"table-actions","btn-toolbar"],[1,"btn-group",3,"permission","selection","tableActions"]],template:function(t,o){1&t&&(e._UZ(0,"cd-rbd-tabs"),e.TgZ(1,"cd-table",0),e.NdJ("fetchData",function(){return o.refresh()})("updateSelection",function(_){return o.updateSelection(_)}),e.TgZ(2,"div",1),e._UZ(3,"cd-table-actions",2),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("data",o.namespaces)("columns",o.columns),e.xp6(2),e.Q6J("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[z.a,ce.K,it]}),n})(),gr=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-rbd-performance"]],decls:2,vars:2,consts:function(){let s;return s="RBD overview",[["title",s,"uid","41FrpeUiz","grafanaStyle","two",3,"grafanaPath","type"]]},template:function(t,o){1&t&&e._UZ(0,"cd-rbd-tabs")(1,"cd-grafana",0),2&t&&(e.xp6(1),e.Q6J("grafanaPath","rbd-overview?")("type","metrics"))},dependencies:[Bt.F,it]}),n})();var Tr=m(91801);function fr(n,s){1&n&&e._UZ(0,"input",15)}function Sr(n,s){if(1&n&&(e.TgZ(0,"option",20),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function Cr(n,s){if(1&n&&(e.TgZ(0,"select",16)(1,"option",17),e.SDv(2,18),e.qZA(),e.YNc(3,Sr,2,2,"option",19),e.qZA()),2&n){const t=e.oxw();e.xp6(3),e.Q6J("ngForOf",t.pools)}}let Er=(()=>{class n{constructor(t,o,i,_,r,l,d){this.authStorageService=t,this.rbdService=o,this.activeModal=i,this.actionLabels=_,this.fb=r,this.poolService=l,this.taskWrapper=d,this.poolPermission=this.authStorageService.getPermissions().pool}createForm(){this.purgeForm=this.fb.group({poolName:""})}ngOnInit(){this.poolPermission.read&&this.poolService.list(["pool_name","application_metadata"]).then(t=>{this.pools=t.filter(o=>o.application_metadata.includes("rbd")).map(o=>o.pool_name)}),this.createForm()}purge(){const t=this.purgeForm.getValue("poolName")||"";this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/trash/purge",{pool_name:t}),call:this.rbdService.purgeTrash(t)}).subscribe({error:()=>{this.purgeForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.activeModal.close()}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(k.j),e.Y36(j.U),e.Y36(P.Kz),e.Y36(E.p4),e.Y36(ot.O),e.Y36(we.q),e.Y36(G.P))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-rbd-trash-purge-modal"]],decls:18,vars:6,consts:function(){let s,t,o,i,_;return s="\uD734\uC9C0\uD1B5 \uBE44\uC6B0\uAE30",t="To purge, select\xA0 " + "[\ufffd#9\ufffd|\ufffd#10\ufffd]" + "All" + "[\ufffd/#9\ufffd|\ufffd/#10\ufffd]" + "\xA0 or one pool and click\xA0 " + "[\ufffd#9\ufffd|\ufffd#10\ufffd]" + "Purge" + "[\ufffd/#9\ufffd|\ufffd/#10\ufffd]" + ".\xA0",t=e.Zx4(t),o="\uD480:",i="\uD480 \uC774\uB984:",_="All",[[3,"modalRef"],[1,"modal-title"],s,[1,"modal-content"],["name","purgeForm","novalidate","",1,"form",3,"formGroup"],["formDir","ngForm"],[1,"modal-body"],t,[1,"form-group"],[1,"col-form-label","mx-auto"],o,["class","form-control","type","text","placeholder",i,"formControlName","poolName",4,"ngIf"],["id","poolName","name","poolName","class","form-control","formControlName","poolName",4,"ngIf"],[1,"modal-footer"],[3,"form","submitText","submitActionEvent"],["type","text","placeholder",i,"formControlName","poolName",1,"form-control"],["id","poolName","name","poolName","formControlName","poolName",1,"form-control"],["value",""],_,[3,"value",4,"ngFor","ngForOf"],[3,"value"]]},template:function(t,o){1&t&&(e.TgZ(0,"cd-modal",0),e.ynx(1,1),e.SDv(2,2),e.BQk(),e.ynx(3,3),e.TgZ(4,"form",4,5)(6,"div",6)(7,"p"),e.tHW(8,7),e._UZ(9,"kbd")(10,"kbd"),e.N_p(),e.qZA(),e.TgZ(11,"div",8)(12,"label",9),e.SDv(13,10),e.qZA(),e.YNc(14,fr,1,0,"input",11),e.YNc(15,Cr,4,1,"select",12),e.qZA()(),e.TgZ(16,"div",13)(17,"cd-form-button-panel",14),e.NdJ("submitActionEvent",function(){return o.purge()}),e.qZA()()(),e.BQk(),e.qZA()),2&t&&(e.Q6J("modalRef",o.activeModal),e.xp6(4),e.Q6J("formGroup",o.purgeForm),e.xp6(10),e.Q6J("ngIf",!o.poolPermission.read),e.xp6(1),e.Q6J("ngIf",o.poolPermission.read),e.xp6(2),e.Q6J("form",o.purgeForm)("submitText",o.actionLabels.PURGE))},dependencies:[c.sg,c.O5,a._Y,a.YN,a.Kr,a.Fj,a.EJ,a.JJ,a.JL,a.sg,a.u,Y.z,R.p,L.o,g.b,T.P,b.V]}),n})();function Mr(n,s){1&n&&(e.TgZ(0,"span",15),e.SDv(1,16),e.qZA())}let Or=(()=>{class n{constructor(t,o,i,_,r){this.rbdService=t,this.activeModal=o,this.actionLabels=i,this.fb=_,this.taskWrapper=r}ngOnInit(){this.imageSpec=new w.N(this.poolName,this.namespace,this.imageName).toString(),this.restoreForm=this.fb.group({name:this.imageName})}restore(){const t=this.restoreForm.getValue("name"),o=new w.N(this.poolName,this.namespace,this.imageId);this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/trash/restore",{image_id_spec:o.toString(),new_image_name:t}),call:this.rbdService.restoreTrash(o,t)}).subscribe({error:()=>{this.restoreForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.activeModal.close()}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(j.U),e.Y36(P.Kz),e.Y36(E.p4),e.Y36(ot.O),e.Y36(G.P))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-rbd-trash-restore-modal"]],decls:18,vars:7,consts:function(){let s,t,o,i;return s="\uC774\uBBF8\uC9C0 \uBCF5\uAD6C\uD558\uAE30",t="To restore\xA0 " + "[\ufffd#9\ufffd|\ufffd#10\ufffd]" + "" + "\ufffd0\ufffd" + "@" + "\ufffd1\ufffd" + "" + "[\ufffd/#9\ufffd|\ufffd/#10\ufffd]" + ",\xA0 type the image's new name and click\xA0 " + "[\ufffd#9\ufffd|\ufffd#10\ufffd]" + "Restore" + "[\ufffd/#9\ufffd|\ufffd/#10\ufffd]" + ".",t=e.Zx4(t),o="\uC0C8\uB85C\uC6B4 \uC774\uB984",i="This field is required.",[[3,"modalRef"],[1,"modal-title"],s,[1,"modal-content"],["name","restoreForm","novalidate","",1,"form",3,"formGroup"],["formDir","ngForm"],[1,"modal-body"],t,[1,"form-group"],["for","name",1,"col-form-label"],o,["type","text","name","name","id","name","autocomplete","off","formControlName","name","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],[1,"modal-footer"],[3,"form","submitText","submitActionEvent"],[1,"invalid-feedback"],i]},template:function(t,o){if(1&t&&(e.TgZ(0,"cd-modal",0),e.ynx(1,1),e.SDv(2,2),e.BQk(),e.ynx(3,3),e.TgZ(4,"form",4,5)(6,"div",6)(7,"p"),e.tHW(8,7),e._UZ(9,"kbd")(10,"kbd"),e.N_p(),e.qZA(),e.TgZ(11,"div",8)(12,"label",9),e.SDv(13,10),e.qZA(),e._UZ(14,"input",11),e.YNc(15,Mr,2,0,"span",12),e.qZA()(),e.TgZ(16,"div",13)(17,"cd-form-button-panel",14),e.NdJ("submitActionEvent",function(){return o.restore()}),e.qZA()()(),e.BQk(),e.qZA()),2&t){const i=e.MAs(5);e.Q6J("modalRef",o.activeModal),e.xp6(4),e.Q6J("formGroup",o.restoreForm),e.xp6(6),e.pQV(o.imageSpec)(o.imageId),e.QtT(8),e.xp6(5),e.Q6J("ngIf",o.restoreForm.showError("name",i,"required")),e.xp6(2),e.Q6J("form",o.restoreForm)("submitText",o.actionLabels.RESTORE)}},dependencies:[c.O5,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,Y.z,R.p,ve.U,L.o,g.b,T.P,b.V]}),n})();const Rr=["expiresTpl"],hr=["deleteTpl"],Ar=function(n){return[n]};function Nr(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"button",6),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.purgeModal())}),e._UZ(1,"i",7),e.ynx(2),e.SDv(3,8),e.BQk(),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("disabled",t.disablePurgeBtn),e.xp6(1),e.Q6J("ngClass",e.VKq(2,Ar,t.icons.destroy))}}function Pr(n,s){1&n&&(e.ynx(0),e.SDv(1,10),e.BQk())}function br(n,s){1&n&&(e.ynx(0),e.SDv(1,11),e.BQk())}function Ir(n,s){if(1&n&&(e.YNc(0,Pr,2,0,"ng-container",9),e.YNc(1,br,2,0,"ng-container",9),e._uU(2),e.ALo(3,"cdDate")),2&n){const t=s.row,o=s.value;e.Q6J("ngIf",t.cdIsExpired),e.xp6(1),e.Q6J("ngIf",!t.cdIsExpired),e.xp6(1),e.hij(" ",e.lcZ(3,3,o),"\n")}}function Fr(n,s){if(1&n&&(e.TgZ(0,"p",13)(1,"strong"),e.ynx(2),e.SDv(3,14),e.ALo(4,"cdDate"),e.BQk(),e.qZA()()),2&n){const t=e.oxw().expiresAt;e.xp6(4),e.pQV(e.lcZ(4,1,t)),e.QtT(3)}}function vr(n,s){1&n&&e.YNc(0,Fr,5,3,"p",12),2&n&&e.Q6J("ngIf",!s.isExpired)}let Lr=(()=>{class n{constructor(t,o,i,_,r,l,d){this.authStorageService=t,this.rbdService=o,this.modalService=i,this.cdDatePipe=_,this.taskListService=r,this.taskWrapper=l,this.actionLabels=d,this.icons=C.P,this.executingTasks=[],this.selection=new le.r,this.tableStatus=new de.E,this.disablePurgeBtn=!0,this.permission=this.authStorageService.getPermissions().rbdImage,this.tableActions=[{permission:"update",icon:C.P.undo,click:()=>this.restoreModal(),name:this.actionLabels.RESTORE},{permission:"delete",icon:C.P.destroy,click:()=>this.deleteModal(),name:this.actionLabels.DELETE}]}ngOnInit(){this.columns=[{name:"ID",prop:"id",flexGrow:1,cellTransformation:Be.e.executing},{name:"Name",prop:"name",flexGrow:1},{name:"Pool",prop:"pool_name",flexGrow:1},{name:"Namespace",prop:"namespace",flexGrow:1},{name:"Status",prop:"deferment_end_time",flexGrow:1,cellTemplate:this.expiresTpl},{name:"Deleted At",prop:"deletion_time",flexGrow:1,pipe:this.cdDatePipe}],this.taskListService.init(()=>this.rbdService.listTrash(),i=>this.prepareResponse(i),i=>this.images=i,()=>this.onFetchError(),i=>["rbd/trash/remove","rbd/trash/restore"].includes(i.name),(i,_)=>new w.N(i.pool_name,i.namespace,i.id).toString()===_.metadata.image_id_spec,void 0)}prepareResponse(t){let o=[];const i={};let _;if(t.forEach(r=>{S().isUndefined(i[r.status])&&(i[r.status]=[]),i[r.status].push(r.pool_name),o=o.concat(r.value),this.disablePurgeBtn=!o.length}),i[3]?_=3:i[1]?_=1:i[2]&&(_=2),_){const r=(i[_].length>1?"pools ":"pool ")+i[_].join();this.tableStatus=new de.E(_,r)}else this.tableStatus=new de.E;return o.forEach(r=>{r.cdIsExpired=De()().isAfter(r.deferment_end_time)}),o}onFetchError(){this.table.reset(),this.tableStatus=new de.E(Tr.T.ValueException)}updateSelection(t){this.selection=t}restoreModal(){const t={poolName:this.selection.first().pool_name,namespace:this.selection.first().namespace,imageName:this.selection.first().name,imageId:this.selection.first().id};this.modalRef=this.modalService.show(Or,t)}deleteModal(){const t=this.selection.first().pool_name,o=this.selection.first().namespace,i=this.selection.first().id,_=this.selection.first().deferment_end_time,r=De()().isAfter(_),l=new w.N(t,o,i);this.modalRef=this.modalService.show(re.M,{itemDescription:"RBD",itemNames:[l],bodyTemplate:this.deleteTpl,bodyContext:{expiresAt:_,isExpired:r},submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new N.R("rbd/trash/remove",{image_id_spec:l.toString()}),call:this.rbdService.removeTrash(l,!0)})})}purgeModal(){this.modalService.show(Er)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(k.j),e.Y36(j.U),e.Y36(ae.Z),e.Y36(qe.N),e.Y36(Se.j),e.Y36(G.P),e.Y36(E.p4))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-rbd-trash-list"]],viewQuery:function(t,o){if(1&t&&(e.Gf(z.a,7),e.Gf(Rr,7),e.Gf(hr,7)),2&t){let i;e.iGM(i=e.CRH())&&(o.table=i.first),e.iGM(i=e.CRH())&&(o.expiresTpl=i.first),e.iGM(i=e.CRH())&&(o.deleteTpl=i.first)}},features:[e._Bn([Se.j])],decls:9,vars:8,consts:function(){let s,t,o,i;return s="\uD734\uC9C0\uD1B5 \uBE44\uC6B0\uAE30",t="\uD3D0\uAE30\uB420",o="\uAE4C\uC9C0 \uBCF4\uD638\uB428",i="This image is protected until \n          " + "\ufffd0\ufffd" + ".\n        ",[["columnMode","flex","identifier","id","forceIdentifier","true","selectionType","single",3,"data","columns","status","autoReload","fetchData","updateSelection"],[1,"table-actions","btn-toolbar"],[1,"btn-group",3,"permission","selection","tableActions"],["class","btn btn-light","type","button",3,"disabled","click",4,"ngIf"],["expiresTpl",""],["deleteTpl",""],["type","button",1,"btn","btn-light",3,"disabled","click"],["aria-hidden","true",3,"ngClass"],s,[4,"ngIf"],t,o,["class","text-danger",4,"ngIf"],[1,"text-danger"],i]},template:function(t,o){1&t&&(e._UZ(0,"cd-rbd-tabs"),e.TgZ(1,"cd-table",0),e.NdJ("fetchData",function(){return o.taskListService.fetch()})("updateSelection",function(_){return o.updateSelection(_)}),e.TgZ(2,"div",1),e._UZ(3,"cd-table-actions",2),e.YNc(4,Nr,4,4,"button",3),e.qZA()(),e.YNc(5,Ir,4,5,"ng-template",null,4,e.W1O),e.YNc(7,vr,1,1,"ng-template",null,5,e.W1O)),2&t&&(e.xp6(1),e.Q6J("data",o.images)("columns",o.columns)("status",o.tableStatus)("autoReload",-1),e.xp6(2),e.Q6J("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions),e.xp6(1),e.Q6J("ngIf",o.permission.delete))},dependencies:[c.mk,c.O5,z.a,ce.K,L.o,it,qe.N]}),n})();var Dr=m(96736),$r=m(5304);const oe="api/nvmeof",wt="ui-api/nvmeof";let Ce=(()=>{class n{constructor(t){this.http=t}listGateways(){return this.http.get(`${oe}/gateway`)}listSubsystems(){return this.http.get(`${oe}/subsystem`)}getSubsystem(t){return this.http.get(`${oe}/subsystem/${t}`)}createSubsystem(t){return this.http.post(`${oe}/subsystem`,t,{observe:"response"})}deleteSubsystem(t){return this.http.delete(`${oe}/subsystem/${t}`,{observe:"response"})}isSubsystemPresent(t){return this.getSubsystem(t).pipe((0,Dr.h)(!0),(0,$r.K)(o=>(o?.preventDefault(),(0,Gt.of)(!1))))}getInitiators(t){return this.http.get(`${oe}/subsystem/${t}/host`)}addInitiators(t,o){return this.http.post(`${wt}/subsystem/${t}/host`,o,{observe:"response"})}removeInitiators(t,o){return this.http.delete(`${wt}/subsystem/${t}/host/${o.host_nqn}`,{observe:"response"})}listListeners(t){return this.http.get(`${oe}/subsystem/${t}/listener`)}createListener(t,o){return this.http.post(`${oe}/subsystem/${t}/listener`,o,{observe:"response"})}deleteListener(t,o,i,_){return this.http.delete(`${oe}/subsystem/${t}/listener/${o}/${i}`,{observe:"response",params:{trsvcid:_}})}listNamespaces(t){return this.http.get(`${oe}/subsystem/${t}/namespace`)}getNamespace(t,o){return this.http.get(`${oe}/subsystem/${t}/namespace/${o}`)}createNamespace(t,o){return this.http.post(`${oe}/subsystem/${t}/namespace`,o,{observe:"response"})}updateNamespace(t,o,i){return this.http.patch(`${oe}/subsystem/${t}/namespace/${o}`,i,{observe:"response"})}deleteNamespace(t,o){return this.http.delete(`${oe}/subsystem/${t}/namespace/${o}`,{observe:"response"})}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(Te.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Ht=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-nvmeof-tabs"]],decls:7,vars:0,consts:function(){let s,t;return s="Subsystems",t="Gateways",[[1,"nav","nav-tabs"],[1,"nav-item"],["routerLink","/block/nvmeof/subsystems","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link"],s,["routerLink","/block/nvmeof/gateways","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link"],t]},template:function(t,o){1&t&&(e.TgZ(0,"ul",0)(1,"li",1)(2,"a",2),e.SDv(3,3),e.qZA()(),e.TgZ(4,"li",1)(5,"a",4),e.SDv(6,5),e.qZA()()())},dependencies:[p.rH,p.Od]}),n})(),Br=(()=>{class n{constructor(t,o){this.nvmeofService=t,this.actionLabels=o,this.gateways=[],this.selection=new le.r}ngOnInit(){this.gatewayColumns=[{name:"Name",prop:"name"},{name:"Address",prop:"addr"},{name:"Port",prop:"port"}]}getGateways(){this.nvmeofService.listGateways().subscribe(t=>{this.gateways=Array.isArray(t)?t:[t]})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Ce),e.Y36(E.p4))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-nvmeof-gateway"]],decls:6,vars:2,consts:function(){let s;return s=" Gateways " + "\ufffd#3\ufffd" + " The NVMe-oF gateway integrates Ceph with the NVMe over TCP (NVMe/TCP) protocol to provide an NVMe/TCP target that exports RADOS Block Device (RBD) images. " + "\ufffd/#3\ufffd" + "",[s,[3,"data","columns","fetchData"]]},template:function(t,o){1&t&&(e._UZ(0,"cd-nvmeof-tabs"),e.TgZ(1,"legend"),e.tHW(2,0),e._UZ(3,"cd-help-text"),e.N_p(),e.qZA(),e.TgZ(4,"div")(5,"cd-table",1),e.NdJ("fetchData",function(){return o.getGateways()}),e.qZA()()),2&t&&(e.xp6(5),e.Q6J("data",o.gateways)("columns",o.gatewayColumns))},dependencies:[me.t,z.a,Ht]}),n})();var Gr=m(61350);let xr=(()=>{class n{constructor(t,o,i,_,r,l){this.actionLabels=t,this.modalService=o,this.authStorageService=i,this.taskWrapper=_,this.nvmeofService=r,this.router=l,this.selection=new le.r,this.permission=this.authStorageService.getPermissions().nvmeof}ngOnInit(){this.listenerColumns=[{name:"Host",prop:"host_name"},{name:"Transport",prop:"trtype"},{name:"Address",prop:"full_addr",cellTransformation:Be.e.copy}],this.tableActions=[{name:this.actionLabels.CREATE,permission:"create",icon:C.P.add,click:()=>this.router.navigate(["block/nvmeof/subsystems",{outlets:{modal:[E.MQ.CREATE,this.subsystemNQN,"listener"]}}]),canBePrimary:t=>!t.hasSelection},{name:this.actionLabels.DELETE,permission:"delete",icon:C.P.destroy,click:()=>this.deleteSubsystemModal()}]}ngOnChanges(){this.listListeners()}updateSelection(t){this.selection=t}listListeners(){this.nvmeofService.listListeners(this.subsystemNQN).subscribe(t=>{this.listeners=t.map((o,i)=>(o.id=i,o.full_addr=`${o.traddr}:${o.trsvcid}`,o))})}deleteSubsystemModal(){const t=this.selection.first();this.modalService.show(re.M,{itemDescription:"Listener",actionDescription:"delete",itemNames:[`listener ${t.host_name} (${t.traddr}:${t.trsvcid})`],submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new N.R("nvmeof/listener/delete",{nqn:this.subsystemNQN,host_name:t.host_name}),call:this.nvmeofService.deleteListener(this.subsystemNQN,t.host_name,t.traddr,t.trsvcid)})})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(E.p4),e.Y36(ae.Z),e.Y36(k.j),e.Y36(G.P),e.Y36(Ce),e.Y36(p.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-nvmeof-listeners-list"]],inputs:{subsystemNQN:"subsystemNQN"},features:[e.TTD],decls:6,vars:5,consts:[["columnMode","flex","identifier","id","forceIdentifier","true","selectionType","single",3,"data","columns","fetchData","updateSelection"],[1,"table-actions","btn-toolbar"],[1,"btn-group",3,"permission","selection","tableActions"]],template:function(t,o){1&t&&(e.TgZ(0,"legend")(1,"cd-help-text"),e._uU(2," A listener defines the IP port on the gateway that is to process NVMe/TCP commands and I/O operations. "),e.qZA()(),e.TgZ(3,"cd-table",0),e.NdJ("fetchData",function(){return o.listListeners()})("updateSelection",function(_){return o.updateSelection(_)}),e.TgZ(4,"div",1),e._UZ(5,"cd-table-actions",2),e.qZA()()),2&t&&(e.xp6(3),e.Q6J("data",o.listeners)("columns",o.listenerColumns),e.xp6(2),e.Q6J("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[me.t,z.a,ce.K]}),n})();var Zr=m(68579),wr=m(21766);const qt="block/nvmeof/subsystems";let Hr=(()=>{class n{constructor(t,o,i,_,r,l,d,u,f){this.actionLabels=t,this.router=o,this.modalService=i,this.authStorageService=_,this.taskWrapper=r,this.nvmeofService=l,this.dimlessBinaryPipe=d,this.mbPerSecondPipe=u,this.iopsPipe=f,this.selection=new le.r,this.permission=this.authStorageService.getPermissions().nvmeof}ngOnInit(){this.namespacesColumns=[{name:"ID",prop:"nsid"},{name:"Bdev Name",prop:"bdev_name"},{name:"Pool ",prop:"rbd_pool_name",flexGrow:2},{name:"Image",prop:"rbd_image_name",flexGrow:3},{name:"Image Size",prop:"rbd_image_size",pipe:this.dimlessBinaryPipe},{name:"Block Size",prop:"block_size",pipe:this.dimlessBinaryPipe},{name:"IOPS",prop:"rw_ios_per_second",sortable:!1,pipe:this.iopsPipe,flexGrow:1.5},{name:"R/W Throughput",prop:"rw_mbytes_per_second",sortable:!1,pipe:this.mbPerSecondPipe,flexGrow:1.5},{name:"Read Throughput",prop:"r_mbytes_per_second",sortable:!1,pipe:this.mbPerSecondPipe,flexGrow:1.5},{name:"Write Throughput",prop:"w_mbytes_per_second",sortable:!1,pipe:this.mbPerSecondPipe,flexGrow:1.5},{name:"Load Balancing Group",prop:"load_balancing_group",flexGrow:1.5}],this.tableActions=[{name:this.actionLabels.CREATE,permission:"create",icon:C.P.add,click:()=>this.router.navigate([qt,{outlets:{modal:[E.MQ.CREATE,this.subsystemNQN,"namespace"]}}]),canBePrimary:t=>!t.hasSelection},{name:this.actionLabels.EDIT,permission:"update",icon:C.P.edit,click:()=>this.router.navigate([qt,{outlets:{modal:[E.MQ.EDIT,this.subsystemNQN,"namespace",this.selection.first().nsid]}}])},{name:this.actionLabels.DELETE,permission:"delete",icon:C.P.destroy,click:()=>this.deleteSubsystemModal()}]}ngOnChanges(){this.listNamespaces()}updateSelection(t){this.selection=t}listNamespaces(){this.nvmeofService.listNamespaces(this.subsystemNQN).subscribe(t=>{this.namespaces=t})}deleteSubsystemModal(){const t=this.selection.first();this.modalService.show(re.M,{itemDescription:"Namespace",itemNames:[t.nsid],actionDescription:"delete",submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new N.R("nvmeof/namespace/delete",{nqn:this.subsystemNQN,nsid:t.nsid}),call:this.nvmeofService.deleteNamespace(this.subsystemNQN,t.nsid)})})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(E.p4),e.Y36(p.F0),e.Y36(ae.Z),e.Y36(k.j),e.Y36(G.P),e.Y36(Ce),e.Y36(Le.$),e.Y36(Zr.B),e.Y36(wr.A))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-nvmeof-namespaces-list"]],inputs:{subsystemNQN:"subsystemNQN"},features:[e.TTD],decls:6,vars:5,consts:[["columnMode","flex","selectionType","single",3,"data","columns","fetchData","updateSelection"],[1,"table-actions","btn-toolbar"],[1,"btn-group",3,"permission","selection","tableActions"]],template:function(t,o){1&t&&(e.TgZ(0,"legend")(1,"cd-help-text"),e._uU(2," An NVMe namespace is a quantity of non-volatile storage that can be formatted into logical blocks and presented to a host as a standard block device. "),e.qZA()(),e.TgZ(3,"cd-table",0),e.NdJ("fetchData",function(){return o.listNamespaces()})("updateSelection",function(_){return o.updateSelection(_)}),e.TgZ(4,"div",1),e._UZ(5,"cd-table-actions",2),e.qZA()()),2&t&&(e.xp6(3),e.Q6J("data",o.namespaces)("columns",o.namespacesColumns),e.xp6(2),e.Q6J("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[me.t,z.a,ce.K]}),n})();const qr=["hostTpl"];function Kr(n,s){1&n&&(e.TgZ(0,"span",5),e.SDv(1,6),e.qZA())}function kr(n,s){if(1&n&&(e.TgZ(0,"span",5),e._uU(1),e.qZA()),2&n){const t=e.oxw().value;e.xp6(1),e.Oqu(t)}}function Vr(n,s){if(1&n&&(e.YNc(0,Kr,2,0,"span",4),e.YNc(1,kr,2,1,"span",4)),2&n){const t=s.value;e.Q6J("ngIf","*"===t),e.xp6(1),e.Q6J("ngIf","*"!==t)}}let Xr=(()=>{class n{constructor(t,o,i,_,r,l){this.actionLabels=t,this.authStorageService=o,this.nvmeofService=i,this.modalService=_,this.router=r,this.taskWrapper=l,this.selection=new le.r,this.initiators=[],this.permission=this.authStorageService.getPermissions().nvmeof}ngOnInit(){this.initiatorColumns=[{name:"Initiator",prop:"nqn",cellTemplate:this.hostTpl}],this.tableActions=[{name:this.actionLabels.ADD,permission:"create",icon:C.P.add,click:()=>this.router.navigate(["block/nvmeof/subsystems",{outlets:{modal:[E.MQ.ADD,this.subsystemNQN,"initiator"]}}]),canBePrimary:t=>!t.hasSelection},{name:this.actionLabels.REMOVE,permission:"delete",icon:C.P.destroy,click:()=>this.removeInitiatorModal(),disable:()=>!this.selection.hasSelection,canBePrimary:t=>t.hasSelection}]}getAllowAllHostIndex(){return this.selection.selected.findIndex(t=>"*"===t.nqn)}ngOnChanges(){this.listInitiators()}updateSelection(t){this.selection=t}listInitiators(){this.nvmeofService.getInitiators(this.subsystemNQN).subscribe(t=>{this.initiators=t})}getSelectedNQNs(){return this.selection.selected.map(t=>t.nqn)}removeInitiatorModal(){const t=this.getSelectedNQNs(),o=this.getAllowAllHostIndex(),i=t.join(",");let _=t;-1!==o&&(t.splice(o,1),_=[...t,"Allow any host(*)"]),this.modalService.show(re.M,{itemDescription:"Initiator",itemNames:_,actionDescription:"remove",submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new N.R("nvmeof/initiator/remove",{nqn:this.subsystemNQN,plural:_.length>1}),call:this.nvmeofService.removeInitiators(this.subsystemNQN,{host_nqn:i})})})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(E.p4),e.Y36(k.j),e.Y36(Ce),e.Y36(ae.Z),e.Y36(p.F0),e.Y36(G.P))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-nvmeof-initiators-list"]],viewQuery:function(t,o){if(1&t&&e.Gf(qr,7),2&t){let i;e.iGM(i=e.CRH())&&(o.hostTpl=i.first)}},inputs:{subsystemNQN:"subsystemNQN"},features:[e.TTD],decls:8,vars:5,consts:function(){let s;return s="Any host allowed (*)",[["columnMode","flex","selectionType","multiClick",3,"data","columns","fetchData","updateSelection"],[1,"table-actions","btn-toolbar"],[1,"btn-group",3,"permission","selection","tableActions"],["hostTpl",""],["class","font-monospace",4,"ngIf"],[1,"font-monospace"],s]},template:function(t,o){1&t&&(e.TgZ(0,"legend")(1,"cd-help-text"),e._uU(2," The client that connects to the NVMe-oF target to access NVMe storage. "),e.qZA()(),e.TgZ(3,"cd-table",0),e.NdJ("fetchData",function(){return o.listInitiators()})("updateSelection",function(_){return o.updateSelection(_)}),e.TgZ(4,"div",1),e._UZ(5,"cd-table-actions",2),e.qZA()(),e.YNc(6,Vr,2,2,"ng-template",null,3,e.W1O)),2&t&&(e.xp6(3),e.Q6J("data",o.initiators)("columns",o.initiatorColumns),e.xp6(2),e.Q6J("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[c.O5,me.t,z.a,ce.K]}),n})();function Yr(n,s){if(1&n&&e._UZ(0,"cd-table-key-value",14),2&n){const t=e.oxw(2);e.Q6J("data",t.data)}}function zr(n,s){if(1&n&&e._UZ(0,"cd-nvmeof-listeners-list",15),2&n){const t=e.oxw(2);e.Q6J("subsystemNQN",t.subsystemNQN)}}function Jr(n,s){if(1&n&&e._UZ(0,"cd-nvmeof-namespaces-list",15),2&n){const t=e.oxw(2);e.Q6J("subsystemNQN",t.subsystemNQN)}}function Ur(n,s){if(1&n&&e._UZ(0,"cd-nvmeof-initiators-list",15),2&n){const t=e.oxw(2);e.Q6J("subsystemNQN",t.subsystemNQN)}}function jr(n,s){if(1&n&&(e.ynx(0),e.TgZ(1,"nav",1,2),e.ynx(3,3),e.TgZ(4,"a",4),e.SDv(5,5),e.qZA(),e.YNc(6,Yr,1,1,"ng-template",6),e.BQk(),e.ynx(7,7),e.TgZ(8,"a",4),e.SDv(9,8),e.qZA(),e.YNc(10,zr,1,1,"ng-template",6),e.BQk(),e.ynx(11,9),e.TgZ(12,"a",4),e.SDv(13,10),e.qZA(),e.YNc(14,Jr,1,1,"ng-template",6),e.BQk(),e.ynx(15,11),e.TgZ(16,"a",4),e.SDv(17,12),e.qZA(),e.YNc(18,Ur,1,1,"ng-template",6),e.BQk(),e.qZA(),e._UZ(19,"div",13),e.BQk()),2&n){const t=e.MAs(2);e.xp6(19),e.Q6J("ngbNavOutlet",t)}}let Wr=(()=>{class n{ngOnChanges(){this.selection&&(this.selectedItem=this.selection,this.subsystemNQN=this.selectedItem.nqn,this.data={},this.data["Serial Number"]=this.selectedItem.serial_number,this.data["Model Number"]=this.selectedItem.model_number,this.data["Minimum Controller Identifier"]=this.selectedItem.min_cntlid,this.data["Maximum Controller Identifier"]=this.selectedItem.max_cntlid,this.data["Subsystem Type"]=this.selectedItem.subtype)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-nvmeof-subsystems-details"]],inputs:{selection:"selection"},features:[e.TTD],decls:1,vars:1,consts:function(){let s,t,o,i;return s="\uC138\uBD80\uC124\uBA85",t="Listeners",o="Namespaces",i="\uAC1C\uC2DC\uC790\uB4E4",[[4,"ngIf"],["ngbNav","","cdStatefulTab","subsystem-details",1,"nav-tabs"],["nav","ngbNav"],["ngbNavItem","details"],["ngbNavLink",""],s,["ngbNavContent",""],["ngbNavItem","listeners"],t,["ngbNavItem","namespaces"],o,["ngbNavItem","initiators"],i,[3,"ngbNavOutlet"],[3,"data"],[3,"subsystemNQN"]]},template:function(t,o){1&t&&e.YNc(0,jr,20,1,"ng-container",0),2&t&&e.Q6J("ngIf",o.selection)},dependencies:[c.O5,P.uN,P.Pz,P.nv,P.Vx,P.tO,P.Dy,Gr.b,dt.m,xr,Hr,Xr]}),n})();const Kt="block/nvmeof/subsystems";let kt=(()=>{class n extends _t.o{constructor(t,o,i,_,r,l){super(),this.nvmeofService=t,this.authStorageService=o,this.actionLabels=i,this.router=_,this.modalService=r,this.taskWrapper=l,this.subsystems=[],this.selection=new le.r,this.permission=this.authStorageService.getPermissions().nvmeof}ngOnInit(){this.subsystemsColumns=[{name:"NQN",prop:"nqn"},{name:"# Namespaces",prop:"namespace_count"},{name:"# Maximum Allowed Namespaces",prop:"max_namespaces"}],this.tableActions=[{name:this.actionLabels.CREATE,permission:"create",icon:C.P.add,click:()=>this.router.navigate([Kt,{outlets:{modal:[E.MQ.CREATE]}}]),canBePrimary:t=>!t.hasSelection},{name:this.actionLabels.EDIT,permission:"update",icon:C.P.edit,click:()=>this.router.navigate([Kt,{outlets:{modal:[E.MQ.EDIT,this.selection.first().nqn,this.selection.first().max_namespaces]}}])},{name:this.actionLabels.DELETE,permission:"delete",icon:C.P.destroy,click:()=>this.deleteSubsystemModal()}]}updateSelection(t){this.selection=t}getSubsystems(){this.nvmeofService.listSubsystems().subscribe(t=>{this.subsystems=Array.isArray(t)?t:[t]})}deleteSubsystemModal(){const t=this.selection.first();this.modalService.show(re.M,{itemDescription:"Subsystem",itemNames:[t.nqn],actionDescription:"delete",submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new N.R("nvmeof/subsystem/delete",{nqn:t.nqn}),call:this.nvmeofService.deleteSubsystem(t.nqn)})})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Ce),e.Y36(k.j),e.Y36(E.p4),e.Y36(p.F0),e.Y36(ae.Z),e.Y36(G.P))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-nvmeof-subsystems"]],features:[e.qOj],decls:9,vars:7,consts:function(){let s;return s=" Subsystems " + "\ufffd#3\ufffd" + " A subsystem presents a collection of controllers which are used to access namespaces. " + "\ufffd/#3\ufffd" + "",[s,["columnMode","flex","selectionType","single",3,"data","columns","hasDetails","fetchData","setExpandedRow","updateSelection"],[1,"table-actions","btn-toolbar"],[1,"btn-group",3,"permission","selection","tableActions"],["cdTableDetail","",3,"selection"],["name","modal"]]},template:function(t,o){1&t&&(e._UZ(0,"cd-nvmeof-tabs"),e.TgZ(1,"legend"),e.tHW(2,0),e._UZ(3,"cd-help-text"),e.N_p(),e.qZA(),e.TgZ(4,"cd-table",1),e.NdJ("fetchData",function(){return o.getSubsystems()})("setExpandedRow",function(_){return o.setExpandedRow(_)})("updateSelection",function(_){return o.updateSelection(_)}),e.TgZ(5,"div",2),e._UZ(6,"cd-table-actions",3),e.qZA(),e._UZ(7,"cd-nvmeof-subsystems-details",4),e.qZA(),e._UZ(8,"router-outlet",5)),2&t&&(e.xp6(4),e.Q6J("data",o.subsystems)("columns",o.subsystemsColumns)("hasDetails",!0),e.xp6(2),e.Q6J("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions),e.xp6(1),e.Q6J("selection",o.expandedRow))},dependencies:[me.t,z.a,ce.K,p.lC,Wr,Ht]}),n})();function el(n,s){1&n&&(e.TgZ(0,"span",21),e.SDv(1,22),e.qZA())}function tl(n,s){1&n&&(e.TgZ(0,"span",21),e.SDv(1,23),e.qZA())}function ol(n,s){1&n&&(e.TgZ(0,"span",21),e.tHW(1,24),e._UZ(2,"br")(3,"code")(4,"br")(5,"code"),e.N_p(),e.qZA())}function nl(n,s){1&n&&(e.TgZ(0,"span",21),e.SDv(1,25),e.qZA())}function il(n,s){1&n&&(e.TgZ(0,"span",21),e.SDv(1,26),e.qZA())}function sl(n,s){1&n&&(e.TgZ(0,"span",21),e.SDv(1,27),e.qZA())}function _l(n,s){1&n&&(e.TgZ(0,"span",21),e.SDv(1,28),e.qZA())}let al=(()=>{class n{constructor(t,o,i,_,r,l){this.authStorageService=t,this.actionLabels=o,this.activeModal=i,this.nvmeofService=_,this.taskWrapperService=r,this.router=l,this.DEFAULT_NQN="nqn.2001-07.com.ceph:"+Date.now(),this.NQN_REGEX=/^nqn\.(19|20)\d\d-(0[1-9]|1[0-2])\.\D{2,3}(\.[A-Za-z0-9-]+)+(:[A-Za-z0-9-\.]+(:[A-Za-z0-9-\.]+)*)$/,this.NQN_REGEX_UUID=/^nqn\.2014-08\.org\.nvmexpress:uuid:[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/,this.customNQNValidator=v.hq.custom("pattern",d=>!!d&&!(this.NQN_REGEX.test(d)||this.NQN_REGEX_UUID.test(d))),this.permission=this.authStorageService.getPermissions().nvmeof,this.resource="Subsystem",this.pageURL="block/nvmeof/subsystems"}ngOnInit(){this.createForm(),this.action=this.actionLabels.CREATE}createForm(){this.subsystemForm=new A.d({nqn:new a.p4(this.DEFAULT_NQN,{validators:[this.customNQNValidator,a.kI.required,this.customNQNValidator,v.hq.custom("maxLength",t=>(new TextEncoder).encode(t).length>223)],asyncValidators:[v.hq.unique(this.nvmeofService.isSubsystemPresent,this.nvmeofService)]}),max_namespaces:new a.p4(256,{validators:[v.hq.number(!1),a.kI.max(256),a.kI.min(1)]})})}onSubmit(){const t=this,o=this.subsystemForm.getValue("nqn"),i=Number(this.subsystemForm.getValue("max_namespaces"));let _=`nvmeof/subsystem/${E.MQ.CREATE}`;const r={nqn:o,max_namespaces:i,enable_ha:!0};i||delete r.max_namespaces,this.taskWrapperService.wrapTaskAroundCall({task:new N.R(_,{nqn:o}),call:this.nvmeofService.createSubsystem(r)}).subscribe({error(){t.subsystemForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.router.navigate([this.pageURL,{outlets:{modal:null}}])}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(k.j),e.Y36(E.p4),e.Y36(P.Kz),e.Y36(Ce),e.Y36(G.P),e.Y36(p.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-nvmeof-subsystems-form"]],decls:37,vars:22,consts:function(){let s,t,o,i,_,r,l,d,u,f,M;return s="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",t="NQN",o="Maximum Namespaces",i="The maximum namespaces per subsystem. Default is 256.",_="This field is required.",r="This NQN is already in use.",l="Expected NQN format" + "[\ufffd#2\ufffd\ufffd/#2\ufffd|\ufffd#4\ufffd\ufffd/#4\ufffd]" + "<" + "[\ufffd#3\ufffd|\ufffd#5\ufffd]" + "nqn.$year-$month.$reverseDomainName:$utf8-string" + "[\ufffd/#3\ufffd|\ufffd/#5\ufffd]" + "\".> or " + "[\ufffd#2\ufffd\ufffd/#2\ufffd|\ufffd#4\ufffd\ufffd/#4\ufffd]" + "<" + "[\ufffd#3\ufffd|\ufffd#5\ufffd]" + "nqn.2014-08.org.nvmexpress:uuid:$UUID-string" + "[\ufffd/#3\ufffd|\ufffd/#5\ufffd]" + "\".>",l=e.Zx4(l),d="An NQN may not be more than 223 bytes in length.",u="The value must be at least 1.",f="The value cannot be greated than 256.",M="The value must be a positive integer.",[[3,"pageURL","modalRef"],[1,"modal-title"],s,[1,"modal-content"],["name","subsystemForm","novalidate","",3,"formGroup"],["formDir","ngForm"],[1,"modal-body"],[1,"form-group","row"],["for","nqn",1,"cd-col-form-label"],[1,"required"],t,[1,"cd-col-form-input"],["name","nqn","type","text","formControlName","nqn",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","max_namespaces",1,"cd-col-form-label"],o,["id","max_namespaces","type","text","name","max_namespaces","formControlName","max_namespaces",1,"form-control"],i,[1,"modal-footer"],[1,"text-right"],[3,"form","submitText","submitActionEvent"],[1,"invalid-feedback"],_,r,l,d,u,f,M]},template:function(t,o){if(1&t&&(e.TgZ(0,"cd-modal",0)(1,"span",1),e.SDv(2,2),e.ALo(3,"titlecase"),e.ALo(4,"upperFirst"),e.qZA(),e.ynx(5,3),e.TgZ(6,"form",4,5)(8,"div",6)(9,"div",7)(10,"label",8)(11,"span",9),e.SDv(12,10),e.qZA()(),e.TgZ(13,"div",11),e._UZ(14,"input",12),e.TgZ(15,"cd-help-text"),e._uU(16," A unique and permanent name for the lifetime of the subsystem. "),e.qZA(),e.YNc(17,el,2,0,"span",13),e.YNc(18,tl,2,0,"span",13),e.YNc(19,ol,6,0,"span",13),e.YNc(20,nl,2,0,"span",13),e.qZA()(),e.TgZ(21,"div",7)(22,"label",14)(23,"span"),e.SDv(24,15),e.qZA()(),e.TgZ(25,"div",11),e._UZ(26,"input",16),e.TgZ(27,"cd-help-text"),e.SDv(28,17),e.qZA(),e.YNc(29,il,2,0,"span",13),e.YNc(30,sl,2,0,"span",13),e.YNc(31,_l,2,0,"span",13),e.qZA()()(),e.TgZ(32,"div",18)(33,"div",19)(34,"cd-form-button-panel",20),e.NdJ("submitActionEvent",function(){return o.onSubmit()}),e.ALo(35,"titlecase"),e.ALo(36,"upperFirst"),e.qZA()()()(),e.BQk(),e.qZA()),2&t){const i=e.MAs(7);e.Q6J("pageURL",o.pageURL)("modalRef",o.activeModal),e.xp6(4),e.pQV(e.lcZ(3,14,o.action))(e.lcZ(4,16,o.resource)),e.QtT(2),e.xp6(2),e.Q6J("formGroup",o.subsystemForm),e.xp6(11),e.Q6J("ngIf",o.subsystemForm.showError("nqn",i,"required")),e.xp6(1),e.Q6J("ngIf",o.subsystemForm.showError("nqn",i,"unique")),e.xp6(1),e.Q6J("ngIf",o.subsystemForm.showError("nqn",i,"pattern")),e.xp6(1),e.Q6J("ngIf",o.subsystemForm.showError("nqn",i,"maxLength")),e.xp6(9),e.Q6J("ngIf",o.subsystemForm.showError("max_namespaces",i,"min")),e.xp6(1),e.Q6J("ngIf",o.subsystemForm.showError("max_namespaces",i,"max")),e.xp6(1),e.Q6J("ngIf",o.subsystemForm.showError("max_namespaces",i,"pattern")),e.xp6(3),e.Q6J("form",o.subsystemForm)("submitText",e.lcZ(35,18,o.action)+" "+e.lcZ(36,20,o.resource))}},dependencies:[c.O5,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,Y.z,R.p,me.t,L.o,g.b,T.P,b.V,c.rS,Fe.m]}),n})();var rl=m(22120);function ll(n,s){1&n&&(e.TgZ(0,"option",24),e.SDv(1,25),e.qZA()),2&n&&e.Q6J("ngValue",null)}function cl(n,s){1&n&&(e.TgZ(0,"option",24),e.SDv(1,26),e.qZA()),2&n&&e.Q6J("ngValue",null)}function dl(n,s){1&n&&(e.TgZ(0,"option",24),e.SDv(1,27),e.qZA()),2&n&&e.Q6J("ngValue",null)}function ml(n,s){if(1&n&&(e.TgZ(0,"option",24),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("ngValue",t),e.xp6(1),e.Oqu(t.hostname)}}function pl(n,s){1&n&&(e.TgZ(0,"span",28),e.SDv(1,29),e.qZA())}function ul(n,s){1&n&&(e.TgZ(0,"span",28),e.SDv(1,30),e.qZA())}function gl(n,s){1&n&&(e.TgZ(0,"span",28),e.SDv(1,31),e.qZA())}function Tl(n,s){1&n&&(e.TgZ(0,"span",28),e.SDv(1,32),e.qZA())}let fl=(()=>{class n{constructor(t,o,i,_,r,l,d,u,f,M){this.actionLabels=t,this.authStorageService=o,this.taskWrapperService=i,this.nvmeofService=_,this.hostService=r,this.router=l,this.route=d,this.activeModal=u,this.formatterService=f,this.dimlessBinaryPipe=M,this.hosts=null,this.permission=this.authStorageService.getPermissions().nvmeof,this.hostPermission=this.authStorageService.getPermissions().hosts,this.resource="Listener",this.pageURL="block/nvmeof/subsystems"}setHosts(){const t=new $.E(()=>{});this.hostService.list(t.toParams(),"false").subscribe(o=>{const i=o.filter(_=>_.service_instances.some(r=>"nvmeof"===r.type));this.hosts=i.map(_=>({hostname:_.hostname,addr:_.addr}))})}ngOnInit(){this.createForm(),this.action=this.actionLabels.CREATE,this.route.params.subscribe(t=>{this.subsystemNQN=t.subsystem_nqn}),this.setHosts()}createForm(){this.listenerForm=new A.d({host:new a.p4(null,{validators:[a.kI.required]}),trsvcid:new a.p4(4420,[a.kI.required,v.hq.number(!1),a.kI.max(65535)])})}buildRequest(){const t=this.listenerForm.getValue("host");let o=Number(this.listenerForm.getValue("trsvcid"));return o||(o=4420),{host_name:t.hostname,traddr:t.addr,trsvcid:o}}onSubmit(){const t=this,o=`nvmeof/listener/${E.MQ.CREATE}`,i=this.buildRequest();this.taskWrapperService.wrapTaskAroundCall({task:new N.R(o,{nqn:this.subsystemNQN,host_name:i.host_name}),call:this.nvmeofService.createListener(this.subsystemNQN,i)}).subscribe({error(){t.listenerForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.router.navigate([this.pageURL,{outlets:{modal:null}}])}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(E.p4),e.Y36(k.j),e.Y36(G.P),e.Y36(Ce),e.Y36(rl.x),e.Y36(p.F0),e.Y36(p.gz),e.Y36(P.Kz),e.Y36(pt.H),e.Y36(Le.$))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-nvmeof-listeners-form"]],decls:38,vars:22,consts:function(){let s,t,o,i,_,r,l,d,u,f,M,O;return s="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",t="Host Name",o=" This hostname uniquely identifies the gateway on which the listener is being set up. ",i="Transport Service ID",_="The IP port to use. Default is 4420.",r="\uB85C\uB529\uC911...",l="-- No hosts available --",d="-- Select a host --",u="This field is required.",f="This field is required.",M="The value cannot be greated than 65535.",O="The value must be a positive integer.",[[3,"pageURL"],[1,"modal-title"],s,[1,"modal-content"],["name","listenerForm","novalidate","",3,"formGroup"],["formDir","ngForm"],[1,"modal-body"],[1,"form-group","row"],["for","host",1,"cd-col-form-label"],[1,"required"],t,[1,"cd-col-form-input"],["id","host","name","host","formControlName","host",1,"form-select"],[3,"ngValue",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],o,["class","invalid-feedback",4,"ngIf"],["for","trsvcid",1,"cd-col-form-label"],i,["id","trsvcid","type","text","name","trsvcid","formControlName","trsvcid",1,"form-control"],_,[1,"modal-footer"],[1,"text-right"],[3,"form","submitText","submitActionEvent"],[3,"ngValue"],r,l,d,[1,"invalid-feedback"],u,f,M,O]},template:function(t,o){if(1&t&&(e.TgZ(0,"cd-modal",0)(1,"span",1),e.SDv(2,2),e.ALo(3,"titlecase"),e.ALo(4,"upperFirst"),e.qZA(),e.ynx(5,3),e.TgZ(6,"form",4,5)(8,"div",6)(9,"div",7)(10,"label",8)(11,"span",9),e.SDv(12,10),e.qZA()(),e.TgZ(13,"div",11)(14,"select",12),e.YNc(15,ll,2,1,"option",13),e.YNc(16,cl,2,1,"option",13),e.YNc(17,dl,2,1,"option",13),e.YNc(18,ml,2,2,"option",14),e.qZA(),e.TgZ(19,"cd-help-text"),e.SDv(20,15),e.qZA(),e.YNc(21,pl,2,0,"span",16),e.qZA()(),e.TgZ(22,"div",7)(23,"label",17)(24,"span"),e.SDv(25,18),e.qZA()(),e.TgZ(26,"div",11),e._UZ(27,"input",19),e.TgZ(28,"cd-help-text"),e.SDv(29,20),e.qZA(),e.YNc(30,ul,2,0,"span",16),e.YNc(31,gl,2,0,"span",16),e.YNc(32,Tl,2,0,"span",16),e.qZA()()(),e.TgZ(33,"div",21)(34,"div",22)(35,"cd-form-button-panel",23),e.NdJ("submitActionEvent",function(){return o.onSubmit()}),e.ALo(36,"titlecase"),e.ALo(37,"upperFirst"),e.qZA()()()(),e.BQk(),e.qZA()),2&t){const i=e.MAs(7);e.Q6J("pageURL",o.pageURL),e.xp6(4),e.pQV(e.lcZ(3,14,o.action))(e.lcZ(4,16,o.resource)),e.QtT(2),e.xp6(2),e.Q6J("formGroup",o.listenerForm),e.xp6(9),e.Q6J("ngIf",null===o.hosts),e.xp6(1),e.Q6J("ngIf",o.hosts&&0===o.hosts.length),e.xp6(1),e.Q6J("ngIf",o.hosts&&o.hosts.length>0),e.xp6(1),e.Q6J("ngForOf",o.hosts),e.xp6(3),e.Q6J("ngIf",o.listenerForm.showError("host",i,"required")),e.xp6(9),e.Q6J("ngIf",o.listenerForm.showError("trsvcid",i,"required")),e.xp6(1),e.Q6J("ngIf",o.listenerForm.showError("trsvcid",i,"max")),e.xp6(1),e.Q6J("ngIf",o.listenerForm.showError("trsvcid",i,"pattern")),e.xp6(3),e.Q6J("form",o.listenerForm)("submitText",e.lcZ(36,18,o.action)+" "+e.lcZ(37,20,o.resource))}},dependencies:[c.sg,c.O5,a._Y,a.YN,a.Kr,a.Fj,a.EJ,a.JJ,a.JL,a.sg,a.u,Y.z,R.p,me.t,L.o,g.b,T.P,b.V,c.rS,Fe.m]}),n})();function Sl(n,s){1&n&&e._UZ(0,"input",28)}function Cl(n,s){1&n&&(e.TgZ(0,"option",31),e.SDv(1,32),e.qZA()),2&n&&e.Q6J("ngValue",null)}function El(n,s){1&n&&(e.TgZ(0,"option",31),e.SDv(1,33),e.qZA()),2&n&&e.Q6J("ngValue",null)}function Ml(n,s){1&n&&(e.TgZ(0,"option",31),e.SDv(1,34),e.qZA()),2&n&&e.Q6J("ngValue",null)}function Ol(n,s){if(1&n&&(e.TgZ(0,"option",35),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t.pool_name),e.xp6(1),e.Oqu(t.pool_name)}}function Rl(n,s){if(1&n&&(e.TgZ(0,"select",29),e.YNc(1,Cl,2,1,"option",30),e.YNc(2,El,2,1,"option",30),e.YNc(3,Ml,2,1,"option",30),e.YNc(4,Ol,2,2,"option",24),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",null===t.rbdPools),e.xp6(1),e.Q6J("ngIf",t.rbdPools&&0===t.rbdPools.length),e.xp6(1),e.Q6J("ngIf",t.rbdPools&&t.rbdPools.length>0),e.xp6(1),e.Q6J("ngForOf",t.rbdPools)}}function hl(n,s){1&n&&(e.TgZ(0,"span",36),e.SDv(1,37),e.qZA())}function Al(n,s){1&n&&(e.TgZ(0,"span",36),e.ynx(1),e.SDv(2,38),e.BQk(),e.qZA())}function Nl(n,s){1&n&&(e.TgZ(0,"span",36),e.ynx(1),e.SDv(2,39),e.BQk(),e.qZA())}function Pl(n,s){if(1&n&&(e.TgZ(0,"option",35),e.SDv(1,40),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t),e.xp6(1),e.pQV(t),e.QtT(1)}}function bl(n,s){1&n&&(e.TgZ(0,"span",36),e.ynx(1),e.SDv(2,41),e.BQk(),e.qZA())}function Il(n,s){1&n&&(e.TgZ(0,"span",36),e.ynx(1),e.SDv(2,42),e.BQk(),e.qZA())}function Fl(n,s){1&n&&(e.TgZ(0,"span",36),e.ynx(1),e.SDv(2,43),e.BQk(),e.qZA())}const St=function(n){return{required:n}};let Vt=(()=>{class n{constructor(t,o,i,_,r,l,d,u,f,M,O){this.actionLabels=t,this.authStorageService=o,this.taskWrapperService=i,this.nvmeofService=_,this.poolService=r,this.rbdService=l,this.router=d,this.route=u,this.activeModal=f,this.formatterService=M,this.dimlessBinaryPipe=O,this.edit=!1,this.rbdPools=null,this.units=["KiB","MiB","GiB","TiB"],this.permission=this.authStorageService.getPermissions().nvmeof,this.poolPermission=this.authStorageService.getPermissions().pool,this.resource="Namespace",this.pageURL="block/nvmeof/subsystems"}init(){this.createForm(),this.action=this.actionLabels.CREATE,this.route.params.subscribe(t=>{this.subsystemNQN=t.subsystem_nqn,this.nsid=t?.nsid})}initForEdit(){this.edit=!0,this.action=this.actionLabels.EDIT,this.nvmeofService.getNamespace(this.subsystemNQN,this.nsid).subscribe(t=>{const o=this.dimlessBinaryPipe.transform(t.rbd_image_size).split(" ");this.currentBytes=t.rbd_image_size,this.nsForm.get("image").setValue(t.rbd_image_name),this.nsForm.get("pool").setValue(t.rbd_pool_name),this.nsForm.get("unit").setValue(o[1]),this.nsForm.get("image_size").setValue(o[0]),this.nsForm.get("image_size").addValidators(a.kI.required),this.nsForm.get("image").disable(),this.nsForm.get("pool").disable()})}initForCreate(){this.poolService.getList().subscribe(t=>{this.rbdPools=t.filter(this.rbdService.isRBDPool)})}ngOnInit(){this.init(),this.router.url.includes("subsystems/(modal:edit")?this.initForEdit():this.initForCreate()}createForm(){this.nsForm=new A.d({image:new a.p4(`nvme_ns_image:${Date.now()}`,{validators:[a.kI.required,a.kI.pattern(/^[^@/]+?$/)]}),pool:new a.p4(null,{validators:[a.kI.required]}),image_size:new a.p4(1,[v.hq.number(!1),a.kI.min(1)]),unit:new a.p4(this.units[2])})}buildRequest(){const t=this.nsForm.getValue("image_size"),o=this.nsForm.getValue("unit"),i={};if(t){const _=this.edit?"rbd_image_size":"size",r=this.formatterService.toBytes(t+o);i[_]=r}if(!this.edit){const _=this.nsForm.getValue("image"),r=this.nsForm.getValue("pool");i.rbd_image_name=_,i.rbd_pool=r}return i}validateSize(){const t=this.nsForm.getValue("unit"),o=this.nsForm.getValue("image_size");return o&&t?this.formatterService.toBytes(o+t)<=this.currentBytes:null}onSubmit(){if(this.validateSize())this.invalidSizeError=!0,this.nsForm.setErrors({cdSubmitButton:!0});else{this.invalidSizeError=!1;const t=this,o=`nvmeof/namespace/${this.edit?E.MQ.EDIT:E.MQ.CREATE}`,i=this.buildRequest();let _;_=this.taskWrapperService.wrapTaskAroundCall(this.edit?{task:new N.R(o,{nqn:this.subsystemNQN,nsid:this.nsid}),call:this.nvmeofService.updateNamespace(this.subsystemNQN,this.nsid,i)}:{task:new N.R(o,{nqn:this.subsystemNQN}),call:this.nvmeofService.createNamespace(this.subsystemNQN,i)}),_.subscribe({error(){t.nsForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.router.navigate([this.pageURL,{outlets:{modal:null}}])}})}}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(E.p4),e.Y36(k.j),e.Y36(G.P),e.Y36(Ce),e.Y36(we.q),e.Y36(j.U),e.Y36(p.F0),e.Y36(p.gz),e.Y36(P.Kz),e.Y36(pt.H),e.Y36(Le.$))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-nvmeof-namespaces-form"]],decls:44,vars:33,consts:function(){let s,t,o,i,_,r,l,d,u,f,M,O,I,B,V;return s="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",t="Pool",o=" A RBD application-enabled pool where the image will be created. ",i="Image Name",_="Image Size",r="\uB85C\uB529\uC911...",l="-- No block pools available --",d="-- \uD480 \uC120\uD0DD --",u="This field is required.",f="This field is required.",M="'/' \uC640 '@' \uBB38\uC790\uB294 \uC0AC\uC6A9\uBD88\uAC00\uC785\uB2C8\uB2E4.",O="" + "\ufffd0\ufffd" + "",I="Enter a positive integer.",B="This field is required",V="Enter a value above than previous. A block device image can be expanded but not reduced.",[[3,"pageURL","modalRef"],[1,"modal-title"],s,[1,"modal-content"],["name","nsForm","novalidate","",3,"formGroup"],["formDir","ngForm"],[1,"modal-body"],[1,"form-group","row"],["for","pool",1,"cd-col-form-label"],[3,"ngClass"],t,[1,"cd-col-form-input"],["name","pool","class","form-control","type","text","formControlName","pool",4,"ngIf"],["id","pool","name","pool","class","form-select","formControlName","pool",4,"ngIf"],o,["class","invalid-feedback",4,"ngIf"],["for","image",1,"cd-col-form-label"],i,["name","image","type","text","formControlName","image",1,"form-control"],["for","image_size",1,"cd-col-form-label"],_,[1,"input-group"],["id","size","type","text","name","image_size","formControlName","image_size",1,"form-control"],["id","unit","name","unit","formControlName","unit",1,"form-input","form-select"],[3,"value",4,"ngFor","ngForOf"],[1,"modal-footer"],[1,"text-right"],[3,"form","submitText","submitActionEvent"],["name","pool","type","text","formControlName","pool",1,"form-control"],["id","pool","name","pool","formControlName","pool",1,"form-select"],[3,"ngValue",4,"ngIf"],[3,"ngValue"],r,l,d,[3,"value"],[1,"invalid-feedback"],u,f,M,O,I,B,V]},template:function(t,o){if(1&t&&(e.TgZ(0,"cd-modal",0)(1,"span",1),e.SDv(2,2),e.ALo(3,"titlecase"),e.ALo(4,"upperFirst"),e.qZA(),e.ynx(5,3),e.TgZ(6,"form",4,5)(8,"div",6)(9,"div",7)(10,"label",8)(11,"span",9),e.SDv(12,10),e.qZA()(),e.TgZ(13,"div",11),e.YNc(14,Sl,1,0,"input",12),e.YNc(15,Rl,5,4,"select",13),e.TgZ(16,"cd-help-text"),e.SDv(17,14),e.qZA(),e.YNc(18,hl,2,0,"span",15),e.qZA()(),e.TgZ(19,"div",7)(20,"label",16)(21,"span",9),e.SDv(22,17),e.qZA()(),e.TgZ(23,"div",11),e._UZ(24,"input",18),e.YNc(25,Al,3,0,"span",15),e.YNc(26,Nl,3,0,"span",15),e.qZA()(),e.TgZ(27,"div",7)(28,"label",19)(29,"span",9),e.SDv(30,20),e.qZA()(),e.TgZ(31,"div",11)(32,"div",21),e._UZ(33,"input",22),e.TgZ(34,"select",23),e.YNc(35,Pl,2,2,"option",24),e.qZA(),e.YNc(36,bl,3,0,"span",15),e.YNc(37,Il,3,0,"span",15),e.YNc(38,Fl,3,0,"span",15),e.qZA()()()(),e.TgZ(39,"div",25)(40,"div",26)(41,"cd-form-button-panel",27),e.NdJ("submitActionEvent",function(){return o.onSubmit()}),e.ALo(42,"titlecase"),e.ALo(43,"upperFirst"),e.qZA()()()(),e.BQk(),e.qZA()),2&t){const i=e.MAs(7);e.Q6J("pageURL",o.pageURL)("modalRef",o.activeModal),e.xp6(4),e.pQV(e.lcZ(3,19,o.action))(e.lcZ(4,21,o.resource)),e.QtT(2),e.xp6(2),e.Q6J("formGroup",o.nsForm),e.xp6(5),e.Q6J("ngClass",e.VKq(27,St,!o.edit)),e.xp6(3),e.Q6J("ngIf",o.edit),e.xp6(1),e.Q6J("ngIf",!o.edit),e.xp6(3),e.Q6J("ngIf",o.nsForm.showError("pool",i,"required")),e.xp6(3),e.Q6J("ngClass",e.VKq(29,St,!o.edit)),e.xp6(4),e.Q6J("ngIf",o.nsForm.showError("image",i,"required")),e.xp6(1),e.Q6J("ngIf",o.nsForm.showError("image",i,"pattern")),e.xp6(3),e.Q6J("ngClass",e.VKq(31,St,o.edit)),e.xp6(6),e.Q6J("ngForOf",o.units),e.xp6(1),e.Q6J("ngIf",o.nsForm.showError("image_size",i,"pattern")),e.xp6(1),e.Q6J("ngIf",o.edit&&o.nsForm.showError("image_size",i,"required")),e.xp6(1),e.Q6J("ngIf",o.edit&&o.invalidSizeError),e.xp6(3),e.Q6J("form",o.nsForm)("submitText",e.lcZ(42,23,o.action)+" "+e.lcZ(43,25,o.resource))}},dependencies:[c.mk,c.sg,c.O5,a._Y,a.YN,a.Kr,a.Fj,a.EJ,a.JJ,a.JL,a.sg,a.u,Y.z,R.p,me.t,L.o,g.b,T.P,b.V,c.rS,Fe.m]}),n})();function vl(n,s){1&n&&(e.TgZ(0,"span",34),e.SDv(1,35),e.qZA())}function Ll(n,s){1&n&&(e.TgZ(0,"span",34),e.tHW(1,36),e._UZ(2,"br")(3,"code")(4,"br")(5,"code"),e.N_p(),e.qZA())}function Dl(n,s){1&n&&(e.TgZ(0,"span",34),e.SDv(1,37),e.qZA())}function $l(n,s){if(1&n&&(e.ynx(0),e.YNc(1,vl,2,0,"span",27),e.YNc(2,Ll,6,0,"span",27),e.YNc(3,Dl,2,0,"span",27),e.BQk()),2&n){const t=e.oxw().index,o=e.oxw(2);e.xp6(1),e.Q6J("ngIf",null==o.initiatorForm.get("addHost.addedHosts").controls[t].errors?null:o.initiatorForm.get("addHost.addedHosts").controls[t].errors.required),e.xp6(1),e.Q6J("ngIf",null==o.initiatorForm.get("addHost.addedHosts").controls[t].errors?null:o.initiatorForm.get("addHost.addedHosts").controls[t].errors.pattern),e.xp6(1),e.Q6J("ngIf",null==o.initiatorForm.get("addHost.addedHosts").controls[t].errors?null:o.initiatorForm.get("addHost.addedHosts").controls[t].errors.maxLength)}}function Bl(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",28),e._UZ(1,"input",29),e.TgZ(2,"button",30),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.addHost())}),e._UZ(3,"i",31),e.qZA(),e.TgZ(4,"button",30),e.NdJ("click",function(){const _=e.CHM(t).index,r=e.oxw(2);return e.KtG(r.removeHost(_))}),e._UZ(5,"i",32),e.qZA(),e.YNc(6,$l,4,3,"ng-container",33),e.qZA()}if(2&n){const t=s.index,o=e.oxw(2);e.xp6(1),e.Q6J("required",!o.initiatorForm.getValue("allowAnyHost"))("formControlName",t),e.xp6(1),e.MGl("id","add-button-",t,""),e.Q6J("disabled",o.initiatorForm.get("addHost.addedHosts").controls[t].invalid||(null==o.initiatorForm.get("addHost.addedHosts").errors?null:o.initiatorForm.get("addHost.addedHosts").errors.duplicate)||32===o.initiatorForm.get("addHost.addedHosts").controls.length||1!==o.initiatorForm.get("addHost.addedHosts").controls.length&&o.initiatorForm.get("addHost.addedHosts").controls.length!==t+1),e.xp6(2),e.MGl("id","delete-button-",t,""),e.Q6J("disabled",1===o.addedHosts.controls.length),e.xp6(2),e.Q6J("ngIf",o.initiatorForm.get("addHost.addedHosts").controls[t].invalid&&(o.initiatorForm.get("addHost.addedHosts").controls[t].dirty||o.initiatorForm.get("addHost.addedHosts").controls[t].touched))}}function Gl(n,s){1&n&&(e.TgZ(0,"span",34),e.SDv(1,38),e.qZA())}function yl(n,s){if(1&n&&(e.TgZ(0,"div",25),e.YNc(1,Bl,7,7,"div",26),e.YNc(2,Gl,2,0,"span",27),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.addedHosts.controls),e.xp6(1),e.Q6J("ngIf",null==t.initiatorForm.get("addHost.addedHosts").errors?null:t.initiatorForm.get("addHost.addedHosts").errors.duplicate)}}function xl(n,s){1&n&&(e.TgZ(0,"cd-alert-panel",39),e._uU(1,"Allowing any host to connect to the NVMe/TCP gateway may pose security risks. "),e.qZA()),2&n&&e.Q6J("showTitle",!1)}let Zl=(()=>{class n{constructor(t,o,i,_,r,l,d){this.authStorageService=t,this.actionLabels=o,this.nvmeofService=i,this.taskWrapperService=_,this.router=r,this.route=l,this.formBuilder=d,this.remove=!1,this.removeHosts=[],this.NQN_REGEX=/^nqn\.(19|20)\d\d-(0[1-9]|1[0-2])\.\D{2,3}(\.[A-Za-z0-9-]+)+(:[A-Za-z0-9-\.]+(:[A-Za-z0-9-\.]+)*)$/,this.NQN_REGEX_UUID=/^nqn\.2014-08\.org\.nvmexpress:uuid:[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/,this.ALLOW_ALL_HOST="*",this.customNQNValidator=v.hq.custom("pattern",u=>!!u&&!(this.NQN_REGEX.test(u)||this.NQN_REGEX_UUID.test(u))),this.permission=this.authStorageService.getPermissions().nvmeof,this.resource="Initiator",this.pageURL="block/nvmeof/subsystems"}ngOnInit(){this.createForm(),this.action=this.actionLabels.ADD,this.route.params.subscribe(t=>{this.subsystemNQN=t.subsystem_nqn})}createForm(){this.initiatorForm=new A.d({allowAnyHost:new a.p4(!1),addHost:new A.d({addHostCheck:new a.p4(!1),addedHosts:this.formBuilder.array([],[v.hq.custom("duplicate",t=>!!t.length&&new Set(t)?.size!==t.length)])})})}get addedHosts(){return this.initiatorForm.get("addHost.addedHosts")}addHost(){let t;t=this.formBuilder.control("",[this.customNQNValidator,a.kI.required]),this.addedHosts.push(t)}removeHost(t){this.addedHosts.removeAt(t)}setAddHostCheck(){if(this.initiatorForm.get("addHost.addHostCheck").value)this.addHost();else for(;0!==this.addedHosts.length;)this.addedHosts.removeAt(0)}onSubmit(){const t=this,o=this.initiatorForm.getValue("allowAnyHost"),i=this.addedHosts.value;let _=`nvmeof/initiator/${E.MQ.ADD}`;const r={host_nqn:i.join(",")};o&&(i.push("*"),r.host_nqn=i.join(",")),this.taskWrapperService.wrapTaskAroundCall({task:new N.R(_,{nqn:this.subsystemNQN}),call:this.nvmeofService.addInitiators(this.subsystemNQN,r)}).subscribe({error(){t.initiatorForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.router.navigate([this.pageURL,{outlets:{modal:null}}])}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(k.j),e.Y36(E.p4),e.Y36(Ce),e.Y36(G.P),e.Y36(p.F0),e.Y36(p.gz),e.Y36(ot.O))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cd-nvmeof-initiators-form"]],decls:31,vars:16,consts:function(){let s,t,o,i,_,r,l,d,u,f;return s="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",t="Hosts ",o="Add host",i="Allow specific hosts to run NVMe/TCP commands to the NVMe subsystem.",_="Allow any host",r="Add host nqn",l="This field is required.",d="Expected NQN format" + "[\ufffd#2\ufffd\ufffd/#2\ufffd|\ufffd#4\ufffd\ufffd/#4\ufffd]" + "<" + "[\ufffd#3\ufffd|\ufffd#5\ufffd]" + "nqn.$year-$month.$reverseDomainName:$utf8-string" + "[\ufffd/#3\ufffd|\ufffd/#5\ufffd]" + "\".> or " + "[\ufffd#2\ufffd\ufffd/#2\ufffd|\ufffd#4\ufffd\ufffd/#4\ufffd]" + "<" + "[\ufffd#3\ufffd|\ufffd#5\ufffd]" + "nqn.2014-08.org.nvmexpress:uuid:$UUID-string" + "[\ufffd/#3\ufffd|\ufffd/#5\ufffd]" + "\".>",d=e.Zx4(d),u="An NQN may not be more than 223 bytes in length.",f="Duplicate entry detected. Enter a unique value.",[[3,"pageURL"],[1,"modal-title"],s,[1,"modal-content"],["name","initiatorForm","novalidate","",3,"formGroup"],["formDir","ngForm"],[1,"modal-body"],[1,"form-group","row"],[1,"cd-col-form-label","required"],t,[1,"cd-col-form-input"],["formGroupName","addHost",1,"custom-control","custom-checkbox"],["type","checkbox","id","addHostCheck","name","addHostCheck","formControlName","addHostCheck",1,"custom-control-input",3,"change"],["for","addHostCheck",1,"custom-control-label","mb-0"],o,i,["formArrayName","addedHosts",4,"ngIf"],[1,"custom-control","custom-checkbox","pt-0"],["type","checkbox","id","allowAnyHost","name","allowAnyHost","formControlName","allowAnyHost",1,"custom-control-input"],["for","allowAnyHost",1,"custom-control-label"],_,["type","warning",3,"showTitle",4,"ngIf"],[1,"modal-footer"],[1,"text-right"],[3,"form","submitText","submitActionEvent"],["formArrayName","addedHosts"],["class","input-group cd-mb my-1",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],[1,"input-group","cd-mb","my-1"],["type","text","placeholder",r,1,"cd-form-control",3,"required","formControlName"],["type","button",1,"btn","btn-light",3,"id","disabled","click"],[1,"fa","fa-plus"],[1,"fa","fa-trash-o"],[4,"ngIf"],[1,"invalid-feedback"],l,d,u,f,["type","warning",3,"showTitle"]]},template:function(t,o){1&t&&(e.TgZ(0,"cd-modal",0)(1,"span",1),e.SDv(2,2),e.ALo(3,"titlecase"),e.ALo(4,"upperFirst"),e.qZA(),e.ynx(5,3),e.TgZ(6,"form",4,5)(8,"div",6)(9,"div",7)(10,"label",8),e.SDv(11,9),e.qZA(),e.TgZ(12,"div",10)(13,"div",11)(14,"input",12),e.NdJ("change",function(){return o.setAddHostCheck()}),e.qZA(),e.TgZ(15,"label",13),e.SDv(16,14),e.qZA(),e.TgZ(17,"cd-help-text")(18,"span"),e.SDv(19,15),e.qZA()(),e.YNc(20,yl,3,2,"div",16),e.qZA(),e.TgZ(21,"div",17),e._UZ(22,"input",18),e.TgZ(23,"label",19),e.SDv(24,20),e.qZA(),e.YNc(25,xl,2,1,"cd-alert-panel",21),e.qZA()()()(),e.TgZ(26,"div",22)(27,"div",23)(28,"cd-form-button-panel",24),e.NdJ("submitActionEvent",function(){return o.onSubmit()}),e.ALo(29,"titlecase"),e.ALo(30,"upperFirst"),e.qZA()()()(),e.BQk(),e.qZA()),2&t&&(e.Q6J("pageURL",o.pageURL),e.xp6(4),e.pQV(e.lcZ(3,8,o.action))(e.lcZ(4,10,o.resource)),e.QtT(2),e.xp6(2),e.Q6J("formGroup",o.initiatorForm),e.xp6(14),e.Q6J("ngIf",o.initiatorForm.get("addHost.addHostCheck").value),e.xp6(5),e.Q6J("ngIf",o.initiatorForm.getValue("allowAnyHost")),e.xp6(3),e.Q6J("form",o.initiatorForm)("submitText",e.lcZ(29,12,o.action)+" "+e.lcZ(30,14,o.resource)))},dependencies:[c.sg,c.O5,a._Y,a.Fj,a.Wl,a.JJ,a.JL,a.Q7,a.sg,a.u,a.x0,a.CE,Y.z,Ze.G,R.p,me.t,L.o,g.b,T.P,b.V,c.rS,Fe.m]}),n})(),Qt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[c.ez,ui,a.u5,a.UX,P.Oz,P.dT,P.HK,Ie.b,_e.m,p.Bz,se.xc]}),n})();const wl=[{path:"",redirectTo:"rbd",pathMatch:"full"},{path:"rbd",canActivate:[q.T,U.P],data:{moduleStatusGuardConfig:{uiApiPath:"block/rbd",redirectTo:"error",header:"Block Pool is not configured",button_name:"Configure Default pool",button_route:"/pool/create",component:"Default Pool",uiConfig:!0},breadcrumbs:"Images"},children:[{path:"",component:nr},{path:"namespaces",component:ur,data:{breadcrumbs:"Namespaces"}},{path:"trash",component:Lr,data:{breadcrumbs:"Trash"}},{path:"performance",component:gr,data:{breadcrumbs:"Overall Performance"}},{path:E.MQ.CREATE,component:He,data:{breadcrumbs:E.Qn.CREATE}},{path:`${E.MQ.EDIT}/:image_spec`,component:He,data:{breadcrumbs:E.Qn.EDIT}},{path:`${E.MQ.CLONE}/:image_spec/:snap`,component:He,data:{breadcrumbs:E.Qn.CLONE}},{path:`${E.MQ.COPY}/:image_spec`,component:He,data:{breadcrumbs:E.Qn.COPY}},{path:`${E.MQ.COPY}/:image_spec/:snap`,component:He,data:{breadcrumbs:E.Qn.COPY}}]},{path:"mirroring",component:gs,canActivate:[q.T,U.P],data:{moduleStatusGuardConfig:{uiApiPath:"block/mirroring",redirectTo:"error",header:"Block Mirroring is not configured",button_name:"Configure Block Mirroring",button_title:"This will create \"rbd-mirror\" service and a replicated Block pool",component:"Block Mirroring",uiConfig:!0},breadcrumbs:"Mirroring"},children:[{path:`${E.MQ.EDIT}/:pool_name`,component:Cs,outlet:"modal"}]},{path:"iscsi",canActivate:[q.T],data:{breadcrumbs:"iSCSI"},children:[{path:"",redirectTo:"overview",pathMatch:"full"},{path:"overview",component:pi,data:{breadcrumbs:"Overview"}},{path:"targets",data:{breadcrumbs:"Targets"},children:[{path:"",component:jn},{path:E.MQ.CREATE,component:Ot,data:{breadcrumbs:E.Qn.CREATE}},{path:`${E.MQ.EDIT}/:target_iqn`,component:Ot,data:{breadcrumbs:E.Qn.EDIT}}]}]},{path:"nvmeof",canActivate:[U.P],data:{breadcrumbs:!0,text:"NVMe/TCP",path:"nvmeof",disableSplit:!0,moduleStatusGuardConfig:{uiApiPath:"nvmeof",redirectTo:"error",header:"NVMe/TCP Gateway not configured",button_name:"Configure NVMe/TCP",button_route:["/services",{outlets:{modal:["create","nvmeof"]}}],uiConfig:!1}},children:[{path:"",redirectTo:"subsystems",pathMatch:"full"},{path:"subsystems",component:kt,data:{breadcrumbs:"Subsystems"},children:[{path:"",component:kt},{path:E.MQ.CREATE,component:al,outlet:"modal"},{path:`${E.MQ.CREATE}/:subsystem_nqn/listener`,component:fl,outlet:"modal"},{path:`${E.MQ.CREATE}/:subsystem_nqn/namespace`,component:Vt,outlet:"modal"},{path:`${E.MQ.EDIT}/:subsystem_nqn/namespace/:nsid`,component:Vt,outlet:"modal"},{path:`${E.MQ.ADD}/:subsystem_nqn/initiator`,component:Zl,outlet:"modal"}]},{path:"gateways",component:Br,data:{breadcrumbs:"Gateways"}}]}];let Hl=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[Qt,p.Bz.forChild(wl)]}),n})()},60950:(st,Ee,m)=>{m.d(Ee,{d:()=>Y});var c=m(64537),a=m(20092),p=m(23815),se=m.n(p),P=m(7357),Ie=m(65862),E=m(95463),q=m(30633),U=m(28211),_e=m(34089),W=m(88692),S=m(18372),ge=m(20044);let Q=(()=>{class R{constructor(g,T,b,y){this.elementRef=g,this.control=T,this.dimlessBinaryPerSecondPipe=b,this.formatter=y,this.ngModelChange=new c.vpe,this.el=this.elementRef.nativeElement}ngOnInit(){this.setValue(this.el.value),this.ngDataReady&&this.ngDataReady.subscribe(()=>this.setValue(this.el.value))}setValue(g){/^[\d.]+$/.test(g)&&(g+=this.defaultUnit||"m");const T=this.formatter.toBytes(g,0),b=this.round(T);this.el.value=this.dimlessBinaryPerSecondPipe.transform(b),null!==T?(this.ngModelChange.emit(this.el.value),this.control.control.setValue(this.el.value)):(this.ngModelChange.emit(null),this.control.control.setValue(null))}round(g){if(null!==g&&0!==g){if(!se().isUndefined(this.minBytes)&&g<this.minBytes)return this.minBytes;if(!se().isUndefined(this.maxBytes)&&g>this.maxBytes)return this.maxBytes;if(!se().isUndefined(this.roundPower)){const T=Math.round(Math.log(g)/Math.log(this.roundPower));return Math.pow(this.roundPower,T)}}return g}onBlur(g){this.setValue(g)}}return R.\u0275fac=function(g){return new(g||R)(c.Y36(c.SBq),c.Y36(a.a5),c.Y36(ge.O),c.Y36(U.H))},R.\u0275dir=c.lG2({type:R,selectors:[["","cdDimlessBinaryPerSecond",""]],hostBindings:function(g,T){1&g&&c.NdJ("blur",function(y){return T.onBlur(y.target.value)})},inputs:{ngDataReady:"ngDataReady",minBytes:"minBytes",maxBytes:"maxBytes",roundPower:"roundPower",defaultUnit:"defaultUnit"},outputs:{ngModelChange:"ngModelChange"}}),R})(),Te=(()=>{class R{constructor(g,T){this.control=g,this.formatter=T}setValue(g){const T=this.formatter.toMilliseconds(g);this.control.control.setValue(`${T} ms`)}ngOnInit(){this.setValue(this.control.value),this.ngDataReady&&this.ngDataReady.subscribe(()=>this.setValue(this.control.value))}onUpdate(g){this.setValue(g)}}return R.\u0275fac=function(g){return new(g||R)(c.Y36(a.a5),c.Y36(U.H))},R.\u0275dir=c.lG2({type:R,selectors:[["","cdMilliseconds",""]],hostBindings:function(g,T){1&g&&c.NdJ("blur",function(y){return T.onUpdate(y.target.value)})},inputs:{ngDataReady:"ngDataReady"}}),R})(),fe=(()=>{class R{constructor(g,T){this.formatter=g,this.ngControl=T}setValue(g){const T=this.formatter.toIops(g);this.ngControl.control.setValue(`${T} IOPS`)}ngOnInit(){this.setValue(this.ngControl.value),this.ngDataReady&&this.ngDataReady.subscribe(()=>this.setValue(this.ngControl.value))}onUpdate(g){this.setValue(g)}}return R.\u0275fac=function(g){return new(g||R)(c.Y36(U.H),c.Y36(a.a5))},R.\u0275dir=c.lG2({type:R,selectors:[["","cdIops",""]],hostBindings:function(g,T){1&g&&c.NdJ("blur",function(y){return T.onUpdate(y.target.value)})},inputs:{ngDataReady:"ngDataReady"}}),R})();var e=m(87925),J=m(94276),j=m(56310),Me=m(41582);function ee(R,L){if(1&R&&(c.ynx(0),c._UZ(1,"input",17),c.BQk()),2&R){const g=c.oxw().$implicit,T=c.oxw(2);c.xp6(1),c.Q6J("id",g.name)("name",g.name)("formControlName",g.name)("ngDataReady",T.ngDataReady)}}function C(R,L){if(1&R&&(c.ynx(0),c._UZ(1,"input",18),c.BQk()),2&R){const g=c.oxw().$implicit,T=c.oxw(2);c.xp6(1),c.Q6J("id",g.name)("name",g.name)("formControlName",g.name)("ngDataReady",T.ngDataReady)}}function $e(R,L){if(1&R&&(c.ynx(0),c._UZ(1,"input",19),c.BQk()),2&R){const g=c.oxw().$implicit,T=c.oxw(2);c.xp6(1),c.Q6J("id",g.name)("name",g.name)("formControlName",g.name)("ngDataReady",T.ngDataReady)}}function A(R,L){1&R&&(c.TgZ(0,"span",20),c.SDv(1,21),c.qZA())}const v=function(R){return{active:R}},$=function(R){return[R]};function N(R,L){if(1&R){const g=c.EpF();c.TgZ(0,"div",10)(1,"label",11),c._uU(2),c.TgZ(3,"cd-helper"),c._uU(4),c.qZA()(),c.TgZ(5,"div")(6,"div",12),c.ynx(7,13),c.YNc(8,ee,2,4,"ng-container",14),c.YNc(9,C,2,4,"ng-container",14),c.YNc(10,$e,2,4,"ng-container",14),c.BQk(),c.TgZ(11,"button",15),c.NdJ("click",function(){const y=c.CHM(g).$implicit,K=c.oxw(2);return c.KtG(K.reset(y.name))}),c._UZ(12,"i",7),c.qZA()(),c.YNc(13,A,2,0,"span",16),c.qZA()()}if(2&R){const g=L.$implicit,T=c.oxw().$implicit,b=c.oxw(),y=c.MAs(1);c.xp6(1),c.Q6J("for",g.name),c.xp6(1),c.Oqu(g.displayName),c.xp6(2),c.Oqu(g.description),c.xp6(1),c.Gre("cd-col-form-input ",T.heading,""),c.xp6(2),c.Q6J("ngSwitch",g.type),c.xp6(1),c.Q6J("ngSwitchCase",b.configurationType.milliseconds),c.xp6(1),c.Q6J("ngSwitchCase",b.configurationType.bps),c.xp6(1),c.Q6J("ngSwitchCase",b.configurationType.iops),c.xp6(1),c.Q6J("ngClass",c.VKq(13,v,b.isDisabled(g.name))),c.xp6(1),c.Q6J("ngClass",c.VKq(15,$,b.icons.erase)),c.xp6(1),c.Q6J("ngIf",b.form.showError("configuration."+g.name,y,"min"))}}function G(R,L){if(1&R){const g=c.EpF();c.TgZ(0,"div",4)(1,"h5",5)(2,"span",6),c.NdJ("click",function(){const y=c.CHM(g).$implicit,K=c.oxw();return c.KtG(K.toggleSectionVisibility(y.class))}),c._uU(3),c._UZ(4,"i",7),c.qZA()(),c.TgZ(5,"div",8),c.YNc(6,N,14,17,"div",9),c.qZA()()}if(2&R){const g=L.$implicit,T=c.oxw();c.xp6(3),c.hij(" ",g.heading," "),c.xp6(1),c.Q6J("ngClass",T.sectionVisibility[g.class]?T.icons.minusCircle:T.icons.addCircle),c.xp6(1),c.Tol(g.class),c.Q6J("hidden",!T.sectionVisibility[g.class]),c.xp6(1),c.Q6J("ngForOf",g.options)}}let Y=(()=>{class R{constructor(g,T){this.formatterService=g,this.rbdConfigurationService=T,this.initializeData=new P.t(1),this.changes=new c.vpe,this.icons=Ie.P,this.ngDataReady=new c.vpe,this.configurationType=q.r,this.sectionVisibility={}}ngOnInit(){const g=this.createConfigurationFormGroup();this.form.addControl("configuration",g),g.valueChanges.subscribe(()=>{this.changes.emit(this.getDirtyValues.bind(this))}),this.initializeData&&this.initializeData.subscribe(T=>{this.initialData=T.initialData;const b=T.sourceType;this.rbdConfigurationService.getWritableOptionFields().forEach(y=>{const K=T.initialData.filter(ye=>ye.name===y.name).pop();K&&K.source===b&&this.form.get(`configuration.${y.name}`).setValue(K.value)}),this.ngDataReady.emit()}),this.rbdConfigurationService.getWritableSections().forEach(T=>this.sectionVisibility[T.class]=!0)}getDirtyValues(g=!1,T){if(g&&!T)throw new Error("ProgrammingError: If local values shall be included, a proper localFieldType argument has to be provided, too");const b={};return this.rbdConfigurationService.getWritableOptionFields().forEach(y=>{const K=this.form.get("configuration").get(y.name);this.initialData&&this.initialData[y.name]===K.value||(K.dirty||g&&K.source===T)&&(b[y.name]=null===K.value?K.value:y.type===q.r.bps?this.formatterService.toBytes(K.value):y.type===q.r.milliseconds?this.formatterService.toMilliseconds(K.value):y.type===q.r.iops?this.formatterService.toIops(K.value):K.value)}),b}createConfigurationFormGroup(){const g=new E.d({});return this.rbdConfigurationService.getWritableOptionFields().forEach(T=>{let b;if(T.type!==q.r.milliseconds&&T.type!==q.r.iops&&T.type!==q.r.bps)throw new Error(`Type ${T.type} is unknown, you may need to add it to RbdConfiguration class`);{let y=0;se().forEach(this.initialData,K=>{K.name===T.name&&(y=K.value)}),b=new a.p4(y,a.kI.min(0))}g.addControl(T.name,b)}),g}reset(g){const T=this.form.get("configuration").get(g);T.disabled?(T.setValue(T.previousValue||0),T.enable(),T.previousValue||T.markAsPristine()):(T.previousValue=T.value,T.setValue(null),T.markAsDirty(),T.disable())}isDisabled(g){return this.form.get("configuration").get(g).disabled}toggleSectionVisibility(g){this.sectionVisibility[g]=!this.sectionVisibility[g]}}return R.\u0275fac=function(g){return new(g||R)(c.Y36(U.H),c.Y36(_e.n))},R.\u0275cmp=c.Xpm({type:R,selectors:[["cd-rbd-configuration-form"]],inputs:{form:"form",initializeData:"initializeData"},outputs:{changes:"changes"},decls:5,vars:2,consts:function(){let L,g,T;return L="RBD \uC124\uC815\uB4E4",g="\uB85C\uCEEC \uAD6C\uC131 \uAC12\uC744 \uC81C\uAC70\uD558\uC2ED\uC2DC\uC624. \uC0C1\uC704 \uAD6C\uC131 \uAC12\uC740 \uACC4\uC2B9\uB418\uACE0 \uB300\uC2E0 \uC0AC\uC6A9\uB429\uB2C8\uB2E4.",T="The minimum value is 0",[[3,"formGroup"],["cfgFormGroup",""],L,["class","col-12",4,"ngFor","ngForOf"],[1,"col-12"],[1,"cd-header"],[1,"collapsible",3,"click"],["aria-hidden","true",3,"ngClass"],[3,"hidden"],["class","form-group row",4,"ngFor","ngForOf"],[1,"form-group","row"],[1,"cd-col-form-label",3,"for"],[1,"input-group"],[3,"ngSwitch"],[4,"ngSwitchCase"],["type","button","data-toggle","button","title",g,1,"btn","btn-light",3,"ngClass","click"],["class","invalid-feedback",4,"ngIf"],["type","text","cdMilliseconds","",1,"form-control",3,"id","name","formControlName","ngDataReady"],["type","text","defaultUnit","b","cdDimlessBinaryPerSecond","",1,"form-control",3,"id","name","formControlName","ngDataReady"],["type","text","cdIops","",1,"form-control",3,"id","name","formControlName","ngDataReady"],[1,"invalid-feedback"],T]},template:function(g,T){1&g&&(c.TgZ(0,"fieldset",0,1)(2,"legend"),c.SDv(3,2),c.qZA(),c.YNc(4,G,7,7,"div",3),c.qZA()),2&g&&(c.Q6J("formGroup",T.form.get("configuration")),c.xp6(4),c.Q6J("ngForOf",T.rbdConfigurationService.sections))},dependencies:[W.mk,W.sg,W.O5,W.RF,W.n9,a.Fj,a.JJ,a.JL,a.sg,a.u,S.S,Q,Te,fe,e.o,J.b,j.P,Me.V],styles:[".collapsible[_ngcontent-%COMP%]{cursor:pointer;user-select:none}"]}),R})()},42176:(st,Ee,m)=>{m.d(Ee,{P:()=>$e});var c=m(83697),a=m(30633),p=m(64537);let se=(()=>{class A{transform($){return{0:"global",1:"pool",2:"image"}[$]}}return A.\u0275fac=function($){return new($||A)},A.\u0275pipe=p.Yjl({name:"rbdConfigurationSource",type:A,pure:!0}),A})();var P=m(28211),Ie=m(34089),E=m(88692),q=m(20044),U=m(48537),_e=m(21766);const W=["configurationSourceTpl"],S=["configurationValueTpl"],ge=["poolConfTable"];function Q(A,v){1&A&&(p.TgZ(0,"span"),p.SDv(1,6),p.qZA())}function Te(A,v){1&A&&(p.TgZ(0,"strong"),p.SDv(1,7),p.qZA())}function fe(A,v){1&A&&(p.TgZ(0,"strong"),p.SDv(1,8),p.qZA())}function e(A,v){1&A&&(p.TgZ(0,"div",4),p.YNc(1,Q,2,0,"span",5),p.YNc(2,Te,2,0,"strong",5),p.YNc(3,fe,2,0,"strong",5),p.qZA()),2&A&&(p.Q6J("ngSwitch",v.value),p.xp6(1),p.Q6J("ngSwitchCase","global"),p.xp6(1),p.Q6J("ngSwitchCase","image"),p.xp6(1),p.Q6J("ngSwitchCase","pool"))}function J(A,v){if(1&A&&(p.TgZ(0,"span"),p._uU(1),p.ALo(2,"dimlessBinaryPerSecond"),p.qZA()),2&A){const $=p.oxw().value;p.xp6(1),p.Oqu(p.lcZ(2,1,$))}}function j(A,v){if(1&A&&(p.TgZ(0,"span"),p._uU(1),p.ALo(2,"milliseconds"),p.qZA()),2&A){const $=p.oxw().value;p.xp6(1),p.Oqu(p.lcZ(2,1,$))}}function Me(A,v){if(1&A&&(p.TgZ(0,"span"),p._uU(1),p.ALo(2,"iops"),p.qZA()),2&A){const $=p.oxw().value;p.xp6(1),p.Oqu(p.lcZ(2,1,$))}}function ee(A,v){if(1&A&&(p.TgZ(0,"span"),p._uU(1),p.qZA()),2&A){const $=p.oxw().value;p.xp6(1),p.Oqu($)}}function C(A,v){if(1&A&&(p.TgZ(0,"div",4),p.YNc(1,J,3,3,"span",5),p.YNc(2,j,3,3,"span",5),p.YNc(3,Me,3,3,"span",5),p.YNc(4,ee,2,1,"span",9),p.qZA()),2&A){const $=v.row,N=p.oxw();p.Q6J("ngSwitch",$.type),p.xp6(1),p.Q6J("ngSwitchCase",N.typeField.bps),p.xp6(1),p.Q6J("ngSwitchCase",N.typeField.milliseconds),p.xp6(1),p.Q6J("ngSwitchCase",N.typeField.iops)}}let $e=(()=>{class A{constructor($,N){this.formatterService=$,this.rbdConfigurationService=N,this.sourceField=a.h,this.typeField=a.r}ngOnInit(){this.poolConfigurationColumns=[{prop:"displayName",name:"Name"},{prop:"description",name:"Description"},{prop:"name",name:"Key"},{prop:"source",name:"Source",cellTemplate:this.configurationSourceTpl,pipe:new se},{prop:"value",name:"Value",cellTemplate:this.configurationValueTpl}]}ngOnChanges(){this.data&&(this.data=this.data.filter($=>this.rbdConfigurationService.getOptionFields().map(N=>N.name).includes($.name)))}}return A.\u0275fac=function($){return new($||A)(p.Y36(P.H),p.Y36(Ie.n))},A.\u0275cmp=p.Xpm({type:A,selectors:[["cd-rbd-configuration-table"]],viewQuery:function($,N){if(1&$&&(p.Gf(W,7),p.Gf(S,7),p.Gf(ge,7)),2&$){let G;p.iGM(G=p.CRH())&&(N.configurationSourceTpl=G.first),p.iGM(G=p.CRH())&&(N.configurationValueTpl=G.first),p.iGM(G=p.CRH())&&(N.poolConfTable=G.first)}},inputs:{data:"data"},features:[p.TTD],decls:6,vars:2,consts:function(){let v,$,N;return v="\uAE00\uB85C\uBC8C",$="Image",N="Pool",[["identifier","name",3,"data","columns"],["poolConfTable",""],["configurationSourceTpl",""],["configurationValueTpl",""],[3,"ngSwitch"],[4,"ngSwitchCase"],v,$,N,[4,"ngSwitchDefault"]]},template:function($,N){1&$&&(p._UZ(0,"cd-table",0,1),p.YNc(2,e,4,4,"ng-template",null,2,p.W1O),p.YNc(4,C,5,4,"ng-template",null,3,p.W1O)),2&$&&p.Q6J("data",N.data)("columns",N.poolConfigurationColumns)},dependencies:[E.RF,E.n9,E.ED,c.a,q.O,U.J,_e.A]}),A})()},1372:(st,Ee,m)=>{m.d(Ee,{B:()=>E});var c=m(64537),a=m(88692),p=m(87925);const se=function(q){return{collapsed:q}},P=function(q){return{show:q}},Ie=["*"];let E=(()=>{class q{constructor(){this.showAdvanced=!1}}return q.\u0275fac=function(_e){return new(_e||q)},q.\u0275cmp=c.Xpm({type:q,selectors:[["cd-form-advanced-fieldset"]],ngContentSelectors:Ie,decls:9,vars:6,consts:function(){let U;return U="Advanced ",[[1,"cd-header"],[1,"accordion","accordion-flush"],["type","button","id","advanced-fieldset","aria-label","toggle advanced mode",1,"accordion-button","cd-form-advanced-fieldset-buttton","p-0",3,"ngClass","click"],U,[1,"accordion-collapse","collapse",3,"ngClass"],[1,"accordion-body"],[1,"card-body"]]},template:function(_e,W){1&_e&&(c.F$t(),c.TgZ(0,"fieldset")(1,"legend",0)(2,"div",1)(3,"button",2),c.NdJ("click",function(){return W.showAdvanced=!W.showAdvanced}),c.SDv(4,3),c.qZA()()(),c.TgZ(5,"div",4)(6,"div",5)(7,"div",6),c.Hsn(8),c.qZA()()()()),2&_e&&(c.xp6(3),c.Q6J("ngClass",c.VKq(2,se,!W.showAdvanced)),c.xp6(2),c.Q6J("ngClass",c.VKq(4,P,W.showAdvanced)))},dependencies:[a.mk,p.o],styles:[".cd-form-advanced-fieldset-buttton[_ngcontent-%COMP%]{--bs-accordion-btn-active-icon: var(--bs-accordion-btn-icon);background-color:inherit;border:hidden;border-color:inherit;box-shadow:none;color:inherit;font-size:inherit;outline:0;text-decoration:none}"]}),q})()}}]);