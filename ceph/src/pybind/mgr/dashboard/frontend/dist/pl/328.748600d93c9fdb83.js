"use strict";(self.webpackChunkceph_dashboard=self.webpackChunkceph_dashboard||[]).push([[328],{5328:(ii,ye,r)=>{r.r(ye),r.d(ye,{PoolModule:()=>We,RoutedPoolModule:()=>ni});var g=r(56610),l=r(37222),pe=r(19102),E=r(95819),h=r(54372),Fo=r(93887),To=r(40626),No=r(26481),bo=r(36651),P=r.n(bo),Ao=r(40598),$o=r(5155),ge=r(59870);class Io{name;plugin;k;m;c;l;d;packetsize;technique;scalar_mds;"crush-root";"crush-locality";"crush-failure-domain";"crush-num-failure-domains";"crush-osds-per-failure-domain";"crush-device-class";directory}var Ce=function(_){return _.Osd="osd",_.Host="host",_}(Ce||{});class T{nodes=[];idTree={};allDevices=[];controls;buckets=[];failureDomains={};failureDomainKeys=[];devices=[];deviceCount=0;autoDeviceUpdate=!0;static searchFailureDomains(i,o){return this.getFailureDomains(this.search(i,o))}static search(i,o){const[t,n]=o.split("~"),s=i.find(c=>["name","id","type"].some(d=>c[d]===t));return s?(i=this.getSubNodes(s,this.createIdTreeFromNodes(i)),n&&(i=this.filterNodesByDeviceType(i,n)),i):[]}static createIdTreeFromNodes(i){const o={};return i.forEach(t=>{o[t.id]=t}),o}static getSubNodes(i,o){let t=[i];return i.children&&i.children.forEach(n=>{t=t.concat(this.getSubNodes(o[n],o))}),t}static filterNodesByDeviceType(i,o){let n,t=i.filter(c=>c.device_class&&c.device_class!==o).map(c=>c.id),s=t;do{n=!1,i=i.filter(d=>!t.includes(d.id));const c=[];i.forEach(d=>{d.children&&d.children.every(f=>t.includes(f))&&(c.push(d.id),n=!0)}),n&&(t=c,s=s.concat(c))}while(n);return(i=P().cloneDeep(i)).map(c=>(c.children&&(c.children=c.children.filter(d=>!s.includes(d))),c))}static getFailureDomains(i){const o={};return i.forEach(t=>{const n=t.type;o[n]||(o[n]=[]),o[n].push(t)}),o}initCrushNodeSelection(i,o,t,n,s=!0){this.autoDeviceUpdate=s,this.nodes=i,this.idTree=T.createIdTreeFromNodes(i),i.forEach(c=>{this.idTree[c.id]=c}),this.buckets=P().sortBy(i.filter(c=>c.children),"name"),this.controls={root:o,failure:t,device:n},this.preSelectRoot(),this.controls.root.valueChanges.subscribe(()=>this.onRootChange()),this.controls.failure.valueChanges.subscribe(()=>this.onFailureDomainChange()),this.controls.device.valueChanges.subscribe(()=>this.onDeviceChange())}preSelectRoot(){const i=this.nodes.find(o=>"root"===o.type);this.silentSet(this.controls.root,i),this.onRootChange()}silentSet(i,o){i.setValue(o,{emitEvent:!1})}onRootChange(){const i=T.getSubNodes(this.controls.root.value,this.idTree),o=T.getFailureDomains(i);Object.keys(o).forEach(t=>{o[t].length<=1&&delete o[t]}),this.failureDomains=o,this.failureDomainKeys=Object.keys(o).sort(),this.updateFailureDomain()}updateFailureDomain(){let i=this.getIncludedCustomValue(this.controls.failure,Object.keys(this.failureDomains));""===i&&(i=this.setMostCommonDomain(this.controls.failure)),this.updateDevices(i)}getIncludedCustomValue(i,o){return i.dirty&&o.includes(i.value)?i.value:""}setMostCommonDomain(i){let o={n:0,type:""};return Object.keys(this.failureDomains).forEach(t=>{const n=this.failureDomains[t].length;o.n<n&&(o={n,type:t})}),this.silentSet(i,o.type),o.type}onFailureDomainChange(){this.updateDevices()}updateDevices(i=this.controls.failure.value){if(i===Ce.Host)this.allDevices=this.failureDomains[i].filter(o=>o.type).map(o=>o.type),this.onDeviceChange("");else{const o=P().flatten(this.failureDomains[i].map(n=>T.getSubNodes(n,this.idTree)));this.allDevices=o.filter(n=>n.device_class).map(n=>n.device_class),this.devices=P().uniq(this.allDevices).sort();const t=1===this.devices.length?this.devices[0]:this.getIncludedCustomValue(this.controls.device,this.devices);this.autoDeviceUpdate&&this.silentSet(this.controls.device,t),this.onDeviceChange(t)}}onDeviceChange(i=this.controls.device.value){this.deviceCount=""===i?this.allDevices.length:this.allDevices.filter(o=>o===i).length}}var Ue=r(84821),vo=r(31345),I=r(46045),Do=r(74902),ke=r(58384),u=r(3687),Go=r(6107),v=r(85481),Xo=r(73651),yo=r(12540),Me=r(50813),e=r(23279),xe=r(43808),He=r(17612),he=r(39403),ze=r(69081),Le=r(59781),Se=r(64333),Fe=r(23603),Te=r(90476),Ne=r(10142),be=r(78708),Ae=r(37966),$e=r(37353);function Uo(_,i){1&_&&(e.j41(0,"span",38),e.pXf(1,8),e.k0s())}function ko(_,i){1&_&&(e.j41(0,"span",38),e.pXf(1,9),e.k0s())}function xo(_,i){1&_&&(e.j41(0,"span",38),e.pXf(1,10),e.k0s())}function Ho(_,i){1&_&&(e.j41(0,"option",35),e.pXf(1,11),e.k0s())}function zo(_,i){if(1&_&&(e.j41(0,"option",39),e.EFF(1),e.k0s()),2&_){const o=i.$implicit;e.Y8G("ngValue",o),e.R7$(),e.SpI(" ",o.name," ")}}function jo(_,i){1&_&&(e.j41(0,"span",38),e.pXf(1,12),e.k0s())}function Vo(_,i){1&_&&(e.j41(0,"option",35),e.pXf(1,13),e.k0s())}function wo(_,i){if(1&_&&(e.j41(0,"option",39),e.EFF(1),e.k0s()),2&_){const o=i.$implicit,t=e.XpG();e.Y8G("ngValue",o),e.R7$(),e.Lme(" ",o," ( ",t.failureDomains[o].length," ) ")}}function Yo(_,i){1&_&&(e.j41(0,"span",38),e.pXf(1,14),e.k0s())}function Bo(_,i){if(1&_&&(e.j41(0,"option",39),e.EFF(1),e.k0s()),2&_){const o=i.$implicit;e.Y8G("ngValue",o),e.R7$(),e.SpI(" ",o," ")}}let qo=(()=>{class _ extends T{formBuilder;activeModal;taskWrapper;crushRuleService;actionLabels;submitAction=new e.bkB;tooltips;form;names;action;resource;constructor(o,t,n,s,c){super(),this.formBuilder=o,this.activeModal=t,this.taskWrapper=n,this.crushRuleService=s,this.actionLabels=c,this.action=this.actionLabels.CREATE,this.resource="Crush Rule",this.createForm()}createForm(){this.form=this.formBuilder.group({name:["",[l.k0.required,l.k0.pattern("[A-Za-z0-9_-]+"),u.xQ.custom("uniqueName",o=>this.names&&-1!==this.names.indexOf(o))]],root:null,failure_domain:"",device_class:""})}ngOnInit(){this.tooltips=this.crushRuleService.formTooltips,this.crushRuleService.getInfo().subscribe(({names:o,nodes:t})=>{this.initCrushNodeSelection(t,this.form.get("root"),this.form.get("failure_domain"),this.form.get("device_class"),!1),this.names=o})}onSubmit(){if(this.form.invalid)return void this.form.setErrors({cdSubmitButton:!0});const o=P().cloneDeep(this.form.value);o.root=o.root.name,""===o.device_class&&delete o.device_class,this.taskWrapper.wrapTaskAroundCall({task:new v.O("crushRule/create",o),call:this.crushRuleService.create(o)}).subscribe({error:()=>{this.form.setErrors({cdSubmitButton:!0})},complete:()=>{this.activeModal.close(),this.submitAction.emit(o)}})}static \u0275fac=function(t){return new(t||_)(e.rXU(xe.$),e.rXU(E.Lw),e.rXU(Me.a),e.rXU(He.j),e.rXU(h.Ss))};static \u0275cmp=e.VBU({type:_,selectors:[["cd-crush-rule-form-modal"]],outputs:{submitAction:"submitAction"},features:[e.Vt3],decls:57,vars:27,consts:()=>{let o,t,n,s,c,d,f,R,p,L,S,C,M,F;return o="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",t="Nazwa",n="Root",s="Failure domain type",c="Device class",d="All devices",f="" + "\ufffd0\ufffd" + "",R="To pole jest wymagane.",p="Nazwa mo\u017Ce sk\u0142ada\u0107 si\u0119 z alfanumerycznych znak\xF3w, kresek i podkre\u015Ble\u0144.",L="Wybrana nazwa profilu kodu kasowania jest ju\u017C u\u017Cywana.",S="\u0141adowanie...",C="To pole jest wymagane.",M="\u0141adowanie...",F="To pole jest wymagane.",[["frm","ngForm"],o,t,n,s,c,d,f,R,p,L,S,C,M,F,[3,"modalRef"],[1,"modal-title"],[1,"modal-content"],["novalidate","",3,"formGroup"],[1,"modal-body"],[1,"form-group","row"],["for","name",1,"cd-col-form-label"],[1,"required"],[1,"cd-col-form-input"],["type","text","id","name","name","name","placeholder","Name...","formControlName","name","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","root",1,"cd-col-form-label"],[3,"html"],["id","root","name","root","formControlName","root",1,"form-select"],["ngValue","",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],["for","failure_domain",1,"cd-col-form-label"],["id","failure_domain","name","failure_domain","formControlName","failure_domain",1,"form-select"],["for","device_class",1,"cd-col-form-label"],["id","device_class","name","device_class","formControlName","device_class",1,"form-select"],["ngValue",""],[1,"modal-footer"],[3,"submitActionEvent","form","submitText"],[1,"invalid-feedback"],[3,"ngValue"]]},template:function(t,n){if(1&t){const s=e.RV6();e.j41(0,"cd-modal",15),e.qex(1,16),e.pXf(2,1),e.nI1(3,"titlecase"),e.nI1(4,"upperFirst"),e.bVm(),e.qex(5,17),e.j41(6,"form",18,0)(8,"div",19)(9,"div",20)(10,"label",21),e.qex(11),e.pXf(12,2),e.bVm(),e.nrm(13,"span",22),e.k0s(),e.j41(14,"div",23),e.nrm(15,"input",24),e.DNE(16,Uo,2,0,"span",25)(17,ko,2,0,"span",25)(18,xo,2,0,"span",25),e.k0s()(),e.j41(19,"div",20)(20,"label",26),e.qex(21),e.pXf(22,3),e.bVm(),e.nrm(23,"cd-helper",27)(24,"span",22),e.k0s(),e.j41(25,"div",23)(26,"select",28),e.DNE(27,Ho,2,0,"option",29)(28,zo,2,2,"option",30),e.k0s(),e.DNE(29,jo,2,0,"span",25),e.k0s()(),e.j41(30,"div",20)(31,"label",31),e.qex(32),e.pXf(33,4),e.bVm(),e.nrm(34,"cd-helper",27)(35,"span",22),e.k0s(),e.j41(36,"div",23)(37,"select",32),e.DNE(38,Vo,2,0,"option",29)(39,wo,2,3,"option",30),e.k0s(),e.DNE(40,Yo,2,0,"span",25),e.k0s()(),e.j41(41,"div",20)(42,"label",33),e.qex(43),e.pXf(44,5),e.bVm(),e.k0s(),e.j41(45,"div",23)(46,"select",34)(47,"option",35),e.pXf(48,6),e.k0s(),e.DNE(49,Bo,2,2,"option",30),e.k0s(),e.j41(50,"cd-help-text")(51,"span"),e.pXf(52,7),e.k0s()()()()(),e.j41(53,"div",36)(54,"cd-form-button-panel",37),e.nI1(55,"titlecase"),e.nI1(56,"upperFirst"),e.bIt("submitActionEvent",function(){return e.eBV(s),e.Njj(n.onSubmit())}),e.k0s()()(),e.bVm(),e.k0s()}if(2&t){const s=e.sdS(7);e.Y8G("modalRef",n.activeModal),e.R7$(4),e.uP7(e.bMT(3,19,n.action))(e.bMT(4,21,n.resource)),e.nnv(2),e.R7$(2),e.Y8G("formGroup",n.form),e.R7$(10),e.Y8G("ngIf",n.form.showError("name",s,"required")),e.R7$(),e.Y8G("ngIf",n.form.showError("name",s,"pattern")),e.R7$(),e.Y8G("ngIf",n.form.showError("name",s,"uniqueName")),e.R7$(5),e.Y8G("html",n.tooltips.root),e.R7$(4),e.Y8G("ngIf",!n.buckets),e.R7$(),e.Y8G("ngForOf",n.buckets),e.R7$(),e.Y8G("ngIf",n.form.showError("root",s,"required")),e.R7$(5),e.Y8G("html",n.tooltips.failure_domain),e.R7$(4),e.Y8G("ngIf",!n.failureDomains),e.R7$(),e.Y8G("ngForOf",n.failureDomainKeys),e.R7$(),e.Y8G("ngIf",n.form.showError("failure_domain",s,"required")),e.R7$(9),e.Y8G("ngForOf",n.devices),e.R7$(3),e.uP7(n.tooltips.device_class),e.nnv(52),e.R7$(2),e.Y8G("form",n.form)("submitText",e.bMT(55,23,n.action)+" "+e.bMT(56,25,n.resource))}},dependencies:[g.Sq,g.bT,he.m,ze.z,Le.e,Se.O,Fe.B,Te.S,Ne.a,be.C,Ae.E,l.qT,l.xH,l.y7,l.me,l.wz,l.BC,l.cb,l.j4,l.JD,g.PV,$e.r]})}return _})();var Qo=r(26409);let Ie=(()=>{class _{http;apiPath="api/erasure_code_profile";formTooltips={k:"Ka\u017Cdy obiekt jest podzielony na cz\u0119\u015Bci fragment\xF3w danych, ka\u017Cdy jest przechowywany na innym OSD.",m:"Oblicz porcje kodu dla ka\u017Cdego obiektu i przechowuj je na r\xF3\u017Cnych OSD.\n Liczba fragment\xF3w koduj\u0105cych to r\xF3wnie\u017C liczba OSD, kt\xF3re mog\u0105 zosta\u0107 wy\u0142\u0105czone bez utraty danych.",plugins:{jerasure:{description:"Wtyczka jerasure jest najbardziej uniwersaln\u0105 i elastyczn\u0105 wtyczk\u0105,\n jest to r\xF3wnie\u017C domy\u015Blne ustawienie dla pui kodowanych przez Ceph.",technique:"Bardziej elastyczn\u0105 technik\u0105 jest reed_sol_van: wystarczy ustawi\u0107 k\n oraz m. Technika cauchy_good mo\u017Ce by\u0107 szybsza, ale musisz wybra\u0107 rozmiar pakietu\n ostro\u017Cnie. Wszystkie reed_sol_r6_op, liberation, blaum_roth, liber8tion s\u0105 odpowiednikami RAID6\n w tym sensie, \u017Ce mog\u0105 by\u0107 skonfigurowane tylko z m = 2.",packetSize:"The encoding will be done on packets of bytes size at a time.\n          Choosing the right packet size is difficult.\n          The jerasure documentation contains extensive information on this topic."},lrc:{description:"Z wtyczk\u0105 jerasure, gdy obiekt zakodowany przy u\u017Cyciu skasowania jest przechowywany na \n wielu OSD-kach, odzyskiwanie po utracie jednego OSD wymaga odczytu ze wszystkich pozosta\u0142ych.\n Na przyk\u0142ad, je\u015Bli konfiguracja skryptu ma warto\u015B\u0107 k = 8 ,m = 4 i l=4, utrata jednego OSD wymaga odczytu\n od jedenastu innych do naprawy.\n\n Wtyczka kodu wymazywania lrc tworzy fragmenty o parzysto\u015Bci lokalnej, aby m\xF3c je odzyska\u0107\n mniej OSD. Na przyk\u0142ad, je\u015Bli lrc jest skonfigurowane z k = 8, m = 4 i l = 4, zostanie utworzony\n dodatkowy fragment parzysto\u015Bci na ka\u017Cde cztery OSD. Gdy jeden OSD zostanie utracone, mo\u017Ce to by\u0107\n odzyskane tylko z czterema OSD zamiast jedenastu.",l:"Grupuj fragmenty kodu i danych w zestawy lokalizacji wielko\u015Bci. Na przyk\u0142ad,\n dla k = 4 i m = 2, gdy lokalno\u015B\u0107 = 3 tworzone s\u0105 dwie grupy po trzy. Ka\u017Cdy zestaw mo\u017Ce\n odzyska\u0107 bez czytania kawa\u0142k\xF3w z innego zestawu.",crushLocality:"Typ wiadra CRUSH, w kt\xF3rym zdefiniowano ka\u017Cdy zestaw porcji\n przez l zostan\u0105 zapisane. Na przyk\u0142ad, je\u015Bli jest ustawiony na rack, ka\u017Cda grupa l porcji b\u0119dzie\n umieszczona w innym raku. S\u0142u\u017Cy do utworzenia kroku regu\u0142y CRUSH, takiego jak krok wyboru\n racka. Je\u015Bli nie jest ustawiony, nie ma takiego grupowania."},isa:{description:"Wtyczka isa zawiera bibliotek\u0119 ISA. Dzia\u0142a tylko na procesorach Intel.",technique:"Wtyczka ISA jest dost\u0119pna w dw\xF3ch formach Reed Solomon.\n Je\u015Bli ustawiono reed_sol_van, jest to Vandermonde, je\u015Bli ustawiono cauchy, to jest to Cauchy."},shec:{description:"Wtyczka shec zawiera wiele bibliotek SHEC.\n Pozwala ceph odzyska\u0107 dane bardziej efektywnie ni\u017C kody Reeda Solomona.",c:"Liczba kawa\u0142k\xF3w parzysto\u015Bci, z kt\xF3rych ka\u017Cdy zawiera ka\u017Cd\u0105 porcj\u0119 danych w swoim zakresie oblicze\u0144. Liczba jest u\u017Cywana jako estymator trwa\u0142o\u015Bci. Na przyk\u0142ad, je\u015Bli c = 2,\n 2 OSD mo\u017Cna wy\u0142\u0105czy\u0107 bez utraty danych."},clay:{description:"CLAY (short for coupled-layer) codes are erasure codes designed to\n          bring about significant savings in terms of network bandwidth and disk IO when a failed\n          node/OSD/rack is being repaired.",d:"Number of OSDs requested to send data during recovery of a single chunk.\n          d needs to be chosen such that k+1 <= d <= k+m-1. The larger the d, the better\n          the savings.",scalar_mds:"scalar_mds specifies the plugin that is used as a building block\n          in the layered construction. It can be one of jerasure, isa, shec.",technique:"technique specifies the technique that will be picked\n          within the 'scalar_mds' plugin specified. Supported techniques\n          are 'reed_sol_van', 'reed_sol_r6_op', 'cauchy_orig',\n          'cauchy_good', 'liber8tion' for jerasure, 'reed_sol_van',\n          'cauchy' for isa and 'single', 'multiple' for shec."}},crushRoot:"Nazwa wiadra crush jest u\u017Cyte do pierwszego kroku regu\u0142y CRUSH.\nNa przyk\u0142ad krok jest domy\u015Blny.",crushFailureDomain:"Upewnij si\u0119, \u017Ce \u017Cadne dwie porcje nie znajduj\u0105 si\u0119 w wiadrze z t\u0105 sam\u0105 awari\u0105\n domeny. Na przyk\u0142ad, je\u015Bli domena awarii jest hostem, nie zostan\u0105 na niej zapisane dwie porcje\n hosta. S\u0142u\u017Cy do utworzenia kroku regu\u0142y CRUSH, takiego jak krok wyboru hosta.",crushNumFailureDomains:" Number of failure domains to map. Results in a CRUSH MSR rule being created.\n    Must be specified if crush-osds-per-failure-domain is specified.",crushOsdsPerFailureDomain:"Maximum number of OSDs to place in each failure domain --\n     defaults to 1. Using a value greater than one will cause a CRUSH MSR rule to be created.\n      Must be specified if crush-num-failure-domains is specified.",crushDeviceClass:"The device class on which to place data.",directory:"Ustaw nazw\u0119 katalogu, z kt\xF3rego \u0142adowana jest wtyczka kodu kasowania."};constructor(o){this.http=o}list(){return this.http.get(this.apiPath)}create(o){return this.http.post(this.apiPath,o,{observe:"response"})}delete(o){return this.http.delete(`${this.apiPath}/${o}`,{observe:"response"})}getInfo(){return this.http.get(`ui-${this.apiPath}/info`)}static \u0275fac=function(t){return new(t||_)(e.KVO(Qo.Qq))};static \u0275prov=e.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})();const je=(_,i,o)=>[_,i,o];function Jo(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,15),e.k0s())}function Wo(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,16),e.k0s())}function Ko(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,17),e.k0s())}function Zo(_,i){1&_&&(e.j41(0,"option",88),e.pXf(1,18),e.k0s())}function e_(_,i){if(1&_&&(e.j41(0,"option",95),e.EFF(1),e.k0s()),2&_){const o=i.$implicit;e.Y8G("ngValue",o),e.R7$(),e.SpI(" ",o," ")}}function o_(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,19),e.k0s())}function __(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,20),e.k0s())}function t_(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,21),e.k0s())}function n_(_,i){if(1&_&&(e.j41(0,"span",94),e.pXf(1,22),e.k0s()),2&_){const o=e.XpG();e.R7$(),e.uP7(o.deviceCount),e.nnv(1)}}function i_(_,i){if(1&_&&(e.j41(0,"span",94),e.pXf(1,23),e.k0s()),2&_){const o=e.XpG();e.R7$(),e.uP7(o.deviceCount),e.nnv(1)}}function s_(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,24),e.k0s())}function a_(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,25),e.k0s())}function l_(_,i){if(1&_&&(e.j41(0,"span",89),e.pXf(1,26),e.k0s()),2&_){const o=e.XpG();e.R7$(),e.uP7(o.lrcMultiK),e.nnv(1)}}function r_(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,27),e.k0s())}function c_(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,28),e.k0s())}function O_(_,i){if(1&_&&(e.j41(0,"span",94),e.pXf(1,29),e.k0s()),2&_){const o=e.XpG();e.R7$(),e.uP7(o.deviceCount),e.nnv(1)}}function d_(_,i){if(1&_&&(e.j41(0,"span",94),e.pXf(1,30),e.k0s()),2&_){const o=e.XpG();e.R7$(),e.uP7(o.deviceCount),e.nnv(1)}}function u_(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,32),e.k0s())}function f_(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,33),e.k0s())}function E_(_,i){if(1&_&&(e.j41(0,"div",61)(1,"label",96)(2,"span",67),e.pXf(3,31),e.k0s(),e.nrm(4,"cd-helper",68),e.k0s(),e.j41(5,"div",63),e.nrm(6,"input",97),e.DNE(7,u_,2,0,"span",65)(8,f_,2,0,"span",65),e.k0s()()),2&_){const o=e.XpG(),t=e.sdS(7);e.R7$(4),e.Y8G("html",o.tooltips.plugins.shec.c),e.R7$(3),e.Y8G("ngIf",o.form.showError("c",t,"min")),e.R7$(),e.Y8G("ngIf",o.form.showError("c",t,"cGreaterM"))}}function P_(_,i){1&_&&(e.j41(0,"span",89),e.pXf(1,35),e.k0s())}function R_(_,i){if(1&_&&(e.j41(0,"span",89),e.pXf(1,36),e.k0s()),2&_){const o=e.XpG(3);e.R7$(),e.uP7(o.getDMin())(o.getDMax()),e.nnv(1)}}function m_(_,i){if(1&_&&(e.j41(0,"span",89),e.pXf(1,37),e.k0s()),2&_){const o=e.XpG(3);e.R7$(),e.uP7(o.getDMax()),e.nnv(1)}}function p_(_,i){if(1&_&&(e.qex(0),e.DNE(1,R_,2,2,"span",74)(2,m_,2,1,"span",74),e.bVm()),2&_){const o=e.XpG(2);e.R7$(),e.Y8G("ngIf",o.getDMin()<o.getDMax()),e.R7$(),e.Y8G("ngIf",o.getDMin()===o.getDMax())}}function C_(_,i){if(1&_&&(e.j41(0,"span",94),e.pXf(1,38),e.k0s()),2&_){const o=e.XpG(2);e.R7$(),e.uP7(o.getDMin()),e.nnv(1)}}function M_(_,i){if(1&_&&(e.j41(0,"span",94),e.pXf(1,39),e.k0s()),2&_){const o=e.XpG(2);e.R7$(),e.uP7(o.getDMax()),e.nnv(1)}}function g_(_,i){if(1&_){const o=e.RV6();e.j41(0,"div",61)(1,"label",98)(2,"span",67),e.pXf(3,34),e.k0s(),e.nrm(4,"cd-helper",68),e.k0s(),e.j41(5,"div",63)(6,"div",99),e.nrm(7,"input",100),e.j41(8,"button",101),e.bIt("click",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.toggleDCalc())}),e.nrm(9,"i",102),e.k0s()(),e.DNE(10,P_,2,0,"span",74)(11,p_,3,2,"ng-container",103)(12,C_,2,1,"span",65)(13,M_,2,1,"span",65),e.k0s()()}if(2&_){const o=e.XpG(),t=e.sdS(7);e.R7$(4),e.Y8G("html",o.tooltips.plugins.clay.d),e.R7$(5),e.Y8G("ngClass",o.dCalc?o.icons.unlock:o.icons.lock),e.R7$(),e.Y8G("ngIf",o.dCalc),e.R7$(),e.Y8G("ngIf",!o.dCalc),e.R7$(),e.Y8G("ngIf",o.form.showError("d",t,"dMin")),e.R7$(),e.Y8G("ngIf",o.form.showError("d",t,"dMax"))}}function h_(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,42),e.k0s())}function L_(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,43),e.k0s())}function S_(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,44),e.k0s())}function F_(_,i){if(1&_&&(e.j41(0,"div",61)(1,"label",104)(2,"span",67),e.pXf(3,40),e.k0s(),e.nrm(4,"cd-helper",68),e.k0s(),e.j41(5,"div",63),e.nrm(6,"input",105),e.DNE(7,h_,2,0,"span",65)(8,L_,2,0,"span",65)(9,S_,2,0,"span",65),e.j41(10,"span",89),e.pXf(11,41),e.k0s()()()),2&_){const o=e.XpG(),t=e.sdS(7);e.R7$(4),e.Y8G("html",o.tooltips.plugins.lrc.l),e.R7$(3),e.Y8G("ngIf",o.form.showError("l",t,"required")),e.R7$(),e.Y8G("ngIf",o.form.showError("l",t,"min")),e.R7$(),e.Y8G("ngIf",o.form.showError("l",t,"unequal")),e.R7$(2),e.uP7(o.lrcGroups),e.nnv(11)}}function T_(_,i){1&_&&(e.j41(0,"option",88),e.pXf(1,45),e.k0s())}function N_(_,i){if(1&_&&(e.j41(0,"option",95),e.EFF(1),e.k0s()),2&_){const o=i.$implicit,t=e.XpG();e.Y8G("ngValue",o),e.R7$(),e.Lme(" ",o," ( ",t.failureDomains[o].length," ) ")}}function b_(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,46),e.k0s())}function A_(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,47),e.k0s())}function $_(_,i){1&_&&(e.j41(0,"option",88),e.pXf(1,49),e.k0s())}function I_(_,i){1&_&&(e.j41(0,"option",88),e.pXf(1,50),e.k0s())}function v_(_,i){if(1&_&&(e.j41(0,"option",95),e.EFF(1),e.k0s()),2&_){const o=i.$implicit,t=e.XpG(2);e.Y8G("ngValue",o),e.R7$(),e.Lme(" ",o," ( ",t.failureDomains[o].length," ) ")}}function D_(_,i){if(1&_&&(e.j41(0,"div",61)(1,"label",106),e.qex(2),e.pXf(3,48),e.bVm(),e.nrm(4,"cd-helper",68),e.k0s(),e.j41(5,"div",63)(6,"select",107),e.DNE(7,$_,2,0,"option",70)(8,I_,2,0,"option",70)(9,v_,2,3,"option",71),e.k0s()()()),2&_){const o=e.XpG();e.R7$(4),e.Y8G("html",o.tooltips.plugins.lrc.crushLocality),e.R7$(3),e.Y8G("ngIf",!o.failureDomains),e.R7$(),e.Y8G("ngIf",o.failureDomainKeys.length>0),e.R7$(),e.Y8G("ngForOf",o.failureDomainKeys)}}function G_(_,i){if(1&_&&(e.j41(0,"option",95),e.EFF(1),e.k0s()),2&_){const o=i.$implicit;e.Y8G("ngValue",o),e.R7$(),e.SpI(" ",o," ")}}function X_(_,i){if(1&_&&(e.j41(0,"div",61)(1,"label",108),e.qex(2),e.pXf(3,51),e.bVm(),e.nrm(4,"cd-helper",68),e.k0s(),e.j41(5,"div",63)(6,"select",109),e.DNE(7,G_,2,2,"option",71),e.k0s()()()),2&_){const o=e.XpG();e.R7$(4),e.Y8G("html",o.tooltips.plugins.clay.scalar_mds),e.R7$(3),e.Y8G("ngForOf",e.sMw(2,je,o.PLUGIN.JERASURE,o.PLUGIN.ISA,o.PLUGIN.SHEC))}}function y_(_,i){if(1&_&&(e.j41(0,"option",95),e.EFF(1),e.k0s()),2&_){const o=i.$implicit;e.Y8G("ngValue",o),e.R7$(),e.SpI(" ",o," ")}}function U_(_,i){if(1&_&&(e.j41(0,"div",61)(1,"label",110),e.qex(2),e.pXf(3,52),e.bVm(),e.nrm(4,"cd-helper",68),e.k0s(),e.j41(5,"div",63)(6,"select",111),e.DNE(7,y_,2,2,"option",71),e.k0s()()()),2&_){const o=e.XpG();e.R7$(4),e.Y8G("html",o.tooltips.plugins[o.plugin].technique),e.R7$(3),e.Y8G("ngForOf",o.techniques)}}function k_(_,i){1&_&&(e.j41(0,"span",94),e.pXf(1,54),e.k0s())}function x_(_,i){if(1&_&&(e.j41(0,"div",61)(1,"label",112),e.qex(2),e.pXf(3,53),e.bVm(),e.nrm(4,"cd-helper",68),e.k0s(),e.j41(5,"div",63),e.nrm(6,"input",113),e.DNE(7,k_,2,0,"span",65),e.k0s()()),2&_){const o=e.XpG(),t=e.sdS(7);e.R7$(4),e.Y8G("html",o.tooltips.plugins.jerasure.packetSize),e.R7$(3),e.Y8G("ngIf",o.form.showError("packetSize",t,"min"))}}function H_(_,i){1&_&&(e.j41(0,"option",88),e.pXf(1,55),e.k0s())}function z_(_,i){if(1&_&&(e.j41(0,"option",95),e.EFF(1),e.k0s()),2&_){const o=i.$implicit;e.Y8G("ngValue",o),e.R7$(),e.SpI(" ",o.name," ")}}function j_(_,i){if(1&_&&(e.j41(0,"option",95),e.EFF(1),e.k0s()),2&_){const o=i.$implicit;e.Y8G("ngValue",o),e.R7$(),e.SpI(" ",o," ")}}let V_=(()=>{class _ extends T{formBuilder;activeModal;taskWrapper;ecpService;actionLabels;submitAction=new e.bkB;tooltips;PLUGIN={LRC:"lrc",SHEC:"shec",CLAY:"clay",JERASURE:"jerasure",ISA:"isa"};plugin=this.PLUGIN.JERASURE;icons=I.F;form;plugins;names;techniques;action;resource;dCalc;lrcGroups;lrcMultiK;CrushFailureDomains=Ce;constructor(o,t,n,s,c){super(),this.formBuilder=o,this.activeModal=t,this.taskWrapper=n,this.ecpService=s,this.actionLabels=c,this.action=this.actionLabels.CREATE,this.resource="EC Profile",this.createForm(),this.setJerasureDefaults()}createForm(){this.form=this.formBuilder.group({name:[null,[l.k0.required,l.k0.pattern("[A-Za-z0-9_-]+"),u.xQ.custom("uniqueName",o=>this.names&&-1!==this.names.indexOf(o))]],plugin:[this.PLUGIN.JERASURE,[l.k0.required]],k:[4,[l.k0.required,u.xQ.custom("max",()=>this.baseValueValidation(!0)),u.xQ.custom("unequal",o=>this.lrcDataValidation(o)),u.xQ.custom("kLowerM",o=>this.shecDataValidation(o))]],m:[2,[l.k0.required,u.xQ.custom("max",()=>this.baseValueValidation())]],crushFailureDomain:"",crushNumFailureDomains:[0,u.xQ.requiredIf({crushOsdsPerFailureDomain:{op:"minValue",arg1:1}})],crushOsdsPerFailureDomain:[0,u.xQ.requiredIf({crushNumFailureDomains:{op:"minValue",arg1:1}})],crushRoot:null,crushDeviceClass:"",directory:"",technique:"reed_sol_van",packetSize:[2048],l:[3,[l.k0.required,u.xQ.custom("unequal",o=>this.lrcLocalityValidation(o))]],crushLocality:"",c:[2,[l.k0.required,u.xQ.custom("cGreaterM",o=>this.shecDurabilityValidation(o))]],d:[5,[l.k0.required,u.xQ.custom("dMin",o=>this.dMinValidation(o)),u.xQ.custom("dMax",o=>this.dMaxValidation(o))]],scalar_mds:[this.PLUGIN.JERASURE,[l.k0.required]]}),this.toggleDCalc(),this.form.get("k").valueChanges.subscribe(()=>this.updateValidityOnChange(["m","l","d"])),this.form.get("m").valueChanges.subscribe(()=>this.updateValidityOnChange(["k","l","c","d"])),this.form.get("l").valueChanges.subscribe(()=>this.updateValidityOnChange(["k","m"])),this.form.get("plugin").valueChanges.subscribe(o=>this.onPluginChange(o)),this.form.get("scalar_mds").valueChanges.subscribe(()=>this.setClayDefaultsForScalar())}baseValueValidation(o=!1){return this.validValidation(()=>(this.form.get("crushFailureDomain").value===Ce.Host?this.getKMSum()+1:this.getKMSum())>this.deviceCount&&this.form.getValue("k")>this.form.getValue("m")===o)}validValidation(o,t){return!((!this.form||t)&&this.plugin!==t)&&o()}getKMSum(){return this.form.getValue("k")+this.form.getValue("m")}lrcDataValidation(o){return this.validValidation(()=>{const t=this.form.getValue("m"),n=this.form.getValue("l"),s=o+t;return this.lrcMultiK=o/(s/n),o%(s/n)!=0},"lrc")}shecDataValidation(o){return this.validValidation(()=>this.form.getValue("m")>o,"shec")}lrcLocalityValidation(o){return this.validValidation(()=>{const t=this.getKMSum();return this.lrcGroups=o>0?t/o:0,o>0&&t%o!=0},"lrc")}shecDurabilityValidation(o){return this.validValidation(()=>{const t=this.form.getValue("m");return o>t},"shec")}dMinValidation(o){return this.validValidation(()=>this.getDMin()>o,"clay")}getDMin(){return this.form.getValue("k")+1}dMaxValidation(o){return this.validValidation(()=>o>this.getDMax(),"clay")}getDMax(){const o=this.form.getValue("m");return this.form.getValue("k")+o-1}toggleDCalc(){this.dCalc=!this.dCalc,this.form.get("d")[this.dCalc?"disable":"enable"](),this.calculateD()}calculateD(){this.plugin!==this.PLUGIN.CLAY||!this.dCalc||this.form.silentSet("d",this.getDMax())}updateValidityOnChange(o){o.forEach(t=>{"d"===t&&this.calculateD(),this.form.get(t).updateValueAndValidity({emitEvent:!1})})}onPluginChange(o){this.plugin=o,o===this.PLUGIN.JERASURE?this.setJerasureDefaults():o===this.PLUGIN.LRC?this.setLrcDefaults():o===this.PLUGIN.ISA?this.setIsaDefaults():o===this.PLUGIN.SHEC?this.setShecDefaults():o===this.PLUGIN.CLAY&&this.setClayDefaults(),this.updateValidityOnChange(["m"])}setJerasureDefaults(){this.techniques=["reed_sol_van","reed_sol_r6_op","cauchy_orig","cauchy_good","liberation","blaum_roth","liber8tion"],this.setDefaults({k:4,m:2,technique:"reed_sol_van"})}setLrcDefaults(){this.setDefaults({k:4,m:2,l:3})}setIsaDefaults(){this.techniques=["reed_sol_van","cauchy"],this.setDefaults({k:7,m:3,technique:"reed_sol_van"})}setShecDefaults(){this.setDefaults({k:4,m:3,c:2})}setClayDefaults(){this.setDefaults({k:4,m:2,scalar_mds:this.PLUGIN.JERASURE}),this.setClayDefaultsForScalar()}setClayDefaultsForScalar(){const o=this.form.getValue("scalar_mds");let t="reed_sol_van";o===this.PLUGIN.JERASURE?this.techniques=["reed_sol_van","reed_sol_r6_op","cauchy_orig","cauchy_good","liber8tion"]:o===this.PLUGIN.ISA?this.techniques=["reed_sol_van","cauchy"]:(t="single",this.techniques=["single","multiple"]),this.setDefaults({technique:t})}setDefaults(o){Object.keys(o).forEach(t=>{const n=this.form.get(t),s=n.value;n.pristine||"technique"===t&&!this.techniques.includes(s)||"k"===t&&[4,7].includes(s)||"m"===t&&[2,3].includes(s)?n.setValue(o[t]):n.updateValueAndValidity()})}ngOnInit(){this.tooltips=this.ecpService.formTooltips,this.ecpService.getInfo().subscribe(({plugins:o,names:t,directory:n,nodes:s})=>{this.initCrushNodeSelection(s,this.form.get("crushRoot"),this.form.get("crushFailureDomain"),this.form.get("crushDeviceClass"),!1),this.plugins=o,this.names=t,this.form.silentSet("directory",n),this.preValidateNumericInputFields()})}preValidateNumericInputFields(){const o=["k","m","l","c","d"].map(t=>this.form.get(t));o.forEach(t=>{t.markAsTouched(),t.markAsDirty()}),o[1].updateValueAndValidity()}onSubmit(){if(this.form.invalid)return void this.form.setErrors({cdSubmitButton:!0});const o=this.createJson();this.taskWrapper.wrapTaskAroundCall({task:new v.O("ecp/create",{name:o.name}),call:this.ecpService.create(o)}).subscribe({error:()=>{this.form.setErrors({cdSubmitButton:!0})},complete:()=>{this.activeModal.close(),this.submitAction.emit(o)}})}createJson(){const o={technique:[this.PLUGIN.ISA,this.PLUGIN.JERASURE,this.PLUGIN.CLAY],packetSize:[this.PLUGIN.JERASURE],l:[this.PLUGIN.LRC],crushLocality:[this.PLUGIN.LRC],c:[this.PLUGIN.SHEC],d:[this.PLUGIN.CLAY],scalar_mds:[this.PLUGIN.CLAY]},t=new Io,n=this.form.getValue("plugin");return Object.keys(this.form.controls).filter(s=>{const c=o[s],d=this.form.getValue(s);return(c&&c.includes(n)||!c)&&d&&""!==d}).forEach(s=>{this.extendJson(s,t)}),t}extendJson(o,t){const s=this.form.getValue(o);t[{crushFailureDomain:"crush-failure-domain",crushNumFailureDomains:"crush-num-failure-domains",crushOsdsPerFailureDomain:"crush-osds-per-failure-domain",crushRoot:"crush-root",crushDeviceClass:"crush-device-class",packetSize:"packetsize",crushLocality:"crush-locality"}[o]||o]="crushRoot"===o?s.name:s}onCrushFailureDomainChane(){this.form.get("k").updateValueAndValidity(),this.form.get("m").updateValueAndValidity()}static \u0275fac=function(t){return new(t||_)(e.rXU(xe.$),e.rXU(E.Lw),e.rXU(Me.a),e.rXU(Ie),e.rXU(h.Ss))};static \u0275cmp=e.VBU({type:_,selectors:[["cd-erasure-code-profile-form-modal"]],outputs:{submitAction:"submitAction"},features:[e.Vt3],decls:118,vars:59,consts:()=>{let o,t,n,s,c,d,f,R,p,L,S,C,M,F,m,D,G,X,y,U,k,x,H,z,j,V,w,Y,B,q,Q,J,W,K,Z,ee,oe,_e,te,A,ne,ie,se,ae,le,re,ce,Oe,de,ue,fe,Ee,Pe,$,Re,me;return o="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",t="Nazwa",n="Wtyczka",s="Ramka danych (k)",c="Kodowanie kawa\u0142ka (m)",d="Domena niepowodzenia Crush",f="Crush num failure domain",R="Crush osds per failure domain",p="korze\u0144 Crusha",L="urz\u0105dzenie klasy Crush",S="All devices",C="" + "\ufffd0\ufffd" + "",M="Available OSDs: " + "\ufffd0\ufffd" + "",F="Katalog",m="To pole jest wymagane.",D="Nazwa mo\u017Ce sk\u0142ada\u0107 si\u0119 z alfanumerycznych znak\xF3w, kresek i podkre\u015Ble\u0144.",G="Wybrana nazwa profilu kodu kasowania jest ju\u017C u\u017Cywana.",X="\u0141adowanie...",y="To pole jest wymagane.",U="To pole jest wymagane.",k="Musi by\u0107 wi\u0119ksza b\u0105d\u017A r\xF3wna 2.",x="Chunks (k+m) have exceeded the available OSDs of " + "\ufffd0\ufffd" + ".",H="Chunks (k+m+1) have exceeded the available hosts of " + "\ufffd0\ufffd" + ".",z="For an equal distribution k has to be a multiple of (k+m)/l.",j="K has to be equal to or greater than m in order to recover data correctly through c.",V="Distribution factor: " + "\ufffd0\ufffd" + "",w="To pole jest wymagane.",Y="Musi by\u0107 wi\u0119ksza b\u0105d\u017A r\xF3wna 1.",B="Chunks (k+m) have exceeded the available OSDs of " + "\ufffd0\ufffd" + ".",q="Chunks (k+m+1) have exceeded the available hosts of " + "\ufffd0\ufffd" + ".",Q="Estymator trwa\u0142o\u015Bci (c)",J="Musi by\u0107 wi\u0119ksza b\u0105d\u017A r\xF3wna 1.",W="C has to be equal to or lower than m as m defines the amount of chunks that can be used.",K="Set d manually or use the plugin's default calculation that maximizes d.",Z="Helper chunks (d)",ee="D is automatically updated on k and m changes",oe="D can be set from " + "\ufffd0\ufffd" + " to " + "\ufffd1\ufffd" + "",_e="D can only be set to " + "\ufffd0\ufffd" + "",te="D has to be greater than k (" + "\ufffd0\ufffd" + ").",A="D has to be lower than k + m (" + "\ufffd0\ufffd" + ").",ne="Lokalno\u015B\u0107  (l)",ie="Locality groups: " + "\ufffd0\ufffd" + "",se="To pole jest wymagane.",ae="Musi by\u0107 wi\u0119ksza b\u0105d\u017A r\xF3wna 1.",le="Can't split up chunks (k+m) correctly with the current locality.",re="\u0141adowanie...",ce="This field is required when crush osds per failure domain is set!",Oe="This field is required when crush num failure domain is set!",de="Lokalno\u015B\u0107 Crusha",ue="\u0141adowanie...",fe="Nic",Ee="Scalar mds",Pe="Technika",$="Rozmiar pakietu",Re="Musi by\u0107 wi\u0119ksza b\u0105d\u017A r\xF3wna 1.",me="\u0141adowanie...",[["frm","ngForm"],o,t,n,s,c,d,f,R,p,L,S,C,M,F,m,D,G,X,y,U,k,x,H,z,j,V,w,Y,B,q,Q,J,W,Z,ee,oe,_e,te,A,ne,ie,se,ae,le,re,ce,Oe,de,ue,fe,Ee,Pe,$,Re,me,[3,"modalRef"],[1,"modal-title"],[1,"modal-content"],["novalidate","",3,"formGroup"],[1,"modal-body"],[1,"form-group","row"],["for","name",1,"cd-col-form-label"],[1,"cd-col-form-input"],["type","text","id","name","name","name","placeholder","Name...","formControlName","name","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","plugin",1,"cd-col-form-label"],[1,"required"],[3,"html"],["id","plugin","name","plugin","formControlName","plugin",1,"form-select"],["ngValue","",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],["for","k",1,"cd-col-form-label"],["type","number","id","k","name","k","ng-model","$ctrl.erasureCodeProfile.k","placeholder","Data chunks...","formControlName","k","min","2",1,"form-control"],["class","form-text text-muted",4,"ngIf"],["for","m",1,"cd-col-form-label"],["type","number","id","m","name","m","placeholder","Coding chunks...","formControlName","m","min","1",1,"form-control"],["class","form-group row",4,"ngIf"],["for","crushFailureDomain",1,"cd-col-form-label"],["id","crushFailureDomain","name","crushFailureDomain","formControlName","crushFailureDomain",1,"form-select",3,"change"],["for","crushNumFailureDomains",1,"cd-col-form-label"],["type","number","id","crushNumFailureDomains","name","crushNumFailureDomains","formControlName","crushNumFailureDomains","min","0",1,"form-control"],["for","crushOsdsPerFailureDomain",1,"cd-col-form-label"],["type","number","id","crushOsdsPerFailureDomain","name","crushOsdsPerFailureDomain","formControlName","crushOsdsPerFailureDomain","min","0",1,"form-control"],["for","crushRoot",1,"cd-col-form-label"],["id","crushRoot","name","crushRoot","formControlName","crushRoot",1,"form-select"],["for","crushDeviceClass",1,"cd-col-form-label"],["id","crushDeviceClass","name","crushDeviceClass","formControlName","crushDeviceClass",1,"form-select"],["ngValue",""],[1,"form-text","text-muted"],["for","directory",1,"cd-col-form-label"],["type","text","id","directory","name","directory","placeholder","Path...","formControlName","directory",1,"form-control"],[1,"modal-footer"],[3,"submitActionEvent","form","submitText"],[1,"invalid-feedback"],[3,"ngValue"],["for","c",1,"cd-col-form-label"],["type","number","id","c","name","c","placeholder","Coding chunks...","formControlName","c","min","1",1,"form-control"],["for","d",1,"cd-col-form-label"],[1,"input-group"],["type","number","id","d","name","d","placeholder","Helper chunks...","formControlName","d",1,"form-control"],["id","d-calc-btn","ngbTooltip",K,"type","button",1,"btn","btn-light",3,"click"],["aria-hidden","true",3,"ngClass"],[4,"ngIf"],["for","l",1,"cd-col-form-label"],["type","number","id","l","name","l","placeholder","Coding chunks...","formControlName","l","min","1",1,"form-control"],["for","crushLocality",1,"cd-col-form-label"],["id","crushLocality","name","crushLocality","formControlName","crushLocality",1,"form-select"],["for","scalar_mds",1,"cd-col-form-label"],["id","scalar_mds","name","scalar_mds","formControlName","scalar_mds",1,"form-select"],["for","technique",1,"cd-col-form-label"],["id","technique","name","technique","formControlName","technique",1,"form-select"],["for","packetSize",1,"cd-col-form-label"],["type","number","id","packetSize","name","packetSize","placeholder","Packetsize...","formControlName","packetSize","min","1",1,"form-control"]]},template:function(t,n){if(1&t){const s=e.RV6();e.j41(0,"cd-modal",56),e.qex(1,57),e.pXf(2,1),e.nI1(3,"titlecase"),e.nI1(4,"upperFirst"),e.bVm(),e.qex(5,58),e.j41(6,"form",59,0)(8,"div",60)(9,"div",61)(10,"label",62),e.pXf(11,2),e.k0s(),e.j41(12,"div",63),e.nrm(13,"input",64),e.DNE(14,Jo,2,0,"span",65)(15,Wo,2,0,"span",65)(16,Ko,2,0,"span",65),e.k0s()(),e.j41(17,"div",61)(18,"label",66)(19,"span",67),e.pXf(20,3),e.k0s(),e.nrm(21,"cd-helper",68),e.k0s(),e.j41(22,"div",63)(23,"select",69),e.DNE(24,Zo,2,0,"option",70)(25,e_,2,2,"option",71),e.k0s(),e.DNE(26,o_,2,0,"span",65),e.k0s()(),e.j41(27,"div",61)(28,"label",72)(29,"span",67),e.pXf(30,4),e.k0s(),e.nrm(31,"cd-helper",68),e.k0s(),e.j41(32,"div",63),e.nrm(33,"input",73),e.DNE(34,__,2,0,"span",65)(35,t_,2,0,"span",65)(36,n_,2,1,"span",65)(37,i_,2,1,"span",65)(38,s_,2,0,"span",65)(39,a_,2,0,"span",65)(40,l_,2,1,"span",74),e.k0s()(),e.j41(41,"div",61)(42,"label",75)(43,"span",67),e.pXf(44,5),e.k0s(),e.nrm(45,"cd-helper",68),e.k0s(),e.j41(46,"div",63),e.nrm(47,"input",76),e.DNE(48,r_,2,0,"span",65)(49,c_,2,0,"span",65)(50,O_,2,1,"span",65)(51,d_,2,1,"span",65),e.k0s()(),e.DNE(52,E_,9,3,"div",77)(53,g_,14,6,"div",77)(54,F_,12,5,"div",77),e.j41(55,"div",61)(56,"label",78),e.qex(57),e.pXf(58,6),e.bVm(),e.nrm(59,"cd-helper",68),e.k0s(),e.j41(60,"div",63)(61,"select",79),e.bIt("change",function(){return e.eBV(s),e.Njj(n.onCrushFailureDomainChane())}),e.DNE(62,T_,2,0,"option",70)(63,N_,2,3,"option",71),e.k0s()()(),e.j41(64,"div",61)(65,"label",80),e.qex(66),e.pXf(67,7),e.bVm(),e.nrm(68,"cd-helper",68),e.k0s(),e.j41(69,"div",63),e.nrm(70,"input",81),e.DNE(71,b_,2,0,"span",65),e.k0s()(),e.j41(72,"div",61)(73,"label",82),e.qex(74),e.pXf(75,8),e.bVm(),e.nrm(76,"cd-helper",68),e.k0s(),e.j41(77,"div",63),e.nrm(78,"input",83),e.DNE(79,A_,2,0,"span",65),e.k0s()(),e.DNE(80,D_,10,4,"div",77)(81,X_,8,6,"div",77)(82,U_,8,2,"div",77)(83,x_,8,2,"div",77),e.j41(84,"div",61)(85,"label",84),e.qex(86),e.pXf(87,9),e.bVm(),e.nrm(88,"cd-helper",68),e.k0s(),e.j41(89,"div",63)(90,"select",85),e.DNE(91,H_,2,0,"option",70)(92,z_,2,2,"option",71),e.k0s()()(),e.j41(93,"div",61)(94,"label",86),e.qex(95),e.pXf(96,10),e.bVm(),e.k0s(),e.j41(97,"div",63)(98,"select",87)(99,"option",88),e.pXf(100,11),e.k0s(),e.DNE(101,j_,2,2,"option",71),e.k0s(),e.j41(102,"cd-help-text")(103,"span"),e.pXf(104,12),e.k0s()(),e.j41(105,"span",89),e.pXf(106,13),e.k0s()()(),e.j41(107,"div",61)(108,"label",90),e.qex(109),e.pXf(110,14),e.bVm(),e.nrm(111,"cd-helper",68),e.k0s(),e.j41(112,"div",63),e.nrm(113,"input",91),e.k0s()()(),e.j41(114,"div",92)(115,"cd-form-button-panel",93),e.nI1(116,"titlecase"),e.nI1(117,"upperFirst"),e.bIt("submitActionEvent",function(){return e.eBV(s),e.Njj(n.onSubmit())}),e.k0s()()(),e.bVm(),e.k0s()}if(2&t){const s=e.sdS(7);e.Y8G("modalRef",n.activeModal),e.R7$(4),e.uP7(e.bMT(3,47,n.action))(e.bMT(4,49,n.resource)),e.nnv(2),e.R7$(2),e.Y8G("formGroup",n.form),e.R7$(8),e.Y8G("ngIf",n.form.showError("name",s,"required")),e.R7$(),e.Y8G("ngIf",n.form.showError("name",s,"pattern")),e.R7$(),e.Y8G("ngIf",n.form.showError("name",s,"uniqueName")),e.R7$(5),e.Y8G("html",n.tooltips.plugins[n.plugin].description),e.R7$(3),e.Y8G("ngIf",!n.plugins),e.R7$(),e.Y8G("ngForOf",n.plugins),e.R7$(),e.Y8G("ngIf",n.form.showError("name",s,"required")),e.R7$(5),e.Y8G("html",n.tooltips.k),e.R7$(3),e.Y8G("ngIf",n.form.showError("k",s,"required")),e.R7$(),e.Y8G("ngIf",n.form.showError("k",s,"min")),e.R7$(),e.Y8G("ngIf",n.form.showError("k",s,"max")&&n.form.getValue("crushFailureDomain")===n.CrushFailureDomains.Osd),e.R7$(),e.Y8G("ngIf",n.form.showError("k",s,"max")&&n.form.getValue("crushFailureDomain")===n.CrushFailureDomains.Host),e.R7$(),e.Y8G("ngIf",n.form.showError("k",s,"unequal")),e.R7$(),e.Y8G("ngIf",n.form.showError("k",s,"kLowerM")),e.R7$(),e.Y8G("ngIf","lrc"===n.plugin),e.R7$(5),e.Y8G("html",n.tooltips.m),e.R7$(3),e.Y8G("ngIf",n.form.showError("m",s,"required")),e.R7$(),e.Y8G("ngIf",n.form.showError("m",s,"min")),e.R7$(),e.Y8G("ngIf",n.form.showError("m",s,"max")&&n.form.getValue("crushFailureDomain")===n.CrushFailureDomains.Osd),e.R7$(),e.Y8G("ngIf",n.form.showError("m",s,"max")&&n.form.getValue("crushFailureDomain")===n.CrushFailureDomains.Host),e.R7$(),e.Y8G("ngIf","shec"===n.plugin),e.R7$(),e.Y8G("ngIf","clay"===n.plugin),e.R7$(),e.Y8G("ngIf",n.plugin===n.PLUGIN.LRC),e.R7$(5),e.Y8G("html",n.tooltips.crushFailureDomain),e.R7$(3),e.Y8G("ngIf",!n.failureDomains),e.R7$(),e.Y8G("ngForOf",n.failureDomainKeys),e.R7$(5),e.Y8G("html",n.tooltips.crushNumFailureDomains),e.R7$(3),e.Y8G("ngIf",n.form.showError("crushNumFailureDomains",s,"required")),e.R7$(5),e.Y8G("html",n.tooltips.crushOsdsPerFailureDomain),e.R7$(3),e.Y8G("ngIf",n.form.showError("crushOsdsPerFailureDomain",s,"required")),e.R7$(),e.Y8G("ngIf",n.plugin===n.PLUGIN.LRC),e.R7$(),e.Y8G("ngIf",n.PLUGIN.CLAY===n.plugin),e.R7$(),e.Y8G("ngIf",e.sMw(55,je,n.PLUGIN.JERASURE,n.PLUGIN.ISA,n.PLUGIN.CLAY).includes(n.plugin)),e.R7$(),e.Y8G("ngIf",n.plugin===n.PLUGIN.JERASURE),e.R7$(5),e.Y8G("html",n.tooltips.crushRoot),e.R7$(3),e.Y8G("ngIf",!n.buckets),e.R7$(),e.Y8G("ngForOf",n.buckets),e.R7$(9),e.Y8G("ngForOf",n.devices),e.R7$(3),e.uP7(n.tooltips.crushDeviceClass),e.nnv(104),e.R7$(2),e.uP7(n.deviceCount),e.nnv(106),e.R7$(5),e.Y8G("html",n.tooltips.directory),e.R7$(4),e.Y8G("form",n.form)("submitText",e.bMT(116,51,n.action)+" "+e.bMT(117,53,n.resource))}},dependencies:[g.YU,g.Sq,g.bT,he.m,ze.z,Le.e,Se.O,Fe.B,Te.S,Ne.a,be.C,Ae.E,l.qT,l.xH,l.y7,l.me,l.Q0,l.wz,l.BC,l.cb,l.VZ,l.j4,l.JD,E.md,g.PV,$e.r]})}return _})();var w_=r(66668);class Y_{poolTypes;erasureInfo=!1;crushInfo=!1;applications;APP_LABELS={cephfs:"Filesystem",rbd:"Block",rgw:"Object"};constructor(){this.poolTypes=["erasure","replicated"],this.applications={selected:[],default:["cephfs","rbd","rgw"],available:[],validators:[l.k0.pattern("[A-Za-z0-9_]+"),l.k0.maxLength(128)],messages:new w_.z({empty:"Nie dodano \u017Cadnego zastosowania",selectionLimit:{text:"Osi\u0105gni\u0119to limit zastosowa\u0144 ",tooltip:"Pul mo\u017Ce mie\u0107 maksymalnie 4 definicje aplikacji. "},customValidations:{pattern:"Dozwolone znaki '_a-zA-Z0-9'",maxlength:"Maksymalna d\u0142ugo\u015B\u0107 wynosi 128 znak\xF3w"},filter:"Filtruj lub dodaj zastosowanie",add:"Dodaj zastosowanie"})}}pgs=1;pool}var B_=r(6872),q_=r(77867),Ve=r(82254),Q_=r(48693),J_=r(87837),we=r(37823),W_=r(42865),K_=r(56677),Z_=r(45413);const et=["crushInfoTabs"],ot=["crushDeletionBtn"],_t=["ecpInfoTabs"],tt=["ecpDeletionBtn"],Ye=_=>({active:_}),b=_=>[_],nt=()=>["name"],it=()=>["steps","type","rule_name"];function st(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,22),e.k0s())}function at(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,23),e.k0s())}function lt(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,24),e.k0s())}function rt(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,25),e.k0s())}function ct(_,i){if(1&_&&(e.j41(0,"option",114),e.EFF(1),e.k0s()),2&_){const o=i.$implicit;e.Y8G("value",o),e.R7$(),e.SpI(" ",o," ")}}function Ot(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,26),e.k0s())}function dt(_,i){if(1&_&&(e.j41(0,"option",114),e.EFF(1),e.k0s()),2&_){const o=i.$implicit;e.Y8G("value",o),e.R7$(),e.SpI(" ",o," ")}}function ut(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,29),e.k0s())}function ft(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,30),e.k0s())}function Et(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,31),e.k0s())}function Pt(_,i){1&_&&(e.j41(0,"span",119),e.pXf(1,32),e.k0s())}function Rt(_,i){if(1&_){const o=e.RV6();e.j41(0,"div",90)(1,"label",117),e.pXf(2,28),e.k0s(),e.j41(3,"div",92)(4,"input",118),e.bIt("focus",function(){e.eBV(o);const n=e.XpG(3);return e.Njj(n.externalPgChange=!1)})("blur",function(){e.eBV(o);const n=e.XpG(3);return e.Njj(n.alignPgs())}),e.k0s(),e.DNE(5,ut,2,0,"span",94)(6,ft,2,0,"span",94)(7,Et,2,0,"span",94),e.j41(8,"span",119),e.nrm(9,"cd-doc",120),e.k0s(),e.DNE(10,Pt,2,0,"span",121),e.k0s()()}if(2&_){e.XpG(2);const o=e.sdS(2),t=e.XpG();e.R7$(5),e.Y8G("ngIf",t.form.showError("pgNum",o,"required")),e.R7$(),e.Y8G("ngIf",t.form.showError("pgNum",o,"min")),e.R7$(),e.Y8G("ngIf",t.form.showError("pgNum",o,"34")),e.R7$(3),e.Y8G("ngIf",t.externalPgChange)}}function mt(_,i){if(1&_&&(e.j41(0,"span",113)(1,"ul",125)(2,"li"),e.pXf(3,34),e.k0s(),e.j41(4,"li"),e.pXf(5,35),e.k0s()()()),2&_){const o=e.XpG(4);e.R7$(3),e.uP7(o.getMinSize()),e.nnv(3),e.R7$(2),e.uP7(o.getMaxSize()),e.nnv(5)}}function pt(_,i){if(1&_&&(e.j41(0,"span",113),e.pXf(1,36),e.k0s()),2&_){const o=e.XpG(4);e.R7$(),e.uP7(o.getMinSize())(o.getMaxSize()),e.nnv(1)}}function Ct(_,i){1&_&&(e.j41(0,"span",126),e.pXf(1,37),e.k0s())}function Mt(_,i){if(1&_&&(e.j41(0,"div",90)(1,"label",122),e.pXf(2,33),e.k0s(),e.j41(3,"div",92),e.nrm(4,"input",123),e.DNE(5,mt,6,2,"span",94)(6,pt,2,2,"span",94)(7,Ct,2,0,"span",124),e.k0s()()),2&_){e.XpG(2);const o=e.sdS(2),t=e.XpG();e.R7$(4),e.Y8G("max",t.getMaxSize())("min",t.getMinSize()),e.R7$(),e.Y8G("ngIf",t.form.showError("size",o)),e.R7$(),e.Y8G("ngIf",t.form.showError("size",o)),e.R7$(),e.Y8G("ngIf",1===t.form.getValue("size"))}}function gt(_,i){1&_&&(e.j41(0,"div",90)(1,"label",127),e.pXf(2,38),e.k0s(),e.j41(3,"div",92)(4,"div",128),e.nrm(5,"input",129),e.j41(6,"label",130),e.pXf(7,39),e.k0s()()()())}function ht(_,i){if(1&_&&(e.j41(0,"div")(1,"div",90)(2,"label",115),e.pXf(3,27),e.k0s(),e.j41(4,"div",92)(5,"select",116),e.DNE(6,dt,2,2,"option",98),e.k0s()()(),e.DNE(7,Rt,11,4,"div",103)(8,Mt,8,5,"div",103)(9,gt,8,0,"div",103),e.k0s()),2&_){const o=e.XpG(2);e.R7$(6),e.Y8G("ngForOf",o.pgAutoscaleModes),e.R7$(),e.Y8G("ngIf","on"!==o.form.getValue("pgAutoscaleMode")),e.R7$(),e.Y8G("ngIf",o.isReplicated),e.R7$(),e.Y8G("ngIf",o.info.is_all_bluestore&&o.isErasure)}}function Lt(_,i){if(1&_&&e.nrm(0,"i",131),2&_){const o=e.XpG(2);e.ZvI("",o.icons.warning," icon-warning-color")}}function St(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,40),e.k0s())}function Ft(_,i){1&_&&(e.j41(0,"div",90)(1,"div",132)(2,"div",128),e.nrm(3,"input",133),e.j41(4,"label",134),e.pXf(5,41),e.k0s(),e.j41(6,"cd-help-text")(7,"span"),e.pXf(8,42),e.k0s()()()()())}function Tt(_,i){1&_&&(e.j41(0,"option",97),e.pXf(1,45),e.k0s())}function Nt(_,i){1&_&&(e.j41(0,"option",146),e.pXf(1,46),e.k0s()),2&_&&e.Y8G("ngValue",null)}function bt(_,i){1&_&&(e.j41(0,"option",146),e.pXf(1,47),e.k0s()),2&_&&e.Y8G("ngValue",null)}function At(_,i){if(1&_&&(e.j41(0,"option",146),e.EFF(1),e.k0s()),2&_){const o=i.$implicit;e.Y8G("ngValue",o),e.R7$(),e.SpI(" ",o.name," ")}}function $t(_,i){if(1&_){const o=e.RV6();e.j41(0,"button",147),e.bIt("click",function(){e.eBV(o);const n=e.XpG(4);return e.Njj(n.addErasureCodeProfile())}),e.nrm(1,"i",142),e.k0s()}if(2&_){const o=e.XpG(4);e.R7$(),e.Y8G("ngClass",e.eq3(1,b,o.icons.add))}}function It(_,i){if(1&_){const o=e.RV6();e.j41(0,"button",148,1),e.bIt("click",function(){e.eBV(o);const n=e.XpG(4);return e.Njj(n.deleteErasureCodeProfile())}),e.nrm(2,"i",142),e.k0s()}if(2&_){const o=e.XpG(4);e.R7$(2),e.Y8G("ngClass",e.eq3(1,b,o.icons.trash))}}function vt(_,i){if(1&_&&e.nrm(0,"cd-table-key-value",156),2&_){const o=e.XpG(5);e.Y8G("renderObjects",!0)("hideKeys",e.lJ4(4,nt))("data",o.form.getValue("erasureProfile"))("autoReload",!1)}}function Dt(_,i){1&_&&(e.j41(0,"span"),e.pXf(1,50),e.k0s())}function Gt(_,i){if(1&_&&(e.j41(0,"li"),e.EFF(1),e.k0s()),2&_){const o=i.$implicit;e.R7$(),e.SpI(" ",o," ")}}function Xt(_,i){if(1&_&&(e.j41(0,"ul"),e.DNE(1,Gt,2,1,"li",158),e.k0s()),2&_){const o=e.XpG(6);e.R7$(),e.Y8G("ngForOf",o.ecpUsage)}}function yt(_,i){if(1&_&&e.DNE(0,Dt,2,0,"ng-template",null,3,e.C5r)(2,Xt,2,1,"ul",157),2&_){const o=e.sdS(1),t=e.XpG(5);e.R7$(2),e.Y8G("ngIf",t.ecpUsage)("ngIfElse",o)}}function Ut(_,i){if(1&_&&(e.j41(0,"span",149)(1,"nav",150,2),e.qex(3,151),e.j41(4,"a",152),e.pXf(5,48),e.k0s(),e.DNE(6,vt,1,5,"ng-template",153),e.bVm(),e.qex(7,154),e.j41(8,"a",152),e.pXf(9,49),e.k0s(),e.DNE(10,yt,3,2,"ng-template",153),e.bVm(),e.k0s(),e.nrm(11,"div",155),e.k0s()),2&_){const o=e.sdS(2);e.R7$(11),e.Y8G("ngbNavOutlet",o)}}function kt(_,i){if(1&_){const o=e.RV6();e.j41(0,"div",90)(1,"label",135),e.pXf(2,44),e.k0s(),e.j41(3,"div",92)(4,"div",136)(5,"select",137),e.bIt("change",function(){e.eBV(o);const n=e.XpG(3);return e.Njj(n.erasureProfileChange())}),e.DNE(6,Tt,2,0,"option",138)(7,Nt,2,1,"option",139)(8,bt,2,1,"option",139)(9,At,2,2,"option",140),e.k0s(),e.j41(10,"button",141),e.bIt("click",function(){e.eBV(o);const n=e.XpG(3);return e.Njj(n.data.erasureInfo=!n.data.erasureInfo)}),e.nrm(11,"i",142),e.k0s(),e.DNE(12,$t,2,3,"button",143)(13,It,3,3,"button",144),e.k0s(),e.DNE(14,Ut,12,1,"span",145),e.k0s()()}if(2&_){const o=e.XpG(3);e.R7$(6),e.Y8G("ngIf",!o.ecProfiles),e.R7$(),e.Y8G("ngIf",o.ecProfiles&&0===o.ecProfiles.length),e.R7$(),e.Y8G("ngIf",o.ecProfiles&&o.ecProfiles.length>0),e.R7$(),e.Y8G("ngForOf",o.ecProfiles),e.R7$(),e.Y8G("ngClass",e.eq3(9,Ye,o.data.erasureInfo)),e.R7$(),e.Y8G("ngClass",e.eq3(11,b,o.icons.questionCircle)),e.R7$(),e.Y8G("ngIf",!o.editing),e.R7$(),e.Y8G("ngIf",!o.editing),e.R7$(),e.Y8G("ngIf",o.data.erasureInfo&&o.form.getValue("erasureProfile"))}}function xt(_,i){1&_&&(e.j41(0,"span",119),e.pXf(1,52),e.k0s())}function Ht(_,i){1&_&&(e.j41(0,"span",119),e.pXf(1,53),e.k0s())}function zt(_,i){if(1&_&&(e.j41(0,"div",90)(1,"label",159),e.pXf(2,51),e.k0s(),e.j41(3,"div",92),e.DNE(4,xt,2,0,"span",160)(5,Ht,2,0,"ng-template",null,4,e.C5r),e.k0s()()),2&_){const o=e.sdS(6),t=e.XpG(3);e.R7$(4),e.Y8G("ngIf",!t.msrCrush)("ngIfElse",o)}}function jt(_,i){1&_&&(e.j41(0,"span",119)(1,"span"),e.pXf(2,55),e.k0s(),e.EFF(3,"\xa0 "),e.k0s())}function Vt(_,i){if(1&_&&(e.j41(0,"option",146),e.EFF(1),e.k0s()),2&_){const o=i.$implicit;e.Y8G("ngValue",o),e.R7$(),e.SpI(" ",o.rule_name," ")}}function wt(_,i){if(1&_){const o=e.RV6();e.j41(0,"button",147),e.bIt("click",function(){e.eBV(o);const n=e.XpG(5);return e.Njj(n.addCrushRule())}),e.nrm(1,"i",142),e.k0s()}if(2&_){const o=e.XpG(5);e.R7$(),e.Y8G("ngClass",e.eq3(1,b,o.icons.add))}}function Yt(_,i){if(1&_){const o=e.RV6();e.j41(0,"button",166,6),e.bIt("click",function(){e.eBV(o);const n=e.XpG(5);return e.Njj(n.deleteCrushRule())}),e.nrm(2,"i",142),e.k0s()}if(2&_){const o=e.XpG(5);e.R7$(2),e.Y8G("ngClass",e.eq3(1,b,o.icons.trash))}}function Bt(_,i){if(1&_&&e.nrm(0,"cd-table-key-value",156),2&_){const o=e.XpG(6);e.Y8G("renderObjects",!1)("hideKeys",e.lJ4(4,it))("data",o.form.getValue("crushRule"))("autoReload",!1)}}function qt(_,i){if(1&_&&(e.j41(0,"li"),e.EFF(1),e.k0s()),2&_){const o=i.$implicit,t=e.XpG(7);e.R7$(),e.SpI(" ",t.describeCrushStep(o)," ")}}function Qt(_,i){if(1&_&&(e.j41(0,"ol"),e.DNE(1,qt,2,1,"li",158),e.k0s()),2&_){const o=e.XpG(6);e.R7$(),e.Y8G("ngForOf",o.form.get("crushRule").value.steps)}}function Jt(_,i){1&_&&(e.j41(0,"span"),e.pXf(1,60),e.k0s())}function Wt(_,i){if(1&_&&(e.j41(0,"li"),e.EFF(1),e.k0s()),2&_){const o=i.$implicit;e.R7$(),e.SpI(" ",o," ")}}function Kt(_,i){if(1&_&&(e.j41(0,"ul"),e.DNE(1,Wt,2,1,"li",158),e.k0s()),2&_){const o=e.XpG(7);e.R7$(),e.Y8G("ngForOf",o.crushUsage)}}function Zt(_,i){if(1&_&&e.DNE(0,Jt,2,0,"ng-template",null,8,e.C5r)(2,Kt,2,1,"ul",157),2&_){const o=e.sdS(1),t=e.XpG(6);e.R7$(2),e.Y8G("ngIf",t.crushUsage)("ngIfElse",o)}}function en(_,i){if(1&_&&(e.j41(0,"div",167)(1,"nav",150,7),e.qex(3,168),e.j41(4,"a",152),e.pXf(5,57),e.k0s(),e.DNE(6,Bt,1,5,"ng-template",153),e.bVm(),e.qex(7,169),e.j41(8,"a",152),e.pXf(9,58),e.k0s(),e.DNE(10,Qt,2,1,"ng-template",153),e.bVm(),e.qex(11,154),e.j41(12,"a",152),e.pXf(13,59),e.k0s(),e.DNE(14,Zt,3,2,"ng-template",153),e.bVm(),e.k0s(),e.nrm(15,"div",155),e.k0s()),2&_){const o=e.sdS(2);e.R7$(15),e.Y8G("ngbNavOutlet",o)}}function on(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,61),e.k0s())}function _n(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,62),e.k0s())}function tn(_,i){if(1&_){const o=e.RV6();e.j41(0,"div")(1,"div",161)(2,"select",162)(3,"option",146),e.pXf(4,56),e.k0s(),e.DNE(5,Vt,2,2,"option",140),e.k0s(),e.j41(6,"button",163),e.bIt("click",function(){e.eBV(o);const n=e.XpG(4);return e.Njj(n.data.crushInfo=!n.data.crushInfo)}),e.nrm(7,"i",142),e.k0s(),e.DNE(8,wt,2,3,"button",143)(9,Yt,3,3,"button",164),e.k0s(),e.DNE(10,en,16,1,"div",165)(11,on,2,0,"span",94)(12,_n,2,0,"span",94),e.k0s()}if(2&_){e.XpG(3);const o=e.sdS(2),t=e.XpG();e.R7$(3),e.Y8G("ngValue",null),e.R7$(2),e.Y8G("ngForOf",t.current.rules),e.R7$(),e.Y8G("ngClass",e.eq3(9,Ye,t.data.crushInfo)),e.R7$(),e.Y8G("ngClass",e.eq3(11,b,t.icons.questionCircle)),e.R7$(),e.Y8G("ngIf",t.isReplicated&&!t.editing),e.R7$(),e.Y8G("ngIf",t.isReplicated&&!t.editing),e.R7$(),e.Y8G("ngIf",t.data.crushInfo&&t.form.getValue("crushRule")),e.R7$(),e.Y8G("ngIf",t.form.showError("crushRule",o,"required")),e.R7$(),e.Y8G("ngIf",t.form.showError("crushRule",o,"tooFewOsds"))}}function nn(_,i){if(1&_&&(e.j41(0,"div",90)(1,"label",159),e.pXf(2,54),e.k0s(),e.j41(3,"div",92),e.DNE(4,jt,4,0,"ng-template",null,5,e.C5r)(6,tn,13,13,"div",157),e.k0s()()),2&_){const o=e.sdS(5),t=e.XpG(3);e.R7$(6),e.Y8G("ngIf",t.current.rules.length>0)("ngIfElse",o)}}function sn(_,i){if(1&_&&(e.j41(0,"div")(1,"legend"),e.pXf(2,43),e.k0s(),e.DNE(3,kt,15,13,"div",103)(4,zt,7,2,"div",103)(5,nn,7,2,"div",103),e.k0s()),2&_){const o=e.XpG(2);e.R7$(3),e.Y8G("ngIf",o.isErasure),e.R7$(),e.Y8G("ngIf",o.isErasure&&!o.editing),e.R7$(),e.Y8G("ngIf",o.isReplicated||o.editing)}}function an(_,i){if(1&_&&(e.j41(0,"option",114),e.EFF(1),e.k0s()),2&_){const o=i.$implicit;e.Y8G("value",o),e.R7$(),e.SpI(" ",o," ")}}function ln(_,i){1&_&&(e.j41(0,"option",97),e.pXf(1,73),e.k0s())}function rn(_,i){1&_&&(e.j41(0,"option",97),e.pXf(1,74),e.k0s())}function cn(_,i){if(1&_&&(e.j41(0,"option",114),e.EFF(1),e.k0s()),2&_){const o=i.$implicit;e.Y8G("value",o),e.R7$(),e.SpI(" ",o," ")}}function On(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,75),e.k0s())}function dn(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,76),e.k0s())}function un(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,77),e.k0s())}function fn(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,78),e.k0s())}function En(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,79),e.k0s())}function Pn(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,80),e.k0s())}function Rn(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,81),e.k0s())}function mn(_,i){if(1&_&&(e.j41(0,"div")(1,"div",90)(2,"label",173),e.qex(3),e.pXf(4,65),e.bVm(),e.k0s(),e.j41(5,"div",92)(6,"select",174),e.DNE(7,ln,2,0,"option",138)(8,rn,2,0,"option",138)(9,cn,2,2,"option",98),e.k0s(),e.j41(10,"cd-help-text")(11,"span"),e.pXf(12,66),e.k0s()()()(),e.j41(13,"div",90)(14,"label",175),e.qex(15),e.pXf(16,67),e.bVm(),e.k0s(),e.j41(17,"div",92),e.nrm(18,"input",176),e.j41(19,"cd-help-text")(20,"span"),e.pXf(21,68),e.k0s()(),e.DNE(22,On,2,0,"span",94)(23,dn,2,0,"span",94)(24,un,2,0,"span",94),e.k0s()(),e.j41(25,"div",90)(26,"label",177),e.qex(27),e.pXf(28,69),e.bVm(),e.k0s(),e.j41(29,"div",92),e.nrm(30,"input",178),e.j41(31,"cd-help-text")(32,"span"),e.pXf(33,70),e.k0s()(),e.DNE(34,fn,2,0,"span",94)(35,En,2,0,"span",94)(36,Pn,2,0,"span",94),e.k0s()(),e.j41(37,"div",90)(38,"label",179),e.qex(39),e.pXf(40,71),e.bVm(),e.k0s(),e.j41(41,"div",92),e.nrm(42,"input",180),e.j41(43,"cd-help-text")(44,"span"),e.pXf(45,72),e.k0s()(),e.DNE(46,Rn,2,0,"span",94),e.k0s()()()),2&_){e.XpG(2);const o=e.sdS(2),t=e.XpG();e.R7$(7),e.Y8G("ngIf",!t.info.compression_algorithms),e.R7$(),e.Y8G("ngIf",t.info.compression_algorithms&&0===t.info.compression_algorithms.length),e.R7$(),e.Y8G("ngForOf",t.info.compression_algorithms),e.R7$(13),e.Y8G("ngIf",t.form.showError("minBlobSize",o,"min")),e.R7$(),e.Y8G("ngIf",t.form.showError("minBlobSize",o,"maximum")),e.R7$(),e.Y8G("ngIf",t.form.showError("minBlobSize",o,"pattern")),e.R7$(10),e.Y8G("ngIf",t.form.showError("maxBlobSize",o,"min")),e.R7$(),e.Y8G("ngIf",t.form.showError("maxBlobSize",o,"minimum")),e.R7$(),e.Y8G("ngIf",t.form.showError("maxBlobSize",o,"pattern")),e.R7$(10),e.Y8G("ngIf",t.form.showError("ratio",o,"min")||t.form.showError("ratio",o,"max"))}}function pn(_,i){if(1&_&&(e.j41(0,"div",170)(1,"legend"),e.pXf(2,63),e.k0s(),e.j41(3,"div",90)(4,"label",171),e.pXf(5,64),e.k0s(),e.j41(6,"div",92)(7,"select",172),e.DNE(8,an,2,2,"option",98),e.k0s(),e.j41(9,"cd-help-text"),e.EFF(10,"Policy used for compression algorithm"),e.k0s()()(),e.DNE(11,mn,47,10,"div",99),e.k0s()),2&_){const o=e.XpG(2);e.R7$(8),e.Y8G("ngForOf",o.info.compression_modes),e.R7$(3),e.Y8G("ngIf",o.hasCompressionEnabled())}}function Cn(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,82),e.k0s())}function Mn(_,i){1&_&&(e.j41(0,"span",113),e.pXf(1,83),e.k0s())}function gn(_,i){if(1&_){const o=e.RV6();e.j41(0,"div",85)(1,"form",86,0)(3,"div",87)(4,"div",88),e.pXf(5,9),e.nI1(6,"titlecase"),e.nI1(7,"upperFirst"),e.k0s(),e.j41(8,"div",89)(9,"div",90)(10,"label",91),e.pXf(11,10),e.k0s(),e.j41(12,"div",92),e.nrm(13,"input",93),e.DNE(14,st,2,0,"span",94)(15,at,2,0,"span",94)(16,lt,2,0,"span",94)(17,rt,2,0,"span",94),e.k0s()(),e.j41(18,"div",90)(19,"label",95),e.pXf(20,11),e.k0s(),e.j41(21,"div",92)(22,"select",96)(23,"option",97),e.pXf(24,12),e.k0s(),e.DNE(25,ct,2,2,"option",98),e.k0s(),e.DNE(26,Ot,2,0,"span",94),e.k0s()(),e.DNE(27,ht,10,4,"div",99),e.j41(28,"div",90)(29,"label",100),e.qex(30),e.pXf(31,13),e.bVm(),e.j41(32,"cd-helper")(33,"span"),e.pXf(34,14),e.k0s()()(),e.j41(35,"div",92)(36,"cd-select-badges",101),e.bIt("selection",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.appSelection())}),e.k0s(),e.DNE(37,Lt,1,3,"i",102)(38,St,2,0,"span",94),e.k0s()(),e.DNE(39,Ft,9,0,"div",103)(40,sn,6,3,"div",99)(41,pn,12,2,"div",104),e.j41(42,"div")(43,"legend"),e.pXf(44,15),e.k0s(),e.j41(45,"div",90)(46,"label",105),e.qex(47),e.pXf(48,16),e.bVm(),e.k0s(),e.j41(49,"div",92),e.nrm(50,"input",106),e.j41(51,"cd-help-text")(52,"span"),e.pXf(53,17),e.k0s(),e.nrm(54,"br"),e.j41(55,"span"),e.pXf(56,18),e.k0s()(),e.DNE(57,Cn,2,0,"span",94),e.k0s()(),e.j41(58,"div",90)(59,"label",107),e.qex(60),e.pXf(61,19),e.bVm(),e.k0s(),e.j41(62,"div",92),e.nrm(63,"input",108),e.j41(64,"cd-help-text")(65,"span"),e.pXf(66,20),e.k0s(),e.nrm(67,"br"),e.j41(68,"span"),e.pXf(69,21),e.k0s()(),e.DNE(70,Mn,2,0,"span",94),e.k0s()()(),e.j41(71,"div",109)(72,"cd-rbd-configuration-form",110),e.bIt("changes",function(n){e.eBV(o);const s=e.XpG();return e.Njj(s.currentConfigurationValues=n())}),e.k0s()()(),e.j41(73,"div",111)(74,"cd-form-button-panel",112),e.nI1(75,"titlecase"),e.nI1(76,"upperFirst"),e.bIt("submitActionEvent",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.submit())}),e.k0s()()()()()}if(2&_){const o=e.sdS(2),t=e.XpG();e.R7$(),e.Y8G("formGroup",t.form),e.R7$(6),e.uP7(e.bMT(6,28,t.action))(e.bMT(7,30,t.resource)),e.nnv(5),e.R7$(7),e.Y8G("ngIf",t.form.showError("name",o,"required")),e.R7$(),e.Y8G("ngIf",t.form.showError("name",o,"uniqueName")),e.R7$(),e.Y8G("ngIf",t.form.showError("name",o,"rbdPool")),e.R7$(),e.Y8G("ngIf",t.form.showError("name",o,"pattern")),e.R7$(8),e.Y8G("ngForOf",t.data.poolTypes),e.R7$(),e.Y8G("ngIf",t.form.showError("poolType",o,"required")),e.R7$(),e.Y8G("ngIf",t.isReplicated||t.isErasure),e.R7$(9),e.Y8G("customBadges",!0)("customBadgeValidators",t.data.applications.validators)("messages",t.data.applications.messages)("data",t.data.applications.selected)("options",t.data.applications.available)("selectionLimit",4),e.R7$(),e.Y8G("ngIf",t.data.applications.selected<=0),e.R7$(),e.Y8G("ngIf",!t.isApplicationsSelected&&t.data.applications.selected<=0),e.R7$(),e.Y8G("ngIf",t.data.applications.selected.includes("rbd")),e.R7$(),e.Y8G("ngIf",t.isErasure||t.isReplicated),e.R7$(),e.Y8G("ngIf",t.info.is_all_bluestore),e.R7$(16),e.Y8G("ngIf",t.form.showError("max_bytes",o,"pattern")),e.R7$(13),e.Y8G("ngIf",t.form.showError("max_objects",o,"min")),e.R7$(),e.Y8G("hidden",t.isErasure||-1===t.data.applications.selected.indexOf("rbd")),e.R7$(),e.Y8G("form",t.form)("initializeData",t.initializeConfigData),e.R7$(2),e.Y8G("form",t.form)("submitText",e.bMT(75,32,t.action)+" "+e.bMT(76,34,t.resource))}}let Be=(()=>{class _ extends Do.g{dimlessBinaryPipe;route;router;modalService;poolService;authStorageService;formatter;taskWrapper;ecpService;crushRuleService;actionLabels;rbdMirroringService;crushInfoTabs;crushDeletionBtn;ecpInfoTabs;ecpDeletionBtn;permission;form;ecProfiles;info;routeParamsSubscribe;editing=!1;isReplicated=!1;isErasure=!1;data=new Y_;externalPgChange=!1;current={rules:[]};initializeConfigData=new Ao.m(1);currentConfigurationValues={};action;resource;icons=I.F;pgAutoscaleModes;crushUsage=void 0;ecpUsage=void 0;crushRuleMaxSize=10;DEFAULT_RATIO=.875;isApplicationsSelected=!0;msrCrush=!1;modalSubscription;constructor(o,t,n,s,c,d,f,R,p,L,S,C){super(),this.dimlessBinaryPipe=o,this.route=t,this.router=n,this.modalService=s,this.poolService=c,this.authStorageService=d,this.formatter=f,this.taskWrapper=R,this.ecpService=p,this.crushRuleService=L,this.actionLabels=S,this.rbdMirroringService=C,this.editing=this.router.url.startsWith(`/pool/${h.Qp.EDIT}`),this.action=this.editing?this.actionLabels.EDIT:this.actionLabels.CREATE,this.resource="pool",this.authenticate(),this.createForm()}authenticate(){if(this.permission=this.authStorageService.getPermissions().pool,!this.permission.read||!this.permission.update&&this.editing||!this.permission.create&&!this.editing)throw new $o.YW}createForm(){const o=new ke.$({mode:new l.hs("none"),algorithm:new l.hs(""),minBlobSize:new l.hs("",{updateOn:"blur"}),maxBlobSize:new l.hs("",{updateOn:"blur"}),ratio:new l.hs(this.DEFAULT_RATIO,{updateOn:"blur"})});this.form=new ke.$({name:new l.hs("",{validators:[l.k0.pattern(/^[.A-Za-z0-9_/-]+$/),l.k0.required,u.xQ.custom("rbdPool",()=>this.form&&this.form.getValue("name").includes("/")&&this.data&&-1!==this.data.applications.selected.indexOf("rbd"))]}),poolType:new l.hs("",{validators:[l.k0.required]}),crushRule:new l.hs(null,{validators:[u.xQ.custom("tooFewOsds",t=>this.info&&t&&this.info.osd_count<1),u.xQ.custom("required",t=>this.isReplicated&&this.info?.crush_rules_replicated?.length>0&&!t)]}),size:new l.hs("",{updateOn:"blur"}),erasureProfile:new l.hs(null),pgNum:new l.hs("",{validators:[l.k0.required]}),pgAutoscaleMode:new l.hs(null),ecOverwrites:new l.hs(!1),compression:o,max_bytes:new l.hs(""),max_objects:new l.hs(0),rbdMirroring:new l.hs(!1)},[u.xQ.custom("form",()=>null)])}ngOnInit(){this.poolService.getInfo().subscribe(o=>{this.initInfo(o),this.editing?this.initEditMode():(this.setAvailableApps(),this.loadingReady()),this.listenToChanges(),this.setComplexValidators()}),this.erasureProfileChange()}initInfo(o){this.pgAutoscaleModes=o.pg_autoscale_modes,this.form.silentSet("pgAutoscaleMode",o.pg_autoscale_default_mode),this.form.silentSet("algorithm",o.bluestore_compression_algorithm),this.info=o,this.initEcp(o.erasure_code_profiles)}initEcp(o){this.setListControlStatus("erasureProfile",o),this.ecProfiles=o}setListControlStatus(o,t){const n=this.form.get(o),s=n.value;1!==t.length||s&&P().isEqual(s,t[0])?0===t.length&&s&&n.setValue(null):n.setValue(t[0]),t.length<=1?n.enabled&&n.disable():n.disabled&&n.enable()}initEditMode(){this.disableForEdit(),this.routeParamsSubscribe=this.route.params.subscribe(o=>this.poolService.get(o.name).subscribe(t=>{this.data.pool=t,this.initEditFormData(t),this.loadingReady()}))}disableForEdit(){["poolType","crushRule","size","erasureProfile","ecOverwrites"].forEach(o=>this.form.get(o).disable())}initEditFormData(o){this.initializeConfigData.next({initialData:o.configuration,sourceType:Go.M.pool}),this.poolTypeChange(o.type);const t=this.info.crush_rules_replicated.concat(this.info.crush_rules_erasure),n={name:o.pool_name,poolType:o.type,crushRule:t.find(s=>s.rule_name===o.crush_rule),size:o.size,erasureProfile:this.ecProfiles.find(s=>s.name===o.erasure_code_profile),pgAutoscaleMode:o.pg_autoscale_mode,pgNum:o.pg_num,ecOverwrites:o.flags_names.includes("ec_overwrites"),mode:o.options.compression_mode,algorithm:o.options.compression_algorithm,minBlobSize:this.dimlessBinaryPipe.transform(o.options.compression_min_blob_size),maxBlobSize:this.dimlessBinaryPipe.transform(o.options.compression_max_blob_size),ratio:o.options.compression_required_ratio,max_bytes:this.dimlessBinaryPipe.transform(o.quota_max_bytes),max_objects:o.quota_max_objects};Object.keys(n).forEach(s=>{const c=n[s];!P().isUndefined(c)&&""!==c&&this.form.silentSet(s,c)}),this.data.pgs=this.form.getValue("pgNum"),this.setAvailableApps(this.data.applications.default.concat(o.application_metadata)),this.data.applications.selected=o.application_metadata,this.rbdMirroringService.getPool(o.pool_name).subscribe(s=>{this.form.get("rbdMirroring").setValue("pool"===s.mirror_mode)})}setAvailableApps(o=this.data.applications.default){this.data.applications.available=P().uniq(o.sort()).map(t=>new vo.O(!1,t,this.data.APP_LABELS[t]||t))}listenToChanges(){this.listenToChangesDuringAddEdit(),this.editing||this.listenToChangesDuringAdd()}listenToChangesDuringAddEdit(){this.form.get("pgNum").valueChanges.subscribe(o=>{const t=o-this.data.pgs;1===Math.abs(t)&&2!==o?this.doPgPowerJump(t):this.data.pgs=o})}doPgPowerJump(o){const t=this.calculatePgPower()+o;this.setPgs(-1===o?Math.round(t):Math.floor(t))}calculatePgPower(o=this.form.getValue("pgNum")){return Math.log(o)/Math.log(2)}setPgs(o){const t=Math.pow(2,o<0?0:o);this.data.pgs=t,this.form.silentSet("pgNum",t)}listenToChangesDuringAdd(){this.form.get("poolType").valueChanges.subscribe(o=>{this.poolTypeChange(o)}),this.form.get("crushRule").valueChanges.subscribe(o=>{this.crushDeletionBtn&&this.crushDeletionBtn.isOpen()&&this.crushDeletionBtn.close(),o&&(this.setCorrectMaxSize(o),this.crushRuleIsUsedBy(o.rule_name),this.replicatedRuleChange(),this.pgCalc())}),this.form.get("size").valueChanges.subscribe(()=>{this.pgCalc()}),this.form.get("erasureProfile").valueChanges.subscribe(o=>{this.ecpDeletionBtn&&this.ecpDeletionBtn.isOpen()&&this.ecpDeletionBtn.close(),o&&(this.ecpIsUsedBy(o.name),this.pgCalc())}),this.form.get("mode").valueChanges.subscribe(()=>{["minBlobSize","maxBlobSize","ratio"].forEach(o=>{this.form.get(o).updateValueAndValidity({emitEvent:!1})})}),this.form.get("minBlobSize").valueChanges.subscribe(()=>{this.form.get("maxBlobSize").updateValueAndValidity({emitEvent:!1})}),this.form.get("maxBlobSize").valueChanges.subscribe(()=>{this.form.get("minBlobSize").updateValueAndValidity({emitEvent:!1})})}poolTypeChange(o){if("replicated"===o?this.setTypeBooleans(!0,!1):this.setTypeBooleans(!1,"erasure"===o),!o||!this.info)return void(this.current.rules=[]);const t=this.info["crush_rules_"+o]||[];this.current.rules=t,!this.editing&&(this.isReplicated&&this.setListControlStatus("crushRule",t),this.replicatedRuleChange(),this.pgCalc())}setTypeBooleans(o,t){this.isReplicated=o,this.isErasure=t}replicatedRuleChange(){if(!this.isReplicated)return;const o=this.form.get("size");let t=this.form.getValue("size")||3;const n=this.getMinSize(),s=this.getMaxSize();t<n?t=n:t>s&&(t=s),t!==o.value&&this.form.silentSet("size",t)}getMinSize(){return!this.info||this.info.osd_count<1?0:1}getMaxSize(){const o=this.form.getValue("crushRule");return this.info?o?o.usable_size:Math.min(this.info.osd_count,3):0}pgCalc(){const o=this.form.getValue("poolType");if(!this.info||this.form.get("pgNum").dirty||!o)return;const t=100*this.info.osd_count,n=this.isReplicated?this.replicatedPgCalc(t):this.erasurePgCalc(t);if(!n)return;const s=this.data.pgs;this.alignPgs(n),this.externalPgChange||(this.externalPgChange=s!==this.data.pgs)}setCorrectMaxSize(o=this.form.getValue("crushRule")){if(!o)return;const n=T.searchFailureDomains(this.info.nodes,o.steps[0].item_name)[o.steps[1].type];o.usable_size=Math.min(n?n.length:this.crushRuleMaxSize,this.crushRuleMaxSize)}replicatedPgCalc(o){const t=this.form.get("size"),n=t.value;return t.valid&&n>0?o/n:0}erasurePgCalc(o){const t=this.form.get("erasureProfile"),n=t.value;return(t.valid||t.disabled)&&n?o/(n.k+n.m):0}alignPgs(o=this.form.getValue("pgNum")){this.setPgs(Math.round(this.calculatePgPower(o<1?1:o)))}setComplexValidators(){this.editing?this.form.get("name").setValidators([this.form.get("name").validator,u.xQ.custom("uniqueName",o=>this.data.pool&&this.info&&-1!==this.info.pool_names.indexOf(o)&&this.info.pool_names.indexOf(o)!==this.info.pool_names.indexOf(this.data.pool.pool_name))]):(u.xQ.validateIf(this.form.get("size"),()=>this.isReplicated,[u.xQ.custom("min",o=>this.form.getValue("size")&&o<this.getMinSize()),u.xQ.custom("max",o=>this.form.getValue("size")&&this.getMaxSize()<o)]),this.form.get("name").setValidators([this.form.get("name").validator,u.xQ.custom("uniqueName",o=>this.info&&-1!==this.info.pool_names.indexOf(o))])),this.setCompressionValidators()}setCompressionValidators(){u.xQ.validateIf(this.form.get("minBlobSize"),()=>this.hasCompressionEnabled(),[l.k0.min(0),u.xQ.custom("maximum",o=>this.oddBlobSize(o,this.form.getValue("maxBlobSize")))]),u.xQ.validateIf(this.form.get("maxBlobSize"),()=>this.hasCompressionEnabled(),[l.k0.min(0),u.xQ.custom("minimum",o=>this.oddBlobSize(this.form.getValue("minBlobSize"),o))]),u.xQ.validateIf(this.form.get("ratio"),()=>this.hasCompressionEnabled(),[l.k0.min(0),l.k0.max(1)])}oddBlobSize(o,t){const n=this.formatter.toBytes(o),s=this.formatter.toBytes(t);return!!(n&&s&&n>=s)}hasCompressionEnabled(){return this.form.getValue("mode")&&"none"!==this.form.get("mode").value.toLowerCase()}describeCrushStep(o){return[o.op.replace("_"," "),o.item_name||"",o.type?o.num+" type "+o.type:""].join(" ")}addErasureCodeProfile(){this.addModal(V_,o=>this.reloadECPs(o))}addModal(o,t){this.hideOpenTooltips(),this.modalService.show(o).componentInstance.submitAction.subscribe(s=>{t(s.name)})}hideOpenTooltips(){const o=t=>t&&t.isOpen()&&t.close();o(this.ecpDeletionBtn),o(this.crushDeletionBtn)}reloadECPs(o){this.reloadList({newItemName:o,getInfo:()=>this.ecpService.list(),initInfo:t=>this.initEcp(t),findNewItem:()=>this.ecProfiles.find(t=>t.name===o),controlName:"erasureProfile"})}reloadList({newItemName:o,getInfo:t,initInfo:n,findNewItem:s,controlName:c}){this.modalSubscription&&this.modalSubscription.unsubscribe(),t().subscribe(d=>{if(n(d),!o)return;const f=s();f&&this.form.get(c).setValue(f)})}deleteErasureCodeProfile(){this.deletionModal({value:this.form.getValue("erasureProfile"),usage:this.ecpUsage,deletionBtn:this.ecpDeletionBtn,dataName:"erasureInfo",getTabs:()=>this.ecpInfoTabs,tabPosition:"used-by-pools",nameAttribute:"name",itemDescription:"skasuj profil kodu",reloadFn:()=>this.reloadECPs(),deleteFn:o=>this.ecpService.delete(o),taskName:"ecp/delete"})}deletionModal({value:o,usage:t,deletionBtn:n,dataName:s,getTabs:c,tabPosition:d,nameAttribute:f,itemDescription:R,reloadFn:p,deleteFn:L,taskName:S}){if(!o)return;if(t)return n.animation=!1,n.toggle(),this.data[s]=!0,void setTimeout(()=>{const M=c();M&&M.select(d)},50);const C=o[f];this.modalService.show(Ue.D,{itemDescription:R,itemNames:[C],submitActionObservable:()=>{const M=L(C);return M.subscribe(()=>p()),this.taskWrapper.wrapTaskAroundCall({task:new v.O(S,{name:C}),call:M})}})}addCrushRule(){this.addModal(qo,o=>this.reloadCrushRules(o))}reloadCrushRules(o){this.reloadList({newItemName:o,getInfo:()=>this.poolService.getInfo(),initInfo:t=>{this.initInfo(t),this.poolTypeChange("replicated")},findNewItem:()=>this.info.crush_rules_replicated.find(t=>t.rule_name===o),controlName:"crushRule"})}deleteCrushRule(){this.deletionModal({value:this.form.getValue("crushRule"),usage:this.crushUsage,deletionBtn:this.crushDeletionBtn,dataName:"crushInfo",getTabs:()=>this.crushInfoTabs,tabPosition:"used-by-pools",nameAttribute:"rule_name",itemDescription:"crush rule",reloadFn:()=>this.reloadCrushRules(),deleteFn:o=>this.crushRuleService.delete(o),taskName:"crushRule/delete"})}crushRuleIsUsedBy(o){this.crushUsage=o?this.info.used_rules[o]:void 0}ecpIsUsedBy(o){this.ecpUsage=o?this.info.used_profiles[o]:void 0}submit(){if(this.form.invalid)return void this.form.setErrors({cdSubmitButton:!0});const o={pool:this.form.getValue("name")};this.assignFormFields(o,[{externalFieldName:"pool_type",formControlName:"poolType"},{externalFieldName:"pg_autoscale_mode",formControlName:"pgAutoscaleMode",editable:!0},{externalFieldName:"pg_num",formControlName:"pgNum",replaceFn:n=>"on"===this.form.getValue("pgAutoscaleMode")?1:n,editable:!0},this.isReplicated?{externalFieldName:"size",formControlName:"size"}:{externalFieldName:"erasure_code_profile",formControlName:"erasureProfile",attr:"name"},{externalFieldName:"rule_name",formControlName:"crushRule",replaceFn:n=>this.isReplicated?n&&n.rule_name:void 0},{externalFieldName:"quota_max_bytes",formControlName:"max_bytes",replaceFn:this.formatter.toBytes,editable:!0,resetValue:this.editing?0:void 0},{externalFieldName:"quota_max_objects",formControlName:"max_objects",editable:!0,resetValue:this.editing?0:void 0},this.data.applications.selected.includes("rbd")?{externalFieldName:"rbd_mirroring",formControlName:"rbdMirroring"}:{externalFieldName:"rbd_mirroring",formControlName:"rbdMirroring",resetValue:void 0}]),this.info.is_all_bluestore&&(this.assignFormField(o,{externalFieldName:"flags",formControlName:"ecOverwrites",replaceFn:()=>this.isErasure?["ec_overwrites"]:void 0}),"none"!==this.form.getValue("mode")?this.assignFormFields(o,[{externalFieldName:"compression_mode",formControlName:"mode",editable:!0,replaceFn:n=>this.hasCompressionEnabled()&&n},{externalFieldName:"compression_algorithm",formControlName:"algorithm",editable:!0},{externalFieldName:"compression_min_blob_size",formControlName:"minBlobSize",replaceFn:this.formatter.toBytes,editable:!0,resetValue:0},{externalFieldName:"compression_max_blob_size",formControlName:"maxBlobSize",replaceFn:this.formatter.toBytes,editable:!0,resetValue:0},{externalFieldName:"compression_required_ratio",formControlName:"ratio",editable:!0,resetValue:0}]):this.editing&&this.assignFormFields(o,[{externalFieldName:"compression_mode",formControlName:"mode",editable:!0,replaceFn:()=>"unset"},{externalFieldName:"srcpool",formControlName:"name",editable:!0,replaceFn:()=>this.data.pool.pool_name}]));const t=this.data.applications.selected;t.length>0||this.editing?(o.application_metadata=t,t.includes("rbd")&&(o.rbd_mirroring=this.form.getValue("rbdMirroring")),this.isApplicationsSelected=!0):this.isApplicationsSelected=!1,this.isReplicated&&!P().isEmpty(this.currentConfigurationValues)&&(o.configuration=this.currentConfigurationValues),this.isApplicationsSelected?this.triggerApiTask(o):this.form.setErrors({cdSubmitButton:!0})}assignFormFields(o,t){t.forEach(n=>this.assignFormField(o,n))}assignFormField(o,{externalFieldName:t,formControlName:n,attr:s,replaceFn:c,editable:d,resetValue:f}){if(this.editing&&(!d||this.form.get(n).pristine))return;const R=this.form.getValue(n);let p=c?c(R):s?P().get(R,s):R;if(!R||!p){if(!d||P().isUndefined(f))return;p=f}o[t]=p}triggerApiTask(o){const t=o.hasOwnProperty("srcpool")?o.srcpool:o.pool;this.taskWrapper.wrapTaskAroundCall({task:new v.O("pool/"+(this.editing?h.Qp.EDIT:h.Qp.CREATE),{pool_name:t}),call:this.poolService[this.editing?h.Qp.UPDATE:h.Qp.CREATE](o)}).subscribe({error:n=>{P().isObject(n.error)&&"34"===n.error.code&&this.form.get("pgNum").setErrors({34:!0}),this.form.setErrors({cdSubmitButton:!0})},complete:()=>this.router.navigate(["/pool"])})}appSelection(){this.form.get("name").updateValueAndValidity({emitEvent:!1,onlySelf:!0})}erasureProfileChange(){const o=this.form.get("erasureProfile").value;o&&(this.msrCrush=o["crush-num-failure-domains"]>0||o["crush-osds-per-failure-domain"]>0)}static \u0275fac=function(t){return new(t||_)(e.rXU(Xo.l),e.rXU(pe.nX),e.rXU(pe.Ix),e.rXU(q_.B),e.rXU(ge.m),e.rXU(Ve.v),e.rXU(yo.k),e.rXU(Me.a),e.rXU(Ie),e.rXU(He.j),e.rXU(h.Ss),e.rXU(B_.B))};static \u0275cmp=e.VBU({type:_,selectors:[["cd-pool-form"]],viewQuery:function(t,n){if(1&t&&(e.GBs(et,5),e.GBs(ot,5),e.GBs(_t,5),e.GBs(tt,5)),2&t){let s;e.mGM(s=e.lsd())&&(n.crushInfoTabs=s.first),e.mGM(s=e.lsd())&&(n.crushDeletionBtn=s.first),e.mGM(s=e.lsd())&&(n.ecpInfoTabs=s.first),e.mGM(s=e.lsd())&&(n.ecpDeletionBtn=s.first)}},features:[e.Vt3],decls:1,vars:1,consts:()=>{let o,t,n,s,c,d,f,R,p,L,S,C,M,F,m,D,G,X,y,U,k,x,H,z,j,V,w,Y,B,q,Q,J,W,K,Z,ee,oe,_e,te,A,ne,ie,se,ae,le,re,ce,Oe,de,ue,fe,Ee,Pe,$,Re,me,O,Ke,Ze,eo,oo,_o,to,no,io,so,ao,lo,ro,co,Oo,uo,fo,Eo,Po,Ro,mo,po,Co,Mo,go,ho,Lo,So;return o="Nazwa...",t="Pools should be associated with an application tag",n="np. 10 GiB",s="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",c="Nazwa",d="Typ pula",f="-- Wybierz typ pula --",R="Zastosowania",p="Pools need to be associated with an application before use",L="Quotas",S="Max bytes",C="Leave it blank or specify 0 to disable this quota.",M="A valid quota should be greater than 0.",F="Max objects",m="Leave it blank or specify 0 to disable this quota.",D="A valid quota should be greater than 0.",G="To pole jest wymagane.",X="Wybrana nazwa Ceph pula jest ju\u017C u\u017Cyta.",y="It's not possible to create an RBD pool with '/' in the name. Please change the name or remove 'rbd' from the applications list.",U="Pool name can only contain letters, numbers, '.', '-', '_' or '/'.",k="To pole jest wymagane.",x="PG Autoscale",H="Pomoc obliczeniowa",z="Grupa umieszczenia",j="To pole jest wymagane.",V="Przynajmniej jedna grupa umieszczenia jest wymagana",w="Tw\xF3j klaster nie obs\u0142uguje tylu PG. Skalkuluj prosz\u0119 potrzebn\u0105 ilo\u015B\u0107 PG.",Y="The current PGs settings were calculated for you, you should make sure the values suit your needs before submit.",B="Replikowany rozmiar",q="Minimum: " + "\ufffd0\ufffd" + "",Q="Maximum: " + "\ufffd0\ufffd" + "",J="The size specified is out of range. A value from " + "\ufffd0\ufffd" + " to " + "\ufffd1\ufffd" + " is usable.",W="A size of 1 will not create a replication of the object. The 'Replicated size' includes the object itself.",K="Flagi",Z="EC Nadpisuje",ee="Application selection is required!",oe="Kopia lustrzana",_e="Check this option to enable Pool based mirroring on a Block(RBD) pool.",te="CRUSH",A="This profile can't be deleted as it is in use.",ne="Skasuj profil kodu.",ie="\u0141adowanie...",se="-- Brak profilu kasowania --",ae="-- Wybierz profil kodu wymazywania --",le="Profile",re="Used by pools",ce="Profile is not in use.",Oe="zbi\xF3r zasad Crush",de="A new crush ruleset will be implicitly created.",ue="A new crush MSR ruleset will be implicitly created. When crush-osds-per-failure-domain or crush-num-failure-domains is specified",fe="zbi\xF3r zasad Crush",Ee="There are no rules.",Pe="Placement and\n                          replication strategies or distribution policies that allow to\n                          specify how CRUSH places data replicas.",$="This rule can't be deleted as it is in use.",Re="-- Wybierz zasad\u0119 Crush --",me="zasada Crush",O="Kroki Crush",Ke="Used by pools",Ze="Rule is not in use.",eo="To pole jest wymagane.",oo="The rule can't be used in the current cluster as it has too few OSDs to meet the minimum required OSD by this rule.",_o="Kompresja",to="Mode ",no="np. 128 KB",io="np. 512 KB",so="Algorytm",ao="Compression algorithm used",lo="Minimalny rozmiar blob",ro="Chunks smaller than Minimum blob size are never compressed",co="Maksymalny rozmiar blob",Oo="Chunks larger than `Maximum Blob Size` are broken into smaller blobs of size mentioned before being compressed.",uo="Stosunek",fo="The ratio of the size of the data chunk after compression relative to the original size must be at least this small in order to store the compressed version",Eo="\u0141adowanie...",Po="-- Brak algorytmu kompresji wymazywania --",Ro="Warto\u015B\u0107 powinna by\u0107 wi\u0119ksza ni\u017C 0",mo="Value should be less than the maximum blob size",po="Size must be a number or in a valid format. eg: 5 GiB",Co="Warto\u015B\u0107 powinna by\u0107 wi\u0119ksza ni\u017C 0",Mo="Warto\u015B\u0107 powinna by\u0107 wi\u0119ksza ni\u017C minimalny rozmiar blob",go="Size must be a number or in a valid format. eg: 5 GiB",ho="Warto\u015B\u0107 powinna by\u0107 pomi\u0119dzy 0.0, a 1.0",Lo="Size must be a number or in a valid format. eg: 5 GiB",So="The value should be greater or equal to 0",[["formDir","ngForm"],["ecpDeletionBtn","ngbTooltip"],["ecpInfoTabs","ngbNav"],["ecpIsNotUsed",""],["msrCrushText",""],["noRules",""],["crushDeletionBtn","ngbTooltip"],["crushInfoTabs","ngbNav"],["ruleIsNotUsed",""],s,c,d,f,R,p,L,S,C,M,F,m,D,G,X,y,U,k,x,z,j,V,w,Y,B,q,Q,J,W,K,Z,ee,oe,_e,te,ne,ie,se,ae,le,re,ce,Oe,de,ue,fe,Ee,Re,me,O,Ke,Ze,eo,oo,_o,to,so,ao,lo,ro,co,Oo,uo,fo,Eo,Po,Ro,mo,po,Co,Mo,go,ho,Lo,So,["class","cd-col-form",4,"cdFormLoading"],[1,"cd-col-form"],["name","form","novalidate","",3,"formGroup"],[1,"card"],[1,"card-header"],[1,"card-body"],[1,"form-group","row"],["for","name",1,"cd-col-form-label","required"],[1,"cd-col-form-input"],["id","name","name","name","type","text","placeholder",o,"formControlName","name","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","poolType",1,"cd-col-form-label","required"],["id","poolType","formControlName","poolType","name","poolType",1,"form-select"],["ngValue",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["for","applications",1,"cd-col-form-label","required"],["id","applications","name","applications",3,"selection","customBadges","customBadgeValidators","messages","data","options","selectionLimit"],["title",t,3,"class",4,"ngIf"],["class","form-group row",4,"ngIf"],["formGroupName","compression",4,"ngIf"],["for","max_bytes",1,"cd-col-form-label"],["id","max_bytes","name","max_bytes","type","text","formControlName","max_bytes","placeholder",n,"defaultUnit","GiB","cdDimlessBinary","",1,"form-control"],["for","max_objects",1,"cd-col-form-label"],["id","max_objects","min","0","name","max_objects","type","number","formControlName","max_objects",1,"form-control"],[3,"hidden"],[3,"changes","form","initializeData"],[1,"card-footer"],["wrappingClass","text-right",3,"submitActionEvent","form","submitText"],[1,"invalid-feedback"],[3,"value"],["for","pgAutoscaleMode",1,"cd-col-form-label"],["id","pgAutoscaleMode","name","pgAutoscaleMode","formControlName","pgAutoscaleMode",1,"form-select"],["for","pgNum",1,"cd-col-form-label","required"],["id","pgNum","name","pgNum","formControlName","pgNum","min","1","type","number","required","",1,"form-control",3,"focus","blur"],[1,"form-text","text-muted"],["section","pgs","docText",H],["class","form-text text-muted",4,"ngIf"],["for","size",1,"cd-col-form-label","required"],["id","size","name","size","type","number","formControlName","size",1,"form-control",3,"max","min"],["class","text-warning-dark",4,"ngIf"],[1,"list-inline"],[1,"text-warning-dark"],[1,"cd-col-form-label"],[1,"custom-control","custom-checkbox"],["type","checkbox","id","ec-overwrites","formControlName","ecOverwrites",1,"custom-control-input"],["for","ec-overwrites",1,"custom-control-label"],["title",t],[1,"cd-col-form-offset"],["id","rbdMirroring","name","rbdMirroring","type","checkbox","formControlName","rbdMirroring",1,"custom-control-input"],["for","rbdMirroring",1,"custom-control-label"],["for","erasureProfile",1,"cd-col-form-label"],[1,"input-group","mb-1"],["id","erasureProfile","name","erasureProfile","formControlName","erasureProfile",1,"form-select",3,"change"],["ngValue","",4,"ngIf"],[3,"ngValue",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],["id","ecp-info-button","type","button",1,"btn","btn-light",3,"click","ngClass"],["aria-hidden","true",3,"ngClass"],["class","btn btn-light","type","button",3,"click",4,"ngIf"],["class","btn btn-light","type","button","ngbTooltip",A,"triggers","manual",3,"click",4,"ngIf"],["class","form-text text-muted","id","ecp-info-block",4,"ngIf"],[3,"ngValue"],["type","button",1,"btn","btn-light",3,"click"],["type","button","ngbTooltip",A,"triggers","manual",1,"btn","btn-light",3,"click"],["id","ecp-info-block",1,"form-text","text-muted"],["ngbNav","",1,"nav-tabs"],["ngbNavItem","ecp-info"],["ngbNavLink",""],["ngbNavContent",""],["ngbNavItem","used-by-pools"],[3,"ngbNavOutlet"],[3,"renderObjects","hideKeys","data","autoReload"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],["for","crushRule",1,"cd-col-form-label"],["class","form-text text-muted",4,"ngIf","ngIfElse"],[1,"input-group"],["id","crushRule","formControlName","crushRule","name","crushSet",1,"form-select"],["id","crush-info-button","type","button","ngbTooltip",Pe,1,"btn","btn-light",3,"click","ngClass"],["class","btn btn-light","type","button","ngbTooltip",$,"triggers","manual",3,"click",4,"ngIf"],["class","form-text text-muted","id","crush-info-block",4,"ngIf"],["type","button","ngbTooltip",$,"triggers","manual",1,"btn","btn-light",3,"click"],["id","crush-info-block",1,"form-text","text-muted"],["ngbNavItem","crush-rule-info"],["ngbNavItem","crush-rule-steps"],["formGroupName","compression"],["for","mode",1,"cd-col-form-label"],["id","mode","name","mode","formControlName","mode",1,"form-select"],["for","algorithm",1,"cd-col-form-label"],["id","algorithm","name","algorithm","formControlName","algorithm",1,"form-select"],["for","minBlobSize",1,"cd-col-form-label"],["id","minBlobSize","name","minBlobSize","formControlName","minBlobSize","type","text","min","0","placeholder",no,"defaultUnit","KiB","cdDimlessBinary","",1,"form-control"],["for","maxBlobSize",1,"cd-col-form-label"],["id","maxBlobSize","type","text","min","0","formControlName","maxBlobSize","placeholder",io,"defaultUnit","KiB","cdDimlessBinary","",1,"form-control"],["for","ratio",1,"cd-col-form-label"],["id","ratio","name","ratio","formControlName","ratio","type","number","min","0","max","1","step","0.1",1,"form-control"]]},template:function(t,n){1&t&&e.DNE(0,gn,77,36,"div",84),2&t&&e.Y8G("cdFormLoading",n.loading)},dependencies:[g.YU,g.Sq,g.bT,E.Um,E.X9,E.sy,E.Ri,E.WA,E.m_,he.m,Q_.U,J_.C,Le.e,Se.O,we.i,Fe.B,W_.Y,K_.G,Te.S,Ne.a,be.C,Ae.E,l.qT,l.xH,l.y7,l.me,l.Q0,l.Zm,l.wz,l.BC,l.cb,l.YS,l.VZ,l.zX,l.j4,l.JD,l.$R,E.md,Z_.c,g.PV,$e.r],styles:[".icon-warning-color[_ngcontent-%COMP%]{margin-left:3px}"]})}return _})();var hn=r(41483),Ln=r(97421),Sn=r(25947),ve=r(2243),De=r(62847),N=r(2148),Fn=r(29130),Tn=r(19380),Nn=r(18457),qe=r(58510),Ge=r(2361);class bn{cache_target_full_ratio_micro;fast_read;stripe_width;flags_names;tier_of;hit_set_grade_decay_rate;use_gmt_hitset;last_force_op_resend_preluminous;quota_max_bytes;erasure_code_profile;expected_num_objects;size;snap_seq;auid;cache_min_flush_age;hit_set_period;min_read_recency_for_promote;target_max_objects;pg_num;pg_num_target;pg_num_pending;pg_placement_num;pg_placement_num_target;pg_autoscale_mode;pg_status;type;pool_name;cache_min_evict_age;cache_mode;min_size;cache_target_dirty_high_ratio_micro;object_hash;application_metadata;write_tier;cache_target_dirty_ratio_micro;pool;removed_snaps;cdExecuting;executingTasks;crush_rule;tiers;hit_set_params;last_force_op_resend;pool_snaps;quota_max_objects;options;hit_set_count;flags;target_max_bytes;hit_set_search_last_n;last_change;min_write_recency_for_promote;read_tier;stats;cdIsBinary;configuration;constructor(i){this.pool_name=i}}var An=r(22453),$n=r(94254),In=r(10978),vn=r(40837),Qe=r(1505),Dn=r(32295),Gn=r(45843),Xn=r(71656),Je=r(32609),yn=r(62988),Un=r(15224);function kn(_,i){if(1&_&&e.nrm(0,"cd-table-key-value",14),2&_){const o=e.XpG(2);e.Y8G("renderObjects",!0)("data",o.poolDetails)("autoReload",!1)}}function xn(_,i){if(1&_&&e.nrm(0,"cd-grafana",16),2&_){const o=e.XpG(3);e.Mz_("grafanaPath","ceph-pool-detail?var-pool_name=",o.selection.pool_name,""),e.Y8G("type","metrics")}}function Hn(_,i){1&_&&(e.qex(0,15),e.j41(1,"a",8),e.pXf(2,2),e.k0s(),e.DNE(3,xn,1,3,"ng-template",9),e.bVm())}function zn(_,i){if(1&_&&e.nrm(0,"cd-rbd-configuration-table",18),2&_){const o=e.XpG(3);e.Y8G("data",o.selectedPoolConfiguration)}}function jn(_,i){1&_&&(e.qex(0,17),e.j41(1,"a",8),e.pXf(2,3),e.k0s(),e.DNE(3,zn,1,1,"ng-template",9),e.bVm())}function Vn(_,i){if(1&_&&e.nrm(0,"cd-table",20),2&_){const o=e.XpG(3);e.Y8G("data",o.cacheTiers)("columns",o.cacheTierColumns)("autoSave",!1)}}function wn(_,i){1&_&&(e.qex(0,19),e.j41(1,"a",8),e.pXf(2,4),e.k0s(),e.DNE(3,Vn,1,3,"ng-template",9),e.bVm())}function Yn(_,i){if(1&_&&(e.qex(0),e.j41(1,"nav",6,0),e.qex(3,7),e.j41(4,"a",8),e.pXf(5,1),e.k0s(),e.DNE(6,kn,1,3,"ng-template",9),e.bVm(),e.DNE(7,Hn,4,0,"ng-container",10)(8,jn,4,0,"ng-container",11)(9,wn,4,0,"ng-container",12),e.k0s(),e.nrm(10,"div",13),e.bVm()),2&_){const o=e.sdS(2),t=e.XpG();e.R7$(7),e.Y8G("ngIf",t.permissions.grafana.read),e.R7$(),e.Y8G("ngIf","replicated"===t.selection.type),e.R7$(),e.Y8G("ngIf",(null==t.selection.tiers?null:t.selection.tiers.length)>0),e.R7$(),e.Y8G("ngbNavOutlet",o)}}let Bn=(()=>{class _{poolService;cacheTiers;permissions;selection;cacheTierColumns=[];omittedPoolAttributes=["cdExecuting","cdIsBinary","stats"];poolDetails;selectedPoolConfiguration;constructor(o){this.poolService=o,this.cacheTierColumns=[{prop:"pool_name",name:"Nazwa",flexGrow:3},{prop:"cache_mode",name:"Tryb pami\u0119ci podr\u0119cznej",flexGrow:2},{prop:"cache_min_evict_age",name:"Min wiek eksmisji",flexGrow:2},{prop:"cache_min_flush_age",name:"Min wiek wyr\xF3wnania ",flexGrow:2},{prop:"target_max_bytes",name:"Max bajt\xF3w obiektu docelowego ",flexGrow:2},{prop:"target_max_objects",name:"Max obiekt\xF3w docelowych",flexGrow:2}]}ngOnChanges(){this.selection&&(this.poolService.getConfiguration(this.selection.pool_name).subscribe(o=>{Je.c.updateChanged(this,{selectedPoolConfiguration:o})}),Je.c.updateChanged(this,{poolDetails:P().omit(this.selection,this.omittedPoolAttributes)}))}static \u0275fac=function(t){return new(t||_)(e.rXU(ge.m))};static \u0275cmp=e.VBU({type:_,selectors:[["cd-pool-details"]],inputs:{cacheTiers:"cacheTiers",permissions:"permissions",selection:"selection"},features:[e.OA$],decls:1,vars:1,consts:()=>{let o,t,n,s,c;return o="Szczeg\xF3\u0142y",t="Szczeg\xF3\u0142y wydajno\u015Bci",n="Pool details",s="Konfiguracja",c="Szczeg\xF3\u0142y poziom\xF3w pami\u0119ci podr\u0119cznej",[["nav","ngbNav"],o,t,s,c,[4,"ngIf"],["ngbNav","","cdStatefulTab","pool-details",1,"nav-tabs"],["ngbNavItem","details"],["ngbNavLink",""],["ngbNavContent",""],["ngbNavItem","performance-details",4,"ngIf"],["ngbNavItem","configuration",4,"ngIf"],["ngbNavItem","cache-tiers-details",4,"ngIf"],[3,"ngbNavOutlet"],[3,"renderObjects","data","autoReload"],["ngbNavItem","performance-details"],["title",n,"uid","-xyV8KCiz","grafanaStyle","three",3,"grafanaPath","type"],["ngbNavItem","configuration"],[3,"data"],["ngbNavItem","cache-tiers-details"],["columnMode","flex",3,"data","columns","autoSave"]]},template:function(t,n){1&t&&e.DNE(0,Yn,11,4,"ng-container",5),2&t&&e.Y8G("ngIf",n.selection)},dependencies:[g.bT,E.Um,E.X9,E.sy,E.Ri,E.WA,E.m_,Qe.c,De.O,we.i,yn.B,Un.k],changeDetection:0})}return _})();const qn=["poolUsageTpl"],Qn=["poolConfigurationSourceTpl"];function Jn(_,i){if(1&_&&e.nrm(0,"cd-pool-details",14),2&_){const o=e.XpG(2);e.Y8G("selection",o.expandedRow)("permissions",o.permissions)("cacheTiers",o.cacheTiers)}}function Wn(_,i){if(1&_){const o=e.RV6();e.j41(0,"cd-table",11,2),e.bIt("fetchData",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.taskListService.fetch())})("setExpandedRow",function(n){e.eBV(o);const s=e.XpG();return e.Njj(s.setExpandedRow(n))})("updateSelection",function(n){e.eBV(o);const s=e.XpG();return e.Njj(s.updateSelection(n))}),e.nrm(2,"cd-table-actions",12),e.DNE(3,Jn,1,3,"cd-pool-details",13),e.k0s()}if(2&_){const o=e.XpG();e.Y8G("data",o.pools)("columns",o.columns)("hasDetails",!0)("status",o.tableStatus)("autoReload",-1),e.R7$(2),e.Y8G("permission",o.permissions.pool)("selection",o.selection)("tableActions",o.tableActions)}}function Kn(_,i){1&_&&e.nrm(0,"cd-grafana",15),2&_&&e.Y8G("grafanaPath","ceph-pools-overview?")("type","metrics")}function Zn(_,i){1&_&&(e.qex(0,6),e.j41(1,"a",7),e.pXf(2,4),e.k0s(),e.DNE(3,Kn,1,2,"ng-template",8),e.bVm())}function ei(_,i){if(1&_&&e.nrm(0,"cd-usage-bar",17),2&_){const o=e.XpG().data.row;e.Y8G("total",o.stats.bytes_used.latest+o.stats.avail_raw.latest)("used",o.stats.bytes_used.latest)("title",o.pool_name)}}function oi(_,i){if(1&_&&e.DNE(0,ei,1,3,"cd-usage-bar",16),2&_){const o=i.data.row;e.Y8G("ngIf",null==o.stats||null==o.stats.avail_raw?null:o.stats.avail_raw.latest)}}const Xe="pool";let _i=(()=>{class _ extends Sn.D{poolService;taskWrapper;ecpService;authStorageService;taskListService;modalService;pgCategoryService;dimlessPipe;urlBuilder;configurationService;actionLabels;table;poolUsageTpl;poolConfigurationSourceTpl;pools;columns;selection=new Tn.y;executingTasks=[];permissions;tableActions;tableStatus=new ve.m;cacheTiers=[];monAllowPoolDelete=!1;ecProfileList;constructor(o,t,n,s,c,d,f,R,p,L,S){super(),this.poolService=o,this.taskWrapper=t,this.ecpService=n,this.authStorageService=s,this.taskListService=c,this.modalService=d,this.pgCategoryService=f,this.dimlessPipe=R,this.urlBuilder=p,this.configurationService=L,this.actionLabels=S,this.permissions=this.authStorageService.getPermissions(),this.tableActions=[{permission:"create",icon:I.F.add,routerLink:()=>this.urlBuilder.getCreate(),name:this.actionLabels.CREATE},{permission:"update",icon:I.F.edit,routerLink:()=>this.urlBuilder.getEdit(encodeURIComponent(this.selection.first().pool_name)),name:this.actionLabels.EDIT},{permission:"delete",icon:I.F.destroy,click:()=>this.deletePoolModal(),name:this.actionLabels.DELETE,disable:this.getDisableDesc.bind(this)}],this.permissions.configOpt.read&&this.configurationService.get("mon_allow_pool_delete").subscribe(C=>{if(P().has(C,"value")){const M=P().find(C.value,F=>"mon"===F.section)||{value:!1};this.monAllowPoolDelete="true"===M.value}})}ngOnInit(){const o=(t,n,s)=>P().get(n,t)>P().get(s,t)?1:-1;this.columns=[{prop:"pool_name",name:"Nazwa",flexGrow:2,cellTransformation:N.x.executing},{prop:"data_protection",name:"Data Protection",cellTransformation:N.x.badge,customTemplateConfig:{class:"badge-background-gray"},flexGrow:1.3},{prop:"application_metadata",name:"Zastosowania",cellTransformation:N.x.badge,customTemplateConfig:{class:"badge-background-primary"},flexGrow:1.5},{prop:"pg_status",name:"Status PG",flexGrow:1.2,cellClass:({row:t,column:n,value:s})=>this.getPgStatusCellClass(t,n,s)},{prop:"crush_rule",name:"Zbi\xF3r zasad Crush",isHidden:!0,flexGrow:2},{name:"U\u017Cycie",prop:"usage",cellTemplate:this.poolUsageTpl,flexGrow:1.2},{prop:"stats.rd_bytes.rates",name:"Czytanie bajt\xF3w",comparator:(t,n,s,c)=>o("stats.rd_bytes.latest",s,c),cellTransformation:N.x.sparkline,flexGrow:1.5},{prop:"stats.wr_bytes.rates",name:"Zapis bajt\xF3w ",comparator:(t,n,s,c)=>o("stats.wr_bytes.latest",s,c),cellTransformation:N.x.sparkline,flexGrow:1.5},{prop:"stats.rd.rate",name:"Czytanie ops",flexGrow:1,pipe:this.dimlessPipe,cellTransformation:N.x.perSecond},{prop:"stats.wr.rate",name:"Zapis ops",flexGrow:1,pipe:this.dimlessPipe,cellTransformation:N.x.perSecond}],this.taskListService.init(()=>this.ecpService.list().pipe((0,hn.ZZ)(t=>(this.ecProfileList=t,this.poolService.getList()))),void 0,t=>{this.pools=this.transformPoolsData(t),this.tableStatus=new ve.m},()=>{this.table.reset(),this.tableStatus=new ve.m(Fn.k.ValueException)},t=>t.name.startsWith(`${Xe}/`),(t,n)=>n.metadata.pool_name===t.pool_name,{default:t=>new bn(t.pool_name)})}updateSelection(o){this.selection=o}deletePoolModal(){const o=this.selection.first().pool_name;this.modalService.show(Ue.D,{impact:An.r.high,itemDescription:"Pool",itemNames:[o],submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new v.O(`${Xe}/${h.Qp.DELETE}`,{pool_name:o}),call:this.poolService.delete(o)})})}getPgStatusCellClass(o,t,n){return{"text-right":!0,[`pg-${this.pgCategoryService.getTypeByStates(n)}`]:!0}}getErasureCodeProfile(o){let t="";return P().forEach(this.ecProfileList,n=>{n.name===o&&(t=`EC: ${n.k}+${n.m}`)}),t}transformPoolsData(o){const t=["bytes_used","max_avail","avail_raw","percent_used","rd_bytes","wr_bytes","rd","wr"],n={latest:0,rate:0,rates:[]};return P().forEach(o,s=>{s.pg_status=this.transformPgStatus(s.pg_status);const c={};P().forEach(t,d=>{c[d]=s.stats&&s.stats[d]?s.stats[d]:n}),s.stats=c,s.usage=c.percent_used.latest,!s.cdExecuting&&s.pg_num+s.pg_placement_num!==s.pg_num_target+s.pg_placement_num_target&&(s.cdExecuting="Updating"),["rd_bytes","wr_bytes"].forEach(d=>{s.stats[d].rates=s.stats[d].rates.map(f=>f[1])}),s.cdIsBinary=!0,"erasure"===s.type&&(s.data_protection=this.getErasureCodeProfile(s.erasure_code_profile)),"replicated"===s.type&&(s.data_protection=`replica: \xd7${s.size}`)}),o}transformPgStatus(o){const t=[];return P().forEach(o,(n,s)=>{t.push(`${n} ${s}`)}),t.join(", ")}getSelectionTiers(){if(typeof this.expandedRow<"u"){const o=this.expandedRow.tiers;this.cacheTiers=this.pools.filter(t=>o.includes(t.pool))}}getDisableDesc(){return!this.selection?.hasSelection||!this.monAllowPoolDelete&&"Pool deletion is disabled by the mon_allow_pool_delete configuration setting."}setExpandedRow(o){super.setExpandedRow(o),this.getSelectionTiers()}static \u0275fac=function(t){return new(t||_)(e.rXU(ge.m),e.rXU(Me.a),e.rXU(Ie),e.rXU(Ve.v),e.rXU(qe.D),e.rXU($n.V),e.rXU(Ln.v),e.rXU(Nn.u),e.rXU(Ge.E),e.rXU(In.s),e.rXU(h.Ss))};static \u0275cmp=e.VBU({type:_,selectors:[["cd-pool-list"]],viewQuery:function(t,n){if(1&t&&(e.GBs(De.O,5),e.GBs(qn,7),e.GBs(Qn,5)),2&t){let s;e.mGM(s=e.lsd())&&(n.table=s.first),e.mGM(s=e.lsd())&&(n.poolUsageTpl=s.first),e.mGM(s=e.lsd())&&(n.poolConfigurationSourceTpl=s.first)}},features:[e.Jv_([qe.D,{provide:Ge.E,useValue:new Ge.E(Xe)}]),e.Vt3],decls:10,vars:2,consts:()=>{let o,t,n;return o="Lista puli",t="Ca\u0142kowita wydajno\u015B\u0107",n="Ceph pools overview",[["nav","ngbNav"],["poolUsageTpl",""],["table",""],o,t,["ngbNav","",1,"nav-tabs"],["ngbNavItem",""],["ngbNavLink",""],["ngbNavContent",""],["ngbNavItem","",4,"cdScope"],[3,"ngbNavOutlet"],["id","pool-list","selectionType","single",3,"fetchData","setExpandedRow","updateSelection","data","columns","hasDetails","status","autoReload"],["id","pool-list-actions",1,"table-actions",3,"permission","selection","tableActions"],["id","pool-list-details",3,"selection","permissions","cacheTiers",4,"cdTableDetail"],["id","pool-list-details",3,"selection","permissions","cacheTiers"],["title",n,"uid","z99hzWtmk","grafanaStyle","two",3,"grafanaPath","type"],["decimals","2",3,"total","used","title",4,"ngIf"],["decimals","2",3,"total","used","title"]]},template:function(t,n){if(1&t&&(e.j41(0,"nav",5,0),e.qex(2,6),e.j41(3,"a",7),e.pXf(4,3),e.k0s(),e.DNE(5,Wn,4,8,"ng-template",8),e.bVm(),e.DNE(6,Zn,4,0,"ng-container",9),e.k0s(),e.nrm(7,"div",10),e.DNE(8,oi,1,1,"ng-template",null,1,e.C5r)),2&t){const s=e.sdS(1);e.R7$(6),e.Y8G("cdScope","grafana"),e.R7$(),e.Y8G("ngbNavOutlet",s)}},dependencies:[g.bT,E.Um,E.X9,E.sy,E.Ri,E.WA,E.m_,vn.o,Qe.c,De.O,Dn.j,Gn.N,Xn.V,Bn],styles:["cd-pool-list .pg-clean{color:#008a00}  cd-pool-list .pg-working{color:#25828e}  cd-pool-list .pg-warning{color:#d48200}  cd-pool-list .pg-unknown{color:#dc3545}"]})}return _})(),We=(()=>{class _{static \u0275fac=function(t){return new(t||_)};static \u0275mod=e.$C({type:_});static \u0275inj=e.G2t({imports:[No._,g.MD,E.Pv,Fo.G,pe.iI,l.X1,E.n8,To.BlockModule]})}return _})();const ti=[{path:"",component:_i},{path:h.Qp.CREATE,component:Be,data:{breadcrumbs:h.yY.CREATE}},{path:`${h.Qp.EDIT}/:name`,component:Be,data:{breadcrumbs:h.yY.EDIT}}];let ni=(()=>{class _{static \u0275fac=function(t){return new(t||_)};static \u0275mod=e.$C({type:_});static \u0275inj=e.G2t({imports:[We,pe.iI.forChild(ti)]})}return _})()}}]);