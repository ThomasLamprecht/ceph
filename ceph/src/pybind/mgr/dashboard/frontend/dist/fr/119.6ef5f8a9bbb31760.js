"use strict";(self.webpackChunkceph_dashboard=self.webpackChunkceph_dashboard||[]).push([[119],{22119:(Gi,ve,r)=>{r.r(ve),r.d(ve,{PoolModule:()=>Je,RoutedPoolModule:()=>Ui});var C=r(88692),l=r(20092),fe=r(54247),E=r(51389),M=r(79512),E_=r(44466),g_=r(47080),p_=r(370),m_=r(23815),g=r.n(m_),R_=r(7357),C_=r(26504),ge=r(80842);class T{constructor(){this.nodes=[],this.idTree={},this.allDevices=[],this.buckets=[],this.failureDomains={},this.failureDomainKeys=[],this.devices=[],this.deviceCount=0}static searchFailureDomains(i,_){return this.getFailureDomains(this.search(i,_))}static search(i,_){const[t,n]=_.split("~"),s=i.find(c=>["name","id","type"].some(d=>c[d]===t));return s?(i=this.getSubNodes(s,this.createIdTreeFromNodes(i)),n&&(i=this.filterNodesByDeviceType(i,n)),i):[]}static createIdTreeFromNodes(i){const _={};return i.forEach(t=>{_[t.id]=t}),_}static getSubNodes(i,_){let t=[i];return i.children&&i.children.forEach(n=>{t=t.concat(this.getSubNodes(_[n],_))}),t}static filterNodesByDeviceType(i,_){let n,t=i.filter(c=>c.device_class&&c.device_class!==_).map(c=>c.id),s=t;do{n=!1,i=i.filter(d=>!t.includes(d.id));const c=[];i.forEach(d=>{d.children&&d.children.every(f=>t.includes(f))&&(c.push(d.id),n=!0)}),n&&(t=c,s=s.concat(c))}while(n);return(i=g().cloneDeep(i)).map(c=>(c.children&&(c.children=c.children.filter(d=>!s.includes(d))),c))}static getFailureDomains(i){const _={};return i.forEach(t=>{const n=t.type;_[n]||(_[n]=[]),_[n].push(t)}),_}initCrushNodeSelection(i,_,t,n){this.nodes=i,this.idTree=T.createIdTreeFromNodes(i),i.forEach(s=>{this.idTree[s.id]=s}),this.buckets=g().sortBy(i.filter(s=>s.children),"name"),this.controls={root:_,failure:t,device:n},this.preSelectRoot(),this.controls.root.valueChanges.subscribe(()=>this.onRootChange()),this.controls.failure.valueChanges.subscribe(()=>this.onFailureDomainChange()),this.controls.device.valueChanges.subscribe(()=>this.onDeviceChange())}preSelectRoot(){const i=this.nodes.find(_=>"root"===_.type);this.silentSet(this.controls.root,i),this.onRootChange()}silentSet(i,_){i.setValue(_,{emitEvent:!1})}onRootChange(){const i=T.getSubNodes(this.controls.root.value,this.idTree),_=T.getFailureDomains(i);Object.keys(_).forEach(t=>{_[t].length<=1&&delete _[t]}),this.failureDomains=_,this.failureDomainKeys=Object.keys(_).sort(),this.updateFailureDomain()}updateFailureDomain(){let i=this.getIncludedCustomValue(this.controls.failure,Object.keys(this.failureDomains));""===i&&(i=this.setMostCommonDomain(this.controls.failure)),this.updateDevices(i)}getIncludedCustomValue(i,_){return i.dirty&&_.includes(i.value)?i.value:""}setMostCommonDomain(i){let _={n:0,type:""};return Object.keys(this.failureDomains).forEach(t=>{const n=this.failureDomains[t].length;_.n<n&&(_={n,type:t})}),this.silentSet(i,_.type),_.type}onFailureDomainChange(){this.updateDevices()}updateDevices(i=this.controls.failure.value){const _=g().flatten(this.failureDomains[i].map(n=>T.getSubNodes(n,this.idTree)));this.allDevices=_.filter(n=>n.device_class).map(n=>n.device_class),this.devices=g().uniq(this.allDevices).sort();const t=1===this.devices.length?this.devices[0]:this.getIncludedCustomValue(this.controls.device,this.devices);this.silentSet(this.controls.device,t),this.onDeviceChange(t)}onDeviceChange(i=this.controls.device.value){this.deviceCount=""===i?this.allDevices.length:this.allDevices.filter(_=>_===i).length}}var De=r(30982),M_=r(14745),v=r(65862),h_=r(93614),$e=r(95463),u=r(82723),S_=r(30633),D=r(76111),T_=r(47557),L_=r(28211),Ee=r(32337),e=r(64537),Ie=r(62862),xe=r(83608),pe=r(18372),Ze=r(60312),me=r(30839),Re=r(82945),Ce=r(87925),Me=r(94276),he=r(56310),Se=r(41582),Te=r(10545);function A_(o,i){1&o&&(e.TgZ(0,"span",30),e.SDv(1,31),e.qZA())}function F_(o,i){1&o&&(e.TgZ(0,"span",30),e.SDv(1,32),e.qZA())}function N_(o,i){1&o&&(e.TgZ(0,"span",30),e.SDv(1,33),e.qZA())}function b_(o,i){1&o&&(e.TgZ(0,"option",26),e.SDv(1,34),e.qZA())}function v_(o,i){if(1&o&&(e.TgZ(0,"option",35),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_.name," ")}}function D_(o,i){1&o&&(e.TgZ(0,"span",30),e.SDv(1,36),e.qZA())}function $_(o,i){1&o&&(e.TgZ(0,"option",26),e.SDv(1,37),e.qZA())}function I_(o,i){if(1&o&&(e.TgZ(0,"option",35),e._uU(1),e.qZA()),2&o){const _=i.$implicit,t=e.oxw();e.Q6J("ngValue",_),e.xp6(1),e.AsE(" ",_," ( ",t.failureDomains[_].length," ) ")}}function x_(o,i){1&o&&(e.TgZ(0,"span",30),e.SDv(1,38),e.qZA())}function Z_(o,i){if(1&o&&(e.TgZ(0,"option",35),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_," ")}}let y_=(()=>{class o extends T{constructor(_,t,n,s,c){super(),this.formBuilder=_,this.activeModal=t,this.taskWrapper=n,this.crushRuleService=s,this.actionLabels=c,this.submitAction=new e.vpe,this.tooltips=this.crushRuleService.formTooltips,this.action=this.actionLabels.CREATE,this.resource="Crush Rule",this.createForm()}createForm(){this.form=this.formBuilder.group({name:["",[l.kI.required,l.kI.pattern("[A-Za-z0-9_-]+"),u.hq.custom("uniqueName",_=>this.names&&-1!==this.names.indexOf(_))]],root:null,failure_domain:"",device_class:""})}ngOnInit(){this.crushRuleService.getInfo().subscribe(({names:_,nodes:t})=>{this.initCrushNodeSelection(t,this.form.get("root"),this.form.get("failure_domain"),this.form.get("device_class")),this.names=_})}onSubmit(){if(this.form.invalid)return void this.form.setErrors({cdSubmitButton:!0});const _=g().cloneDeep(this.form.value);_.root=_.root.name,""===_.device_class&&delete _.device_class,this.taskWrapper.wrapTaskAroundCall({task:new D.R("crushRule/create",_),call:this.crushRuleService.create(_)}).subscribe({error:()=>{this.form.setErrors({cdSubmitButton:!0})},complete:()=>{this.activeModal.close(),this.submitAction.emit(_)}})}}return o.\u0275fac=function(_){return new(_||o)(e.Y36(Ie.O),e.Y36(E.Kz),e.Y36(Ee.P),e.Y36(xe.H),e.Y36(M.p4))},o.\u0275cmp=e.Xpm({type:o,selectors:[["cd-crush-rule-form-modal"]],outputs:{submitAction:"submitAction"},features:[e.qOj],decls:55,vars:27,consts:function(){let i,_,t,n,s,c,d,f,p,m,h,S,R;return i="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",_="Name",t="Root",n="Failure domain type",s="Device class",c="Let Ceph decide",d="Ce champ est obligatoire !",f="Le nom doit \xEAtre exclusivement compos\xE9 de caract\xE8res alphanum\xE9riques, de tirets et de traits de soulignement.",p="Le nom de profil du code d'effacement s\xE9lectionn\xE9 est d\xE9j\xE0 utilis\xE9.",m="Chargement...",h="Ce champ est obligatoire !",S="Chargement...",R="Ce champ est obligatoire !",[[3,"modalRef"],[1,"modal-title"],i,[1,"modal-content"],["novalidate","",3,"formGroup"],["frm","ngForm"],[1,"modal-body"],[1,"form-group","row"],["for","name",1,"cd-col-form-label"],_,[1,"required"],[1,"cd-col-form-input"],["type","text","id","name","name","name","placeholder","Name...","formControlName","name","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","root",1,"cd-col-form-label"],t,[3,"html"],["id","root","name","root","formControlName","root",1,"form-select"],["ngValue","",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],["for","failure_domain",1,"cd-col-form-label"],n,["id","failure_domain","name","failure_domain","formControlName","failure_domain",1,"form-select"],["for","device_class",1,"cd-col-form-label"],s,["id","device_class","name","device_class","formControlName","device_class",1,"form-select"],["ngValue",""],c,[1,"modal-footer"],[3,"form","submitText","submitActionEvent"],[1,"invalid-feedback"],d,f,p,m,[3,"ngValue"],h,S,R]},template:function(_,t){if(1&_&&(e.TgZ(0,"cd-modal",0),e.ynx(1,1),e.SDv(2,2),e.ALo(3,"titlecase"),e.ALo(4,"upperFirst"),e.BQk(),e.ynx(5,3),e.TgZ(6,"form",4,5)(8,"div",6)(9,"div",7)(10,"label",8),e.ynx(11),e.SDv(12,9),e.BQk(),e._UZ(13,"span",10),e.qZA(),e.TgZ(14,"div",11),e._UZ(15,"input",12),e.YNc(16,A_,2,0,"span",13),e.YNc(17,F_,2,0,"span",13),e.YNc(18,N_,2,0,"span",13),e.qZA()(),e.TgZ(19,"div",7)(20,"label",14),e.ynx(21),e.SDv(22,15),e.BQk(),e._UZ(23,"cd-helper",16)(24,"span",10),e.qZA(),e.TgZ(25,"div",11)(26,"select",17),e.YNc(27,b_,2,0,"option",18),e.YNc(28,v_,2,2,"option",19),e.qZA(),e.YNc(29,D_,2,0,"span",13),e.qZA()(),e.TgZ(30,"div",7)(31,"label",20),e.ynx(32),e.SDv(33,21),e.BQk(),e._UZ(34,"cd-helper",16)(35,"span",10),e.qZA(),e.TgZ(36,"div",11)(37,"select",22),e.YNc(38,$_,2,0,"option",18),e.YNc(39,I_,2,3,"option",19),e.qZA(),e.YNc(40,x_,2,0,"span",13),e.qZA()(),e.TgZ(41,"div",7)(42,"label",23),e.ynx(43),e.SDv(44,24),e.BQk(),e._UZ(45,"cd-helper",16),e.qZA(),e.TgZ(46,"div",11)(47,"select",25)(48,"option",26),e.SDv(49,27),e.qZA(),e.YNc(50,Z_,2,2,"option",19),e.qZA()()()(),e.TgZ(51,"div",28)(52,"cd-form-button-panel",29),e.NdJ("submitActionEvent",function(){return t.onSubmit()}),e.ALo(53,"titlecase"),e.ALo(54,"upperFirst"),e.qZA()()(),e.BQk(),e.qZA()),2&_){const n=e.MAs(7);e.Q6J("modalRef",t.activeModal),e.xp6(4),e.pQV(e.lcZ(3,19,t.action))(e.lcZ(4,21,t.resource)),e.QtT(2),e.xp6(2),e.Q6J("formGroup",t.form),e.xp6(10),e.Q6J("ngIf",t.form.showError("name",n,"required")),e.xp6(1),e.Q6J("ngIf",t.form.showError("name",n,"pattern")),e.xp6(1),e.Q6J("ngIf",t.form.showError("name",n,"uniqueName")),e.xp6(5),e.Q6J("html",t.tooltips.root),e.xp6(4),e.Q6J("ngIf",!t.buckets),e.xp6(1),e.Q6J("ngForOf",t.buckets),e.xp6(1),e.Q6J("ngIf",t.form.showError("root",n,"required")),e.xp6(5),e.Q6J("html",t.tooltips.failure_domain),e.xp6(4),e.Q6J("ngIf",!t.failureDomains),e.xp6(1),e.Q6J("ngForOf",t.failureDomainKeys),e.xp6(1),e.Q6J("ngIf",t.form.showError("failure_domain",n,"required")),e.xp6(5),e.Q6J("html",t.tooltips.device_class),e.xp6(5),e.Q6J("ngForOf",t.devices),e.xp6(2),e.Q6J("form",t.form)("submitText",e.lcZ(53,23,t.action)+" "+e.lcZ(54,25,t.resource))}},dependencies:[C.sg,C.O5,pe.S,Ze.z,me.p,Re.U,Ce.o,Me.b,he.P,Se.V,l._Y,l.YN,l.Kr,l.Fj,l.EJ,l.JJ,l.JL,l.sg,l.u,C.rS,Te.m]}),o})();class U_{}var G_=r(35732);let Le=(()=>{class o{constructor(_){this.http=_,this.apiPath="api/erasure_code_profile",this.formTooltips={k:"Each object is split in data-chunks parts, each stored on a different OSD.",m:"Compute coding chunks for each object and store them on different OSDs.\n      The number of coding chunks is also the number of OSDs that can be down without losing data.",plugins:{jerasure:{description:"The jerasure plugin is the most generic and flexible plugin,\n          it is also the default for Ceph erasure coded pools.",technique:"The more flexible technique is reed_sol_van : it is enough to set k\n          and m. The cauchy_good technique can be faster but you need to chose the packetsize\n          carefully. All of reed_sol_r6_op, liberation, blaum_roth, liber8tion are RAID6 equivalents\n          in the sense that they can only be configured with m=2.",packetSize:"The encoding will be done on packets of bytes size at a time.\n          Choosing the right packet size is difficult.\n          The jerasure documentation contains extensive information on this topic."},lrc:{description:"With the jerasure plugin, when an erasure coded object is stored on\n          multiple OSDs, recovering from the loss of one OSD requires reading from all the others.\n          For instance if jerasure is configured with k=8 and m=4, losing one OSD requires reading\n          from the eleven others to repair.\n\n          The lrc erasure code plugin creates local parity chunks to be able to recover using\n          less OSDs. For instance if lrc is configured with k=8, m=4 and l=4, it will create\n          an additional parity chunk for every four OSDs. When a single OSD is lost, it can be\n          recovered with only four OSDs instead of eleven.",l:"Group the coding and data chunks into sets of size locality. For instance,\n          for k=4 and m=2, when locality=3 two groups of three are created. Each set can\n          be recovered without reading chunks from another set.",crushLocality:"The type of the crush bucket in which each set of chunks defined\n          by l will be stored. For instance, if it is set to rack, each group of l chunks will be\n          placed in a different rack. It is used to create a CRUSH rule step such as step choose\n          rack. If it is not set, no such grouping is done."},isa:{description:"The isa plugin encapsulates the ISA library. It only runs on Intel processors.",technique:"The ISA plugin comes in two Reed Solomon forms.\n          If reed_sol_van is set, it is Vandermonde, if cauchy is set, it is Cauchy."},shec:{description:"The shec plugin encapsulates the multiple SHEC library.\n          It allows ceph to recover data more efficiently than Reed Solomon codes.",c:"The number of parity chunks each of which includes each data chunk in its\n          calculation range. The number is used as a durability estimator. For instance, if c=2,\n          2 OSDs can be down without losing data."},clay:{description:"CLAY (short for coupled-layer) codes are erasure codes designed to\n          bring about significant savings in terms of network bandwidth and disk IO when a failed\n          node/OSD/rack is being repaired.",d:"Number of OSDs requested to send data during recovery of a single chunk.\n          d needs to be chosen such that k+1 <= d <= k+m-1. The larger the d, the better\n          the savings.",scalar_mds:"scalar_mds specifies the plugin that is used as a building block\n          in the layered construction. It can be one of jerasure, isa, shec.",technique:"technique specifies the technique that will be picked\n          within the 'scalar_mds' plugin specified. Supported techniques\n          are 'reed_sol_van', 'reed_sol_r6_op', 'cauchy_orig',\n          'cauchy_good', 'liber8tion' for jerasure, 'reed_sol_van',\n          'cauchy' for isa and 'single', 'multiple' for shec."}},crushRoot:"The name of the crush bucket used for the first step of the CRUSH rule.\n      For instance step take default.",crushFailureDomain:"Ensure that no two chunks are in a bucket with the same failure\n      domain. For instance, if the failure domain is host no two chunks will be stored on the same\n      host. It is used to create a CRUSH rule step such as step chooseleaf host.",crushNumFailureDomains:" Number of failure domains to map. Results in a CRUSH MSR rule being created.\n    Must be specified if crush-osds-per-failure-domain is specified.",crushOsdsPerFailureDomain:"Maximum number of OSDs to place in each failure domain --\n     defaults to 1. Using a value greater than one will cause a CRUSH MSR rule to be created.\n      Must be specified if crush-num-failure-domains is specified.",crushDeviceClass:"Restrict placement to devices of a specific class\n      (e.g., ssd or hdd), using the crush device class names in the CRUSH map.",directory:"Set the directory name from which the erasure code plugin is loaded."}}list(){return this.http.get(this.apiPath)}create(_){return this.http.post(this.apiPath,_,{observe:"response"})}delete(_){return this.http.delete(`${this.apiPath}/${_}`,{observe:"response"})}getInfo(){return this.http.get(`ui-${this.apiPath}/info`)}}return o.\u0275fac=function(_){return new(_||o)(e.LFG(G_.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();function H_(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,53),e.qZA())}function q_(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,54),e.qZA())}function z_(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,55),e.qZA())}function X_(o,i){1&o&&(e.TgZ(0,"option",43),e.SDv(1,56),e.qZA())}function w_(o,i){if(1&o&&(e.TgZ(0,"option",57),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_," ")}}function Q_(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,58),e.qZA())}function J_(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,59),e.qZA())}function k_(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,60),e.qZA())}function V_(o,i){if(1&o&&(e.TgZ(0,"span",52),e.SDv(1,61),e.qZA()),2&o){const _=e.oxw();e.xp6(1),e.pQV(_.deviceCount),e.QtT(1)}}function Y_(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,62),e.qZA())}function B_(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,63),e.qZA())}function j_(o,i){if(1&o&&(e.TgZ(0,"span",45),e.SDv(1,64),e.qZA()),2&o){const _=e.oxw();e.xp6(1),e.pQV(_.lrcMultiK),e.QtT(1)}}function K_(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,65),e.qZA())}function W_(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,66),e.qZA())}function eo(o,i){if(1&o&&(e.TgZ(0,"span",52),e.SDv(1,67),e.qZA()),2&o){const _=e.oxw();e.xp6(1),e.pQV(_.deviceCount),e.QtT(1)}}function _o(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,71),e.qZA())}function oo(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,72),e.qZA())}function to(o,i){if(1&o&&(e.TgZ(0,"div",7)(1,"label",68)(2,"span",14),e.SDv(3,69),e.qZA(),e._UZ(4,"cd-helper",16),e.qZA(),e.TgZ(5,"div",10),e._UZ(6,"input",70),e.YNc(7,_o,2,0,"span",12),e.YNc(8,oo,2,0,"span",12),e.qZA()()),2&o){const _=e.oxw(),t=e.MAs(7);e.xp6(4),e.Q6J("html",_.tooltips.plugins.shec.c),e.xp6(3),e.Q6J("ngIf",_.form.showError("c",t,"min")),e.xp6(1),e.Q6J("ngIf",_.form.showError("c",t,"cGreaterM"))}}function io(o,i){1&o&&(e.TgZ(0,"span",45),e.SDv(1,80),e.qZA())}function no(o,i){if(1&o&&(e.TgZ(0,"span",45),e.SDv(1,81),e.qZA()),2&o){const _=e.oxw(3);e.xp6(1),e.pQV(_.getDMin())(_.getDMax()),e.QtT(1)}}function so(o,i){if(1&o&&(e.TgZ(0,"span",45),e.SDv(1,82),e.qZA()),2&o){const _=e.oxw(3);e.xp6(1),e.pQV(_.getDMax()),e.QtT(1)}}function ao(o,i){if(1&o&&(e.ynx(0),e.YNc(1,no,2,2,"span",23),e.YNc(2,so,2,1,"span",23),e.BQk()),2&o){const _=e.oxw(2);e.xp6(1),e.Q6J("ngIf",_.getDMin()<_.getDMax()),e.xp6(1),e.Q6J("ngIf",_.getDMin()===_.getDMax())}}function lo(o,i){if(1&o&&(e.TgZ(0,"span",52),e.SDv(1,83),e.qZA()),2&o){const _=e.oxw(2);e.xp6(1),e.pQV(_.getDMin()),e.QtT(1)}}function ro(o,i){if(1&o&&(e.TgZ(0,"span",52),e.SDv(1,84),e.qZA()),2&o){const _=e.oxw(2);e.xp6(1),e.pQV(_.getDMax()),e.QtT(1)}}function co(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"div",7)(1,"label",73)(2,"span",14),e.SDv(3,74),e.qZA(),e._UZ(4,"cd-helper",16),e.qZA(),e.TgZ(5,"div",10)(6,"div",75),e._UZ(7,"input",76),e.TgZ(8,"button",77),e.NdJ("click",function(){e.CHM(_);const n=e.oxw();return e.KtG(n.toggleDCalc())}),e._UZ(9,"i",78),e.qZA()(),e.YNc(10,io,2,0,"span",23),e.YNc(11,ao,3,2,"ng-container",79),e.YNc(12,lo,2,1,"span",12),e.YNc(13,ro,2,1,"span",12),e.qZA()()}if(2&o){const _=e.oxw(),t=e.MAs(7);e.xp6(4),e.Q6J("html",_.tooltips.plugins.clay.d),e.xp6(5),e.Q6J("ngClass",_.dCalc?_.icons.unlock:_.icons.lock),e.xp6(1),e.Q6J("ngIf",_.dCalc),e.xp6(1),e.Q6J("ngIf",!_.dCalc),e.xp6(1),e.Q6J("ngIf",_.form.showError("d",t,"dMin")),e.xp6(1),e.Q6J("ngIf",_.form.showError("d",t,"dMax"))}}function Oo(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,89),e.qZA())}function uo(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,90),e.qZA())}function Po(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,91),e.qZA())}function fo(o,i){if(1&o&&(e.TgZ(0,"div",7)(1,"label",85)(2,"span",14),e.SDv(3,86),e.qZA(),e._UZ(4,"cd-helper",16),e.qZA(),e.TgZ(5,"div",10),e._UZ(6,"input",87),e.YNc(7,Oo,2,0,"span",12),e.YNc(8,uo,2,0,"span",12),e.YNc(9,Po,2,0,"span",12),e.TgZ(10,"span",45),e.SDv(11,88),e.qZA()()()),2&o){const _=e.oxw(),t=e.MAs(7);e.xp6(4),e.Q6J("html",_.tooltips.plugins.lrc.l),e.xp6(3),e.Q6J("ngIf",_.form.showError("l",t,"required")),e.xp6(1),e.Q6J("ngIf",_.form.showError("l",t,"min")),e.xp6(1),e.Q6J("ngIf",_.form.showError("l",t,"unequal")),e.xp6(2),e.pQV(_.lrcGroups),e.QtT(11)}}function Eo(o,i){1&o&&(e.TgZ(0,"option",43),e.SDv(1,92),e.qZA())}function go(o,i){if(1&o&&(e.TgZ(0,"option",57),e._uU(1),e.qZA()),2&o){const _=i.$implicit,t=e.oxw();e.Q6J("ngValue",_),e.xp6(1),e.AsE(" ",_," ( ",t.failureDomains[_].length," ) ")}}function po(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,93),e.qZA())}function mo(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,94),e.qZA())}function Ro(o,i){1&o&&(e.TgZ(0,"option",43),e.SDv(1,98),e.qZA())}function Co(o,i){1&o&&(e.TgZ(0,"option",43),e.SDv(1,99),e.qZA())}function Mo(o,i){if(1&o&&(e.TgZ(0,"option",57),e._uU(1),e.qZA()),2&o){const _=i.$implicit,t=e.oxw(2);e.Q6J("ngValue",_),e.xp6(1),e.AsE(" ",_," ( ",t.failureDomains[_].length," ) ")}}function ho(o,i){if(1&o&&(e.TgZ(0,"div",7)(1,"label",95),e.ynx(2),e.SDv(3,96),e.BQk(),e._UZ(4,"cd-helper",16),e.qZA(),e.TgZ(5,"div",10)(6,"select",97),e.YNc(7,Ro,2,0,"option",18),e.YNc(8,Co,2,0,"option",18),e.YNc(9,Mo,2,3,"option",19),e.qZA()()()),2&o){const _=e.oxw();e.xp6(4),e.Q6J("html",_.tooltips.plugins.lrc.crushLocality),e.xp6(3),e.Q6J("ngIf",!_.failureDomains),e.xp6(1),e.Q6J("ngIf",_.failureDomainKeys.length>0),e.xp6(1),e.Q6J("ngForOf",_.failureDomainKeys)}}function So(o,i){if(1&o&&(e.TgZ(0,"option",57),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_," ")}}const ye=function(o,i,_){return[o,i,_]};function To(o,i){if(1&o&&(e.TgZ(0,"div",7)(1,"label",100),e.ynx(2),e.SDv(3,101),e.BQk(),e._UZ(4,"cd-helper",16),e.qZA(),e.TgZ(5,"div",10)(6,"select",102),e.YNc(7,So,2,2,"option",19),e.qZA()()()),2&o){const _=e.oxw();e.xp6(4),e.Q6J("html",_.tooltips.plugins.clay.scalar_mds),e.xp6(3),e.Q6J("ngForOf",e.kEZ(2,ye,_.PLUGIN.JERASURE,_.PLUGIN.ISA,_.PLUGIN.SHEC))}}function Lo(o,i){if(1&o&&(e.TgZ(0,"option",57),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_," ")}}function Ao(o,i){if(1&o&&(e.TgZ(0,"div",7)(1,"label",103),e.ynx(2),e.SDv(3,104),e.BQk(),e._UZ(4,"cd-helper",16),e.qZA(),e.TgZ(5,"div",10)(6,"select",105),e.YNc(7,Lo,2,2,"option",19),e.qZA()()()),2&o){const _=e.oxw();e.xp6(4),e.Q6J("html",_.tooltips.plugins[_.plugin].technique),e.xp6(3),e.Q6J("ngForOf",_.techniques)}}function Fo(o,i){1&o&&(e.TgZ(0,"span",52),e.SDv(1,109),e.qZA())}function No(o,i){if(1&o&&(e.TgZ(0,"div",7)(1,"label",106),e.ynx(2),e.SDv(3,107),e.BQk(),e._UZ(4,"cd-helper",16),e.qZA(),e.TgZ(5,"div",10),e._UZ(6,"input",108),e.YNc(7,Fo,2,0,"span",12),e.qZA()()),2&o){const _=e.oxw(),t=e.MAs(7);e.xp6(4),e.Q6J("html",_.tooltips.plugins.jerasure.packetSize),e.xp6(3),e.Q6J("ngIf",_.form.showError("packetSize",t,"min"))}}function bo(o,i){1&o&&(e.TgZ(0,"option",43),e.SDv(1,110),e.qZA())}function vo(o,i){if(1&o&&(e.TgZ(0,"option",57),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_.name," ")}}function Do(o,i){if(1&o&&(e.TgZ(0,"option",57),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_," ")}}let $o=(()=>{class o extends T{constructor(_,t,n,s,c){super(),this.formBuilder=_,this.activeModal=t,this.taskWrapper=n,this.ecpService=s,this.actionLabels=c,this.submitAction=new e.vpe,this.tooltips=this.ecpService.formTooltips,this.PLUGIN={LRC:"lrc",SHEC:"shec",CLAY:"clay",JERASURE:"jerasure",ISA:"isa"},this.plugin=this.PLUGIN.JERASURE,this.icons=v.P,this.action=this.actionLabels.CREATE,this.resource="EC Profile",this.createForm(),this.setJerasureDefaults()}createForm(){this.form=this.formBuilder.group({name:[null,[l.kI.required,l.kI.pattern("[A-Za-z0-9_-]+"),u.hq.custom("uniqueName",_=>this.names&&-1!==this.names.indexOf(_))]],plugin:[this.PLUGIN.JERASURE,[l.kI.required]],k:[4,[l.kI.required,u.hq.custom("max",()=>this.baseValueValidation(!0)),u.hq.custom("unequal",_=>this.lrcDataValidation(_)),u.hq.custom("kLowerM",_=>this.shecDataValidation(_))]],m:[2,[l.kI.required,u.hq.custom("max",()=>this.baseValueValidation())]],crushFailureDomain:"",crushNumFailureDomains:[0,u.hq.requiredIf({crushOsdsPerFailureDomain:{op:"minValue",arg1:1}})],crushOsdsPerFailureDomain:[0,u.hq.requiredIf({crushNumFailureDomains:{op:"minValue",arg1:1}})],crushRoot:null,crushDeviceClass:"",directory:"",technique:"reed_sol_van",packetSize:[2048],l:[3,[l.kI.required,u.hq.custom("unequal",_=>this.lrcLocalityValidation(_))]],crushLocality:"",c:[2,[l.kI.required,u.hq.custom("cGreaterM",_=>this.shecDurabilityValidation(_))]],d:[5,[l.kI.required,u.hq.custom("dMin",_=>this.dMinValidation(_)),u.hq.custom("dMax",_=>this.dMaxValidation(_))]],scalar_mds:[this.PLUGIN.JERASURE,[l.kI.required]]}),this.toggleDCalc(),this.form.get("k").valueChanges.subscribe(()=>this.updateValidityOnChange(["m","l","d"])),this.form.get("m").valueChanges.subscribe(()=>this.updateValidityOnChange(["k","l","c","d"])),this.form.get("l").valueChanges.subscribe(()=>this.updateValidityOnChange(["k","m"])),this.form.get("plugin").valueChanges.subscribe(_=>this.onPluginChange(_)),this.form.get("scalar_mds").valueChanges.subscribe(()=>this.setClayDefaultsForScalar())}baseValueValidation(_=!1){return this.validValidation(()=>this.getKMSum()>this.deviceCount&&this.form.getValue("k")>this.form.getValue("m")===_)}validValidation(_,t){return!((!this.form||t)&&this.plugin!==t)&&_()}getKMSum(){return this.form.getValue("k")+this.form.getValue("m")}lrcDataValidation(_){return this.validValidation(()=>{const t=this.form.getValue("m"),n=this.form.getValue("l"),s=_+t;return this.lrcMultiK=_/(s/n),_%(s/n)!=0},"lrc")}shecDataValidation(_){return this.validValidation(()=>this.form.getValue("m")>_,"shec")}lrcLocalityValidation(_){return this.validValidation(()=>{const t=this.getKMSum();return this.lrcGroups=_>0?t/_:0,_>0&&t%_!=0},"lrc")}shecDurabilityValidation(_){return this.validValidation(()=>{const t=this.form.getValue("m");return _>t},"shec")}dMinValidation(_){return this.validValidation(()=>this.getDMin()>_,"clay")}getDMin(){return this.form.getValue("k")+1}dMaxValidation(_){return this.validValidation(()=>_>this.getDMax(),"clay")}getDMax(){const _=this.form.getValue("m");return this.form.getValue("k")+_-1}toggleDCalc(){this.dCalc=!this.dCalc,this.form.get("d")[this.dCalc?"disable":"enable"](),this.calculateD()}calculateD(){this.plugin!==this.PLUGIN.CLAY||!this.dCalc||this.form.silentSet("d",this.getDMax())}updateValidityOnChange(_){_.forEach(t=>{"d"===t&&this.calculateD(),this.form.get(t).updateValueAndValidity({emitEvent:!1})})}onPluginChange(_){this.plugin=_,_===this.PLUGIN.JERASURE?this.setJerasureDefaults():_===this.PLUGIN.LRC?this.setLrcDefaults():_===this.PLUGIN.ISA?this.setIsaDefaults():_===this.PLUGIN.SHEC?this.setShecDefaults():_===this.PLUGIN.CLAY&&this.setClayDefaults(),this.updateValidityOnChange(["m"])}setJerasureDefaults(){this.techniques=["reed_sol_van","reed_sol_r6_op","cauchy_orig","cauchy_good","liberation","blaum_roth","liber8tion"],this.setDefaults({k:4,m:2,technique:"reed_sol_van"})}setLrcDefaults(){this.setDefaults({k:4,m:2,l:3})}setIsaDefaults(){this.techniques=["reed_sol_van","cauchy"],this.setDefaults({k:7,m:3,technique:"reed_sol_van"})}setShecDefaults(){this.setDefaults({k:4,m:3,c:2})}setClayDefaults(){this.setDefaults({k:4,m:2,scalar_mds:this.PLUGIN.JERASURE}),this.setClayDefaultsForScalar()}setClayDefaultsForScalar(){const _=this.form.getValue("scalar_mds");let t="reed_sol_van";_===this.PLUGIN.JERASURE?this.techniques=["reed_sol_van","reed_sol_r6_op","cauchy_orig","cauchy_good","liber8tion"]:_===this.PLUGIN.ISA?this.techniques=["reed_sol_van","cauchy"]:(t="single",this.techniques=["single","multiple"]),this.setDefaults({technique:t})}setDefaults(_){Object.keys(_).forEach(t=>{const n=this.form.get(t),s=n.value;n.pristine||"technique"===t&&!this.techniques.includes(s)||"k"===t&&[4,7].includes(s)||"m"===t&&[2,3].includes(s)?n.setValue(_[t]):n.updateValueAndValidity()})}ngOnInit(){this.ecpService.getInfo().subscribe(({plugins:_,names:t,directory:n,nodes:s})=>{this.initCrushNodeSelection(s,this.form.get("crushRoot"),this.form.get("crushFailureDomain"),this.form.get("crushDeviceClass")),this.plugins=_,this.names=t,this.form.silentSet("directory",n),this.preValidateNumericInputFields()})}preValidateNumericInputFields(){const _=["k","m","l","c","d"].map(t=>this.form.get(t));_.forEach(t=>{t.markAsTouched(),t.markAsDirty()}),_[1].updateValueAndValidity()}onSubmit(){if(this.form.invalid)return void this.form.setErrors({cdSubmitButton:!0});const _=this.createJson();this.taskWrapper.wrapTaskAroundCall({task:new D.R("ecp/create",{name:_.name}),call:this.ecpService.create(_)}).subscribe({error:()=>{this.form.setErrors({cdSubmitButton:!0})},complete:()=>{this.activeModal.close(),this.submitAction.emit(_)}})}createJson(){const _={technique:[this.PLUGIN.ISA,this.PLUGIN.JERASURE,this.PLUGIN.CLAY],packetSize:[this.PLUGIN.JERASURE],l:[this.PLUGIN.LRC],crushLocality:[this.PLUGIN.LRC],c:[this.PLUGIN.SHEC],d:[this.PLUGIN.CLAY],scalar_mds:[this.PLUGIN.CLAY]},t=new U_,n=this.form.getValue("plugin");return Object.keys(this.form.controls).filter(s=>{const c=_[s],d=this.form.getValue(s);return(c&&c.includes(n)||!c)&&d&&""!==d}).forEach(s=>{this.extendJson(s,t)}),t}extendJson(_,t){const s=this.form.getValue(_);t[{crushFailureDomain:"crush-failure-domain",crushNumFailureDomains:"crush-num-failure-domains",crushOsdsPerFailureDomain:"crush-osds-per-failure-domain",crushRoot:"crush-root",crushDeviceClass:"crush-device-class",packetSize:"packetsize",crushLocality:"crush-locality"}[_]||_]="crushRoot"===_?s.name:s}}return o.\u0275fac=function(_){return new(_||o)(e.Y36(Ie.O),e.Y36(E.Kz),e.Y36(Ee.P),e.Y36(Le),e.Y36(M.p4))},o.\u0275cmp=e.Xpm({type:o,selectors:[["cd-erasure-code-profile-form-modal"]],outputs:{submitAction:"submitAction"},features:[e.qOj],decls:114,vars:57,consts:function(){let i,_,t,n,s,c,d,f,p,m,h,S,R,P,A,$,I,x,Z,y,U,G,H,q,z,X,w,Q,J,k,V,Y,B,j,K,W,N,ee,_e,oe,te,ie,ne,se,ae,le,re,ce,Oe,de,b,ue,Pe;return i="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",_="Name",t="Plug-in",n="Blocs de donn\xE9es (k)",s="Blocs de codage (m)",c="Domaine de d\xE9faillance Crush",d="Crush num failure domain",f="Crush osds per failure domain",p="Racine Crush",m="Classe de p\xE9riph\xE9rique Crush",h="Let Ceph decide",S="Available OSDs: \n          " + "\ufffd0\ufffd" + "\n        ",R="R\xE9pertoire",P="Ce champ est obligatoire !",A="Le nom doit \xEAtre exclusivement compos\xE9 de caract\xE8res alphanum\xE9riques, de tirets et de traits de soulignement.",$="Le nom de profil du code d'effacement s\xE9lectionn\xE9 est d\xE9j\xE0 utilis\xE9.",I="Chargement...",x="Ce champ est obligatoire !",Z="Ce champ est obligatoire !",y="Doit \xEAtre \xE9gal ou sup\xE9rieur \xE0 2.",U="Chunks (k+m) have exceeded the available OSDs of \n          " + "\ufffd0\ufffd" + ".\n        ",G="For an equal distribution k has to be a multiple of (k+m)/l.",H="K has to be equal to or greater than m in order to recover data correctly through c.",q="Distribution factor: \n          " + "\ufffd0\ufffd" + "\n        ",z="Ce champ est obligatoire !",X="Doit \xEAtre \xE9gal ou sup\xE9rieur \xE0 1.",w="Chunks (k+m) have exceeded the available OSDs of \n          " + "\ufffd0\ufffd" + ".\n        ",Q="Estimateur de durabilit\xE9 (c)",J="Doit \xEAtre \xE9gal ou sup\xE9rieur \xE0 1.",k="C has to be equal to or lower than m as m defines the amount of chunks that can be used.",V="Helper chunks (d)",Y="Set d manually or use the plugin's default calculation that maximizes d.",B="D is automatically updated on k and m changes",j="D can be set from \n          " + "\ufffd0\ufffd" + " to \n          " + "\ufffd1\ufffd" + "\n        ",K="D can only be set to \n          " + "\ufffd0\ufffd" + "\n        ",W="D has to be greater than k (\n          " + "\ufffd0\ufffd" + ").\n        ",N="D has to be lower than k + m (\n          " + "\ufffd0\ufffd" + ").\n        ",ee="Localit\xE9 (l)",_e="Locality groups: \n          " + "\ufffd0\ufffd" + "\n        ",oe="Ce champ est obligatoire !",te="Doit \xEAtre \xE9gal ou sup\xE9rieur \xE0 1.",ie="Can't split up chunks (k+m) correctly with the current locality.",ne="Chargement...",se="This field is required when crush osds per failure domain is set!",ae="This field is required when crush num failure domain is set!",le="Localit\xE9 Crush",re="Chargement...",ce="Aucun",Oe="Scalar mds",de="Technique",b="Taille de paquet",ue="Doit \xEAtre \xE9gal ou sup\xE9rieur \xE0 1.",Pe="Chargement...",[[3,"modalRef"],[1,"modal-title"],i,[1,"modal-content"],["novalidate","",3,"formGroup"],["frm","ngForm"],[1,"modal-body"],[1,"form-group","row"],["for","name",1,"cd-col-form-label"],_,[1,"cd-col-form-input"],["type","text","id","name","name","name","placeholder","Name...","formControlName","name","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","plugin",1,"cd-col-form-label"],[1,"required"],t,[3,"html"],["id","plugin","name","plugin","formControlName","plugin",1,"form-select"],["ngValue","",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],["for","k",1,"cd-col-form-label"],n,["type","number","id","k","name","k","ng-model","$ctrl.erasureCodeProfile.k","placeholder","Data chunks...","formControlName","k","min","2",1,"form-control"],["class","form-text text-muted",4,"ngIf"],["for","m",1,"cd-col-form-label"],s,["type","number","id","m","name","m","placeholder","Coding chunks...","formControlName","m","min","1",1,"form-control"],["class","form-group row",4,"ngIf"],["for","crushFailureDomain",1,"cd-col-form-label"],c,["id","crushFailureDomain","name","crushFailureDomain","formControlName","crushFailureDomain",1,"form-select"],["for","crushNumFailureDomains",1,"cd-col-form-label"],d,["type","number","id","crushNumFailureDomains","name","crushNumFailureDomains","formControlName","crushNumFailureDomains","min","0",1,"form-control"],["for","crushOsdsPerFailureDomain",1,"cd-col-form-label"],f,["type","number","id","crushOsdsPerFailureDomain","name","crushOsdsPerFailureDomain","formControlName","crushOsdsPerFailureDomain","min","0",1,"form-control"],["for","crushRoot",1,"cd-col-form-label"],p,["id","crushRoot","name","crushRoot","formControlName","crushRoot",1,"form-select"],["for","crushDeviceClass",1,"cd-col-form-label"],m,["id","crushDeviceClass","name","crushDeviceClass","formControlName","crushDeviceClass",1,"form-select"],["ngValue",""],h,[1,"form-text","text-muted"],S,["for","directory",1,"cd-col-form-label"],R,["type","text","id","directory","name","directory","placeholder","Path...","formControlName","directory",1,"form-control"],[1,"modal-footer"],[3,"form","submitText","submitActionEvent"],[1,"invalid-feedback"],P,A,$,I,[3,"ngValue"],x,Z,y,U,G,H,q,z,X,w,["for","c",1,"cd-col-form-label"],Q,["type","number","id","c","name","c","placeholder","Coding chunks...","formControlName","c","min","1",1,"form-control"],J,k,["for","d",1,"cd-col-form-label"],V,[1,"input-group"],["type","number","id","d","name","d","placeholder","Helper chunks...","formControlName","d",1,"form-control"],["id","d-calc-btn","ngbTooltip",Y,"type","button",1,"btn","btn-light",3,"click"],["aria-hidden","true",3,"ngClass"],[4,"ngIf"],B,j,K,W,N,["for","l",1,"cd-col-form-label"],ee,["type","number","id","l","name","l","placeholder","Coding chunks...","formControlName","l","min","1",1,"form-control"],_e,oe,te,ie,ne,se,ae,["for","crushLocality",1,"cd-col-form-label"],le,["id","crushLocality","name","crushLocality","formControlName","crushLocality",1,"form-select"],re,ce,["for","scalar_mds",1,"cd-col-form-label"],Oe,["id","scalar_mds","name","scalar_mds","formControlName","scalar_mds",1,"form-select"],["for","technique",1,"cd-col-form-label"],de,["id","technique","name","technique","formControlName","technique",1,"form-select"],["for","packetSize",1,"cd-col-form-label"],b,["type","number","id","packetSize","name","packetSize","placeholder","Packetsize...","formControlName","packetSize","min","1",1,"form-control"],ue,Pe]},template:function(_,t){if(1&_&&(e.TgZ(0,"cd-modal",0),e.ynx(1,1),e.SDv(2,2),e.ALo(3,"titlecase"),e.ALo(4,"upperFirst"),e.BQk(),e.ynx(5,3),e.TgZ(6,"form",4,5)(8,"div",6)(9,"div",7)(10,"label",8),e.SDv(11,9),e.qZA(),e.TgZ(12,"div",10),e._UZ(13,"input",11),e.YNc(14,H_,2,0,"span",12),e.YNc(15,q_,2,0,"span",12),e.YNc(16,z_,2,0,"span",12),e.qZA()(),e.TgZ(17,"div",7)(18,"label",13)(19,"span",14),e.SDv(20,15),e.qZA(),e._UZ(21,"cd-helper",16),e.qZA(),e.TgZ(22,"div",10)(23,"select",17),e.YNc(24,X_,2,0,"option",18),e.YNc(25,w_,2,2,"option",19),e.qZA(),e.YNc(26,Q_,2,0,"span",12),e.qZA()(),e.TgZ(27,"div",7)(28,"label",20)(29,"span",14),e.SDv(30,21),e.qZA(),e._UZ(31,"cd-helper",16),e.qZA(),e.TgZ(32,"div",10),e._UZ(33,"input",22),e.YNc(34,J_,2,0,"span",12),e.YNc(35,k_,2,0,"span",12),e.YNc(36,V_,2,1,"span",12),e.YNc(37,Y_,2,0,"span",12),e.YNc(38,B_,2,0,"span",12),e.YNc(39,j_,2,1,"span",23),e.qZA()(),e.TgZ(40,"div",7)(41,"label",24)(42,"span",14),e.SDv(43,25),e.qZA(),e._UZ(44,"cd-helper",16),e.qZA(),e.TgZ(45,"div",10),e._UZ(46,"input",26),e.YNc(47,K_,2,0,"span",12),e.YNc(48,W_,2,0,"span",12),e.YNc(49,eo,2,1,"span",12),e.qZA()(),e.YNc(50,to,9,3,"div",27),e.YNc(51,co,14,6,"div",27),e.YNc(52,fo,12,5,"div",27),e.TgZ(53,"div",7)(54,"label",28),e.ynx(55),e.SDv(56,29),e.BQk(),e._UZ(57,"cd-helper",16),e.qZA(),e.TgZ(58,"div",10)(59,"select",30),e.YNc(60,Eo,2,0,"option",18),e.YNc(61,go,2,3,"option",19),e.qZA()()(),e.TgZ(62,"div",7)(63,"label",31),e.ynx(64),e.SDv(65,32),e.BQk(),e._UZ(66,"cd-helper",16),e.qZA(),e.TgZ(67,"div",10),e._UZ(68,"input",33),e.YNc(69,po,2,0,"span",12),e.qZA()(),e.TgZ(70,"div",7)(71,"label",34),e.ynx(72),e.SDv(73,35),e.BQk(),e._UZ(74,"cd-helper",16),e.qZA(),e.TgZ(75,"div",10),e._UZ(76,"input",36),e.YNc(77,mo,2,0,"span",12),e.qZA()(),e.YNc(78,ho,10,4,"div",27),e.YNc(79,To,8,6,"div",27),e.YNc(80,Ao,8,2,"div",27),e.YNc(81,No,8,2,"div",27),e.TgZ(82,"div",7)(83,"label",37),e.ynx(84),e.SDv(85,38),e.BQk(),e._UZ(86,"cd-helper",16),e.qZA(),e.TgZ(87,"div",10)(88,"select",39),e.YNc(89,bo,2,0,"option",18),e.YNc(90,vo,2,2,"option",19),e.qZA()()(),e.TgZ(91,"div",7)(92,"label",40),e.ynx(93),e.SDv(94,41),e.BQk(),e._UZ(95,"cd-helper",16),e.qZA(),e.TgZ(96,"div",10)(97,"select",42)(98,"option",43),e.SDv(99,44),e.qZA(),e.YNc(100,Do,2,2,"option",19),e.qZA(),e.TgZ(101,"span",45),e.SDv(102,46),e.qZA()()(),e.TgZ(103,"div",7)(104,"label",47),e.ynx(105),e.SDv(106,48),e.BQk(),e._UZ(107,"cd-helper",16),e.qZA(),e.TgZ(108,"div",10),e._UZ(109,"input",49),e.qZA()()(),e.TgZ(110,"div",50)(111,"cd-form-button-panel",51),e.NdJ("submitActionEvent",function(){return t.onSubmit()}),e.ALo(112,"titlecase"),e.ALo(113,"upperFirst"),e.qZA()()(),e.BQk(),e.qZA()),2&_){const n=e.MAs(7);e.Q6J("modalRef",t.activeModal),e.xp6(4),e.pQV(e.lcZ(3,45,t.action))(e.lcZ(4,47,t.resource)),e.QtT(2),e.xp6(2),e.Q6J("formGroup",t.form),e.xp6(8),e.Q6J("ngIf",t.form.showError("name",n,"required")),e.xp6(1),e.Q6J("ngIf",t.form.showError("name",n,"pattern")),e.xp6(1),e.Q6J("ngIf",t.form.showError("name",n,"uniqueName")),e.xp6(5),e.Q6J("html",t.tooltips.plugins[t.plugin].description),e.xp6(3),e.Q6J("ngIf",!t.plugins),e.xp6(1),e.Q6J("ngForOf",t.plugins),e.xp6(1),e.Q6J("ngIf",t.form.showError("name",n,"required")),e.xp6(5),e.Q6J("html",t.tooltips.k),e.xp6(3),e.Q6J("ngIf",t.form.showError("k",n,"required")),e.xp6(1),e.Q6J("ngIf",t.form.showError("k",n,"min")),e.xp6(1),e.Q6J("ngIf",t.form.showError("k",n,"max")),e.xp6(1),e.Q6J("ngIf",t.form.showError("k",n,"unequal")),e.xp6(1),e.Q6J("ngIf",t.form.showError("k",n,"kLowerM")),e.xp6(1),e.Q6J("ngIf","lrc"===t.plugin),e.xp6(5),e.Q6J("html",t.tooltips.m),e.xp6(3),e.Q6J("ngIf",t.form.showError("m",n,"required")),e.xp6(1),e.Q6J("ngIf",t.form.showError("m",n,"min")),e.xp6(1),e.Q6J("ngIf",t.form.showError("m",n,"max")),e.xp6(1),e.Q6J("ngIf","shec"===t.plugin),e.xp6(1),e.Q6J("ngIf","clay"===t.plugin),e.xp6(1),e.Q6J("ngIf",t.plugin===t.PLUGIN.LRC),e.xp6(5),e.Q6J("html",t.tooltips.crushFailureDomain),e.xp6(3),e.Q6J("ngIf",!t.failureDomains),e.xp6(1),e.Q6J("ngForOf",t.failureDomainKeys),e.xp6(5),e.Q6J("html",t.tooltips.crushNumFailureDomains),e.xp6(3),e.Q6J("ngIf",t.form.showError("crushNumFailureDomains",n,"required")),e.xp6(5),e.Q6J("html",t.tooltips.crushOsdsPerFailureDomain),e.xp6(3),e.Q6J("ngIf",t.form.showError("crushOsdsPerFailureDomain",n,"required")),e.xp6(1),e.Q6J("ngIf",t.plugin===t.PLUGIN.LRC),e.xp6(1),e.Q6J("ngIf",t.PLUGIN.CLAY===t.plugin),e.xp6(1),e.Q6J("ngIf",e.kEZ(53,ye,t.PLUGIN.JERASURE,t.PLUGIN.ISA,t.PLUGIN.CLAY).includes(t.plugin)),e.xp6(1),e.Q6J("ngIf",t.plugin===t.PLUGIN.JERASURE),e.xp6(5),e.Q6J("html",t.tooltips.crushRoot),e.xp6(3),e.Q6J("ngIf",!t.buckets),e.xp6(1),e.Q6J("ngForOf",t.buckets),e.xp6(5),e.Q6J("html",t.tooltips.crushDeviceClass),e.xp6(5),e.Q6J("ngForOf",t.devices),e.xp6(2),e.pQV(t.deviceCount),e.QtT(102),e.xp6(5),e.Q6J("html",t.tooltips.directory),e.xp6(4),e.Q6J("form",t.form)("submitText",e.lcZ(112,49,t.action)+" "+e.lcZ(113,51,t.resource))}},dependencies:[C.mk,C.sg,C.O5,pe.S,Ze.z,me.p,Re.U,Ce.o,Me.b,he.P,Se.V,l._Y,l.YN,l.Kr,l.Fj,l.wV,l.EJ,l.JJ,l.JL,l.qQ,l.sg,l.u,E._L,C.rS,Te.m]}),o})();var Io=r(7022);class xo{constructor(){this.erasureInfo=!1,this.crushInfo=!1,this.pgs=1,this.poolTypes=["erasure","replicated"],this.applications={selected:[],default:["cephfs","rbd","rgw"],available:[],validators:[l.kI.pattern("[A-Za-z0-9_]+"),l.kI.maxLength(128)],messages:new Io.a({empty:"No applications added",selectionLimit:{text:"Applications limit reached",tooltip:"A pool can only have up to four applications definitions."},customValidations:{pattern:"Allowed characters '_a-zA-Z0-9'",maxlength:"Maximum length is 128 characters"},filter:"Filter or add applications'",add:"Add application"})}}}var Ue=r(63285),Ge=r(47640),Zo=r(60192),yo=r(30490),He=r(61350),Uo=r(17932),Go=r(63622),Ho=r(60950);const qo=["crushInfoTabs"],zo=["crushDeletionBtn"],Xo=["ecpInfoTabs"],wo=["ecpDeletionBtn"];function Qo(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,42),e.qZA())}function Jo(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,43),e.qZA())}function ko(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,44),e.qZA())}function Vo(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,45),e.qZA())}function Yo(o,i){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("value",_),e.xp6(1),e.hij(" ",_," ")}}function Bo(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,47),e.qZA())}function jo(o,i){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("value",_),e.xp6(1),e.hij(" ",_," ")}}function Ko(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,58),e.qZA())}function Wo(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,59),e.qZA())}function et(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,60),e.qZA())}function _t(o,i){1&o&&(e.TgZ(0,"span",55),e.SDv(1,61),e.qZA())}function ot(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"div",8)(1,"label",52),e.SDv(2,53),e.qZA(),e.TgZ(3,"div",11)(4,"input",54),e.NdJ("focus",function(){e.CHM(_);const n=e.oxw(3);return e.KtG(n.externalPgChange=!1)})("blur",function(){e.CHM(_);const n=e.oxw(3);return e.KtG(n.alignPgs())}),e.qZA(),e.YNc(5,Ko,2,0,"span",13),e.YNc(6,Wo,2,0,"span",13),e.YNc(7,et,2,0,"span",13),e.TgZ(8,"span",55),e._UZ(9,"cd-doc",56),e.qZA(),e.YNc(10,_t,2,0,"span",57),e.qZA()()}if(2&o){e.oxw(2);const _=e.MAs(2),t=e.oxw();e.xp6(5),e.Q6J("ngIf",t.form.showError("pgNum",_,"required")),e.xp6(1),e.Q6J("ngIf",t.form.showError("pgNum",_,"min")),e.xp6(1),e.Q6J("ngIf",t.form.showError("pgNum",_,"34")),e.xp6(3),e.Q6J("ngIf",t.externalPgChange)}}function tt(o,i){if(1&o&&(e.TgZ(0,"span",41)(1,"ul",66)(2,"li"),e.SDv(3,67),e.qZA(),e.TgZ(4,"li"),e.SDv(5,68),e.qZA()()()),2&o){const _=e.oxw(4);e.xp6(3),e.pQV(_.getMinSize()),e.QtT(3),e.xp6(2),e.pQV(_.getMaxSize()),e.QtT(5)}}function it(o,i){if(1&o&&(e.TgZ(0,"span",41),e.SDv(1,69),e.qZA()),2&o){const _=e.oxw(4);e.xp6(1),e.pQV(_.getMinSize())(_.getMaxSize()),e.QtT(1)}}function nt(o,i){1&o&&(e.TgZ(0,"span",70),e.SDv(1,71),e.qZA())}function st(o,i){if(1&o&&(e.TgZ(0,"div",8)(1,"label",62),e.SDv(2,63),e.qZA(),e.TgZ(3,"div",11),e._UZ(4,"input",64),e.YNc(5,tt,6,2,"span",13),e.YNc(6,it,2,2,"span",13),e.YNc(7,nt,2,0,"span",65),e.qZA()()),2&o){e.oxw(2);const _=e.MAs(2),t=e.oxw();e.xp6(4),e.Q6J("max",t.getMaxSize())("min",t.getMinSize()),e.xp6(1),e.Q6J("ngIf",t.form.showError("size",_)),e.xp6(1),e.Q6J("ngIf",t.form.showError("size",_)),e.xp6(1),e.Q6J("ngIf",1===t.form.getValue("size"))}}function at(o,i){1&o&&(e.TgZ(0,"div",8)(1,"label",72),e.SDv(2,73),e.qZA(),e.TgZ(3,"div",11)(4,"div",74),e._UZ(5,"input",75),e.TgZ(6,"label",76),e.SDv(7,77),e.qZA()()()())}function lt(o,i){if(1&o&&(e.TgZ(0,"div")(1,"div",8)(2,"label",48),e.SDv(3,49),e.qZA(),e.TgZ(4,"div",11)(5,"select",50),e.YNc(6,jo,2,2,"option",19),e.qZA()()(),e.YNc(7,ot,11,4,"div",51),e.YNc(8,st,8,5,"div",51),e.YNc(9,at,8,0,"div",51),e.qZA()),2&o){const _=e.oxw(2);e.xp6(6),e.Q6J("ngForOf",_.pgAutoscaleModes),e.xp6(1),e.Q6J("ngIf","on"!==_.form.getValue("pgAutoscaleMode")),e.xp6(1),e.Q6J("ngIf",_.isReplicated),e.xp6(1),e.Q6J("ngIf",_.info.is_all_bluestore&&_.isErasure)}}function rt(o,i){if(1&o&&e._UZ(0,"i",78),2&o){const _=e.oxw(2);e.Gre("",_.icons.warning," icon-warning-color")}}function ct(o,i){1&o&&(e.TgZ(0,"option",17),e.SDv(1,92),e.qZA())}function Ot(o,i){1&o&&(e.TgZ(0,"option",93),e.SDv(1,94),e.qZA()),2&o&&e.Q6J("ngValue",null)}function dt(o,i){1&o&&(e.TgZ(0,"option",93),e.SDv(1,95),e.qZA()),2&o&&e.Q6J("ngValue",null)}function ut(o,i){if(1&o&&(e.TgZ(0,"option",93),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_.name," ")}}const F=function(o){return[o]};function Pt(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"button",96),e.NdJ("click",function(){e.CHM(_);const n=e.oxw(4);return e.KtG(n.addErasureCodeProfile())}),e._UZ(1,"i",88),e.qZA()}if(2&o){const _=e.oxw(4);e.xp6(1),e.Q6J("ngClass",e.VKq(1,F,_.icons.add))}}function ft(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"button",97,98),e.NdJ("click",function(){e.CHM(_);const n=e.oxw(4);return e.KtG(n.deleteErasureCodeProfile())}),e._UZ(2,"i",88),e.qZA()}if(2&o){const _=e.oxw(4);e.xp6(2),e.Q6J("ngClass",e.VKq(1,F,_.icons.trash))}}const Et=function(){return["name"]};function gt(o,i){if(1&o&&e._UZ(0,"cd-table-key-value",109),2&o){const _=e.oxw(5);e.Q6J("renderObjects",!0)("hideKeys",e.DdM(4,Et))("data",_.form.getValue("erasureProfile"))("autoReload",!1)}}function pt(o,i){1&o&&(e.TgZ(0,"span"),e.SDv(1,112),e.qZA())}function mt(o,i){if(1&o&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.xp6(1),e.hij(" ",_," ")}}function Rt(o,i){if(1&o&&(e.TgZ(0,"ul"),e.YNc(1,mt,2,1,"li",113),e.qZA()),2&o){const _=e.oxw(6);e.xp6(1),e.Q6J("ngForOf",_.ecpUsage)}}function Ct(o,i){if(1&o&&(e.YNc(0,pt,2,0,"ng-template",null,110,e.W1O),e.YNc(2,Rt,2,1,"ul",111)),2&o){const _=e.MAs(1),t=e.oxw(5);e.xp6(2),e.Q6J("ngIf",t.ecpUsage)("ngIfElse",_)}}function Mt(o,i){if(1&o&&(e.TgZ(0,"span",99)(1,"nav",100,101),e.ynx(3,102),e.TgZ(4,"a",103),e.SDv(5,104),e.qZA(),e.YNc(6,gt,1,5,"ng-template",105),e.BQk(),e.ynx(7,106),e.TgZ(8,"a",103),e.SDv(9,107),e.qZA(),e.YNc(10,Ct,3,2,"ng-template",105),e.BQk(),e.qZA(),e._UZ(11,"div",108),e.qZA()),2&o){const _=e.MAs(2);e.xp6(11),e.Q6J("ngbNavOutlet",_)}}const qe=function(o){return{active:o}};function ht(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"div",8)(1,"label",80),e.SDv(2,81),e.qZA(),e.TgZ(3,"div",11)(4,"div",82)(5,"select",83),e.NdJ("change",function(){e.CHM(_);const n=e.oxw(3);return e.KtG(n.erasureProfileChange())}),e.YNc(6,ct,2,0,"option",84),e.YNc(7,Ot,2,1,"option",85),e.YNc(8,dt,2,1,"option",85),e.YNc(9,ut,2,2,"option",86),e.qZA(),e.TgZ(10,"button",87),e.NdJ("click",function(){e.CHM(_);const n=e.oxw(3);return e.KtG(n.data.erasureInfo=!n.data.erasureInfo)}),e._UZ(11,"i",88),e.qZA(),e.YNc(12,Pt,2,3,"button",89),e.YNc(13,ft,3,3,"button",90),e.qZA(),e.YNc(14,Mt,12,1,"span",91),e.qZA()()}if(2&o){const _=e.oxw(3);e.xp6(6),e.Q6J("ngIf",!_.ecProfiles),e.xp6(1),e.Q6J("ngIf",_.ecProfiles&&0===_.ecProfiles.length),e.xp6(1),e.Q6J("ngIf",_.ecProfiles&&_.ecProfiles.length>0),e.xp6(1),e.Q6J("ngForOf",_.ecProfiles),e.xp6(1),e.Q6J("ngClass",e.VKq(9,qe,_.data.erasureInfo)),e.xp6(1),e.Q6J("ngClass",e.VKq(11,F,_.icons.questionCircle)),e.xp6(1),e.Q6J("ngIf",!_.editing),e.xp6(1),e.Q6J("ngIf",!_.editing),e.xp6(1),e.Q6J("ngIf",_.data.erasureInfo&&_.form.getValue("erasureProfile"))}}function St(o,i){1&o&&(e.TgZ(0,"span",55),e.SDv(1,118),e.qZA())}function Tt(o,i){1&o&&(e.TgZ(0,"span",55),e.SDv(1,119),e.qZA())}function Lt(o,i){if(1&o&&(e.TgZ(0,"div",8)(1,"label",114),e.SDv(2,115),e.qZA(),e.TgZ(3,"div",11),e.YNc(4,St,2,0,"span",116),e.YNc(5,Tt,2,0,"ng-template",null,117,e.W1O),e.qZA()()),2&o){const _=e.MAs(6),t=e.oxw(3);e.xp6(4),e.Q6J("ngIf",!t.msrCrush)("ngIfElse",_)}}function At(o,i){1&o&&(e.TgZ(0,"span",55)(1,"span"),e.SDv(2,122),e.qZA(),e._uU(3,"\xa0 "),e.qZA())}function Ft(o,i){if(1&o&&(e.TgZ(0,"option",93),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_.rule_name," ")}}function Nt(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"button",96),e.NdJ("click",function(){e.CHM(_);const n=e.oxw(5);return e.KtG(n.addCrushRule())}),e._UZ(1,"i",88),e.qZA()}if(2&o){const _=e.oxw(5);e.xp6(1),e.Q6J("ngClass",e.VKq(1,F,_.icons.add))}}function bt(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"button",129,130),e.NdJ("click",function(){e.CHM(_);const n=e.oxw(5);return e.KtG(n.deleteCrushRule())}),e._UZ(2,"i",88),e.qZA()}if(2&o){const _=e.oxw(5);e.xp6(2),e.Q6J("ngClass",e.VKq(1,F,_.icons.trash))}}const vt=function(){return["steps","type","rule_name"]};function Dt(o,i){if(1&o&&e._UZ(0,"cd-table-key-value",109),2&o){const _=e.oxw(6);e.Q6J("renderObjects",!1)("hideKeys",e.DdM(4,vt))("data",_.form.getValue("crushRule"))("autoReload",!1)}}function $t(o,i){if(1&o&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&o){const _=i.$implicit,t=e.oxw(7);e.xp6(1),e.hij(" ",t.describeCrushStep(_)," ")}}function It(o,i){if(1&o&&(e.TgZ(0,"ol"),e.YNc(1,$t,2,1,"li",113),e.qZA()),2&o){const _=e.oxw(6);e.xp6(1),e.Q6J("ngForOf",_.form.get("crushRule").value.steps)}}function xt(o,i){1&o&&(e.TgZ(0,"span"),e.SDv(1,139),e.qZA())}function Zt(o,i){if(1&o&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.xp6(1),e.hij(" ",_," ")}}function yt(o,i){if(1&o&&(e.TgZ(0,"ul"),e.YNc(1,Zt,2,1,"li",113),e.qZA()),2&o){const _=e.oxw(7);e.xp6(1),e.Q6J("ngForOf",_.crushUsage)}}function Ut(o,i){if(1&o&&(e.YNc(0,xt,2,0,"ng-template",null,138,e.W1O),e.YNc(2,yt,2,1,"ul",111)),2&o){const _=e.MAs(1),t=e.oxw(6);e.xp6(2),e.Q6J("ngIf",t.crushUsage)("ngIfElse",_)}}function Gt(o,i){if(1&o&&(e.TgZ(0,"div",131)(1,"nav",100,132),e.ynx(3,133),e.TgZ(4,"a",103),e.SDv(5,134),e.qZA(),e.YNc(6,Dt,1,5,"ng-template",105),e.BQk(),e.ynx(7,135),e.TgZ(8,"a",103),e.SDv(9,136),e.qZA(),e.YNc(10,It,2,1,"ng-template",105),e.BQk(),e.ynx(11,106),e.TgZ(12,"a",103),e.SDv(13,137),e.qZA(),e.YNc(14,Ut,3,2,"ng-template",105),e.BQk(),e.qZA(),e._UZ(15,"div",108),e.qZA()),2&o){const _=e.MAs(2);e.xp6(15),e.Q6J("ngbNavOutlet",_)}}function Ht(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,140),e.qZA())}function qt(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,141),e.qZA())}function zt(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"div")(1,"div",123)(2,"select",124)(3,"option",93),e.SDv(4,125),e.qZA(),e.YNc(5,Ft,2,2,"option",86),e.qZA(),e.TgZ(6,"button",126),e.NdJ("click",function(){e.CHM(_);const n=e.oxw(4);return e.KtG(n.data.crushInfo=!n.data.crushInfo)}),e._UZ(7,"i",88),e.qZA(),e.YNc(8,Nt,2,3,"button",89),e.YNc(9,bt,3,3,"button",127),e.qZA(),e.YNc(10,Gt,16,1,"div",128),e.YNc(11,Ht,2,0,"span",13),e.YNc(12,qt,2,0,"span",13),e.qZA()}if(2&o){e.oxw(3);const _=e.MAs(2),t=e.oxw();e.xp6(3),e.Q6J("ngValue",null),e.xp6(2),e.Q6J("ngForOf",t.current.rules),e.xp6(1),e.Q6J("ngClass",e.VKq(9,qe,t.data.crushInfo)),e.xp6(1),e.Q6J("ngClass",e.VKq(11,F,t.icons.questionCircle)),e.xp6(1),e.Q6J("ngIf",t.isReplicated&&!t.editing),e.xp6(1),e.Q6J("ngIf",t.isReplicated&&!t.editing),e.xp6(1),e.Q6J("ngIf",t.data.crushInfo&&t.form.getValue("crushRule")),e.xp6(1),e.Q6J("ngIf",t.form.showError("crushRule",_,"required")),e.xp6(1),e.Q6J("ngIf",t.form.showError("crushRule",_,"tooFewOsds"))}}function Xt(o,i){if(1&o&&(e.TgZ(0,"div",8)(1,"label",114),e.SDv(2,120),e.qZA(),e.TgZ(3,"div",11),e.YNc(4,At,4,0,"ng-template",null,121,e.W1O),e.YNc(6,zt,13,13,"div",111),e.qZA()()),2&o){const _=e.MAs(5),t=e.oxw(3);e.xp6(6),e.Q6J("ngIf",t.current.rules.length>0)("ngIfElse",_)}}function wt(o,i){if(1&o&&(e.TgZ(0,"div")(1,"legend"),e.SDv(2,79),e.qZA(),e.YNc(3,ht,15,13,"div",51),e.YNc(4,Lt,7,2,"div",51),e.YNc(5,Xt,7,2,"div",51),e.qZA()),2&o){const _=e.oxw(2);e.xp6(3),e.Q6J("ngIf",_.isErasure),e.xp6(1),e.Q6J("ngIf",_.isErasure&&!_.editing),e.xp6(1),e.Q6J("ngIf",_.isReplicated||_.editing)}}function Qt(o,i){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("value",_),e.xp6(1),e.hij(" ",_," ")}}function Jt(o,i){1&o&&(e.TgZ(0,"option",17),e.SDv(1,159),e.qZA())}function kt(o,i){1&o&&(e.TgZ(0,"option",17),e.SDv(1,160),e.qZA())}function Vt(o,i){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("value",_),e.xp6(1),e.hij(" ",_," ")}}function Yt(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,161),e.qZA())}function Bt(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,162),e.qZA())}function jt(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,163),e.qZA())}function Kt(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,164),e.qZA())}function Wt(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,165),e.qZA())}function ei(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,166),e.qZA())}function _i(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,167),e.qZA())}function oi(o,i){if(1&o&&(e.TgZ(0,"div")(1,"div",8)(2,"label",147),e.SDv(3,148),e.qZA(),e.TgZ(4,"div",11)(5,"select",149),e.YNc(6,Jt,2,0,"option",84),e.YNc(7,kt,2,0,"option",84),e.YNc(8,Vt,2,2,"option",19),e.qZA()()(),e.TgZ(9,"div",8)(10,"label",150),e.SDv(11,151),e.qZA(),e.TgZ(12,"div",11),e._UZ(13,"input",152),e.YNc(14,Yt,2,0,"span",13),e.YNc(15,Bt,2,0,"span",13),e.YNc(16,jt,2,0,"span",13),e.qZA()(),e.TgZ(17,"div",8)(18,"label",153),e.SDv(19,154),e.qZA(),e.TgZ(20,"div",11),e._UZ(21,"input",155),e.YNc(22,Kt,2,0,"span",13),e.YNc(23,Wt,2,0,"span",13),e.YNc(24,ei,2,0,"span",13),e.qZA()(),e.TgZ(25,"div",8)(26,"label",156),e.SDv(27,157),e.qZA(),e.TgZ(28,"div",11),e._UZ(29,"input",158),e.YNc(30,_i,2,0,"span",13),e.qZA()()()),2&o){e.oxw(2);const _=e.MAs(2),t=e.oxw();e.xp6(6),e.Q6J("ngIf",!t.info.compression_algorithms),e.xp6(1),e.Q6J("ngIf",t.info.compression_algorithms&&0===t.info.compression_algorithms.length),e.xp6(1),e.Q6J("ngForOf",t.info.compression_algorithms),e.xp6(6),e.Q6J("ngIf",t.form.showError("minBlobSize",_,"min")),e.xp6(1),e.Q6J("ngIf",t.form.showError("minBlobSize",_,"maximum")),e.xp6(1),e.Q6J("ngIf",t.form.showError("minBlobSize",_,"pattern")),e.xp6(6),e.Q6J("ngIf",t.form.showError("maxBlobSize",_,"min")),e.xp6(1),e.Q6J("ngIf",t.form.showError("maxBlobSize",_,"minimum")),e.xp6(1),e.Q6J("ngIf",t.form.showError("maxBlobSize",_,"pattern")),e.xp6(6),e.Q6J("ngIf",t.form.showError("ratio",_,"min")||t.form.showError("ratio",_,"max"))}}function ti(o,i){if(1&o&&(e.TgZ(0,"div",142)(1,"legend"),e.SDv(2,143),e.qZA(),e.TgZ(3,"div",8)(4,"label",144),e.SDv(5,145),e.qZA(),e.TgZ(6,"div",11)(7,"select",146),e.YNc(8,Qt,2,2,"option",19),e.qZA()()(),e.YNc(9,oi,31,10,"div",20),e.qZA()),2&o){const _=e.oxw(2);e.xp6(8),e.Q6J("ngForOf",_.info.compression_modes),e.xp6(1),e.Q6J("ngIf",_.hasCompressionEnabled())}}function ii(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,168),e.qZA())}function ni(o,i){1&o&&(e.TgZ(0,"span",41),e.SDv(1,169),e.qZA())}function si(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"div",1)(1,"form",2,3)(3,"div",4)(4,"div",5),e.SDv(5,6),e.ALo(6,"titlecase"),e.ALo(7,"upperFirst"),e.qZA(),e.TgZ(8,"div",7)(9,"div",8)(10,"label",9),e.SDv(11,10),e.qZA(),e.TgZ(12,"div",11),e._UZ(13,"input",12),e.YNc(14,Qo,2,0,"span",13),e.YNc(15,Jo,2,0,"span",13),e.YNc(16,ko,2,0,"span",13),e.YNc(17,Vo,2,0,"span",13),e.qZA()(),e.TgZ(18,"div",8)(19,"label",14),e.SDv(20,15),e.qZA(),e.TgZ(21,"div",11)(22,"select",16)(23,"option",17),e.SDv(24,18),e.qZA(),e.YNc(25,Yo,2,2,"option",19),e.qZA(),e.YNc(26,Bo,2,0,"span",13),e.qZA()(),e.YNc(27,lt,10,4,"div",20),e.TgZ(28,"div",8)(29,"label",21),e.SDv(30,22),e.qZA(),e.TgZ(31,"div",11)(32,"cd-select-badges",23),e.NdJ("selection",function(){e.CHM(_);const n=e.oxw();return e.KtG(n.appSelection())}),e.qZA(),e.YNc(33,rt,1,3,"i",24),e.qZA()(),e.YNc(34,wt,6,3,"div",20),e.YNc(35,ti,10,2,"div",25),e.TgZ(36,"div")(37,"legend"),e.SDv(38,26),e.qZA(),e.TgZ(39,"div",8)(40,"label",27),e.ynx(41),e.SDv(42,28),e.BQk(),e.TgZ(43,"cd-helper")(44,"span"),e.SDv(45,29),e.qZA(),e._UZ(46,"br"),e.TgZ(47,"span"),e.SDv(48,30),e.qZA()()(),e.TgZ(49,"div",11),e._UZ(50,"input",31),e.YNc(51,ii,2,0,"span",13),e.qZA()(),e.TgZ(52,"div",8)(53,"label",32),e.ynx(54),e.SDv(55,33),e.BQk(),e.TgZ(56,"cd-helper")(57,"span"),e.SDv(58,34),e.qZA(),e._UZ(59,"br"),e.TgZ(60,"span"),e.SDv(61,35),e.qZA()()(),e.TgZ(62,"div",11),e._UZ(63,"input",36),e.YNc(64,ni,2,0,"span",13),e.qZA()()(),e.TgZ(65,"div",37)(66,"cd-rbd-configuration-form",38),e.NdJ("changes",function(n){e.CHM(_);const s=e.oxw();return e.KtG(s.currentConfigurationValues=n())}),e.qZA()()(),e.TgZ(67,"div",39)(68,"cd-form-button-panel",40),e.NdJ("submitActionEvent",function(){e.CHM(_);const n=e.oxw();return e.KtG(n.submit())}),e.ALo(69,"titlecase"),e.ALo(70,"upperFirst"),e.qZA()()()()()}if(2&o){const _=e.MAs(2),t=e.oxw();e.xp6(1),e.Q6J("formGroup",t.form),e.xp6(6),e.pQV(e.lcZ(6,26,t.action))(e.lcZ(7,28,t.resource)),e.QtT(5),e.xp6(7),e.Q6J("ngIf",t.form.showError("name",_,"required")),e.xp6(1),e.Q6J("ngIf",t.form.showError("name",_,"uniqueName")),e.xp6(1),e.Q6J("ngIf",t.form.showError("name",_,"rbdPool")),e.xp6(1),e.Q6J("ngIf",t.form.showError("name",_,"pattern")),e.xp6(8),e.Q6J("ngForOf",t.data.poolTypes),e.xp6(1),e.Q6J("ngIf",t.form.showError("poolType",_,"required")),e.xp6(1),e.Q6J("ngIf",t.isReplicated||t.isErasure),e.xp6(5),e.Q6J("customBadges",!0)("customBadgeValidators",t.data.applications.validators)("messages",t.data.applications.messages)("data",t.data.applications.selected)("options",t.data.applications.available)("selectionLimit",4),e.xp6(1),e.Q6J("ngIf",t.data.applications.selected<=0),e.xp6(1),e.Q6J("ngIf",t.isErasure||t.isReplicated),e.xp6(1),e.Q6J("ngIf",t.info.is_all_bluestore),e.xp6(16),e.Q6J("ngIf",t.form.showError("max_bytes",_,"pattern")),e.xp6(13),e.Q6J("ngIf",t.form.showError("max_objects",_,"min")),e.xp6(1),e.Q6J("hidden",t.isErasure||-1===t.data.applications.selected.indexOf("rbd")),e.xp6(1),e.Q6J("form",t.form)("initializeData",t.initializeConfigData),e.xp6(2),e.Q6J("form",t.form)("submitText",e.lcZ(69,30,t.action)+" "+e.lcZ(70,32,t.resource))}}let ze=(()=>{class o extends h_.E{constructor(_,t,n,s,c,d,f,p,m,h,S){super(),this.dimlessBinaryPipe=_,this.route=t,this.router=n,this.modalService=s,this.poolService=c,this.authStorageService=d,this.formatter=f,this.taskWrapper=p,this.ecpService=m,this.crushRuleService=h,this.actionLabels=S,this.editing=!1,this.isReplicated=!1,this.isErasure=!1,this.data=new xo,this.externalPgChange=!1,this.current={rules:[]},this.initializeConfigData=new R_.t(1),this.currentConfigurationValues={},this.icons=v.P,this.crushUsage=void 0,this.ecpUsage=void 0,this.crushRuleMaxSize=10,this.msrCrush=!1,this.editing=this.router.url.startsWith(`/pool/${M.MQ.EDIT}`),this.action=this.editing?this.actionLabels.EDIT:this.actionLabels.CREATE,this.resource="pool",this.authenticate(),this.createForm()}authenticate(){if(this.permission=this.authStorageService.getPermissions().pool,!this.permission.read||!this.permission.update&&this.editing||!this.permission.create&&!this.editing)throw new C_._2}createForm(){const _=new $e.d({mode:new l.p4("none"),algorithm:new l.p4(""),minBlobSize:new l.p4("",{updateOn:"blur"}),maxBlobSize:new l.p4("",{updateOn:"blur"}),ratio:new l.p4("",{updateOn:"blur"})});this.form=new $e.d({name:new l.p4("",{validators:[l.kI.pattern(/^[.A-Za-z0-9_/-]+$/),l.kI.required,u.hq.custom("rbdPool",()=>this.form&&this.form.getValue("name").includes("/")&&this.data&&-1!==this.data.applications.selected.indexOf("rbd"))]}),poolType:new l.p4("",{validators:[l.kI.required]}),crushRule:new l.p4(null,{validators:[u.hq.custom("tooFewOsds",t=>this.info&&t&&this.info.osd_count<1),u.hq.custom("required",t=>this.isReplicated&&this.info.crush_rules_replicated.length>0&&!t)]}),size:new l.p4("",{updateOn:"blur"}),erasureProfile:new l.p4(null),pgNum:new l.p4("",{validators:[l.kI.required]}),pgAutoscaleMode:new l.p4(null),ecOverwrites:new l.p4(!1),compression:_,max_bytes:new l.p4(""),max_objects:new l.p4(0)},[u.hq.custom("form",()=>null)])}ngOnInit(){this.poolService.getInfo().subscribe(_=>{this.initInfo(_),this.editing?this.initEditMode():(this.setAvailableApps(),this.loadingReady()),this.listenToChanges(),this.setComplexValidators()}),this.erasureProfileChange()}initInfo(_){this.pgAutoscaleModes=_.pg_autoscale_modes,this.form.silentSet("pgAutoscaleMode",_.pg_autoscale_default_mode),this.form.silentSet("algorithm",_.bluestore_compression_algorithm),this.info=_,this.initEcp(_.erasure_code_profiles)}initEcp(_){this.setListControlStatus("erasureProfile",_),this.ecProfiles=_}setListControlStatus(_,t){const n=this.form.get(_),s=n.value;1!==t.length||s&&g().isEqual(s,t[0])?0===t.length&&s&&n.setValue(null):n.setValue(t[0]),t.length<=1?n.enabled&&n.disable():n.disabled&&n.enable()}initEditMode(){this.disableForEdit(),this.routeParamsSubscribe=this.route.params.subscribe(_=>this.poolService.get(_.name).subscribe(t=>{this.data.pool=t,this.initEditFormData(t),this.loadingReady()}))}disableForEdit(){["poolType","crushRule","size","erasureProfile","ecOverwrites"].forEach(_=>this.form.get(_).disable())}initEditFormData(_){this.initializeConfigData.next({initialData:_.configuration,sourceType:S_.h.pool}),this.poolTypeChange(_.type);const t=this.info.crush_rules_replicated.concat(this.info.crush_rules_erasure),n={name:_.pool_name,poolType:_.type,crushRule:t.find(s=>s.rule_name===_.crush_rule),size:_.size,erasureProfile:this.ecProfiles.find(s=>s.name===_.erasure_code_profile),pgAutoscaleMode:_.pg_autoscale_mode,pgNum:_.pg_num,ecOverwrites:_.flags_names.includes("ec_overwrites"),mode:_.options.compression_mode,algorithm:_.options.compression_algorithm,minBlobSize:this.dimlessBinaryPipe.transform(_.options.compression_min_blob_size),maxBlobSize:this.dimlessBinaryPipe.transform(_.options.compression_max_blob_size),ratio:_.options.compression_required_ratio,max_bytes:this.dimlessBinaryPipe.transform(_.quota_max_bytes),max_objects:_.quota_max_objects};Object.keys(n).forEach(s=>{const c=n[s];!g().isUndefined(c)&&""!==c&&this.form.silentSet(s,c)}),this.data.pgs=this.form.getValue("pgNum"),this.setAvailableApps(this.data.applications.default.concat(_.application_metadata)),this.data.applications.selected=_.application_metadata}setAvailableApps(_=this.data.applications.default){this.data.applications.available=g().uniq(_.sort()).map(t=>new M_.$(!1,t,""))}listenToChanges(){this.listenToChangesDuringAddEdit(),this.editing||this.listenToChangesDuringAdd()}listenToChangesDuringAddEdit(){this.form.get("pgNum").valueChanges.subscribe(_=>{const t=_-this.data.pgs;1===Math.abs(t)&&2!==_?this.doPgPowerJump(t):this.data.pgs=_})}doPgPowerJump(_){const t=this.calculatePgPower()+_;this.setPgs(-1===_?Math.round(t):Math.floor(t))}calculatePgPower(_=this.form.getValue("pgNum")){return Math.log(_)/Math.log(2)}setPgs(_){const t=Math.pow(2,_<0?0:_);this.data.pgs=t,this.form.silentSet("pgNum",t)}listenToChangesDuringAdd(){this.form.get("poolType").valueChanges.subscribe(_=>{this.poolTypeChange(_)}),this.form.get("crushRule").valueChanges.subscribe(_=>{this.crushDeletionBtn&&this.crushDeletionBtn.isOpen()&&this.crushDeletionBtn.close(),_&&(this.setCorrectMaxSize(_),this.crushRuleIsUsedBy(_.rule_name),this.replicatedRuleChange(),this.pgCalc())}),this.form.get("size").valueChanges.subscribe(()=>{this.pgCalc()}),this.form.get("erasureProfile").valueChanges.subscribe(_=>{this.ecpDeletionBtn&&this.ecpDeletionBtn.isOpen()&&this.ecpDeletionBtn.close(),_&&(this.ecpIsUsedBy(_.name),this.pgCalc())}),this.form.get("mode").valueChanges.subscribe(()=>{["minBlobSize","maxBlobSize","ratio"].forEach(_=>{this.form.get(_).updateValueAndValidity({emitEvent:!1})})}),this.form.get("minBlobSize").valueChanges.subscribe(()=>{this.form.get("maxBlobSize").updateValueAndValidity({emitEvent:!1})}),this.form.get("maxBlobSize").valueChanges.subscribe(()=>{this.form.get("minBlobSize").updateValueAndValidity({emitEvent:!1})})}poolTypeChange(_){if("replicated"===_?this.setTypeBooleans(!0,!1):this.setTypeBooleans(!1,"erasure"===_),!_||!this.info)return void(this.current.rules=[]);const t=this.info["crush_rules_"+_]||[];this.current.rules=t,!this.editing&&(this.isReplicated&&this.setListControlStatus("crushRule",t),this.replicatedRuleChange(),this.pgCalc())}setTypeBooleans(_,t){this.isReplicated=_,this.isErasure=t}replicatedRuleChange(){if(!this.isReplicated)return;const _=this.form.get("size");let t=this.form.getValue("size")||3;const n=this.getMinSize(),s=this.getMaxSize();t<n?t=n:t>s&&(t=s),t!==_.value&&this.form.silentSet("size",t)}getMinSize(){return!this.info||this.info.osd_count<1?0:1}getMaxSize(){const _=this.form.getValue("crushRule");return this.info?_?_.usable_size:Math.min(this.info.osd_count,3):0}pgCalc(){const _=this.form.getValue("poolType");if(!this.info||this.form.get("pgNum").dirty||!_)return;const t=100*this.info.osd_count,n=this.isReplicated?this.replicatedPgCalc(t):this.erasurePgCalc(t);if(!n)return;const s=this.data.pgs;this.alignPgs(n),this.externalPgChange||(this.externalPgChange=s!==this.data.pgs)}setCorrectMaxSize(_=this.form.getValue("crushRule")){if(!_)return;const n=T.searchFailureDomains(this.info.nodes,_.steps[0].item_name)[_.steps[1].type];_.usable_size=Math.min(n?n.length:this.crushRuleMaxSize,this.crushRuleMaxSize)}replicatedPgCalc(_){const t=this.form.get("size"),n=t.value;return t.valid&&n>0?_/n:0}erasurePgCalc(_){const t=this.form.get("erasureProfile"),n=t.value;return(t.valid||t.disabled)&&n?_/(n.k+n.m):0}alignPgs(_=this.form.getValue("pgNum")){this.setPgs(Math.round(this.calculatePgPower(_<1?1:_)))}setComplexValidators(){this.editing?this.form.get("name").setValidators([this.form.get("name").validator,u.hq.custom("uniqueName",_=>this.data.pool&&this.info&&-1!==this.info.pool_names.indexOf(_)&&this.info.pool_names.indexOf(_)!==this.info.pool_names.indexOf(this.data.pool.pool_name))]):(u.hq.validateIf(this.form.get("size"),()=>this.isReplicated,[u.hq.custom("min",_=>this.form.getValue("size")&&_<this.getMinSize()),u.hq.custom("max",_=>this.form.getValue("size")&&this.getMaxSize()<_)]),this.form.get("name").setValidators([this.form.get("name").validator,u.hq.custom("uniqueName",_=>this.info&&-1!==this.info.pool_names.indexOf(_))])),this.setCompressionValidators()}setCompressionValidators(){u.hq.validateIf(this.form.get("minBlobSize"),()=>this.hasCompressionEnabled(),[l.kI.min(0),u.hq.custom("maximum",_=>this.oddBlobSize(_,this.form.getValue("maxBlobSize")))]),u.hq.validateIf(this.form.get("maxBlobSize"),()=>this.hasCompressionEnabled(),[l.kI.min(0),u.hq.custom("minimum",_=>this.oddBlobSize(this.form.getValue("minBlobSize"),_))]),u.hq.validateIf(this.form.get("ratio"),()=>this.hasCompressionEnabled(),[l.kI.min(0),l.kI.max(1)])}oddBlobSize(_,t){const n=this.formatter.toBytes(_),s=this.formatter.toBytes(t);return Boolean(n&&s&&n>=s)}hasCompressionEnabled(){return this.form.getValue("mode")&&"none"!==this.form.get("mode").value.toLowerCase()}describeCrushStep(_){return[_.op.replace("_"," "),_.item_name||"",_.type?_.num+" type "+_.type:""].join(" ")}addErasureCodeProfile(){this.addModal($o,_=>this.reloadECPs(_))}addModal(_,t){this.hideOpenTooltips(),this.modalService.show(_).componentInstance.submitAction.subscribe(s=>{t(s.name)})}hideOpenTooltips(){const _=t=>t&&t.isOpen()&&t.close();_(this.ecpDeletionBtn),_(this.crushDeletionBtn)}reloadECPs(_){this.reloadList({newItemName:_,getInfo:()=>this.ecpService.list(),initInfo:t=>this.initEcp(t),findNewItem:()=>this.ecProfiles.find(t=>t.name===_),controlName:"erasureProfile"})}reloadList({newItemName:_,getInfo:t,initInfo:n,findNewItem:s,controlName:c}){this.modalSubscription&&this.modalSubscription.unsubscribe(),t().subscribe(d=>{if(n(d),!_)return;const f=s();f&&this.form.get(c).setValue(f)})}deleteErasureCodeProfile(){this.deletionModal({value:this.form.getValue("erasureProfile"),usage:this.ecpUsage,deletionBtn:this.ecpDeletionBtn,dataName:"erasureInfo",getTabs:()=>this.ecpInfoTabs,tabPosition:"used-by-pools",nameAttribute:"name",itemDescription:"erasure code profile",reloadFn:()=>this.reloadECPs(),deleteFn:_=>this.ecpService.delete(_),taskName:"ecp/delete"})}deletionModal({value:_,usage:t,deletionBtn:n,dataName:s,getTabs:c,tabPosition:d,nameAttribute:f,itemDescription:p,reloadFn:m,deleteFn:h,taskName:S}){if(!_)return;if(t)return n.animation=!1,n.toggle(),this.data[s]=!0,void setTimeout(()=>{const P=c();P&&P.select(d)},50);const R=_[f];this.modalService.show(De.M,{itemDescription:p,itemNames:[R],submitActionObservable:()=>{const P=h(R);return P.subscribe(()=>m()),this.taskWrapper.wrapTaskAroundCall({task:new D.R(S,{name:R}),call:P})}})}addCrushRule(){this.addModal(y_,_=>this.reloadCrushRules(_))}reloadCrushRules(_){this.reloadList({newItemName:_,getInfo:()=>this.poolService.getInfo(),initInfo:t=>{this.initInfo(t),this.poolTypeChange("replicated")},findNewItem:()=>this.info.crush_rules_replicated.find(t=>t.rule_name===_),controlName:"crushRule"})}deleteCrushRule(){this.deletionModal({value:this.form.getValue("crushRule"),usage:this.crushUsage,deletionBtn:this.crushDeletionBtn,dataName:"crushInfo",getTabs:()=>this.crushInfoTabs,tabPosition:"used-by-pools",nameAttribute:"rule_name",itemDescription:"crush rule",reloadFn:()=>this.reloadCrushRules(),deleteFn:_=>this.crushRuleService.delete(_),taskName:"crushRule/delete"})}crushRuleIsUsedBy(_){this.crushUsage=_?this.info.used_rules[_]:void 0}ecpIsUsedBy(_){this.ecpUsage=_?this.info.used_profiles[_]:void 0}submit(){if(this.form.invalid)return void this.form.setErrors({cdSubmitButton:!0});const _={pool:this.form.getValue("name")};this.assignFormFields(_,[{externalFieldName:"pool_type",formControlName:"poolType"},{externalFieldName:"pg_autoscale_mode",formControlName:"pgAutoscaleMode",editable:!0},{externalFieldName:"pg_num",formControlName:"pgNum",replaceFn:n=>"on"===this.form.getValue("pgAutoscaleMode")?1:n,editable:!0},this.isReplicated?{externalFieldName:"size",formControlName:"size"}:{externalFieldName:"erasure_code_profile",formControlName:"erasureProfile",attr:"name"},{externalFieldName:"rule_name",formControlName:"crushRule",replaceFn:n=>this.isReplicated?n&&n.rule_name:void 0},{externalFieldName:"quota_max_bytes",formControlName:"max_bytes",replaceFn:this.formatter.toBytes,editable:!0,resetValue:this.editing?0:void 0},{externalFieldName:"quota_max_objects",formControlName:"max_objects",editable:!0,resetValue:this.editing?0:void 0}]),this.info.is_all_bluestore&&(this.assignFormField(_,{externalFieldName:"flags",formControlName:"ecOverwrites",replaceFn:()=>this.isErasure?["ec_overwrites"]:void 0}),"none"!==this.form.getValue("mode")?this.assignFormFields(_,[{externalFieldName:"compression_mode",formControlName:"mode",editable:!0,replaceFn:n=>this.hasCompressionEnabled()&&n},{externalFieldName:"compression_algorithm",formControlName:"algorithm",editable:!0},{externalFieldName:"compression_min_blob_size",formControlName:"minBlobSize",replaceFn:this.formatter.toBytes,editable:!0,resetValue:0},{externalFieldName:"compression_max_blob_size",formControlName:"maxBlobSize",replaceFn:this.formatter.toBytes,editable:!0,resetValue:0},{externalFieldName:"compression_required_ratio",formControlName:"ratio",editable:!0,resetValue:0}]):this.editing&&this.assignFormFields(_,[{externalFieldName:"compression_mode",formControlName:"mode",editable:!0,replaceFn:()=>"unset"},{externalFieldName:"srcpool",formControlName:"name",editable:!0,replaceFn:()=>this.data.pool.pool_name}]));const t=this.data.applications.selected;(t.length>0||this.editing)&&(_.application_metadata=t),this.isReplicated&&!g().isEmpty(this.currentConfigurationValues)&&(_.configuration=this.currentConfigurationValues),this.triggerApiTask(_)}assignFormFields(_,t){t.forEach(n=>this.assignFormField(_,n))}assignFormField(_,{externalFieldName:t,formControlName:n,attr:s,replaceFn:c,editable:d,resetValue:f}){if(this.editing&&(!d||this.form.get(n).pristine))return;const p=this.form.getValue(n);let m=c?c(p):s?g().get(p,s):p;if(!p||!m){if(!d||g().isUndefined(f))return;m=f}_[t]=m}triggerApiTask(_){this.taskWrapper.wrapTaskAroundCall({task:new D.R("pool/"+(this.editing?M.MQ.EDIT:M.MQ.CREATE),{pool_name:_.hasOwnProperty("srcpool")?_.srcpool:_.pool}),call:this.poolService[this.editing?M.MQ.UPDATE:M.MQ.CREATE](_)}).subscribe({error:t=>{g().isObject(t.error)&&"34"===t.error.code&&this.form.get("pgNum").setErrors({34:!0}),this.form.setErrors({cdSubmitButton:!0})},complete:()=>this.router.navigate(["/pool"])})}appSelection(){this.form.get("name").updateValueAndValidity({emitEvent:!1,onlySelf:!0})}erasureProfileChange(){const _=this.form.get("erasureProfile").value;_&&(this.msrCrush=_["crush-num-failure-domains"]>0||_["crush-osds-per-failure-domain"]>0)}}return o.\u0275fac=function(_){return new(_||o)(e.Y36(T_.$),e.Y36(fe.gz),e.Y36(fe.F0),e.Y36(Ue.Z),e.Y36(ge.q),e.Y36(Ge.j),e.Y36(L_.H),e.Y36(Ee.P),e.Y36(Le),e.Y36(xe.H),e.Y36(M.p4))},o.\u0275cmp=e.Xpm({type:o,selectors:[["cd-pool-form"]],viewQuery:function(_,t){if(1&_&&(e.Gf(qo,5),e.Gf(zo,5),e.Gf(Xo,5),e.Gf(wo,5)),2&_){let n;e.iGM(n=e.CRH())&&(t.crushInfoTabs=n.first),e.iGM(n=e.CRH())&&(t.crushDeletionBtn=n.first),e.iGM(n=e.CRH())&&(t.ecpInfoTabs=n.first),e.iGM(n=e.CRH())&&(t.ecpDeletionBtn=n.first)}},features:[e.qOj],decls:1,vars:1,consts:function(){let i,_,t,n,s,c,d,f,p,m,h,S,R,P,A,$,I,x,Z,y,U,G,H,q,z,X,w,Q,J,k,V,Y,B,j,K,W,N,ee,_e,oe,te,ie,ne,se,ae,le,re,ce,Oe,de,b,ue,Pe,O,ke,Ve,Ye,Be,je,Ke,We,e_,__,o_,t_,i_,n_,s_,a_,l_,r_,c_,O_,d_,u_,P_,f_;return i="\n          " + "\ufffd0\ufffd" + "\n          " + "\ufffd1\ufffd" + "\n        ",_="Name",t="Nom...",n="Type de r\xE9serve",s="-- S\xE9lectionner un type de r\xE9serve --",c="Applications",d="Pools should be associated with an application tag",f="Quotas",p="Max bytes",m="Leave it blank or specify 0 to disable this quota.",h="A valid quota should be greater than 0.",S="par exemple, 10 Gio",R="Max objects",P="Leave it blank or specify 0 to disable this quota.",A="A valid quota should be greater than 0.",$="Ce champ est obligatoire !",I="Le nom de r\xE9serve Ceph s\xE9lectionn\xE9 est d\xE9j\xE0 utilis\xE9.",x="It's not possible to create an RBD pool with '/' in the name. Please change the name or remove 'rbd' from the applications list.",Z="Pool name can only contain letters, numbers, '.', '-', '_' or '/'.",y="Ce champ est obligatoire !",U="PG Autoscale",G="Groupes de placements",H="Aide au calcul",q="Ce champ est obligatoire !",z="Au moins un groupe de placements est n\xE9cessaire.",X="Votre grappe ne peut pas g\xE9rer autant de groupes de placements. Veuillez recalculer le nombre de groupes de placements n\xE9cessaires.",w="The current PGs settings were calculated for you, you should make sure the values suit your needs before submit.",Q="Taille de r\xE9plication",J="Minimum: \n          " + "\ufffd0\ufffd" + "\n        ",k="Maximum: \n          " + "\ufffd0\ufffd" + "\n        ",V="The size specified is out of range. A value from \n          " + "\ufffd0\ufffd" + " to \n          " + "\ufffd1\ufffd" + " is usable.\n        ",Y="A size of 1 will not create a replication of the object. The 'Replicated size' includes the object itself.",B="Flags",j="\xC9crasements EC",K="CRUSH",W="Profil de code d'effacement",N="This profile can't be deleted as it is in use.",ee="Chargement...",_e="-- Aucun profil de code d'effacement n'est disponible --",oe="-- S\xE9lectionner un profil de code d'effacement --",te="Profile",ie="Used by pools",ne="Profile is not in use.",se="Jeu de r\xE8gles Crush",ae="A new crush ruleset will be implicitly created.",le="A new crush MSR ruleset will be implicitly created. When crush-osds-per-failure-domain or crush-num-failure-domains is specified",re="Jeu de r\xE8gles Crush",ce="There are no rules.",Oe="-- S\xE9lectionner une r\xE8gle crush --",de="Placement and\n                          replication strategies or distribution policies that allow to\n                          specify how CRUSH places data replicas.",b="This rule can't be deleted as it is in use.",ue="R\xE8gle Crush",Pe="\xC9tapes Crush",O="Used by pools",ke="Rule is not in use.",Ve="Ce champ est obligatoire !",Ye="The rule can't be used in the current cluster as it has too few OSDs to meet the minimum required OSD by this rule.",Be="Compression",je="Mode",Ke="Algorithme",We="Taille de blob minimale",e_="par ex. 128 Kio",__="Taille de blob maximale",o_="par ex., 512 Kio",t_="Rapport",i_="Rapport de compression",n_="Chargement...",s_="-- Aucun algorithme de compression d'effacement n'est disponible --",a_="La valeur doit \xEAtre sup\xE9rieure \xE0 0",l_="Value should be less than the maximum blob size",r_="Size must be a number or in a valid format. eg: 5 GiB",c_="La valeur doit \xEAtre sup\xE9rieure \xE0 0",O_="La valeur doit \xEAtre sup\xE9rieure \xE0 la taille de blob minimale.",d_="Size must be a number or in a valid format. eg: 5 GiB",u_="La valeur doit se situer entre 0.0 et 1.0",P_="Size must be a number or in a valid format. eg: 5 GiB",f_="The value should be greater or equal to 0",[["class","cd-col-form",4,"cdFormLoading"],[1,"cd-col-form"],["name","form","novalidate","",3,"formGroup"],["formDir","ngForm"],[1,"card"],[1,"card-header"],i,[1,"card-body"],[1,"form-group","row"],["for","name",1,"cd-col-form-label","required"],_,[1,"cd-col-form-input"],["id","name","name","name","type","text","placeholder",t,"formControlName","name","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","poolType",1,"cd-col-form-label","required"],n,["id","poolType","formControlName","poolType","name","poolType",1,"form-select"],["ngValue",""],s,[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["for","applications",1,"cd-col-form-label"],c,["id","applications",3,"customBadges","customBadgeValidators","messages","data","options","selectionLimit","selection"],["title",d,3,"class",4,"ngIf"],["formGroupName","compression",4,"ngIf"],f,["for","max_bytes",1,"cd-col-form-label"],p,m,h,["id","max_bytes","name","max_bytes","type","text","formControlName","max_bytes","placeholder",S,"defaultUnit","GiB","cdDimlessBinary","",1,"form-control"],["for","max_objects",1,"cd-col-form-label"],R,P,A,["id","max_objects","min","0","name","max_objects","type","number","formControlName","max_objects",1,"form-control"],[3,"hidden"],[3,"form","initializeData","changes"],[1,"card-footer"],["wrappingClass","text-right",3,"form","submitText","submitActionEvent"],[1,"invalid-feedback"],$,I,x,Z,[3,"value"],y,["for","pgAutoscaleMode",1,"cd-col-form-label"],U,["id","pgAutoscaleMode","name","pgAutoscaleMode","formControlName","pgAutoscaleMode",1,"form-select"],["class","form-group row",4,"ngIf"],["for","pgNum",1,"cd-col-form-label","required"],G,["id","pgNum","name","pgNum","formControlName","pgNum","min","1","type","number","required","",1,"form-control",3,"focus","blur"],[1,"form-text","text-muted"],["section","pgs","docText",H],["class","form-text text-muted",4,"ngIf"],q,z,X,w,["for","size",1,"cd-col-form-label","required"],Q,["id","size","name","size","type","number","formControlName","size",1,"form-control",3,"max","min"],["class","text-warning-dark",4,"ngIf"],[1,"list-inline"],J,k,V,[1,"text-warning-dark"],Y,[1,"cd-col-form-label"],B,[1,"custom-control","custom-checkbox"],["type","checkbox","id","ec-overwrites","formControlName","ecOverwrites",1,"custom-control-input"],["for","ec-overwrites",1,"custom-control-label"],j,["title",d],K,["for","erasureProfile",1,"cd-col-form-label"],W,[1,"input-group","mb-1"],["id","erasureProfile","name","erasureProfile","formControlName","erasureProfile",1,"form-select",3,"change"],["ngValue","",4,"ngIf"],[3,"ngValue",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],["id","ecp-info-button","type","button",1,"btn","btn-light",3,"ngClass","click"],["aria-hidden","true",3,"ngClass"],["class","btn btn-light","type","button",3,"click",4,"ngIf"],["class","btn btn-light","type","button","ngbTooltip",N,"triggers","manual",3,"click",4,"ngIf"],["class","form-text text-muted","id","ecp-info-block",4,"ngIf"],ee,[3,"ngValue"],_e,oe,["type","button",1,"btn","btn-light",3,"click"],["type","button","ngbTooltip",N,"triggers","manual",1,"btn","btn-light",3,"click"],["ecpDeletionBtn","ngbTooltip"],["id","ecp-info-block",1,"form-text","text-muted"],["ngbNav","",1,"nav-tabs"],["ecpInfoTabs","ngbNav"],["ngbNavItem","ecp-info"],["ngbNavLink",""],te,["ngbNavContent",""],["ngbNavItem","used-by-pools"],ie,[3,"ngbNavOutlet"],[3,"renderObjects","hideKeys","data","autoReload"],["ecpIsNotUsed",""],[4,"ngIf","ngIfElse"],ne,[4,"ngFor","ngForOf"],["for","crushRule",1,"cd-col-form-label"],se,["class","form-text text-muted",4,"ngIf","ngIfElse"],["msrCrushText",""],ae,le,re,["noRules",""],ce,[1,"input-group"],["id","crushRule","formControlName","crushRule","name","crushSet",1,"form-select"],Oe,["id","crush-info-button","type","button","ngbTooltip",de,1,"btn","btn-light",3,"ngClass","click"],["class","btn btn-light","type","button","ngbTooltip",b,"triggers","manual",3,"click",4,"ngIf"],["class","form-text text-muted","id","crush-info-block",4,"ngIf"],["type","button","ngbTooltip",b,"triggers","manual",1,"btn","btn-light",3,"click"],["crushDeletionBtn","ngbTooltip"],["id","crush-info-block",1,"form-text","text-muted"],["crushInfoTabs","ngbNav"],["ngbNavItem","crush-rule-info"],ue,["ngbNavItem","crush-rule-steps"],Pe,O,["ruleIsNotUsed",""],ke,Ve,Ye,["formGroupName","compression"],Be,["for","mode",1,"cd-col-form-label"],je,["id","mode","name","mode","formControlName","mode",1,"form-select"],["for","algorithm",1,"cd-col-form-label"],Ke,["id","algorithm","name","algorithm","formControlName","algorithm",1,"form-select"],["for","minBlobSize",1,"cd-col-form-label"],We,["id","minBlobSize","name","minBlobSize","formControlName","minBlobSize","type","text","min","0","placeholder",e_,"defaultUnit","KiB","cdDimlessBinary","",1,"form-control"],["for","maxBlobSize",1,"cd-col-form-label"],__,["id","maxBlobSize","type","text","min","0","formControlName","maxBlobSize","placeholder",o_,"defaultUnit","KiB","cdDimlessBinary","",1,"form-control"],["for","ratio",1,"cd-col-form-label"],t_,["id","ratio","name","ratio","formControlName","ratio","type","number","min","0","max","1","step","0.1","placeholder",i_,1,"form-control"],n_,s_,a_,l_,r_,c_,O_,d_,u_,P_,f_]},template:function(_,t){1&_&&e.YNc(0,si,71,34,"div",0),2&_&&e.Q6J("cdFormLoading",t.loading)},dependencies:[C.mk,C.sg,C.O5,E.uN,E.Pz,E.nv,E.Vx,E.tO,E.Dy,pe.S,Zo.m,yo.K,me.p,He.b,Re.U,Uo.Q,Go.y,Ce.o,Me.b,he.P,Se.V,l._Y,l.YN,l.Kr,l.Fj,l.wV,l.Wl,l.EJ,l.JJ,l.JL,l.Q7,l.qQ,l.Fd,l.sg,l.u,l.x0,E._L,Ho.d,C.rS,Te.m],styles:[".icon-warning-color[_ngcontent-%COMP%]{margin-left:3px}"]}),o})();var ai=r(19773),li=r(20687),ri=r(68136),Ae=r(69158),Fe=r(83697),L=r(99466),ci=r(91801),Oi=r(68774),di=r(66369),Xe=r(38047),Ne=r(51847);class ui{constructor(i){this.pool_name=i}}var Pi=r(64724),fi=r(60251),we=r(76317),Ei=r(94928),gi=r(23240),Qe=r(51295),pi=r(59376),mi=r(42176);function Ri(o,i){if(1&o&&e._UZ(0,"cd-table-key-value",12),2&o){const _=e.oxw(2);e.Q6J("renderObjects",!0)("data",_.poolDetails)("autoReload",!1)}}function Ci(o,i){if(1&o&&e._UZ(0,"cd-grafana",15),2&o){const _=e.oxw(3);e.MGl("grafanaPath","ceph-pool-detail?var-pool_name=",_.selection.pool_name,""),e.Q6J("type","metrics")}}function Mi(o,i){1&o&&(e.ynx(0,13),e.TgZ(1,"a",5),e.SDv(2,14),e.qZA(),e.YNc(3,Ci,1,2,"ng-template",7),e.BQk())}function hi(o,i){if(1&o&&e._UZ(0,"cd-rbd-configuration-table",18),2&o){const _=e.oxw(3);e.Q6J("data",_.selectedPoolConfiguration)}}function Si(o,i){1&o&&(e.ynx(0,16),e.TgZ(1,"a",5),e.SDv(2,17),e.qZA(),e.YNc(3,hi,1,1,"ng-template",7),e.BQk())}function Ti(o,i){if(1&o&&e._UZ(0,"cd-table",21),2&o){const _=e.oxw(3);e.Q6J("data",_.cacheTiers)("columns",_.cacheTierColumns)("autoSave",!1)}}function Li(o,i){1&o&&(e.ynx(0,19),e.TgZ(1,"a",5),e.SDv(2,20),e.qZA(),e.YNc(3,Ti,1,3,"ng-template",7),e.BQk())}function Ai(o,i){if(1&o&&(e.ynx(0,1),e.TgZ(1,"nav",2,3),e.ynx(3,4),e.TgZ(4,"a",5),e.SDv(5,6),e.qZA(),e.YNc(6,Ri,1,3,"ng-template",7),e.BQk(),e.YNc(7,Mi,4,0,"ng-container",8),e.YNc(8,Si,4,0,"ng-container",9),e.YNc(9,Li,4,0,"ng-container",10),e.qZA(),e._UZ(10,"div",11),e.BQk()),2&o){const _=e.MAs(2),t=e.oxw();e.xp6(7),e.Q6J("ngIf",t.permissions.grafana.read),e.xp6(1),e.Q6J("ngIf","replicated"===t.selection.type),e.xp6(1),e.Q6J("ngIf",(null==t.selection.tiers?null:t.selection.tiers.length)>0),e.xp6(1),e.Q6J("ngbNavOutlet",_)}}let Fi=(()=>{class o{constructor(_){this.poolService=_,this.cacheTierColumns=[],this.omittedPoolAttributes=["cdExecuting","cdIsBinary","stats"],this.cacheTierColumns=[{prop:"pool_name",name:"Name",flexGrow:3},{prop:"cache_mode",name:"Cache Mode",flexGrow:2},{prop:"cache_min_evict_age",name:"Min Evict Age",flexGrow:2},{prop:"cache_min_flush_age",name:"Min Flush Age",flexGrow:2},{prop:"target_max_bytes",name:"Target Max Bytes",flexGrow:2},{prop:"target_max_objects",name:"Target Max Objects",flexGrow:2}]}ngOnChanges(){this.selection&&(this.poolService.getConfiguration(this.selection.pool_name).subscribe(_=>{Qe.T.updateChanged(this,{selectedPoolConfiguration:_})}),Qe.T.updateChanged(this,{poolDetails:g().omit(this.selection,this.omittedPoolAttributes)}))}}return o.\u0275fac=function(_){return new(_||o)(e.Y36(ge.q))},o.\u0275cmp=e.Xpm({type:o,selectors:[["cd-pool-details"]],inputs:{cacheTiers:"cacheTiers",permissions:"permissions",selection:"selection"},features:[e.TTD],decls:1,vars:1,consts:function(){let i,_,t,n,s;return i="D\xE9tails",_="D\xE9tails des performances",t="Pool details",n="Configuration",s="D\xE9tails des niveaux de mise en cache",[["cdTableDetail","",4,"ngIf"],["cdTableDetail",""],["ngbNav","","cdStatefulTab","pool-details",1,"nav-tabs"],["nav","ngbNav"],["ngbNavItem","details"],["ngbNavLink",""],i,["ngbNavContent",""],["ngbNavItem","performance-details",4,"ngIf"],["ngbNavItem","configuration",4,"ngIf"],["ngbNavItem","cache-tiers-details",4,"ngIf"],[3,"ngbNavOutlet"],[3,"renderObjects","data","autoReload"],["ngbNavItem","performance-details"],_,["title",t,"uid","-xyV8KCiz","grafanaStyle","three",3,"grafanaPath","type"],["ngbNavItem","configuration"],n,[3,"data"],["ngbNavItem","cache-tiers-details"],s,["columnMode","flex",3,"data","columns","autoSave"]]},template:function(_,t){1&_&&e.YNc(0,Ai,11,4,"ng-container",0),2&_&&e.Q6J("ngIf",t.selection)},dependencies:[C.O5,E.uN,E.Pz,E.nv,E.Vx,E.tO,E.Dy,we.F,Fe.a,He.b,pi.m,mi.P],changeDetection:0}),o})();const Ni=["poolUsageTpl"],bi=["poolConfigurationSourceTpl"];function vi(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"cd-table",9,10),e.NdJ("fetchData",function(){e.CHM(_);const n=e.oxw();return e.KtG(n.taskListService.fetch())})("setExpandedRow",function(n){e.CHM(_);const s=e.oxw();return e.KtG(s.setExpandedRow(n))})("updateSelection",function(n){e.CHM(_);const s=e.oxw();return e.KtG(s.updateSelection(n))}),e._UZ(2,"cd-table-actions",11)(3,"cd-pool-details",12),e.qZA()}if(2&o){const _=e.oxw();e.Q6J("data",_.pools)("columns",_.columns)("hasDetails",!0)("status",_.tableStatus)("autoReload",-1),e.xp6(2),e.Q6J("permission",_.permissions.pool)("selection",_.selection)("tableActions",_.tableActions),e.xp6(1),e.Q6J("selection",_.expandedRow)("permissions",_.permissions)("cacheTiers",_.cacheTiers)}}function Di(o,i){1&o&&e._UZ(0,"cd-grafana",14),2&o&&e.Q6J("grafanaPath","ceph-pools-overview?")("type","metrics")}function $i(o,i){1&o&&(e.ynx(0,2),e.TgZ(1,"a",3),e.SDv(2,13),e.qZA(),e.YNc(3,Di,1,2,"ng-template",5),e.BQk())}function Ii(o,i){if(1&o&&e._UZ(0,"cd-usage-bar",16),2&o){const _=e.oxw().row;e.Q6J("total",_.stats.bytes_used.latest+_.stats.avail_raw.latest)("used",_.stats.bytes_used.latest)("title",_.pool_name)}}function xi(o,i){if(1&o&&e.YNc(0,Ii,1,3,"cd-usage-bar",15),2&o){const _=i.row;e.Q6J("ngIf",null==_.stats||null==_.stats.avail_raw?null:_.stats.avail_raw.latest)}}const be="pool";let Zi=(()=>{class o extends ri.o{constructor(_,t,n,s,c,d,f,p,m,h,S){super(),this.poolService=_,this.taskWrapper=t,this.ecpService=n,this.authStorageService=s,this.taskListService=c,this.modalService=d,this.pgCategoryService=f,this.dimlessPipe=p,this.urlBuilder=m,this.configurationService=h,this.actionLabels=S,this.selection=new Oi.r,this.executingTasks=[],this.tableStatus=new Ae.E,this.cacheTiers=[],this.monAllowPoolDelete=!1,this.permissions=this.authStorageService.getPermissions(),this.tableActions=[{permission:"create",icon:v.P.add,routerLink:()=>this.urlBuilder.getCreate(),name:this.actionLabels.CREATE},{permission:"update",icon:v.P.edit,routerLink:()=>this.urlBuilder.getEdit(encodeURIComponent(this.selection.first().pool_name)),name:this.actionLabels.EDIT},{permission:"delete",icon:v.P.destroy,click:()=>this.deletePoolModal(),name:this.actionLabels.DELETE,disable:this.getDisableDesc.bind(this)}],this.permissions.configOpt.read&&this.configurationService.get("mon_allow_pool_delete").subscribe(R=>{if(g().has(R,"value")){const P=g().find(R.value,A=>"mon"===A.section)||{value:!1};this.monAllowPoolDelete="true"===P.value}})}ngOnInit(){const _=(t,n,s)=>g().get(n,t)>g().get(s,t)?1:-1;this.columns=[{prop:"pool_name",name:"Name",flexGrow:4,cellTransformation:L.e.executing},{prop:"data_protection",name:"Data Protection",cellTransformation:L.e.badge,customTemplateConfig:{class:"badge-background-gray"},flexGrow:1.3},{prop:"application_metadata",name:"Applications",cellTransformation:L.e.badge,customTemplateConfig:{class:"badge-background-primary"},flexGrow:1.5},{prop:"pg_status",name:"PG Status",flexGrow:1.2,cellClass:({row:t,column:n,value:s})=>this.getPgStatusCellClass(t,n,s)},{prop:"crush_rule",name:"Crush Ruleset",isHidden:!0,flexGrow:2},{name:"Usage",prop:"usage",cellTemplate:this.poolUsageTpl,flexGrow:1.2},{prop:"stats.rd_bytes.rates",name:"Read bytes",comparator:(t,n,s,c)=>_("stats.rd_bytes.latest",s,c),cellTransformation:L.e.sparkline,flexGrow:1.5},{prop:"stats.wr_bytes.rates",name:"Write bytes",comparator:(t,n,s,c)=>_("stats.wr_bytes.latest",s,c),cellTransformation:L.e.sparkline,flexGrow:1.5},{prop:"stats.rd.rate",name:"Read ops",flexGrow:1,pipe:this.dimlessPipe,cellTransformation:L.e.perSecond},{prop:"stats.wr.rate",name:"Write ops",flexGrow:1,pipe:this.dimlessPipe,cellTransformation:L.e.perSecond}],this.taskListService.init(()=>this.ecpService.list().pipe((0,ai.zg)(t=>(this.ecProfileList=t,this.poolService.getList()))),void 0,t=>{this.pools=this.transformPoolsData(t),this.tableStatus=new Ae.E},()=>{this.table.reset(),this.tableStatus=new Ae.E(ci.T.ValueException)},t=>t.name.startsWith(`${be}/`),(t,n)=>n.metadata.pool_name===t.pool_name,{default:t=>new ui(t.pool_name)})}updateSelection(_){this.selection=_}deletePoolModal(){const _=this.selection.first().pool_name;this.modalService.show(De.M,{itemDescription:"Pool",itemNames:[_],submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new D.R(`${be}/${M.MQ.DELETE}`,{pool_name:_}),call:this.poolService.delete(_)})})}getPgStatusCellClass(_,t,n){return{"text-right":!0,[`pg-${this.pgCategoryService.getTypeByStates(n)}`]:!0}}getErasureCodeProfile(_){let t="";return g().forEach(this.ecProfileList,n=>{n.name===_&&(t=`EC: ${n.k}+${n.m}`)}),t}transformPoolsData(_){const t=["bytes_used","max_avail","avail_raw","percent_used","rd_bytes","wr_bytes","rd","wr"],n={latest:0,rate:0,rates:[]};return g().forEach(_,s=>{s.pg_status=this.transformPgStatus(s.pg_status);const c={};g().forEach(t,d=>{c[d]=s.stats&&s.stats[d]?s.stats[d]:n}),s.stats=c,s.usage=c.percent_used.latest,!s.cdExecuting&&s.pg_num+s.pg_placement_num!==s.pg_num_target+s.pg_placement_num_target&&(s.cdExecuting="Updating"),["rd_bytes","wr_bytes"].forEach(d=>{s.stats[d].rates=s.stats[d].rates.map(f=>f[1])}),s.cdIsBinary=!0,"erasure"===s.type&&(s.data_protection=this.getErasureCodeProfile(s.erasure_code_profile)),"replicated"===s.type&&(s.data_protection=`replica: \xd7${s.size}`)}),_}transformPgStatus(_){const t=[];return g().forEach(_,(n,s)=>{t.push(`${n} ${s}`)}),t.join(", ")}getSelectionTiers(){if(typeof this.expandedRow<"u"){const _=this.expandedRow.tiers;this.cacheTiers=this.pools.filter(t=>_.includes(t.pool))}}getDisableDesc(){return!this.selection?.hasSelection||!this.monAllowPoolDelete&&"Pool deletion is disabled by the mon_allow_pool_delete configuration setting."}setExpandedRow(_){super.setExpandedRow(_),this.getSelectionTiers()}}return o.\u0275fac=function(_){return new(_||o)(e.Y36(ge.q),e.Y36(Ee.P),e.Y36(Le),e.Y36(Ge.j),e.Y36(Xe.j),e.Y36(Ue.Z),e.Y36(li.j),e.Y36(di.n),e.Y36(Ne.F),e.Y36(Pi.e),e.Y36(M.p4))},o.\u0275cmp=e.Xpm({type:o,selectors:[["cd-pool-list"]],viewQuery:function(_,t){if(1&_&&(e.Gf(Fe.a,5),e.Gf(Ni,7),e.Gf(bi,5)),2&_){let n;e.iGM(n=e.CRH())&&(t.table=n.first),e.iGM(n=e.CRH())&&(t.poolUsageTpl=n.first),e.iGM(n=e.CRH())&&(t.poolConfigurationSourceTpl=n.first)}},features:[e._Bn([Xe.j,{provide:Ne.F,useValue:new Ne.F(be)}]),e.qOj],decls:10,vars:2,consts:function(){let i,_,t;return i="Liste des r\xE9serves",_="Performance globale",t="Ceph pools overview",[["ngbNav","",1,"nav-tabs"],["nav","ngbNav"],["ngbNavItem",""],["ngbNavLink",""],i,["ngbNavContent",""],["ngbNavItem","",4,"cdScope"],[3,"ngbNavOutlet"],["poolUsageTpl",""],["id","pool-list","selectionType","single",3,"data","columns","hasDetails","status","autoReload","fetchData","setExpandedRow","updateSelection"],["table",""],["id","pool-list-actions",1,"table-actions",3,"permission","selection","tableActions"],["cdTableDetail","","id","pool-list-details",3,"selection","permissions","cacheTiers"],_,["title",t,"uid","z99hzWtmk","grafanaStyle","two",3,"grafanaPath","type"],["decimals","2",3,"total","used","title",4,"ngIf"],["decimals","2",3,"total","used","title"]]},template:function(_,t){if(1&_&&(e.TgZ(0,"nav",0,1),e.ynx(2,2),e.TgZ(3,"a",3),e.SDv(4,4),e.qZA(),e.YNc(5,vi,4,11,"ng-template",5),e.BQk(),e.YNc(6,$i,4,0,"ng-container",6),e.qZA(),e._UZ(7,"div",7),e.YNc(8,xi,1,1,"ng-template",null,8,e.W1O)),2&_){const n=e.MAs(1);e.xp6(6),e.Q6J("cdScope","grafana"),e.xp6(1),e.Q6J("ngbNavOutlet",n)}},dependencies:[C.O5,E.uN,E.Pz,E.nv,E.Vx,E.tO,E.Dy,fi.O,we.F,Fe.a,Ei.K,gi.w,Fi],styles:["cd-pool-list .pg-clean{color:#008a00}  cd-pool-list .pg-working{color:#25828e}  cd-pool-list .pg-warning{color:#d48200}  cd-pool-list .pg-unknown{color:#dc3545}"]}),o})(),Je=(()=>{class o{}return o.\u0275fac=function(_){return new(_||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[p_.t,C.ez,E.Oz,E_.m,fe.Bz,l.UX,E.HK,g_.BlockModule]}),o})();const yi=[{path:"",component:Zi},{path:M.MQ.CREATE,component:ze,data:{breadcrumbs:M.Qn.CREATE}},{path:`${M.MQ.EDIT}/:name`,component:ze,data:{breadcrumbs:M.Qn.EDIT}}];let Ui=(()=>{class o{}return o.\u0275fac=function(_){return new(_||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[Je,fe.Bz.forChild(yi)]}),o})()}}]);