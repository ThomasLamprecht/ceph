"use strict";(self.webpackChunkceph_dashboard=self.webpackChunkceph_dashboard||[]).push([[119],{22119:(wi,$e,r)=>{r.r($e),r.d($e,{PoolModule:()=>Ve,RoutedPoolModule:()=>Xi});var M=r(88692),l=r(20092),fe=r(54247),E=r(51389),h=r(79512),R_=r(44466),m_=r(55330),C_=r(370),M_=r(23815),f=r.n(M_),h_=r(7357),S_=r(26504),pe=r(80842);class L{constructor(){this.nodes=[],this.idTree={},this.allDevices=[],this.buckets=[],this.failureDomains={},this.failureDomainKeys=[],this.devices=[],this.deviceCount=0,this.autoDeviceUpdate=!0}static searchFailureDomains(i,_){return this.getFailureDomains(this.search(i,_))}static search(i,_){const[t,n]=_.split("~"),s=i.find(c=>["name","id","type"].some(d=>c[d]===t));return s?(i=this.getSubNodes(s,this.createIdTreeFromNodes(i)),n&&(i=this.filterNodesByDeviceType(i,n)),i):[]}static createIdTreeFromNodes(i){const _={};return i.forEach(t=>{_[t.id]=t}),_}static getSubNodes(i,_){let t=[i];return i.children&&i.children.forEach(n=>{t=t.concat(this.getSubNodes(_[n],_))}),t}static filterNodesByDeviceType(i,_){let n,t=i.filter(c=>c.device_class&&c.device_class!==_).map(c=>c.id),s=t;do{n=!1,i=i.filter(d=>!t.includes(d.id));const c=[];i.forEach(d=>{d.children&&d.children.every(P=>t.includes(P))&&(c.push(d.id),n=!0)}),n&&(t=c,s=s.concat(c))}while(n);return(i=f().cloneDeep(i)).map(c=>(c.children&&(c.children=c.children.filter(d=>!s.includes(d))),c))}static getFailureDomains(i){const _={};return i.forEach(t=>{const n=t.type;_[n]||(_[n]=[]),_[n].push(t)}),_}initCrushNodeSelection(i,_,t,n,s=!0){this.autoDeviceUpdate=s,this.nodes=i,this.idTree=L.createIdTreeFromNodes(i),i.forEach(c=>{this.idTree[c.id]=c}),this.buckets=f().sortBy(i.filter(c=>c.children),"name"),this.controls={root:_,failure:t,device:n},this.preSelectRoot(),this.controls.root.valueChanges.subscribe(()=>this.onRootChange()),this.controls.failure.valueChanges.subscribe(()=>this.onFailureDomainChange()),this.controls.device.valueChanges.subscribe(()=>this.onDeviceChange())}preSelectRoot(){const i=this.nodes.find(_=>"root"===_.type);this.silentSet(this.controls.root,i),this.onRootChange()}silentSet(i,_){i.setValue(_,{emitEvent:!1})}onRootChange(){const i=L.getSubNodes(this.controls.root.value,this.idTree),_=L.getFailureDomains(i);Object.keys(_).forEach(t=>{_[t].length<=1&&delete _[t]}),this.failureDomains=_,this.failureDomainKeys=Object.keys(_).sort(),this.updateFailureDomain()}updateFailureDomain(){let i=this.getIncludedCustomValue(this.controls.failure,Object.keys(this.failureDomains));""===i&&(i=this.setMostCommonDomain(this.controls.failure)),this.updateDevices(i)}getIncludedCustomValue(i,_){return i.dirty&&_.includes(i.value)?i.value:""}setMostCommonDomain(i){let _={n:0,type:""};return Object.keys(this.failureDomains).forEach(t=>{const n=this.failureDomains[t].length;_.n<n&&(_={n,type:t})}),this.silentSet(i,_.type),_.type}onFailureDomainChange(){this.updateDevices()}updateDevices(i=this.controls.failure.value){const _=f().flatten(this.failureDomains[i].map(n=>L.getSubNodes(n,this.idTree)));this.allDevices=_.filter(n=>n.device_class).map(n=>n.device_class),this.devices=f().uniq(this.allDevices).sort();const t=1===this.devices.length?this.devices[0]:this.getIncludedCustomValue(this.controls.device,this.devices);this.autoDeviceUpdate&&this.silentSet(this.controls.device,t),this.onDeviceChange(t)}onDeviceChange(i=this.controls.device.value){this.deviceCount=""===i?this.allDevices.length:this.allDevices.filter(_=>_===i).length}}var Ie=r(30982),T_=r(14745),v=r(65862),L_=r(93614),xe=r(95463),u=r(82723),A_=r(30633),D=r(76111),F_=r(47557),N_=r(28211),ge=r(32337),e=r(64537),Ze=r(62862),ye=r(83608),Re=r(18372),Ue=r(60312),me=r(30839),Ce=r(32966),Me=r(82945),he=r(87925),Se=r(94276),Te=r(56310),Le=r(41582),Ae=r(10545);function b_(o,i){1&o&&(e.TgZ(0,"span",31),e.SDv(1,32),e.qZA())}function v_(o,i){1&o&&(e.TgZ(0,"span",31),e.SDv(1,33),e.qZA())}function D_(o,i){1&o&&(e.TgZ(0,"span",31),e.SDv(1,34),e.qZA())}function $_(o,i){1&o&&(e.TgZ(0,"option",26),e.SDv(1,35),e.qZA())}function I_(o,i){if(1&o&&(e.TgZ(0,"option",36),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_.name," ")}}function x_(o,i){1&o&&(e.TgZ(0,"span",31),e.SDv(1,37),e.qZA())}function Z_(o,i){1&o&&(e.TgZ(0,"option",26),e.SDv(1,38),e.qZA())}function y_(o,i){if(1&o&&(e.TgZ(0,"option",36),e._uU(1),e.qZA()),2&o){const _=i.$implicit,t=e.oxw();e.Q6J("ngValue",_),e.xp6(1),e.AsE(" ",_," ( ",t.failureDomains[_].length," ) ")}}function U_(o,i){1&o&&(e.TgZ(0,"span",31),e.SDv(1,39),e.qZA())}function G_(o,i){if(1&o&&(e.TgZ(0,"option",36),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_," ")}}let H_=(()=>{class o extends L{constructor(_,t,n,s,c){super(),this.formBuilder=_,this.activeModal=t,this.taskWrapper=n,this.crushRuleService=s,this.actionLabels=c,this.submitAction=new e.vpe,this.tooltips=this.crushRuleService.formTooltips,this.action=this.actionLabels.CREATE,this.resource="Crush Rule",this.createForm()}createForm(){this.form=this.formBuilder.group({name:["",[l.kI.required,l.kI.pattern("[A-Za-z0-9_-]+"),u.hq.custom("uniqueName",_=>this.names&&-1!==this.names.indexOf(_))]],root:null,failure_domain:"",device_class:""})}ngOnInit(){this.crushRuleService.getInfo().subscribe(({names:_,nodes:t})=>{this.initCrushNodeSelection(t,this.form.get("root"),this.form.get("failure_domain"),this.form.get("device_class")),this.names=_})}onSubmit(){if(this.form.invalid)return void this.form.setErrors({cdSubmitButton:!0});const _=f().cloneDeep(this.form.value);_.root=_.root.name,""===_.device_class&&delete _.device_class,this.taskWrapper.wrapTaskAroundCall({task:new D.R("crushRule/create",_),call:this.crushRuleService.create(_)}).subscribe({error:()=>{this.form.setErrors({cdSubmitButton:!0})},complete:()=>{this.activeModal.close(),this.submitAction.emit(_)}})}}return o.\u0275fac=function(_){return new(_||o)(e.Y36(Ze.O),e.Y36(E.Kz),e.Y36(ge.P),e.Y36(ye.H),e.Y36(h.p4))},o.\u0275cmp=e.Xpm({type:o,selectors:[["cd-crush-rule-form-modal"]],outputs:{submitAction:"submitAction"},features:[e.qOj],decls:57,vars:27,consts:function(){let i,_,t,n,s,c,d,P,p,R,S,T,m,C;return i="\n          " + "\ufffd0\ufffd" + "\n          " + "\ufffd1\ufffd" + "\n        ",_="Name",t="Root",n="Failure domain type",s="Device class",c="All devices",d="[object Object]",P="This field is required!",p="The name can only consist of alphanumeric characters, dashes and underscores.",R="The chosen erasure code profile name is already in use.",S="Loading...",T="This field is required!",m="Loading...",C="This field is required!",[[3,"modalRef"],[1,"modal-title"],i,[1,"modal-content"],["novalidate","",3,"formGroup"],["frm","ngForm"],[1,"modal-body"],[1,"form-group","row"],["for","name",1,"cd-col-form-label"],_,[1,"required"],[1,"cd-col-form-input"],["type","text","id","name","name","name","placeholder","Name...","formControlName","name","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","root",1,"cd-col-form-label"],t,[3,"html"],["id","root","name","root","formControlName","root",1,"form-select"],["ngValue","",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],["for","failure_domain",1,"cd-col-form-label"],n,["id","failure_domain","name","failure_domain","formControlName","failure_domain",1,"form-select"],["for","device_class",1,"cd-col-form-label"],s,["id","device_class","name","device_class","formControlName","device_class",1,"form-select"],["ngValue",""],c,d,[1,"modal-footer"],[3,"form","submitText","submitActionEvent"],[1,"invalid-feedback"],P,p,R,S,[3,"ngValue"],T,m,C]},template:function(_,t){if(1&_&&(e.TgZ(0,"cd-modal",0),e.ynx(1,1),e.SDv(2,2),e.ALo(3,"titlecase"),e.ALo(4,"upperFirst"),e.BQk(),e.ynx(5,3),e.TgZ(6,"form",4,5)(8,"div",6)(9,"div",7)(10,"label",8),e.ynx(11),e.SDv(12,9),e.BQk(),e._UZ(13,"span",10),e.qZA(),e.TgZ(14,"div",11),e._UZ(15,"input",12),e.YNc(16,b_,2,0,"span",13),e.YNc(17,v_,2,0,"span",13),e.YNc(18,D_,2,0,"span",13),e.qZA()(),e.TgZ(19,"div",7)(20,"label",14),e.ynx(21),e.SDv(22,15),e.BQk(),e._UZ(23,"cd-helper",16)(24,"span",10),e.qZA(),e.TgZ(25,"div",11)(26,"select",17),e.YNc(27,$_,2,0,"option",18),e.YNc(28,I_,2,2,"option",19),e.qZA(),e.YNc(29,x_,2,0,"span",13),e.qZA()(),e.TgZ(30,"div",7)(31,"label",20),e.ynx(32),e.SDv(33,21),e.BQk(),e._UZ(34,"cd-helper",16)(35,"span",10),e.qZA(),e.TgZ(36,"div",11)(37,"select",22),e.YNc(38,Z_,2,0,"option",18),e.YNc(39,y_,2,3,"option",19),e.qZA(),e.YNc(40,U_,2,0,"span",13),e.qZA()(),e.TgZ(41,"div",7)(42,"label",23),e.ynx(43),e.SDv(44,24),e.BQk(),e.qZA(),e.TgZ(45,"div",11)(46,"select",25)(47,"option",26),e.SDv(48,27),e.qZA(),e.YNc(49,G_,2,2,"option",19),e.qZA(),e.TgZ(50,"cd-help-text")(51,"span"),e.SDv(52,28),e.qZA()()()()(),e.TgZ(53,"div",29)(54,"cd-form-button-panel",30),e.NdJ("submitActionEvent",function(){return t.onSubmit()}),e.ALo(55,"titlecase"),e.ALo(56,"upperFirst"),e.qZA()()(),e.BQk(),e.qZA()),2&_){const n=e.MAs(7);e.Q6J("modalRef",t.activeModal),e.xp6(4),e.pQV(e.lcZ(3,19,t.action))(e.lcZ(4,21,t.resource)),e.QtT(2),e.xp6(2),e.Q6J("formGroup",t.form),e.xp6(10),e.Q6J("ngIf",t.form.showError("name",n,"required")),e.xp6(1),e.Q6J("ngIf",t.form.showError("name",n,"pattern")),e.xp6(1),e.Q6J("ngIf",t.form.showError("name",n,"uniqueName")),e.xp6(5),e.Q6J("html",t.tooltips.root),e.xp6(4),e.Q6J("ngIf",!t.buckets),e.xp6(1),e.Q6J("ngForOf",t.buckets),e.xp6(1),e.Q6J("ngIf",t.form.showError("root",n,"required")),e.xp6(5),e.Q6J("html",t.tooltips.failure_domain),e.xp6(4),e.Q6J("ngIf",!t.failureDomains),e.xp6(1),e.Q6J("ngForOf",t.failureDomainKeys),e.xp6(1),e.Q6J("ngIf",t.form.showError("failure_domain",n,"required")),e.xp6(9),e.Q6J("ngForOf",t.devices),e.xp6(3),e.pQV(t.tooltips.device_class),e.QtT(52),e.xp6(2),e.Q6J("form",t.form)("submitText",e.lcZ(55,23,t.action)+" "+e.lcZ(56,25,t.resource))}},dependencies:[M.sg,M.O5,Re.S,Ue.z,me.p,Ce.t,Me.U,he.o,Se.b,Te.P,Le.V,l._Y,l.YN,l.Kr,l.Fj,l.EJ,l.JJ,l.JL,l.sg,l.u,M.rS,Ae.m]}),o})();class q_{}var z_=r(35732);let Fe=(()=>{class o{constructor(_){this.http=_,this.apiPath="api/erasure_code_profile",this.formTooltips={k:"Each object is split in data-chunks parts, each stored on a different OSD.",m:"Compute coding chunks for each object and store them on different OSDs.\n      The number of coding chunks is also the number of OSDs that can be down without losing data.",plugins:{jerasure:{description:"The jerasure plugin is the most generic and flexible plugin,\n          it is also the default for Ceph erasure coded pools.",technique:"The more flexible technique is reed_sol_van : it is enough to set k\n          and m. The cauchy_good technique can be faster but you need to chose the packetsize\n          carefully. All of reed_sol_r6_op, liberation, blaum_roth, liber8tion are RAID6 equivalents\n          in the sense that they can only be configured with m=2.",packetSize:"The encoding will be done on packets of bytes size at a time.\n          Choosing the right packet size is difficult.\n          The jerasure documentation contains extensive information on this topic."},lrc:{description:"With the jerasure plugin, when an erasure coded object is stored on\n          multiple OSDs, recovering from the loss of one OSD requires reading from all the others.\n          For instance if jerasure is configured with k=8 and m=4, losing one OSD requires reading\n          from the eleven others to repair.\n\n          The lrc erasure code plugin creates local parity chunks to be able to recover using\n          less OSDs. For instance if lrc is configured with k=8, m=4 and l=4, it will create\n          an additional parity chunk for every four OSDs. When a single OSD is lost, it can be\n          recovered with only four OSDs instead of eleven.",l:"Group the coding and data chunks into sets of size locality. For instance,\n          for k=4 and m=2, when locality=3 two groups of three are created. Each set can\n          be recovered without reading chunks from another set.",crushLocality:"The type of the crush bucket in which each set of chunks defined\n          by l will be stored. For instance, if it is set to rack, each group of l chunks will be\n          placed in a different rack. It is used to create a CRUSH rule step such as step choose\n          rack. If it is not set, no such grouping is done."},isa:{description:"The isa plugin encapsulates the ISA library. It only runs on Intel processors.",technique:"The ISA plugin comes in two Reed Solomon forms.\n          If reed_sol_van is set, it is Vandermonde, if cauchy is set, it is Cauchy."},shec:{description:"The shec plugin encapsulates the multiple SHEC library.\n          It allows ceph to recover data more efficiently than Reed Solomon codes.",c:"The number of parity chunks each of which includes each data chunk in its\n          calculation range. The number is used as a durability estimator. For instance, if c=2,\n          2 OSDs can be down without losing data."},clay:{description:"CLAY (short for coupled-layer) codes are erasure codes designed to\n          bring about significant savings in terms of network bandwidth and disk IO when a failed\n          node/OSD/rack is being repaired.",d:"Number of OSDs requested to send data during recovery of a single chunk.\n          d needs to be chosen such that k+1 <= d <= k+m-1. The larger the d, the better\n          the savings.",scalar_mds:"scalar_mds specifies the plugin that is used as a building block\n          in the layered construction. It can be one of jerasure, isa, shec.",technique:"technique specifies the technique that will be picked\n          within the 'scalar_mds' plugin specified. Supported techniques\n          are 'reed_sol_van', 'reed_sol_r6_op', 'cauchy_orig',\n          'cauchy_good', 'liber8tion' for jerasure, 'reed_sol_van',\n          'cauchy' for isa and 'single', 'multiple' for shec."}},crushRoot:"The name of the crush bucket used for the first step of the CRUSH rule.\n      For instance step take default.",crushFailureDomain:"Ensure that no two chunks are in a bucket with the same failure\n      domain. For instance, if the failure domain is host no two chunks will be stored on the same\n      host. It is used to create a CRUSH rule step such as step chooseleaf host.",crushNumFailureDomains:" Number of failure domains to map. Results in a CRUSH MSR rule being created.\n    Must be specified if crush-osds-per-failure-domain is specified.",crushOsdsPerFailureDomain:"Maximum number of OSDs to place in each failure domain --\n     defaults to 1. Using a value greater than one will cause a CRUSH MSR rule to be created.\n      Must be specified if crush-num-failure-domains is specified.",crushDeviceClass:"The device class on which to place data.",directory:"Set the directory name from which the erasure code plugin is loaded."}}list(){return this.http.get(this.apiPath)}create(_){return this.http.post(this.apiPath,_,{observe:"response"})}delete(_){return this.http.delete(`${this.apiPath}/${_}`,{observe:"response"})}getInfo(){return this.http.get(`ui-${this.apiPath}/info`)}}return o.\u0275fac=function(_){return new(_||o)(e.LFG(z_.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();function X_(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,54),e.qZA())}function w_(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,55),e.qZA())}function Q_(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,56),e.qZA())}function J_(o,i){1&o&&(e.TgZ(0,"option",43),e.SDv(1,57),e.qZA())}function k_(o,i){if(1&o&&(e.TgZ(0,"option",58),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_," ")}}function V_(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,59),e.qZA())}function Y_(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,60),e.qZA())}function B_(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,61),e.qZA())}function j_(o,i){if(1&o&&(e.TgZ(0,"span",53),e.SDv(1,62),e.qZA()),2&o){const _=e.oxw();e.xp6(1),e.pQV(_.deviceCount),e.QtT(1)}}function K_(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,63),e.qZA())}function W_(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,64),e.qZA())}function eo(o,i){if(1&o&&(e.TgZ(0,"span",46),e.SDv(1,65),e.qZA()),2&o){const _=e.oxw();e.xp6(1),e.pQV(_.lrcMultiK),e.QtT(1)}}function _o(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,66),e.qZA())}function oo(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,67),e.qZA())}function to(o,i){if(1&o&&(e.TgZ(0,"span",53),e.SDv(1,68),e.qZA()),2&o){const _=e.oxw();e.xp6(1),e.pQV(_.deviceCount),e.QtT(1)}}function io(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,72),e.qZA())}function no(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,73),e.qZA())}function so(o,i){if(1&o&&(e.TgZ(0,"div",7)(1,"label",69)(2,"span",14),e.SDv(3,70),e.qZA(),e._UZ(4,"cd-helper",16),e.qZA(),e.TgZ(5,"div",10),e._UZ(6,"input",71),e.YNc(7,io,2,0,"span",12),e.YNc(8,no,2,0,"span",12),e.qZA()()),2&o){const _=e.oxw(),t=e.MAs(7);e.xp6(4),e.Q6J("html",_.tooltips.plugins.shec.c),e.xp6(3),e.Q6J("ngIf",_.form.showError("c",t,"min")),e.xp6(1),e.Q6J("ngIf",_.form.showError("c",t,"cGreaterM"))}}function ao(o,i){1&o&&(e.TgZ(0,"span",46),e.SDv(1,81),e.qZA())}function lo(o,i){if(1&o&&(e.TgZ(0,"span",46),e.SDv(1,82),e.qZA()),2&o){const _=e.oxw(3);e.xp6(1),e.pQV(_.getDMin())(_.getDMax()),e.QtT(1)}}function ro(o,i){if(1&o&&(e.TgZ(0,"span",46),e.SDv(1,83),e.qZA()),2&o){const _=e.oxw(3);e.xp6(1),e.pQV(_.getDMax()),e.QtT(1)}}function co(o,i){if(1&o&&(e.ynx(0),e.YNc(1,lo,2,2,"span",23),e.YNc(2,ro,2,1,"span",23),e.BQk()),2&o){const _=e.oxw(2);e.xp6(1),e.Q6J("ngIf",_.getDMin()<_.getDMax()),e.xp6(1),e.Q6J("ngIf",_.getDMin()===_.getDMax())}}function Oo(o,i){if(1&o&&(e.TgZ(0,"span",53),e.SDv(1,84),e.qZA()),2&o){const _=e.oxw(2);e.xp6(1),e.pQV(_.getDMin()),e.QtT(1)}}function uo(o,i){if(1&o&&(e.TgZ(0,"span",53),e.SDv(1,85),e.qZA()),2&o){const _=e.oxw(2);e.xp6(1),e.pQV(_.getDMax()),e.QtT(1)}}function Po(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"div",7)(1,"label",74)(2,"span",14),e.SDv(3,75),e.qZA(),e._UZ(4,"cd-helper",16),e.qZA(),e.TgZ(5,"div",10)(6,"div",76),e._UZ(7,"input",77),e.TgZ(8,"button",78),e.NdJ("click",function(){e.CHM(_);const n=e.oxw();return e.KtG(n.toggleDCalc())}),e._UZ(9,"i",79),e.qZA()(),e.YNc(10,ao,2,0,"span",23),e.YNc(11,co,3,2,"ng-container",80),e.YNc(12,Oo,2,1,"span",12),e.YNc(13,uo,2,1,"span",12),e.qZA()()}if(2&o){const _=e.oxw(),t=e.MAs(7);e.xp6(4),e.Q6J("html",_.tooltips.plugins.clay.d),e.xp6(5),e.Q6J("ngClass",_.dCalc?_.icons.unlock:_.icons.lock),e.xp6(1),e.Q6J("ngIf",_.dCalc),e.xp6(1),e.Q6J("ngIf",!_.dCalc),e.xp6(1),e.Q6J("ngIf",_.form.showError("d",t,"dMin")),e.xp6(1),e.Q6J("ngIf",_.form.showError("d",t,"dMax"))}}function Eo(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,90),e.qZA())}function fo(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,91),e.qZA())}function go(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,92),e.qZA())}function po(o,i){if(1&o&&(e.TgZ(0,"div",7)(1,"label",86)(2,"span",14),e.SDv(3,87),e.qZA(),e._UZ(4,"cd-helper",16),e.qZA(),e.TgZ(5,"div",10),e._UZ(6,"input",88),e.YNc(7,Eo,2,0,"span",12),e.YNc(8,fo,2,0,"span",12),e.YNc(9,go,2,0,"span",12),e.TgZ(10,"span",46),e.SDv(11,89),e.qZA()()()),2&o){const _=e.oxw(),t=e.MAs(7);e.xp6(4),e.Q6J("html",_.tooltips.plugins.lrc.l),e.xp6(3),e.Q6J("ngIf",_.form.showError("l",t,"required")),e.xp6(1),e.Q6J("ngIf",_.form.showError("l",t,"min")),e.xp6(1),e.Q6J("ngIf",_.form.showError("l",t,"unequal")),e.xp6(2),e.pQV(_.lrcGroups),e.QtT(11)}}function Ro(o,i){1&o&&(e.TgZ(0,"option",43),e.SDv(1,93),e.qZA())}function mo(o,i){if(1&o&&(e.TgZ(0,"option",58),e._uU(1),e.qZA()),2&o){const _=i.$implicit,t=e.oxw();e.Q6J("ngValue",_),e.xp6(1),e.AsE(" ",_," ( ",t.failureDomains[_].length," ) ")}}function Co(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,94),e.qZA())}function Mo(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,95),e.qZA())}function ho(o,i){1&o&&(e.TgZ(0,"option",43),e.SDv(1,99),e.qZA())}function So(o,i){1&o&&(e.TgZ(0,"option",43),e.SDv(1,100),e.qZA())}function To(o,i){if(1&o&&(e.TgZ(0,"option",58),e._uU(1),e.qZA()),2&o){const _=i.$implicit,t=e.oxw(2);e.Q6J("ngValue",_),e.xp6(1),e.AsE(" ",_," ( ",t.failureDomains[_].length," ) ")}}function Lo(o,i){if(1&o&&(e.TgZ(0,"div",7)(1,"label",96),e.ynx(2),e.SDv(3,97),e.BQk(),e._UZ(4,"cd-helper",16),e.qZA(),e.TgZ(5,"div",10)(6,"select",98),e.YNc(7,ho,2,0,"option",18),e.YNc(8,So,2,0,"option",18),e.YNc(9,To,2,3,"option",19),e.qZA()()()),2&o){const _=e.oxw();e.xp6(4),e.Q6J("html",_.tooltips.plugins.lrc.crushLocality),e.xp6(3),e.Q6J("ngIf",!_.failureDomains),e.xp6(1),e.Q6J("ngIf",_.failureDomainKeys.length>0),e.xp6(1),e.Q6J("ngForOf",_.failureDomainKeys)}}function Ao(o,i){if(1&o&&(e.TgZ(0,"option",58),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_," ")}}const Ge=function(o,i,_){return[o,i,_]};function Fo(o,i){if(1&o&&(e.TgZ(0,"div",7)(1,"label",101),e.ynx(2),e.SDv(3,102),e.BQk(),e._UZ(4,"cd-helper",16),e.qZA(),e.TgZ(5,"div",10)(6,"select",103),e.YNc(7,Ao,2,2,"option",19),e.qZA()()()),2&o){const _=e.oxw();e.xp6(4),e.Q6J("html",_.tooltips.plugins.clay.scalar_mds),e.xp6(3),e.Q6J("ngForOf",e.kEZ(2,Ge,_.PLUGIN.JERASURE,_.PLUGIN.ISA,_.PLUGIN.SHEC))}}function No(o,i){if(1&o&&(e.TgZ(0,"option",58),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_," ")}}function bo(o,i){if(1&o&&(e.TgZ(0,"div",7)(1,"label",104),e.ynx(2),e.SDv(3,105),e.BQk(),e._UZ(4,"cd-helper",16),e.qZA(),e.TgZ(5,"div",10)(6,"select",106),e.YNc(7,No,2,2,"option",19),e.qZA()()()),2&o){const _=e.oxw();e.xp6(4),e.Q6J("html",_.tooltips.plugins[_.plugin].technique),e.xp6(3),e.Q6J("ngForOf",_.techniques)}}function vo(o,i){1&o&&(e.TgZ(0,"span",53),e.SDv(1,110),e.qZA())}function Do(o,i){if(1&o&&(e.TgZ(0,"div",7)(1,"label",107),e.ynx(2),e.SDv(3,108),e.BQk(),e._UZ(4,"cd-helper",16),e.qZA(),e.TgZ(5,"div",10),e._UZ(6,"input",109),e.YNc(7,vo,2,0,"span",12),e.qZA()()),2&o){const _=e.oxw(),t=e.MAs(7);e.xp6(4),e.Q6J("html",_.tooltips.plugins.jerasure.packetSize),e.xp6(3),e.Q6J("ngIf",_.form.showError("packetSize",t,"min"))}}function $o(o,i){1&o&&(e.TgZ(0,"option",43),e.SDv(1,111),e.qZA())}function Io(o,i){if(1&o&&(e.TgZ(0,"option",58),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_.name," ")}}function xo(o,i){if(1&o&&(e.TgZ(0,"option",58),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_," ")}}let Zo=(()=>{class o extends L{constructor(_,t,n,s,c){super(),this.formBuilder=_,this.activeModal=t,this.taskWrapper=n,this.ecpService=s,this.actionLabels=c,this.submitAction=new e.vpe,this.tooltips=this.ecpService.formTooltips,this.PLUGIN={LRC:"lrc",SHEC:"shec",CLAY:"clay",JERASURE:"jerasure",ISA:"isa"},this.plugin=this.PLUGIN.JERASURE,this.icons=v.P,this.action=this.actionLabels.CREATE,this.resource="EC Profile",this.createForm(),this.setJerasureDefaults()}createForm(){this.form=this.formBuilder.group({name:[null,[l.kI.required,l.kI.pattern("[A-Za-z0-9_-]+"),u.hq.custom("uniqueName",_=>this.names&&-1!==this.names.indexOf(_))]],plugin:[this.PLUGIN.JERASURE,[l.kI.required]],k:[4,[l.kI.required,u.hq.custom("max",()=>this.baseValueValidation(!0)),u.hq.custom("unequal",_=>this.lrcDataValidation(_)),u.hq.custom("kLowerM",_=>this.shecDataValidation(_))]],m:[2,[l.kI.required,u.hq.custom("max",()=>this.baseValueValidation())]],crushFailureDomain:"",crushNumFailureDomains:[0,u.hq.requiredIf({crushOsdsPerFailureDomain:{op:"minValue",arg1:1}})],crushOsdsPerFailureDomain:[0,u.hq.requiredIf({crushNumFailureDomains:{op:"minValue",arg1:1}})],crushRoot:null,crushDeviceClass:"",directory:"",technique:"reed_sol_van",packetSize:[2048],l:[3,[l.kI.required,u.hq.custom("unequal",_=>this.lrcLocalityValidation(_))]],crushLocality:"",c:[2,[l.kI.required,u.hq.custom("cGreaterM",_=>this.shecDurabilityValidation(_))]],d:[5,[l.kI.required,u.hq.custom("dMin",_=>this.dMinValidation(_)),u.hq.custom("dMax",_=>this.dMaxValidation(_))]],scalar_mds:[this.PLUGIN.JERASURE,[l.kI.required]]}),this.toggleDCalc(),this.form.get("k").valueChanges.subscribe(()=>this.updateValidityOnChange(["m","l","d"])),this.form.get("m").valueChanges.subscribe(()=>this.updateValidityOnChange(["k","l","c","d"])),this.form.get("l").valueChanges.subscribe(()=>this.updateValidityOnChange(["k","m"])),this.form.get("plugin").valueChanges.subscribe(_=>this.onPluginChange(_)),this.form.get("scalar_mds").valueChanges.subscribe(()=>this.setClayDefaultsForScalar())}baseValueValidation(_=!1){return this.validValidation(()=>this.getKMSum()>this.deviceCount&&this.form.getValue("k")>this.form.getValue("m")===_)}validValidation(_,t){return!((!this.form||t)&&this.plugin!==t)&&_()}getKMSum(){return this.form.getValue("k")+this.form.getValue("m")}lrcDataValidation(_){return this.validValidation(()=>{const t=this.form.getValue("m"),n=this.form.getValue("l"),s=_+t;return this.lrcMultiK=_/(s/n),_%(s/n)!=0},"lrc")}shecDataValidation(_){return this.validValidation(()=>this.form.getValue("m")>_,"shec")}lrcLocalityValidation(_){return this.validValidation(()=>{const t=this.getKMSum();return this.lrcGroups=_>0?t/_:0,_>0&&t%_!=0},"lrc")}shecDurabilityValidation(_){return this.validValidation(()=>{const t=this.form.getValue("m");return _>t},"shec")}dMinValidation(_){return this.validValidation(()=>this.getDMin()>_,"clay")}getDMin(){return this.form.getValue("k")+1}dMaxValidation(_){return this.validValidation(()=>_>this.getDMax(),"clay")}getDMax(){const _=this.form.getValue("m");return this.form.getValue("k")+_-1}toggleDCalc(){this.dCalc=!this.dCalc,this.form.get("d")[this.dCalc?"disable":"enable"](),this.calculateD()}calculateD(){this.plugin!==this.PLUGIN.CLAY||!this.dCalc||this.form.silentSet("d",this.getDMax())}updateValidityOnChange(_){_.forEach(t=>{"d"===t&&this.calculateD(),this.form.get(t).updateValueAndValidity({emitEvent:!1})})}onPluginChange(_){this.plugin=_,_===this.PLUGIN.JERASURE?this.setJerasureDefaults():_===this.PLUGIN.LRC?this.setLrcDefaults():_===this.PLUGIN.ISA?this.setIsaDefaults():_===this.PLUGIN.SHEC?this.setShecDefaults():_===this.PLUGIN.CLAY&&this.setClayDefaults(),this.updateValidityOnChange(["m"])}setJerasureDefaults(){this.techniques=["reed_sol_van","reed_sol_r6_op","cauchy_orig","cauchy_good","liberation","blaum_roth","liber8tion"],this.setDefaults({k:4,m:2,technique:"reed_sol_van"})}setLrcDefaults(){this.setDefaults({k:4,m:2,l:3})}setIsaDefaults(){this.techniques=["reed_sol_van","cauchy"],this.setDefaults({k:7,m:3,technique:"reed_sol_van"})}setShecDefaults(){this.setDefaults({k:4,m:3,c:2})}setClayDefaults(){this.setDefaults({k:4,m:2,scalar_mds:this.PLUGIN.JERASURE}),this.setClayDefaultsForScalar()}setClayDefaultsForScalar(){const _=this.form.getValue("scalar_mds");let t="reed_sol_van";_===this.PLUGIN.JERASURE?this.techniques=["reed_sol_van","reed_sol_r6_op","cauchy_orig","cauchy_good","liber8tion"]:_===this.PLUGIN.ISA?this.techniques=["reed_sol_van","cauchy"]:(t="single",this.techniques=["single","multiple"]),this.setDefaults({technique:t})}setDefaults(_){Object.keys(_).forEach(t=>{const n=this.form.get(t),s=n.value;n.pristine||"technique"===t&&!this.techniques.includes(s)||"k"===t&&[4,7].includes(s)||"m"===t&&[2,3].includes(s)?n.setValue(_[t]):n.updateValueAndValidity()})}ngOnInit(){this.ecpService.getInfo().subscribe(({plugins:_,names:t,directory:n,nodes:s})=>{this.initCrushNodeSelection(s,this.form.get("crushRoot"),this.form.get("crushFailureDomain"),this.form.get("crushDeviceClass"),!1),this.plugins=_,this.names=t,this.form.silentSet("directory",n),this.preValidateNumericInputFields()})}preValidateNumericInputFields(){const _=["k","m","l","c","d"].map(t=>this.form.get(t));_.forEach(t=>{t.markAsTouched(),t.markAsDirty()}),_[1].updateValueAndValidity()}onSubmit(){if(this.form.invalid)return void this.form.setErrors({cdSubmitButton:!0});const _=this.createJson();this.taskWrapper.wrapTaskAroundCall({task:new D.R("ecp/create",{name:_.name}),call:this.ecpService.create(_)}).subscribe({error:()=>{this.form.setErrors({cdSubmitButton:!0})},complete:()=>{this.activeModal.close(),this.submitAction.emit(_)}})}createJson(){const _={technique:[this.PLUGIN.ISA,this.PLUGIN.JERASURE,this.PLUGIN.CLAY],packetSize:[this.PLUGIN.JERASURE],l:[this.PLUGIN.LRC],crushLocality:[this.PLUGIN.LRC],c:[this.PLUGIN.SHEC],d:[this.PLUGIN.CLAY],scalar_mds:[this.PLUGIN.CLAY]},t=new q_,n=this.form.getValue("plugin");return Object.keys(this.form.controls).filter(s=>{const c=_[s],d=this.form.getValue(s);return(c&&c.includes(n)||!c)&&d&&""!==d}).forEach(s=>{this.extendJson(s,t)}),t}extendJson(_,t){const s=this.form.getValue(_);t[{crushFailureDomain:"crush-failure-domain",crushNumFailureDomains:"crush-num-failure-domains",crushOsdsPerFailureDomain:"crush-osds-per-failure-domain",crushRoot:"crush-root",crushDeviceClass:"crush-device-class",packetSize:"packetsize",crushLocality:"crush-locality"}[_]||_]="crushRoot"===_?s.name:s}}return o.\u0275fac=function(_){return new(_||o)(e.Y36(Ze.O),e.Y36(E.Kz),e.Y36(ge.P),e.Y36(Fe),e.Y36(h.p4))},o.\u0275cmp=e.Xpm({type:o,selectors:[["cd-erasure-code-profile-form-modal"]],outputs:{submitAction:"submitAction"},features:[e.qOj],decls:116,vars:57,consts:function(){let i,_,t,n,s,c,d,P,p,R,S,T,m,C,g,$,I,x,Z,y,U,G,H,q,z,X,w,Q,J,k,V,Y,B,j,K,W,ee,_e,N,oe,te,ie,ne,se,ae,le,re,ce,Oe,de,ue,Pe,b,Ee;return i="\n          " + "\ufffd0\ufffd" + "\n          " + "\ufffd1\ufffd" + "\n        ",_="Name",t="Plugin",n="Data chunks (k)",s="Coding chunks (m)",c="Crush failure domain",d="Crush num failure domain",P="Crush osds per failure domain",p="Crush root",R="Crush device class",S="All devices",T="[object Object]",m="Available OSDs: \n          " + "\ufffd0\ufffd" + "\n        ",C="Directory",g="This field is required!",$="The name can only consist of alphanumeric characters, dashes and underscores.",I="The chosen erasure code profile name is already in use.",x="Loading...",Z="This field is required!",y="This field is required!",U="Must be equal to or greater than 2.",G="Chunks (k+m) have exceeded the available OSDs of \n          " + "\ufffd0\ufffd" + ".\n        ",H="For an equal distribution k has to be a multiple of (k+m)/l.",q="K has to be equal to or greater than m in order to recover data correctly through c.",z="Distribution factor: \n          " + "\ufffd0\ufffd" + "\n        ",X="This field is required!",w="Must be equal to or greater than 1.",Q="Chunks (k+m) have exceeded the available OSDs of \n          " + "\ufffd0\ufffd" + ".\n        ",J="Durability estimator (c)",k="Must be equal to or greater than 1.",V="C has to be equal to or lower than m as m defines the amount of chunks that can be used.",Y="Helper chunks (d)",B="Set d manually or use the plugin's default calculation that maximizes d.",j="D is automatically updated on k and m changes",K="D can be set from \n          " + "\ufffd0\ufffd" + " to \n          " + "\ufffd1\ufffd" + "\n        ",W="D can only be set to \n          " + "\ufffd0\ufffd" + "\n        ",ee="D has to be greater than k (\n          " + "\ufffd0\ufffd" + ").\n        ",_e="D has to be lower than k + m (\n          " + "\ufffd0\ufffd" + ").\n        ",N="Locality (l)",oe="Locality groups: \n          " + "\ufffd0\ufffd" + "\n        ",te="This field is required!",ie="Must be equal to or greater than 1.",ne="Can't split up chunks (k+m) correctly with the current locality.",se="Loading...",ae="This field is required when crush osds per failure domain is set!",le="This field is required when crush num failure domain is set!",re="Crush Locality",ce="Loading...",Oe="None",de="Scalar mds",ue="Technique",Pe="Packetsize",b="Must be equal to or greater than 1.",Ee="Loading...",[[3,"modalRef"],[1,"modal-title"],i,[1,"modal-content"],["novalidate","",3,"formGroup"],["frm","ngForm"],[1,"modal-body"],[1,"form-group","row"],["for","name",1,"cd-col-form-label"],_,[1,"cd-col-form-input"],["type","text","id","name","name","name","placeholder","Name...","formControlName","name","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","plugin",1,"cd-col-form-label"],[1,"required"],t,[3,"html"],["id","plugin","name","plugin","formControlName","plugin",1,"form-select"],["ngValue","",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],["for","k",1,"cd-col-form-label"],n,["type","number","id","k","name","k","ng-model","$ctrl.erasureCodeProfile.k","placeholder","Data chunks...","formControlName","k","min","2",1,"form-control"],["class","form-text text-muted",4,"ngIf"],["for","m",1,"cd-col-form-label"],s,["type","number","id","m","name","m","placeholder","Coding chunks...","formControlName","m","min","1",1,"form-control"],["class","form-group row",4,"ngIf"],["for","crushFailureDomain",1,"cd-col-form-label"],c,["id","crushFailureDomain","name","crushFailureDomain","formControlName","crushFailureDomain",1,"form-select"],["for","crushNumFailureDomains",1,"cd-col-form-label"],d,["type","number","id","crushNumFailureDomains","name","crushNumFailureDomains","formControlName","crushNumFailureDomains","min","0",1,"form-control"],["for","crushOsdsPerFailureDomain",1,"cd-col-form-label"],P,["type","number","id","crushOsdsPerFailureDomain","name","crushOsdsPerFailureDomain","formControlName","crushOsdsPerFailureDomain","min","0",1,"form-control"],["for","crushRoot",1,"cd-col-form-label"],p,["id","crushRoot","name","crushRoot","formControlName","crushRoot",1,"form-select"],["for","crushDeviceClass",1,"cd-col-form-label"],R,["id","crushDeviceClass","name","crushDeviceClass","formControlName","crushDeviceClass",1,"form-select"],["ngValue",""],S,T,[1,"form-text","text-muted"],m,["for","directory",1,"cd-col-form-label"],C,["type","text","id","directory","name","directory","placeholder","Path...","formControlName","directory",1,"form-control"],[1,"modal-footer"],[3,"form","submitText","submitActionEvent"],[1,"invalid-feedback"],g,$,I,x,[3,"ngValue"],Z,y,U,G,H,q,z,X,w,Q,["for","c",1,"cd-col-form-label"],J,["type","number","id","c","name","c","placeholder","Coding chunks...","formControlName","c","min","1",1,"form-control"],k,V,["for","d",1,"cd-col-form-label"],Y,[1,"input-group"],["type","number","id","d","name","d","placeholder","Helper chunks...","formControlName","d",1,"form-control"],["id","d-calc-btn","ngbTooltip",B,"type","button",1,"btn","btn-light",3,"click"],["aria-hidden","true",3,"ngClass"],[4,"ngIf"],j,K,W,ee,_e,["for","l",1,"cd-col-form-label"],N,["type","number","id","l","name","l","placeholder","Coding chunks...","formControlName","l","min","1",1,"form-control"],oe,te,ie,ne,se,ae,le,["for","crushLocality",1,"cd-col-form-label"],re,["id","crushLocality","name","crushLocality","formControlName","crushLocality",1,"form-select"],ce,Oe,["for","scalar_mds",1,"cd-col-form-label"],de,["id","scalar_mds","name","scalar_mds","formControlName","scalar_mds",1,"form-select"],["for","technique",1,"cd-col-form-label"],ue,["id","technique","name","technique","formControlName","technique",1,"form-select"],["for","packetSize",1,"cd-col-form-label"],Pe,["type","number","id","packetSize","name","packetSize","placeholder","Packetsize...","formControlName","packetSize","min","1",1,"form-control"],b,Ee]},template:function(_,t){if(1&_&&(e.TgZ(0,"cd-modal",0),e.ynx(1,1),e.SDv(2,2),e.ALo(3,"titlecase"),e.ALo(4,"upperFirst"),e.BQk(),e.ynx(5,3),e.TgZ(6,"form",4,5)(8,"div",6)(9,"div",7)(10,"label",8),e.SDv(11,9),e.qZA(),e.TgZ(12,"div",10),e._UZ(13,"input",11),e.YNc(14,X_,2,0,"span",12),e.YNc(15,w_,2,0,"span",12),e.YNc(16,Q_,2,0,"span",12),e.qZA()(),e.TgZ(17,"div",7)(18,"label",13)(19,"span",14),e.SDv(20,15),e.qZA(),e._UZ(21,"cd-helper",16),e.qZA(),e.TgZ(22,"div",10)(23,"select",17),e.YNc(24,J_,2,0,"option",18),e.YNc(25,k_,2,2,"option",19),e.qZA(),e.YNc(26,V_,2,0,"span",12),e.qZA()(),e.TgZ(27,"div",7)(28,"label",20)(29,"span",14),e.SDv(30,21),e.qZA(),e._UZ(31,"cd-helper",16),e.qZA(),e.TgZ(32,"div",10),e._UZ(33,"input",22),e.YNc(34,Y_,2,0,"span",12),e.YNc(35,B_,2,0,"span",12),e.YNc(36,j_,2,1,"span",12),e.YNc(37,K_,2,0,"span",12),e.YNc(38,W_,2,0,"span",12),e.YNc(39,eo,2,1,"span",23),e.qZA()(),e.TgZ(40,"div",7)(41,"label",24)(42,"span",14),e.SDv(43,25),e.qZA(),e._UZ(44,"cd-helper",16),e.qZA(),e.TgZ(45,"div",10),e._UZ(46,"input",26),e.YNc(47,_o,2,0,"span",12),e.YNc(48,oo,2,0,"span",12),e.YNc(49,to,2,1,"span",12),e.qZA()(),e.YNc(50,so,9,3,"div",27),e.YNc(51,Po,14,6,"div",27),e.YNc(52,po,12,5,"div",27),e.TgZ(53,"div",7)(54,"label",28),e.ynx(55),e.SDv(56,29),e.BQk(),e._UZ(57,"cd-helper",16),e.qZA(),e.TgZ(58,"div",10)(59,"select",30),e.YNc(60,Ro,2,0,"option",18),e.YNc(61,mo,2,3,"option",19),e.qZA()()(),e.TgZ(62,"div",7)(63,"label",31),e.ynx(64),e.SDv(65,32),e.BQk(),e._UZ(66,"cd-helper",16),e.qZA(),e.TgZ(67,"div",10),e._UZ(68,"input",33),e.YNc(69,Co,2,0,"span",12),e.qZA()(),e.TgZ(70,"div",7)(71,"label",34),e.ynx(72),e.SDv(73,35),e.BQk(),e._UZ(74,"cd-helper",16),e.qZA(),e.TgZ(75,"div",10),e._UZ(76,"input",36),e.YNc(77,Mo,2,0,"span",12),e.qZA()(),e.YNc(78,Lo,10,4,"div",27),e.YNc(79,Fo,8,6,"div",27),e.YNc(80,bo,8,2,"div",27),e.YNc(81,Do,8,2,"div",27),e.TgZ(82,"div",7)(83,"label",37),e.ynx(84),e.SDv(85,38),e.BQk(),e._UZ(86,"cd-helper",16),e.qZA(),e.TgZ(87,"div",10)(88,"select",39),e.YNc(89,$o,2,0,"option",18),e.YNc(90,Io,2,2,"option",19),e.qZA()()(),e.TgZ(91,"div",7)(92,"label",40),e.ynx(93),e.SDv(94,41),e.BQk(),e.qZA(),e.TgZ(95,"div",10)(96,"select",42)(97,"option",43),e.SDv(98,44),e.qZA(),e.YNc(99,xo,2,2,"option",19),e.qZA(),e.TgZ(100,"cd-help-text")(101,"span"),e.SDv(102,45),e.qZA()(),e.TgZ(103,"span",46),e.SDv(104,47),e.qZA()()(),e.TgZ(105,"div",7)(106,"label",48),e.ynx(107),e.SDv(108,49),e.BQk(),e._UZ(109,"cd-helper",16),e.qZA(),e.TgZ(110,"div",10),e._UZ(111,"input",50),e.qZA()()(),e.TgZ(112,"div",51)(113,"cd-form-button-panel",52),e.NdJ("submitActionEvent",function(){return t.onSubmit()}),e.ALo(114,"titlecase"),e.ALo(115,"upperFirst"),e.qZA()()(),e.BQk(),e.qZA()),2&_){const n=e.MAs(7);e.Q6J("modalRef",t.activeModal),e.xp6(4),e.pQV(e.lcZ(3,45,t.action))(e.lcZ(4,47,t.resource)),e.QtT(2),e.xp6(2),e.Q6J("formGroup",t.form),e.xp6(8),e.Q6J("ngIf",t.form.showError("name",n,"required")),e.xp6(1),e.Q6J("ngIf",t.form.showError("name",n,"pattern")),e.xp6(1),e.Q6J("ngIf",t.form.showError("name",n,"uniqueName")),e.xp6(5),e.Q6J("html",t.tooltips.plugins[t.plugin].description),e.xp6(3),e.Q6J("ngIf",!t.plugins),e.xp6(1),e.Q6J("ngForOf",t.plugins),e.xp6(1),e.Q6J("ngIf",t.form.showError("name",n,"required")),e.xp6(5),e.Q6J("html",t.tooltips.k),e.xp6(3),e.Q6J("ngIf",t.form.showError("k",n,"required")),e.xp6(1),e.Q6J("ngIf",t.form.showError("k",n,"min")),e.xp6(1),e.Q6J("ngIf",t.form.showError("k",n,"max")),e.xp6(1),e.Q6J("ngIf",t.form.showError("k",n,"unequal")),e.xp6(1),e.Q6J("ngIf",t.form.showError("k",n,"kLowerM")),e.xp6(1),e.Q6J("ngIf","lrc"===t.plugin),e.xp6(5),e.Q6J("html",t.tooltips.m),e.xp6(3),e.Q6J("ngIf",t.form.showError("m",n,"required")),e.xp6(1),e.Q6J("ngIf",t.form.showError("m",n,"min")),e.xp6(1),e.Q6J("ngIf",t.form.showError("m",n,"max")),e.xp6(1),e.Q6J("ngIf","shec"===t.plugin),e.xp6(1),e.Q6J("ngIf","clay"===t.plugin),e.xp6(1),e.Q6J("ngIf",t.plugin===t.PLUGIN.LRC),e.xp6(5),e.Q6J("html",t.tooltips.crushFailureDomain),e.xp6(3),e.Q6J("ngIf",!t.failureDomains),e.xp6(1),e.Q6J("ngForOf",t.failureDomainKeys),e.xp6(5),e.Q6J("html",t.tooltips.crushNumFailureDomains),e.xp6(3),e.Q6J("ngIf",t.form.showError("crushNumFailureDomains",n,"required")),e.xp6(5),e.Q6J("html",t.tooltips.crushOsdsPerFailureDomain),e.xp6(3),e.Q6J("ngIf",t.form.showError("crushOsdsPerFailureDomain",n,"required")),e.xp6(1),e.Q6J("ngIf",t.plugin===t.PLUGIN.LRC),e.xp6(1),e.Q6J("ngIf",t.PLUGIN.CLAY===t.plugin),e.xp6(1),e.Q6J("ngIf",e.kEZ(53,Ge,t.PLUGIN.JERASURE,t.PLUGIN.ISA,t.PLUGIN.CLAY).includes(t.plugin)),e.xp6(1),e.Q6J("ngIf",t.plugin===t.PLUGIN.JERASURE),e.xp6(5),e.Q6J("html",t.tooltips.crushRoot),e.xp6(3),e.Q6J("ngIf",!t.buckets),e.xp6(1),e.Q6J("ngForOf",t.buckets),e.xp6(9),e.Q6J("ngForOf",t.devices),e.xp6(3),e.pQV(t.tooltips.crushDeviceClass),e.QtT(102),e.xp6(2),e.pQV(t.deviceCount),e.QtT(104),e.xp6(5),e.Q6J("html",t.tooltips.directory),e.xp6(4),e.Q6J("form",t.form)("submitText",e.lcZ(114,49,t.action)+" "+e.lcZ(115,51,t.resource))}},dependencies:[M.mk,M.sg,M.O5,Re.S,Ue.z,me.p,Ce.t,Me.U,he.o,Se.b,Te.P,Le.V,l._Y,l.YN,l.Kr,l.Fj,l.wV,l.EJ,l.JJ,l.JL,l.qQ,l.sg,l.u,E._L,M.rS,Ae.m]}),o})();var yo=r(7022);class Uo{constructor(){this.erasureInfo=!1,this.crushInfo=!1,this.pgs=1,this.poolTypes=["erasure","replicated"],this.applications={selected:[],default:["cephfs","rbd","rgw"],available:[],validators:[l.kI.pattern("[A-Za-z0-9_]+"),l.kI.maxLength(128)],messages:new yo.a({empty:"No applications added",selectionLimit:{text:"Applications limit reached",tooltip:"A pool can only have up to four applications definitions."},customValidations:{pattern:"Allowed characters '_a-zA-Z0-9'",maxlength:"Maximum length is 128 characters"},filter:"Filter or add applications'",add:"Add application"})}}}var Go=r(2840),He=r(63285),qe=r(47640),Ho=r(60192),qo=r(30490),ze=r(61350),zo=r(17932),Xo=r(63622),wo=r(60950);const Qo=["crushInfoTabs"],Jo=["crushDeletionBtn"],ko=["ecpInfoTabs"],Vo=["ecpDeletionBtn"];function Yo(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,43),e.qZA())}function Bo(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,44),e.qZA())}function jo(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,45),e.qZA())}function Ko(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,46),e.qZA())}function Wo(o,i){if(1&o&&(e.TgZ(0,"option",47),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("value",_),e.xp6(1),e.hij(" ",_," ")}}function et(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,48),e.qZA())}function _t(o,i){if(1&o&&(e.TgZ(0,"option",47),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("value",_),e.xp6(1),e.hij(" ",_," ")}}function ot(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,58),e.qZA())}function tt(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,59),e.qZA())}function it(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,60),e.qZA())}function nt(o,i){1&o&&(e.TgZ(0,"span",55),e.SDv(1,61),e.qZA())}function st(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"div",8)(1,"label",52),e.SDv(2,53),e.qZA(),e.TgZ(3,"div",11)(4,"input",54),e.NdJ("focus",function(){e.CHM(_);const n=e.oxw(3);return e.KtG(n.externalPgChange=!1)})("blur",function(){e.CHM(_);const n=e.oxw(3);return e.KtG(n.alignPgs())}),e.qZA(),e.YNc(5,ot,2,0,"span",13),e.YNc(6,tt,2,0,"span",13),e.YNc(7,it,2,0,"span",13),e.TgZ(8,"span",55),e._UZ(9,"cd-doc",56),e.qZA(),e.YNc(10,nt,2,0,"span",57),e.qZA()()}if(2&o){e.oxw(2);const _=e.MAs(2),t=e.oxw();e.xp6(5),e.Q6J("ngIf",t.form.showError("pgNum",_,"required")),e.xp6(1),e.Q6J("ngIf",t.form.showError("pgNum",_,"min")),e.xp6(1),e.Q6J("ngIf",t.form.showError("pgNum",_,"34")),e.xp6(3),e.Q6J("ngIf",t.externalPgChange)}}function at(o,i){if(1&o&&(e.TgZ(0,"span",42)(1,"ul",66)(2,"li"),e.SDv(3,67),e.qZA(),e.TgZ(4,"li"),e.SDv(5,68),e.qZA()()()),2&o){const _=e.oxw(4);e.xp6(3),e.pQV(_.getMinSize()),e.QtT(3),e.xp6(2),e.pQV(_.getMaxSize()),e.QtT(5)}}function lt(o,i){if(1&o&&(e.TgZ(0,"span",42),e.SDv(1,69),e.qZA()),2&o){const _=e.oxw(4);e.xp6(1),e.pQV(_.getMinSize())(_.getMaxSize()),e.QtT(1)}}function rt(o,i){1&o&&(e.TgZ(0,"span",70),e.SDv(1,71),e.qZA())}function ct(o,i){if(1&o&&(e.TgZ(0,"div",8)(1,"label",62),e.SDv(2,63),e.qZA(),e.TgZ(3,"div",11),e._UZ(4,"input",64),e.YNc(5,at,6,2,"span",13),e.YNc(6,lt,2,2,"span",13),e.YNc(7,rt,2,0,"span",65),e.qZA()()),2&o){e.oxw(2);const _=e.MAs(2),t=e.oxw();e.xp6(4),e.Q6J("max",t.getMaxSize())("min",t.getMinSize()),e.xp6(1),e.Q6J("ngIf",t.form.showError("size",_)),e.xp6(1),e.Q6J("ngIf",t.form.showError("size",_)),e.xp6(1),e.Q6J("ngIf",1===t.form.getValue("size"))}}function Ot(o,i){1&o&&(e.TgZ(0,"div",8)(1,"label",72),e.SDv(2,73),e.qZA(),e.TgZ(3,"div",11)(4,"div",74),e._UZ(5,"input",75),e.TgZ(6,"label",76),e.SDv(7,77),e.qZA()()()())}function dt(o,i){if(1&o&&(e.TgZ(0,"div")(1,"div",8)(2,"label",49),e.SDv(3,50),e.qZA(),e.TgZ(4,"div",11)(5,"select",51),e.YNc(6,_t,2,2,"option",19),e.qZA()()(),e.YNc(7,st,11,4,"div",25),e.YNc(8,ct,8,5,"div",25),e.YNc(9,Ot,8,0,"div",25),e.qZA()),2&o){const _=e.oxw(2);e.xp6(6),e.Q6J("ngForOf",_.pgAutoscaleModes),e.xp6(1),e.Q6J("ngIf","on"!==_.form.getValue("pgAutoscaleMode")),e.xp6(1),e.Q6J("ngIf",_.isReplicated),e.xp6(1),e.Q6J("ngIf",_.info.is_all_bluestore&&_.isErasure)}}function ut(o,i){if(1&o&&e._UZ(0,"i",78),2&o){const _=e.oxw(2);e.Gre("",_.icons.warning," icon-warning-color")}}function Pt(o,i){1&o&&(e.TgZ(0,"div",8)(1,"div",79)(2,"div",74),e._UZ(3,"input",80),e.TgZ(4,"label",81),e.SDv(5,82),e.qZA(),e.TgZ(6,"cd-help-text")(7,"span"),e.SDv(8,83),e.qZA()()()()())}function Et(o,i){1&o&&(e.TgZ(0,"option",17),e.SDv(1,97),e.qZA())}function ft(o,i){1&o&&(e.TgZ(0,"option",98),e.SDv(1,99),e.qZA()),2&o&&e.Q6J("ngValue",null)}function gt(o,i){1&o&&(e.TgZ(0,"option",98),e.SDv(1,100),e.qZA()),2&o&&e.Q6J("ngValue",null)}function pt(o,i){if(1&o&&(e.TgZ(0,"option",98),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_.name," ")}}const F=function(o){return[o]};function Rt(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"button",101),e.NdJ("click",function(){e.CHM(_);const n=e.oxw(4);return e.KtG(n.addErasureCodeProfile())}),e._UZ(1,"i",93),e.qZA()}if(2&o){const _=e.oxw(4);e.xp6(1),e.Q6J("ngClass",e.VKq(1,F,_.icons.add))}}function mt(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"button",102,103),e.NdJ("click",function(){e.CHM(_);const n=e.oxw(4);return e.KtG(n.deleteErasureCodeProfile())}),e._UZ(2,"i",93),e.qZA()}if(2&o){const _=e.oxw(4);e.xp6(2),e.Q6J("ngClass",e.VKq(1,F,_.icons.trash))}}const Ct=function(){return["name"]};function Mt(o,i){if(1&o&&e._UZ(0,"cd-table-key-value",114),2&o){const _=e.oxw(5);e.Q6J("renderObjects",!0)("hideKeys",e.DdM(4,Ct))("data",_.form.getValue("erasureProfile"))("autoReload",!1)}}function ht(o,i){1&o&&(e.TgZ(0,"span"),e.SDv(1,117),e.qZA())}function St(o,i){if(1&o&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.xp6(1),e.hij(" ",_," ")}}function Tt(o,i){if(1&o&&(e.TgZ(0,"ul"),e.YNc(1,St,2,1,"li",118),e.qZA()),2&o){const _=e.oxw(6);e.xp6(1),e.Q6J("ngForOf",_.ecpUsage)}}function Lt(o,i){if(1&o&&(e.YNc(0,ht,2,0,"ng-template",null,115,e.W1O),e.YNc(2,Tt,2,1,"ul",116)),2&o){const _=e.MAs(1),t=e.oxw(5);e.xp6(2),e.Q6J("ngIf",t.ecpUsage)("ngIfElse",_)}}function At(o,i){if(1&o&&(e.TgZ(0,"span",104)(1,"nav",105,106),e.ynx(3,107),e.TgZ(4,"a",108),e.SDv(5,109),e.qZA(),e.YNc(6,Mt,1,5,"ng-template",110),e.BQk(),e.ynx(7,111),e.TgZ(8,"a",108),e.SDv(9,112),e.qZA(),e.YNc(10,Lt,3,2,"ng-template",110),e.BQk(),e.qZA(),e._UZ(11,"div",113),e.qZA()),2&o){const _=e.MAs(2);e.xp6(11),e.Q6J("ngbNavOutlet",_)}}const Xe=function(o){return{active:o}};function Ft(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"div",8)(1,"label",85),e.SDv(2,86),e.qZA(),e.TgZ(3,"div",11)(4,"div",87)(5,"select",88),e.NdJ("change",function(){e.CHM(_);const n=e.oxw(3);return e.KtG(n.erasureProfileChange())}),e.YNc(6,Et,2,0,"option",89),e.YNc(7,ft,2,1,"option",90),e.YNc(8,gt,2,1,"option",90),e.YNc(9,pt,2,2,"option",91),e.qZA(),e.TgZ(10,"button",92),e.NdJ("click",function(){e.CHM(_);const n=e.oxw(3);return e.KtG(n.data.erasureInfo=!n.data.erasureInfo)}),e._UZ(11,"i",93),e.qZA(),e.YNc(12,Rt,2,3,"button",94),e.YNc(13,mt,3,3,"button",95),e.qZA(),e.YNc(14,At,12,1,"span",96),e.qZA()()}if(2&o){const _=e.oxw(3);e.xp6(6),e.Q6J("ngIf",!_.ecProfiles),e.xp6(1),e.Q6J("ngIf",_.ecProfiles&&0===_.ecProfiles.length),e.xp6(1),e.Q6J("ngIf",_.ecProfiles&&_.ecProfiles.length>0),e.xp6(1),e.Q6J("ngForOf",_.ecProfiles),e.xp6(1),e.Q6J("ngClass",e.VKq(9,Xe,_.data.erasureInfo)),e.xp6(1),e.Q6J("ngClass",e.VKq(11,F,_.icons.questionCircle)),e.xp6(1),e.Q6J("ngIf",!_.editing),e.xp6(1),e.Q6J("ngIf",!_.editing),e.xp6(1),e.Q6J("ngIf",_.data.erasureInfo&&_.form.getValue("erasureProfile"))}}function Nt(o,i){1&o&&(e.TgZ(0,"span",55),e.SDv(1,123),e.qZA())}function bt(o,i){1&o&&(e.TgZ(0,"span",55),e.SDv(1,124),e.qZA())}function vt(o,i){if(1&o&&(e.TgZ(0,"div",8)(1,"label",119),e.SDv(2,120),e.qZA(),e.TgZ(3,"div",11),e.YNc(4,Nt,2,0,"span",121),e.YNc(5,bt,2,0,"ng-template",null,122,e.W1O),e.qZA()()),2&o){const _=e.MAs(6),t=e.oxw(3);e.xp6(4),e.Q6J("ngIf",!t.msrCrush)("ngIfElse",_)}}function Dt(o,i){1&o&&(e.TgZ(0,"span",55)(1,"span"),e.SDv(2,127),e.qZA(),e._uU(3,"\xa0 "),e.qZA())}function $t(o,i){if(1&o&&(e.TgZ(0,"option",98),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_.rule_name," ")}}function It(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"button",101),e.NdJ("click",function(){e.CHM(_);const n=e.oxw(5);return e.KtG(n.addCrushRule())}),e._UZ(1,"i",93),e.qZA()}if(2&o){const _=e.oxw(5);e.xp6(1),e.Q6J("ngClass",e.VKq(1,F,_.icons.add))}}function xt(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"button",134,135),e.NdJ("click",function(){e.CHM(_);const n=e.oxw(5);return e.KtG(n.deleteCrushRule())}),e._UZ(2,"i",93),e.qZA()}if(2&o){const _=e.oxw(5);e.xp6(2),e.Q6J("ngClass",e.VKq(1,F,_.icons.trash))}}const Zt=function(){return["steps","type","rule_name"]};function yt(o,i){if(1&o&&e._UZ(0,"cd-table-key-value",114),2&o){const _=e.oxw(6);e.Q6J("renderObjects",!1)("hideKeys",e.DdM(4,Zt))("data",_.form.getValue("crushRule"))("autoReload",!1)}}function Ut(o,i){if(1&o&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&o){const _=i.$implicit,t=e.oxw(7);e.xp6(1),e.hij(" ",t.describeCrushStep(_)," ")}}function Gt(o,i){if(1&o&&(e.TgZ(0,"ol"),e.YNc(1,Ut,2,1,"li",118),e.qZA()),2&o){const _=e.oxw(6);e.xp6(1),e.Q6J("ngForOf",_.form.get("crushRule").value.steps)}}function Ht(o,i){1&o&&(e.TgZ(0,"span"),e.SDv(1,144),e.qZA())}function qt(o,i){if(1&o&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.xp6(1),e.hij(" ",_," ")}}function zt(o,i){if(1&o&&(e.TgZ(0,"ul"),e.YNc(1,qt,2,1,"li",118),e.qZA()),2&o){const _=e.oxw(7);e.xp6(1),e.Q6J("ngForOf",_.crushUsage)}}function Xt(o,i){if(1&o&&(e.YNc(0,Ht,2,0,"ng-template",null,143,e.W1O),e.YNc(2,zt,2,1,"ul",116)),2&o){const _=e.MAs(1),t=e.oxw(6);e.xp6(2),e.Q6J("ngIf",t.crushUsage)("ngIfElse",_)}}function wt(o,i){if(1&o&&(e.TgZ(0,"div",136)(1,"nav",105,137),e.ynx(3,138),e.TgZ(4,"a",108),e.SDv(5,139),e.qZA(),e.YNc(6,yt,1,5,"ng-template",110),e.BQk(),e.ynx(7,140),e.TgZ(8,"a",108),e.SDv(9,141),e.qZA(),e.YNc(10,Gt,2,1,"ng-template",110),e.BQk(),e.ynx(11,111),e.TgZ(12,"a",108),e.SDv(13,142),e.qZA(),e.YNc(14,Xt,3,2,"ng-template",110),e.BQk(),e.qZA(),e._UZ(15,"div",113),e.qZA()),2&o){const _=e.MAs(2);e.xp6(15),e.Q6J("ngbNavOutlet",_)}}function Qt(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,145),e.qZA())}function Jt(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,146),e.qZA())}function kt(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"div")(1,"div",128)(2,"select",129)(3,"option",98),e.SDv(4,130),e.qZA(),e.YNc(5,$t,2,2,"option",91),e.qZA(),e.TgZ(6,"button",131),e.NdJ("click",function(){e.CHM(_);const n=e.oxw(4);return e.KtG(n.data.crushInfo=!n.data.crushInfo)}),e._UZ(7,"i",93),e.qZA(),e.YNc(8,It,2,3,"button",94),e.YNc(9,xt,3,3,"button",132),e.qZA(),e.YNc(10,wt,16,1,"div",133),e.YNc(11,Qt,2,0,"span",13),e.YNc(12,Jt,2,0,"span",13),e.qZA()}if(2&o){e.oxw(3);const _=e.MAs(2),t=e.oxw();e.xp6(3),e.Q6J("ngValue",null),e.xp6(2),e.Q6J("ngForOf",t.current.rules),e.xp6(1),e.Q6J("ngClass",e.VKq(9,Xe,t.data.crushInfo)),e.xp6(1),e.Q6J("ngClass",e.VKq(11,F,t.icons.questionCircle)),e.xp6(1),e.Q6J("ngIf",t.isReplicated&&!t.editing),e.xp6(1),e.Q6J("ngIf",t.isReplicated&&!t.editing),e.xp6(1),e.Q6J("ngIf",t.data.crushInfo&&t.form.getValue("crushRule")),e.xp6(1),e.Q6J("ngIf",t.form.showError("crushRule",_,"required")),e.xp6(1),e.Q6J("ngIf",t.form.showError("crushRule",_,"tooFewOsds"))}}function Vt(o,i){if(1&o&&(e.TgZ(0,"div",8)(1,"label",119),e.SDv(2,125),e.qZA(),e.TgZ(3,"div",11),e.YNc(4,Dt,4,0,"ng-template",null,126,e.W1O),e.YNc(6,kt,13,13,"div",116),e.qZA()()),2&o){const _=e.MAs(5),t=e.oxw(3);e.xp6(6),e.Q6J("ngIf",t.current.rules.length>0)("ngIfElse",_)}}function Yt(o,i){if(1&o&&(e.TgZ(0,"div")(1,"legend"),e.SDv(2,84),e.qZA(),e.YNc(3,Ft,15,13,"div",25),e.YNc(4,vt,7,2,"div",25),e.YNc(5,Vt,7,2,"div",25),e.qZA()),2&o){const _=e.oxw(2);e.xp6(3),e.Q6J("ngIf",_.isErasure),e.xp6(1),e.Q6J("ngIf",_.isErasure&&!_.editing),e.xp6(1),e.Q6J("ngIf",_.isReplicated||_.editing)}}function Bt(o,i){if(1&o&&(e.TgZ(0,"option",47),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("value",_),e.xp6(1),e.hij(" ",_," ")}}function jt(o,i){1&o&&(e.TgZ(0,"option",17),e.SDv(1,164),e.qZA())}function Kt(o,i){1&o&&(e.TgZ(0,"option",17),e.SDv(1,165),e.qZA())}function Wt(o,i){if(1&o&&(e.TgZ(0,"option",47),e._uU(1),e.qZA()),2&o){const _=i.$implicit;e.Q6J("value",_),e.xp6(1),e.hij(" ",_," ")}}function ei(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,166),e.qZA())}function _i(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,167),e.qZA())}function oi(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,168),e.qZA())}function ti(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,169),e.qZA())}function ii(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,170),e.qZA())}function ni(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,171),e.qZA())}function si(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,172),e.qZA())}function ai(o,i){if(1&o&&(e.TgZ(0,"div")(1,"div",8)(2,"label",152),e.SDv(3,153),e.qZA(),e.TgZ(4,"div",11)(5,"select",154),e.YNc(6,jt,2,0,"option",89),e.YNc(7,Kt,2,0,"option",89),e.YNc(8,Wt,2,2,"option",19),e.qZA()()(),e.TgZ(9,"div",8)(10,"label",155),e.SDv(11,156),e.qZA(),e.TgZ(12,"div",11),e._UZ(13,"input",157),e.YNc(14,ei,2,0,"span",13),e.YNc(15,_i,2,0,"span",13),e.YNc(16,oi,2,0,"span",13),e.qZA()(),e.TgZ(17,"div",8)(18,"label",158),e.SDv(19,159),e.qZA(),e.TgZ(20,"div",11),e._UZ(21,"input",160),e.YNc(22,ti,2,0,"span",13),e.YNc(23,ii,2,0,"span",13),e.YNc(24,ni,2,0,"span",13),e.qZA()(),e.TgZ(25,"div",8)(26,"label",161),e.SDv(27,162),e.qZA(),e.TgZ(28,"div",11),e._UZ(29,"input",163),e.YNc(30,si,2,0,"span",13),e.qZA()()()),2&o){e.oxw(2);const _=e.MAs(2),t=e.oxw();e.xp6(6),e.Q6J("ngIf",!t.info.compression_algorithms),e.xp6(1),e.Q6J("ngIf",t.info.compression_algorithms&&0===t.info.compression_algorithms.length),e.xp6(1),e.Q6J("ngForOf",t.info.compression_algorithms),e.xp6(6),e.Q6J("ngIf",t.form.showError("minBlobSize",_,"min")),e.xp6(1),e.Q6J("ngIf",t.form.showError("minBlobSize",_,"maximum")),e.xp6(1),e.Q6J("ngIf",t.form.showError("minBlobSize",_,"pattern")),e.xp6(6),e.Q6J("ngIf",t.form.showError("maxBlobSize",_,"min")),e.xp6(1),e.Q6J("ngIf",t.form.showError("maxBlobSize",_,"minimum")),e.xp6(1),e.Q6J("ngIf",t.form.showError("maxBlobSize",_,"pattern")),e.xp6(6),e.Q6J("ngIf",t.form.showError("ratio",_,"min")||t.form.showError("ratio",_,"max"))}}function li(o,i){if(1&o&&(e.TgZ(0,"div",147)(1,"legend"),e.SDv(2,148),e.qZA(),e.TgZ(3,"div",8)(4,"label",149),e.SDv(5,150),e.qZA(),e.TgZ(6,"div",11)(7,"select",151),e.YNc(8,Bt,2,2,"option",19),e.qZA()()(),e.YNc(9,ai,31,10,"div",20),e.qZA()),2&o){const _=e.oxw(2);e.xp6(8),e.Q6J("ngForOf",_.info.compression_modes),e.xp6(1),e.Q6J("ngIf",_.hasCompressionEnabled())}}function ri(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,173),e.qZA())}function ci(o,i){1&o&&(e.TgZ(0,"span",42),e.SDv(1,174),e.qZA())}function Oi(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"div",1)(1,"form",2,3)(3,"div",4)(4,"div",5),e.SDv(5,6),e.ALo(6,"titlecase"),e.ALo(7,"upperFirst"),e.qZA(),e.TgZ(8,"div",7)(9,"div",8)(10,"label",9),e.SDv(11,10),e.qZA(),e.TgZ(12,"div",11),e._UZ(13,"input",12),e.YNc(14,Yo,2,0,"span",13),e.YNc(15,Bo,2,0,"span",13),e.YNc(16,jo,2,0,"span",13),e.YNc(17,Ko,2,0,"span",13),e.qZA()(),e.TgZ(18,"div",8)(19,"label",14),e.SDv(20,15),e.qZA(),e.TgZ(21,"div",11)(22,"select",16)(23,"option",17),e.SDv(24,18),e.qZA(),e.YNc(25,Wo,2,2,"option",19),e.qZA(),e.YNc(26,et,2,0,"span",13),e.qZA()(),e.YNc(27,dt,10,4,"div",20),e.TgZ(28,"div",8)(29,"label",21),e.SDv(30,22),e.qZA(),e.TgZ(31,"div",11)(32,"cd-select-badges",23),e.NdJ("selection",function(){e.CHM(_);const n=e.oxw();return e.KtG(n.appSelection())}),e.qZA(),e.YNc(33,ut,1,3,"i",24),e.qZA()(),e.YNc(34,Pt,9,0,"div",25),e.YNc(35,Yt,6,3,"div",20),e.YNc(36,li,10,2,"div",26),e.TgZ(37,"div")(38,"legend"),e.SDv(39,27),e.qZA(),e.TgZ(40,"div",8)(41,"label",28),e.ynx(42),e.SDv(43,29),e.BQk(),e.TgZ(44,"cd-helper")(45,"span"),e.SDv(46,30),e.qZA(),e._UZ(47,"br"),e.TgZ(48,"span"),e.SDv(49,31),e.qZA()()(),e.TgZ(50,"div",11),e._UZ(51,"input",32),e.YNc(52,ri,2,0,"span",13),e.qZA()(),e.TgZ(53,"div",8)(54,"label",33),e.ynx(55),e.SDv(56,34),e.BQk(),e.TgZ(57,"cd-helper")(58,"span"),e.SDv(59,35),e.qZA(),e._UZ(60,"br"),e.TgZ(61,"span"),e.SDv(62,36),e.qZA()()(),e.TgZ(63,"div",11),e._UZ(64,"input",37),e.YNc(65,ci,2,0,"span",13),e.qZA()()(),e.TgZ(66,"div",38)(67,"cd-rbd-configuration-form",39),e.NdJ("changes",function(n){e.CHM(_);const s=e.oxw();return e.KtG(s.currentConfigurationValues=n())}),e.qZA()()(),e.TgZ(68,"div",40)(69,"cd-form-button-panel",41),e.NdJ("submitActionEvent",function(){e.CHM(_);const n=e.oxw();return e.KtG(n.submit())}),e.ALo(70,"titlecase"),e.ALo(71,"upperFirst"),e.qZA()()()()()}if(2&o){const _=e.MAs(2),t=e.oxw();e.xp6(1),e.Q6J("formGroup",t.form),e.xp6(6),e.pQV(e.lcZ(6,27,t.action))(e.lcZ(7,29,t.resource)),e.QtT(5),e.xp6(7),e.Q6J("ngIf",t.form.showError("name",_,"required")),e.xp6(1),e.Q6J("ngIf",t.form.showError("name",_,"uniqueName")),e.xp6(1),e.Q6J("ngIf",t.form.showError("name",_,"rbdPool")),e.xp6(1),e.Q6J("ngIf",t.form.showError("name",_,"pattern")),e.xp6(8),e.Q6J("ngForOf",t.data.poolTypes),e.xp6(1),e.Q6J("ngIf",t.form.showError("poolType",_,"required")),e.xp6(1),e.Q6J("ngIf",t.isReplicated||t.isErasure),e.xp6(5),e.Q6J("customBadges",!0)("customBadgeValidators",t.data.applications.validators)("messages",t.data.applications.messages)("data",t.data.applications.selected)("options",t.data.applications.available)("selectionLimit",4),e.xp6(1),e.Q6J("ngIf",t.data.applications.selected<=0),e.xp6(1),e.Q6J("ngIf",t.data.applications.selected.includes("rbd")),e.xp6(1),e.Q6J("ngIf",t.isErasure||t.isReplicated),e.xp6(1),e.Q6J("ngIf",t.info.is_all_bluestore),e.xp6(16),e.Q6J("ngIf",t.form.showError("max_bytes",_,"pattern")),e.xp6(13),e.Q6J("ngIf",t.form.showError("max_objects",_,"min")),e.xp6(1),e.Q6J("hidden",t.isErasure||-1===t.data.applications.selected.indexOf("rbd")),e.xp6(1),e.Q6J("form",t.form)("initializeData",t.initializeConfigData),e.xp6(2),e.Q6J("form",t.form)("submitText",e.lcZ(70,31,t.action)+" "+e.lcZ(71,33,t.resource))}}let we=(()=>{class o extends L_.E{constructor(_,t,n,s,c,d,P,p,R,S,T,m){super(),this.dimlessBinaryPipe=_,this.route=t,this.router=n,this.modalService=s,this.poolService=c,this.authStorageService=d,this.formatter=P,this.taskWrapper=p,this.ecpService=R,this.crushRuleService=S,this.actionLabels=T,this.rbdMirroringService=m,this.editing=!1,this.isReplicated=!1,this.isErasure=!1,this.data=new Uo,this.externalPgChange=!1,this.current={rules:[]},this.initializeConfigData=new h_.t(1),this.currentConfigurationValues={},this.icons=v.P,this.crushUsage=void 0,this.ecpUsage=void 0,this.crushRuleMaxSize=10,this.msrCrush=!1,this.editing=this.router.url.startsWith(`/pool/${h.MQ.EDIT}`),this.action=this.editing?this.actionLabels.EDIT:this.actionLabels.CREATE,this.resource="pool",this.authenticate(),this.createForm()}authenticate(){if(this.permission=this.authStorageService.getPermissions().pool,!this.permission.read||!this.permission.update&&this.editing||!this.permission.create&&!this.editing)throw new S_._2}createForm(){const _=new xe.d({mode:new l.p4("none"),algorithm:new l.p4(""),minBlobSize:new l.p4("",{updateOn:"blur"}),maxBlobSize:new l.p4("",{updateOn:"blur"}),ratio:new l.p4("",{updateOn:"blur"})});this.form=new xe.d({name:new l.p4("",{validators:[l.kI.pattern(/^[.A-Za-z0-9_/-]+$/),l.kI.required,u.hq.custom("rbdPool",()=>this.form&&this.form.getValue("name").includes("/")&&this.data&&-1!==this.data.applications.selected.indexOf("rbd"))]}),poolType:new l.p4("",{validators:[l.kI.required]}),crushRule:new l.p4(null,{validators:[u.hq.custom("tooFewOsds",t=>this.info&&t&&this.info.osd_count<1),u.hq.custom("required",t=>this.isReplicated&&this.info.crush_rules_replicated.length>0&&!t)]}),size:new l.p4("",{updateOn:"blur"}),erasureProfile:new l.p4(null),pgNum:new l.p4("",{validators:[l.kI.required]}),pgAutoscaleMode:new l.p4(null),ecOverwrites:new l.p4(!1),compression:_,max_bytes:new l.p4(""),max_objects:new l.p4(0),rbdMirroring:new l.p4(!1)},[u.hq.custom("form",()=>null)])}ngOnInit(){this.poolService.getInfo().subscribe(_=>{this.initInfo(_),this.editing?this.initEditMode():(this.setAvailableApps(),this.loadingReady()),this.listenToChanges(),this.setComplexValidators()}),this.erasureProfileChange()}initInfo(_){this.pgAutoscaleModes=_.pg_autoscale_modes,this.form.silentSet("pgAutoscaleMode",_.pg_autoscale_default_mode),this.form.silentSet("algorithm",_.bluestore_compression_algorithm),this.info=_,this.initEcp(_.erasure_code_profiles)}initEcp(_){this.setListControlStatus("erasureProfile",_),this.ecProfiles=_}setListControlStatus(_,t){const n=this.form.get(_),s=n.value;1!==t.length||s&&f().isEqual(s,t[0])?0===t.length&&s&&n.setValue(null):n.setValue(t[0]),t.length<=1?n.enabled&&n.disable():n.disabled&&n.enable()}initEditMode(){this.disableForEdit(),this.routeParamsSubscribe=this.route.params.subscribe(_=>this.poolService.get(_.name).subscribe(t=>{this.data.pool=t,this.initEditFormData(t),this.loadingReady()}))}disableForEdit(){["poolType","crushRule","size","erasureProfile","ecOverwrites"].forEach(_=>this.form.get(_).disable())}initEditFormData(_){this.initializeConfigData.next({initialData:_.configuration,sourceType:A_.h.pool}),this.poolTypeChange(_.type);const t=this.info.crush_rules_replicated.concat(this.info.crush_rules_erasure),n={name:_.pool_name,poolType:_.type,crushRule:t.find(s=>s.rule_name===_.crush_rule),size:_.size,erasureProfile:this.ecProfiles.find(s=>s.name===_.erasure_code_profile),pgAutoscaleMode:_.pg_autoscale_mode,pgNum:_.pg_num,ecOverwrites:_.flags_names.includes("ec_overwrites"),mode:_.options.compression_mode,algorithm:_.options.compression_algorithm,minBlobSize:this.dimlessBinaryPipe.transform(_.options.compression_min_blob_size),maxBlobSize:this.dimlessBinaryPipe.transform(_.options.compression_max_blob_size),ratio:_.options.compression_required_ratio,max_bytes:this.dimlessBinaryPipe.transform(_.quota_max_bytes),max_objects:_.quota_max_objects};Object.keys(n).forEach(s=>{const c=n[s];!f().isUndefined(c)&&""!==c&&this.form.silentSet(s,c)}),this.data.pgs=this.form.getValue("pgNum"),this.setAvailableApps(this.data.applications.default.concat(_.application_metadata)),this.data.applications.selected=_.application_metadata,this.rbdMirroringService.getPool(_.pool_name).subscribe(s=>{this.form.get("rbdMirroring").setValue("pool"===s.mirror_mode)})}setAvailableApps(_=this.data.applications.default){this.data.applications.available=f().uniq(_.sort()).map(t=>new T_.$(!1,t,""))}listenToChanges(){this.listenToChangesDuringAddEdit(),this.editing||this.listenToChangesDuringAdd()}listenToChangesDuringAddEdit(){this.form.get("pgNum").valueChanges.subscribe(_=>{const t=_-this.data.pgs;1===Math.abs(t)&&2!==_?this.doPgPowerJump(t):this.data.pgs=_})}doPgPowerJump(_){const t=this.calculatePgPower()+_;this.setPgs(-1===_?Math.round(t):Math.floor(t))}calculatePgPower(_=this.form.getValue("pgNum")){return Math.log(_)/Math.log(2)}setPgs(_){const t=Math.pow(2,_<0?0:_);this.data.pgs=t,this.form.silentSet("pgNum",t)}listenToChangesDuringAdd(){this.form.get("poolType").valueChanges.subscribe(_=>{this.poolTypeChange(_)}),this.form.get("crushRule").valueChanges.subscribe(_=>{this.crushDeletionBtn&&this.crushDeletionBtn.isOpen()&&this.crushDeletionBtn.close(),_&&(this.setCorrectMaxSize(_),this.crushRuleIsUsedBy(_.rule_name),this.replicatedRuleChange(),this.pgCalc())}),this.form.get("size").valueChanges.subscribe(()=>{this.pgCalc()}),this.form.get("erasureProfile").valueChanges.subscribe(_=>{this.ecpDeletionBtn&&this.ecpDeletionBtn.isOpen()&&this.ecpDeletionBtn.close(),_&&(this.ecpIsUsedBy(_.name),this.pgCalc())}),this.form.get("mode").valueChanges.subscribe(()=>{["minBlobSize","maxBlobSize","ratio"].forEach(_=>{this.form.get(_).updateValueAndValidity({emitEvent:!1})})}),this.form.get("minBlobSize").valueChanges.subscribe(()=>{this.form.get("maxBlobSize").updateValueAndValidity({emitEvent:!1})}),this.form.get("maxBlobSize").valueChanges.subscribe(()=>{this.form.get("minBlobSize").updateValueAndValidity({emitEvent:!1})})}poolTypeChange(_){if("replicated"===_?this.setTypeBooleans(!0,!1):this.setTypeBooleans(!1,"erasure"===_),!_||!this.info)return void(this.current.rules=[]);const t=this.info["crush_rules_"+_]||[];this.current.rules=t,!this.editing&&(this.isReplicated&&this.setListControlStatus("crushRule",t),this.replicatedRuleChange(),this.pgCalc())}setTypeBooleans(_,t){this.isReplicated=_,this.isErasure=t}replicatedRuleChange(){if(!this.isReplicated)return;const _=this.form.get("size");let t=this.form.getValue("size")||3;const n=this.getMinSize(),s=this.getMaxSize();t<n?t=n:t>s&&(t=s),t!==_.value&&this.form.silentSet("size",t)}getMinSize(){return!this.info||this.info.osd_count<1?0:1}getMaxSize(){const _=this.form.getValue("crushRule");return this.info?_?_.usable_size:Math.min(this.info.osd_count,3):0}pgCalc(){const _=this.form.getValue("poolType");if(!this.info||this.form.get("pgNum").dirty||!_)return;const t=100*this.info.osd_count,n=this.isReplicated?this.replicatedPgCalc(t):this.erasurePgCalc(t);if(!n)return;const s=this.data.pgs;this.alignPgs(n),this.externalPgChange||(this.externalPgChange=s!==this.data.pgs)}setCorrectMaxSize(_=this.form.getValue("crushRule")){if(!_)return;const n=L.searchFailureDomains(this.info.nodes,_.steps[0].item_name)[_.steps[1].type];_.usable_size=Math.min(n?n.length:this.crushRuleMaxSize,this.crushRuleMaxSize)}replicatedPgCalc(_){const t=this.form.get("size"),n=t.value;return t.valid&&n>0?_/n:0}erasurePgCalc(_){const t=this.form.get("erasureProfile"),n=t.value;return(t.valid||t.disabled)&&n?_/(n.k+n.m):0}alignPgs(_=this.form.getValue("pgNum")){this.setPgs(Math.round(this.calculatePgPower(_<1?1:_)))}setComplexValidators(){this.editing?this.form.get("name").setValidators([this.form.get("name").validator,u.hq.custom("uniqueName",_=>this.data.pool&&this.info&&-1!==this.info.pool_names.indexOf(_)&&this.info.pool_names.indexOf(_)!==this.info.pool_names.indexOf(this.data.pool.pool_name))]):(u.hq.validateIf(this.form.get("size"),()=>this.isReplicated,[u.hq.custom("min",_=>this.form.getValue("size")&&_<this.getMinSize()),u.hq.custom("max",_=>this.form.getValue("size")&&this.getMaxSize()<_)]),this.form.get("name").setValidators([this.form.get("name").validator,u.hq.custom("uniqueName",_=>this.info&&-1!==this.info.pool_names.indexOf(_))])),this.setCompressionValidators()}setCompressionValidators(){u.hq.validateIf(this.form.get("minBlobSize"),()=>this.hasCompressionEnabled(),[l.kI.min(0),u.hq.custom("maximum",_=>this.oddBlobSize(_,this.form.getValue("maxBlobSize")))]),u.hq.validateIf(this.form.get("maxBlobSize"),()=>this.hasCompressionEnabled(),[l.kI.min(0),u.hq.custom("minimum",_=>this.oddBlobSize(this.form.getValue("minBlobSize"),_))]),u.hq.validateIf(this.form.get("ratio"),()=>this.hasCompressionEnabled(),[l.kI.min(0),l.kI.max(1)])}oddBlobSize(_,t){const n=this.formatter.toBytes(_),s=this.formatter.toBytes(t);return Boolean(n&&s&&n>=s)}hasCompressionEnabled(){return this.form.getValue("mode")&&"none"!==this.form.get("mode").value.toLowerCase()}describeCrushStep(_){return[_.op.replace("_"," "),_.item_name||"",_.type?_.num+" type "+_.type:""].join(" ")}addErasureCodeProfile(){this.addModal(Zo,_=>this.reloadECPs(_))}addModal(_,t){this.hideOpenTooltips(),this.modalService.show(_).componentInstance.submitAction.subscribe(s=>{t(s.name)})}hideOpenTooltips(){const _=t=>t&&t.isOpen()&&t.close();_(this.ecpDeletionBtn),_(this.crushDeletionBtn)}reloadECPs(_){this.reloadList({newItemName:_,getInfo:()=>this.ecpService.list(),initInfo:t=>this.initEcp(t),findNewItem:()=>this.ecProfiles.find(t=>t.name===_),controlName:"erasureProfile"})}reloadList({newItemName:_,getInfo:t,initInfo:n,findNewItem:s,controlName:c}){this.modalSubscription&&this.modalSubscription.unsubscribe(),t().subscribe(d=>{if(n(d),!_)return;const P=s();P&&this.form.get(c).setValue(P)})}deleteErasureCodeProfile(){this.deletionModal({value:this.form.getValue("erasureProfile"),usage:this.ecpUsage,deletionBtn:this.ecpDeletionBtn,dataName:"erasureInfo",getTabs:()=>this.ecpInfoTabs,tabPosition:"used-by-pools",nameAttribute:"name",itemDescription:"erasure code profile",reloadFn:()=>this.reloadECPs(),deleteFn:_=>this.ecpService.delete(_),taskName:"ecp/delete"})}deletionModal({value:_,usage:t,deletionBtn:n,dataName:s,getTabs:c,tabPosition:d,nameAttribute:P,itemDescription:p,reloadFn:R,deleteFn:S,taskName:T}){if(!_)return;if(t)return n.animation=!1,n.toggle(),this.data[s]=!0,void setTimeout(()=>{const C=c();C&&C.select(d)},50);const m=_[P];this.modalService.show(Ie.M,{itemDescription:p,itemNames:[m],submitActionObservable:()=>{const C=S(m);return C.subscribe(()=>R()),this.taskWrapper.wrapTaskAroundCall({task:new D.R(T,{name:m}),call:C})}})}addCrushRule(){this.addModal(H_,_=>this.reloadCrushRules(_))}reloadCrushRules(_){this.reloadList({newItemName:_,getInfo:()=>this.poolService.getInfo(),initInfo:t=>{this.initInfo(t),this.poolTypeChange("replicated")},findNewItem:()=>this.info.crush_rules_replicated.find(t=>t.rule_name===_),controlName:"crushRule"})}deleteCrushRule(){this.deletionModal({value:this.form.getValue("crushRule"),usage:this.crushUsage,deletionBtn:this.crushDeletionBtn,dataName:"crushInfo",getTabs:()=>this.crushInfoTabs,tabPosition:"used-by-pools",nameAttribute:"rule_name",itemDescription:"crush rule",reloadFn:()=>this.reloadCrushRules(),deleteFn:_=>this.crushRuleService.delete(_),taskName:"crushRule/delete"})}crushRuleIsUsedBy(_){this.crushUsage=_?this.info.used_rules[_]:void 0}ecpIsUsedBy(_){this.ecpUsage=_?this.info.used_profiles[_]:void 0}submit(){if(this.form.invalid)return void this.form.setErrors({cdSubmitButton:!0});const _={pool:this.form.getValue("name")};this.assignFormFields(_,[{externalFieldName:"pool_type",formControlName:"poolType"},{externalFieldName:"pg_autoscale_mode",formControlName:"pgAutoscaleMode",editable:!0},{externalFieldName:"pg_num",formControlName:"pgNum",replaceFn:n=>"on"===this.form.getValue("pgAutoscaleMode")?1:n,editable:!0},this.isReplicated?{externalFieldName:"size",formControlName:"size"}:{externalFieldName:"erasure_code_profile",formControlName:"erasureProfile",attr:"name"},{externalFieldName:"rule_name",formControlName:"crushRule",replaceFn:n=>this.isReplicated?n&&n.rule_name:void 0},{externalFieldName:"quota_max_bytes",formControlName:"max_bytes",replaceFn:this.formatter.toBytes,editable:!0,resetValue:this.editing?0:void 0},{externalFieldName:"quota_max_objects",formControlName:"max_objects",editable:!0,resetValue:this.editing?0:void 0},this.data.applications.selected.includes("rbd")?{externalFieldName:"rbd_mirroring",formControlName:"rbdMirroring"}:{externalFieldName:"rbd_mirroring",formControlName:"rbdMirroring",resetValue:void 0}]),this.info.is_all_bluestore&&(this.assignFormField(_,{externalFieldName:"flags",formControlName:"ecOverwrites",replaceFn:()=>this.isErasure?["ec_overwrites"]:void 0}),"none"!==this.form.getValue("mode")?this.assignFormFields(_,[{externalFieldName:"compression_mode",formControlName:"mode",editable:!0,replaceFn:n=>this.hasCompressionEnabled()&&n},{externalFieldName:"compression_algorithm",formControlName:"algorithm",editable:!0},{externalFieldName:"compression_min_blob_size",formControlName:"minBlobSize",replaceFn:this.formatter.toBytes,editable:!0,resetValue:0},{externalFieldName:"compression_max_blob_size",formControlName:"maxBlobSize",replaceFn:this.formatter.toBytes,editable:!0,resetValue:0},{externalFieldName:"compression_required_ratio",formControlName:"ratio",editable:!0,resetValue:0}]):this.editing&&this.assignFormFields(_,[{externalFieldName:"compression_mode",formControlName:"mode",editable:!0,replaceFn:()=>"unset"},{externalFieldName:"srcpool",formControlName:"name",editable:!0,replaceFn:()=>this.data.pool.pool_name}]));const t=this.data.applications.selected;(t.length>0||this.editing)&&(_.application_metadata=t,t.includes("rbd")&&(_.rbd_mirroring=this.form.getValue("rbdMirroring"))),this.isReplicated&&!f().isEmpty(this.currentConfigurationValues)&&(_.configuration=this.currentConfigurationValues),this.triggerApiTask(_)}assignFormFields(_,t){t.forEach(n=>this.assignFormField(_,n))}assignFormField(_,{externalFieldName:t,formControlName:n,attr:s,replaceFn:c,editable:d,resetValue:P}){if(this.editing&&(!d||this.form.get(n).pristine))return;const p=this.form.getValue(n);let R=c?c(p):s?f().get(p,s):p;if(!p||!R){if(!d||f().isUndefined(P))return;R=P}_[t]=R}triggerApiTask(_){const t=_.hasOwnProperty("srcpool")?_.srcpool:_.pool;this.taskWrapper.wrapTaskAroundCall({task:new D.R("pool/"+(this.editing?h.MQ.EDIT:h.MQ.CREATE),{pool_name:t}),call:this.poolService[this.editing?h.MQ.UPDATE:h.MQ.CREATE](_)}).subscribe({error:n=>{f().isObject(n.error)&&"34"===n.error.code&&this.form.get("pgNum").setErrors({34:!0}),this.form.setErrors({cdSubmitButton:!0})},complete:()=>this.router.navigate(["/pool"])})}appSelection(){this.form.get("name").updateValueAndValidity({emitEvent:!1,onlySelf:!0})}erasureProfileChange(){const _=this.form.get("erasureProfile").value;_&&(this.msrCrush=_["crush-num-failure-domains"]>0||_["crush-osds-per-failure-domain"]>0)}}return o.\u0275fac=function(_){return new(_||o)(e.Y36(F_.$),e.Y36(fe.gz),e.Y36(fe.F0),e.Y36(He.Z),e.Y36(pe.q),e.Y36(qe.j),e.Y36(N_.H),e.Y36(ge.P),e.Y36(Fe),e.Y36(ye.H),e.Y36(h.p4),e.Y36(Go.d))},o.\u0275cmp=e.Xpm({type:o,selectors:[["cd-pool-form"]],viewQuery:function(_,t){if(1&_&&(e.Gf(Qo,5),e.Gf(Jo,5),e.Gf(ko,5),e.Gf(Vo,5)),2&_){let n;e.iGM(n=e.CRH())&&(t.crushInfoTabs=n.first),e.iGM(n=e.CRH())&&(t.crushDeletionBtn=n.first),e.iGM(n=e.CRH())&&(t.ecpInfoTabs=n.first),e.iGM(n=e.CRH())&&(t.ecpDeletionBtn=n.first)}},features:[e.qOj],decls:1,vars:1,consts:function(){let i,_,t,n,s,c,d,P,p,R,S,T,m,C,g,$,I,x,Z,y,U,G,H,q,z,X,w,Q,J,k,V,Y,B,j,K,W,ee,_e,N,oe,te,ie,ne,se,ae,le,re,ce,Oe,de,ue,Pe,b,Ee,O,Ye,Be,je,Ke,We,e_,__,o_,t_,i_,n_,s_,a_,l_,r_,c_,O_,d_,u_,P_,E_,f_,g_,p_;return i="\n          " + "\ufffd0\ufffd" + "\n          " + "\ufffd1\ufffd" + "\n        ",_="Name",t="Name...",n="Pool type",s="-- Select a pool type --",c="Applications",d="Pools should be associated with an application tag",P="Quotas",p="Max bytes",R="Leave it blank or specify 0 to disable this quota.",S="A valid quota should be greater than 0.",T="e.g., 10GiB",m="Max objects",C="Leave it blank or specify 0 to disable this quota.",g="A valid quota should be greater than 0.",$="This field is required!",I="The chosen Ceph pool name is already in use.",x="It's not possible to create an RBD pool with '/' in the name. Please change the name or remove 'rbd' from the applications list.",Z="Pool name can only contain letters, numbers, '.', '-', '_' or '/'.",y="This field is required!",U="PG Autoscale",G="Placement groups",H="Calculation help",q="This field is required!",z="At least one placement group is needed!",X="Your cluster can't handle this many PGs. Please recalculate the PG amount needed.",w="The current PGs settings were calculated for you, you should make sure the values suit your needs before submit.",Q="Replicated size",J="Minimum: \n          " + "\ufffd0\ufffd" + "\n        ",k="Maximum: \n          " + "\ufffd0\ufffd" + "\n        ",V="The size specified is out of range. A value from \n          " + "\ufffd0\ufffd" + " to \n          " + "\ufffd1\ufffd" + " is usable.\n        ",Y="A size of 1 will not create a replication of the object. The 'Replicated size' includes the object itself.",B="Flags",j="EC Overwrites",K="Mirroring",W="Check this option to enable Pool based mirroring on a Block(RBD) pool.",ee="CRUSH",_e="Erasure code profile",N="This profile can't be deleted as it is in use.",oe="Loading...",te="-- No erasure code profile available --",ie="-- Select an erasure code profile --",ne="Profile",se="Used by pools",ae="Profile is not in use.",le="Crush ruleset",re="A new crush ruleset will be implicitly created.",ce="A new crush MSR ruleset will be implicitly created. When crush-osds-per-failure-domain or crush-num-failure-domains is specified",Oe="Crush ruleset",de="There are no rules.",ue="-- Select a crush rule --",Pe="Placement and\n                          replication strategies or distribution policies that allow to\n                          specify how CRUSH places data replicas.",b="This rule can't be deleted as it is in use.",Ee="Crush rule",O="Crush steps",Ye="Used by pools",Be="Rule is not in use.",je="This field is required!",Ke="The rule can't be used in the current cluster as it has too few OSDs to meet the minimum required OSD by this rule.",We="Compression",e_="Mode",__="Algorithm",o_="Minimum blob size",t_="e.g., 128KiB",i_="Maximum blob size",n_="e.g., 512KiB",s_="Ratio",a_="Compression ratio",l_="Loading...",r_="-- No erasure compression algorithm available --",c_="Value should be greater than 0",O_="Value should be less than the maximum blob size",d_="Size must be a number or in a valid format. eg: 5 GiB",u_="Value should be greater than 0",P_="Value should be greater than the minimum blob size",E_="Size must be a number or in a valid format. eg: 5 GiB",f_="Value should be between 0.0 and 1.0",g_="Size must be a number or in a valid format. eg: 5 GiB",p_="The value should be greater or equal to 0",[["class","cd-col-form",4,"cdFormLoading"],[1,"cd-col-form"],["name","form","novalidate","",3,"formGroup"],["formDir","ngForm"],[1,"card"],[1,"card-header"],i,[1,"card-body"],[1,"form-group","row"],["for","name",1,"cd-col-form-label","required"],_,[1,"cd-col-form-input"],["id","name","name","name","type","text","placeholder",t,"formControlName","name","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","poolType",1,"cd-col-form-label","required"],n,["id","poolType","formControlName","poolType","name","poolType",1,"form-select"],["ngValue",""],s,[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["for","applications",1,"cd-col-form-label"],c,["id","applications",3,"customBadges","customBadgeValidators","messages","data","options","selectionLimit","selection"],["title",d,3,"class",4,"ngIf"],["class","form-group row",4,"ngIf"],["formGroupName","compression",4,"ngIf"],P,["for","max_bytes",1,"cd-col-form-label"],p,R,S,["id","max_bytes","name","max_bytes","type","text","formControlName","max_bytes","placeholder",T,"defaultUnit","GiB","cdDimlessBinary","",1,"form-control"],["for","max_objects",1,"cd-col-form-label"],m,C,g,["id","max_objects","min","0","name","max_objects","type","number","formControlName","max_objects",1,"form-control"],[3,"hidden"],[3,"form","initializeData","changes"],[1,"card-footer"],["wrappingClass","text-right",3,"form","submitText","submitActionEvent"],[1,"invalid-feedback"],$,I,x,Z,[3,"value"],y,["for","pgAutoscaleMode",1,"cd-col-form-label"],U,["id","pgAutoscaleMode","name","pgAutoscaleMode","formControlName","pgAutoscaleMode",1,"form-select"],["for","pgNum",1,"cd-col-form-label","required"],G,["id","pgNum","name","pgNum","formControlName","pgNum","min","1","type","number","required","",1,"form-control",3,"focus","blur"],[1,"form-text","text-muted"],["section","pgs","docText",H],["class","form-text text-muted",4,"ngIf"],q,z,X,w,["for","size",1,"cd-col-form-label","required"],Q,["id","size","name","size","type","number","formControlName","size",1,"form-control",3,"max","min"],["class","text-warning-dark",4,"ngIf"],[1,"list-inline"],J,k,V,[1,"text-warning-dark"],Y,[1,"cd-col-form-label"],B,[1,"custom-control","custom-checkbox"],["type","checkbox","id","ec-overwrites","formControlName","ecOverwrites",1,"custom-control-input"],["for","ec-overwrites",1,"custom-control-label"],j,["title",d],[1,"cd-col-form-offset"],["id","rbdMirroring","name","rbdMirroring","type","checkbox","formControlName","rbdMirroring",1,"custom-control-input"],["for","rbdMirroring",1,"custom-control-label"],K,W,ee,["for","erasureProfile",1,"cd-col-form-label"],_e,[1,"input-group","mb-1"],["id","erasureProfile","name","erasureProfile","formControlName","erasureProfile",1,"form-select",3,"change"],["ngValue","",4,"ngIf"],[3,"ngValue",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],["id","ecp-info-button","type","button",1,"btn","btn-light",3,"ngClass","click"],["aria-hidden","true",3,"ngClass"],["class","btn btn-light","type","button",3,"click",4,"ngIf"],["class","btn btn-light","type","button","ngbTooltip",N,"triggers","manual",3,"click",4,"ngIf"],["class","form-text text-muted","id","ecp-info-block",4,"ngIf"],oe,[3,"ngValue"],te,ie,["type","button",1,"btn","btn-light",3,"click"],["type","button","ngbTooltip",N,"triggers","manual",1,"btn","btn-light",3,"click"],["ecpDeletionBtn","ngbTooltip"],["id","ecp-info-block",1,"form-text","text-muted"],["ngbNav","",1,"nav-tabs"],["ecpInfoTabs","ngbNav"],["ngbNavItem","ecp-info"],["ngbNavLink",""],ne,["ngbNavContent",""],["ngbNavItem","used-by-pools"],se,[3,"ngbNavOutlet"],[3,"renderObjects","hideKeys","data","autoReload"],["ecpIsNotUsed",""],[4,"ngIf","ngIfElse"],ae,[4,"ngFor","ngForOf"],["for","crushRule",1,"cd-col-form-label"],le,["class","form-text text-muted",4,"ngIf","ngIfElse"],["msrCrushText",""],re,ce,Oe,["noRules",""],de,[1,"input-group"],["id","crushRule","formControlName","crushRule","name","crushSet",1,"form-select"],ue,["id","crush-info-button","type","button","ngbTooltip",Pe,1,"btn","btn-light",3,"ngClass","click"],["class","btn btn-light","type","button","ngbTooltip",b,"triggers","manual",3,"click",4,"ngIf"],["class","form-text text-muted","id","crush-info-block",4,"ngIf"],["type","button","ngbTooltip",b,"triggers","manual",1,"btn","btn-light",3,"click"],["crushDeletionBtn","ngbTooltip"],["id","crush-info-block",1,"form-text","text-muted"],["crushInfoTabs","ngbNav"],["ngbNavItem","crush-rule-info"],Ee,["ngbNavItem","crush-rule-steps"],O,Ye,["ruleIsNotUsed",""],Be,je,Ke,["formGroupName","compression"],We,["for","mode",1,"cd-col-form-label"],e_,["id","mode","name","mode","formControlName","mode",1,"form-select"],["for","algorithm",1,"cd-col-form-label"],__,["id","algorithm","name","algorithm","formControlName","algorithm",1,"form-select"],["for","minBlobSize",1,"cd-col-form-label"],o_,["id","minBlobSize","name","minBlobSize","formControlName","minBlobSize","type","text","min","0","placeholder",t_,"defaultUnit","KiB","cdDimlessBinary","",1,"form-control"],["for","maxBlobSize",1,"cd-col-form-label"],i_,["id","maxBlobSize","type","text","min","0","formControlName","maxBlobSize","placeholder",n_,"defaultUnit","KiB","cdDimlessBinary","",1,"form-control"],["for","ratio",1,"cd-col-form-label"],s_,["id","ratio","name","ratio","formControlName","ratio","type","number","min","0","max","1","step","0.1","placeholder",a_,1,"form-control"],l_,r_,c_,O_,d_,u_,P_,E_,f_,g_,p_]},template:function(_,t){1&_&&e.YNc(0,Oi,72,35,"div",0),2&_&&e.Q6J("cdFormLoading",t.loading)},dependencies:[M.mk,M.sg,M.O5,E.uN,E.Pz,E.nv,E.Vx,E.tO,E.Dy,Re.S,Ho.m,qo.K,me.p,Ce.t,ze.b,Me.U,zo.Q,Xo.y,he.o,Se.b,Te.P,Le.V,l._Y,l.YN,l.Kr,l.Fj,l.wV,l.Wl,l.EJ,l.JJ,l.JL,l.Q7,l.qQ,l.Fd,l.sg,l.u,l.x0,E._L,wo.d,M.rS,Ae.m],styles:[".icon-warning-color[_ngcontent-%COMP%]{margin-left:3px}"]}),o})();var di=r(19773),ui=r(20687),Pi=r(68136),Ne=r(69158),be=r(83697),A=r(99466),Ei=r(91801),fi=r(68774),gi=r(66369),Qe=r(38047),ve=r(51847);class pi{constructor(i){this.pool_name=i}}var Ri=r(64724),mi=r(60251),Je=r(76317),Ci=r(94928),Mi=r(23240),ke=r(51295),hi=r(59376),Si=r(42176);function Ti(o,i){if(1&o&&e._UZ(0,"cd-table-key-value",12),2&o){const _=e.oxw(2);e.Q6J("renderObjects",!0)("data",_.poolDetails)("autoReload",!1)}}function Li(o,i){if(1&o&&e._UZ(0,"cd-grafana",15),2&o){const _=e.oxw(3);e.MGl("grafanaPath","ceph-pool-detail?var-pool_name=",_.selection.pool_name,""),e.Q6J("type","metrics")}}function Ai(o,i){1&o&&(e.ynx(0,13),e.TgZ(1,"a",5),e.SDv(2,14),e.qZA(),e.YNc(3,Li,1,2,"ng-template",7),e.BQk())}function Fi(o,i){if(1&o&&e._UZ(0,"cd-rbd-configuration-table",18),2&o){const _=e.oxw(3);e.Q6J("data",_.selectedPoolConfiguration)}}function Ni(o,i){1&o&&(e.ynx(0,16),e.TgZ(1,"a",5),e.SDv(2,17),e.qZA(),e.YNc(3,Fi,1,1,"ng-template",7),e.BQk())}function bi(o,i){if(1&o&&e._UZ(0,"cd-table",21),2&o){const _=e.oxw(3);e.Q6J("data",_.cacheTiers)("columns",_.cacheTierColumns)("autoSave",!1)}}function vi(o,i){1&o&&(e.ynx(0,19),e.TgZ(1,"a",5),e.SDv(2,20),e.qZA(),e.YNc(3,bi,1,3,"ng-template",7),e.BQk())}function Di(o,i){if(1&o&&(e.ynx(0,1),e.TgZ(1,"nav",2,3),e.ynx(3,4),e.TgZ(4,"a",5),e.SDv(5,6),e.qZA(),e.YNc(6,Ti,1,3,"ng-template",7),e.BQk(),e.YNc(7,Ai,4,0,"ng-container",8),e.YNc(8,Ni,4,0,"ng-container",9),e.YNc(9,vi,4,0,"ng-container",10),e.qZA(),e._UZ(10,"div",11),e.BQk()),2&o){const _=e.MAs(2),t=e.oxw();e.xp6(7),e.Q6J("ngIf",t.permissions.grafana.read),e.xp6(1),e.Q6J("ngIf","replicated"===t.selection.type),e.xp6(1),e.Q6J("ngIf",(null==t.selection.tiers?null:t.selection.tiers.length)>0),e.xp6(1),e.Q6J("ngbNavOutlet",_)}}let $i=(()=>{class o{constructor(_){this.poolService=_,this.cacheTierColumns=[],this.omittedPoolAttributes=["cdExecuting","cdIsBinary","stats"],this.cacheTierColumns=[{prop:"pool_name",name:"Name",flexGrow:3},{prop:"cache_mode",name:"Cache Mode",flexGrow:2},{prop:"cache_min_evict_age",name:"Min Evict Age",flexGrow:2},{prop:"cache_min_flush_age",name:"Min Flush Age",flexGrow:2},{prop:"target_max_bytes",name:"Target Max Bytes",flexGrow:2},{prop:"target_max_objects",name:"Target Max Objects",flexGrow:2}]}ngOnChanges(){this.selection&&(this.poolService.getConfiguration(this.selection.pool_name).subscribe(_=>{ke.T.updateChanged(this,{selectedPoolConfiguration:_})}),ke.T.updateChanged(this,{poolDetails:f().omit(this.selection,this.omittedPoolAttributes)}))}}return o.\u0275fac=function(_){return new(_||o)(e.Y36(pe.q))},o.\u0275cmp=e.Xpm({type:o,selectors:[["cd-pool-details"]],inputs:{cacheTiers:"cacheTiers",permissions:"permissions",selection:"selection"},features:[e.TTD],decls:1,vars:1,consts:function(){let i,_,t,n,s;return i="Details",_="Performance Details",t="Pool details",n="Configuration",s="Cache Tiers Details",[["cdTableDetail","",4,"ngIf"],["cdTableDetail",""],["ngbNav","","cdStatefulTab","pool-details",1,"nav-tabs"],["nav","ngbNav"],["ngbNavItem","details"],["ngbNavLink",""],i,["ngbNavContent",""],["ngbNavItem","performance-details",4,"ngIf"],["ngbNavItem","configuration",4,"ngIf"],["ngbNavItem","cache-tiers-details",4,"ngIf"],[3,"ngbNavOutlet"],[3,"renderObjects","data","autoReload"],["ngbNavItem","performance-details"],_,["title",t,"uid","-xyV8KCiz","grafanaStyle","three",3,"grafanaPath","type"],["ngbNavItem","configuration"],n,[3,"data"],["ngbNavItem","cache-tiers-details"],s,["columnMode","flex",3,"data","columns","autoSave"]]},template:function(_,t){1&_&&e.YNc(0,Di,11,4,"ng-container",0),2&_&&e.Q6J("ngIf",t.selection)},dependencies:[M.O5,E.uN,E.Pz,E.nv,E.Vx,E.tO,E.Dy,Je.F,be.a,ze.b,hi.m,Si.P],changeDetection:0}),o})();const Ii=["poolUsageTpl"],xi=["poolConfigurationSourceTpl"];function Zi(o,i){if(1&o){const _=e.EpF();e.TgZ(0,"cd-table",9,10),e.NdJ("fetchData",function(){e.CHM(_);const n=e.oxw();return e.KtG(n.taskListService.fetch())})("setExpandedRow",function(n){e.CHM(_);const s=e.oxw();return e.KtG(s.setExpandedRow(n))})("updateSelection",function(n){e.CHM(_);const s=e.oxw();return e.KtG(s.updateSelection(n))}),e._UZ(2,"cd-table-actions",11)(3,"cd-pool-details",12),e.qZA()}if(2&o){const _=e.oxw();e.Q6J("data",_.pools)("columns",_.columns)("hasDetails",!0)("status",_.tableStatus)("autoReload",-1),e.xp6(2),e.Q6J("permission",_.permissions.pool)("selection",_.selection)("tableActions",_.tableActions),e.xp6(1),e.Q6J("selection",_.expandedRow)("permissions",_.permissions)("cacheTiers",_.cacheTiers)}}function yi(o,i){1&o&&e._UZ(0,"cd-grafana",14),2&o&&e.Q6J("grafanaPath","ceph-pools-overview?")("type","metrics")}function Ui(o,i){1&o&&(e.ynx(0,2),e.TgZ(1,"a",3),e.SDv(2,13),e.qZA(),e.YNc(3,yi,1,2,"ng-template",5),e.BQk())}function Gi(o,i){if(1&o&&e._UZ(0,"cd-usage-bar",16),2&o){const _=e.oxw().row;e.Q6J("total",_.stats.bytes_used.latest+_.stats.avail_raw.latest)("used",_.stats.bytes_used.latest)("title",_.pool_name)}}function Hi(o,i){if(1&o&&e.YNc(0,Gi,1,3,"cd-usage-bar",15),2&o){const _=i.row;e.Q6J("ngIf",null==_.stats||null==_.stats.avail_raw?null:_.stats.avail_raw.latest)}}const De="pool";let qi=(()=>{class o extends Pi.o{constructor(_,t,n,s,c,d,P,p,R,S,T){super(),this.poolService=_,this.taskWrapper=t,this.ecpService=n,this.authStorageService=s,this.taskListService=c,this.modalService=d,this.pgCategoryService=P,this.dimlessPipe=p,this.urlBuilder=R,this.configurationService=S,this.actionLabels=T,this.selection=new fi.r,this.executingTasks=[],this.tableStatus=new Ne.E,this.cacheTiers=[],this.monAllowPoolDelete=!1,this.permissions=this.authStorageService.getPermissions(),this.tableActions=[{permission:"create",icon:v.P.add,routerLink:()=>this.urlBuilder.getCreate(),name:this.actionLabels.CREATE},{permission:"update",icon:v.P.edit,routerLink:()=>this.urlBuilder.getEdit(encodeURIComponent(this.selection.first().pool_name)),name:this.actionLabels.EDIT},{permission:"delete",icon:v.P.destroy,click:()=>this.deletePoolModal(),name:this.actionLabels.DELETE,disable:this.getDisableDesc.bind(this)}],this.permissions.configOpt.read&&this.configurationService.get("mon_allow_pool_delete").subscribe(m=>{if(f().has(m,"value")){const C=f().find(m.value,g=>"mon"===g.section)||{value:!1};this.monAllowPoolDelete="true"===C.value}})}ngOnInit(){const _=(t,n,s)=>f().get(n,t)>f().get(s,t)?1:-1;this.columns=[{prop:"pool_name",name:"Name",flexGrow:4,cellTransformation:A.e.executing},{prop:"data_protection",name:"Data Protection",cellTransformation:A.e.badge,customTemplateConfig:{class:"badge-background-gray"},flexGrow:1.3},{prop:"application_metadata",name:"Applications",cellTransformation:A.e.badge,customTemplateConfig:{class:"badge-background-primary"},flexGrow:1.5},{prop:"pg_status",name:"PG Status",flexGrow:1.2,cellClass:({row:t,column:n,value:s})=>this.getPgStatusCellClass(t,n,s)},{prop:"crush_rule",name:"Crush Ruleset",isHidden:!0,flexGrow:2},{name:"Usage",prop:"usage",cellTemplate:this.poolUsageTpl,flexGrow:1.2},{prop:"stats.rd_bytes.rates",name:"Read bytes",comparator:(t,n,s,c)=>_("stats.rd_bytes.latest",s,c),cellTransformation:A.e.sparkline,flexGrow:1.5},{prop:"stats.wr_bytes.rates",name:"Write bytes",comparator:(t,n,s,c)=>_("stats.wr_bytes.latest",s,c),cellTransformation:A.e.sparkline,flexGrow:1.5},{prop:"stats.rd.rate",name:"Read ops",flexGrow:1,pipe:this.dimlessPipe,cellTransformation:A.e.perSecond},{prop:"stats.wr.rate",name:"Write ops",flexGrow:1,pipe:this.dimlessPipe,cellTransformation:A.e.perSecond}],this.taskListService.init(()=>this.ecpService.list().pipe((0,di.zg)(t=>(this.ecProfileList=t,this.poolService.getList()))),void 0,t=>{this.pools=this.transformPoolsData(t),this.tableStatus=new Ne.E},()=>{this.table.reset(),this.tableStatus=new Ne.E(Ei.T.ValueException)},t=>t.name.startsWith(`${De}/`),(t,n)=>n.metadata.pool_name===t.pool_name,{default:t=>new pi(t.pool_name)})}updateSelection(_){this.selection=_}deletePoolModal(){const _=this.selection.first().pool_name;this.modalService.show(Ie.M,{itemDescription:"Pool",itemNames:[_],submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new D.R(`${De}/${h.MQ.DELETE}`,{pool_name:_}),call:this.poolService.delete(_)})})}getPgStatusCellClass(_,t,n){return{"text-right":!0,[`pg-${this.pgCategoryService.getTypeByStates(n)}`]:!0}}getErasureCodeProfile(_){let t="";return f().forEach(this.ecProfileList,n=>{n.name===_&&(t=`EC: ${n.k}+${n.m}`)}),t}transformPoolsData(_){const t=["bytes_used","max_avail","avail_raw","percent_used","rd_bytes","wr_bytes","rd","wr"],n={latest:0,rate:0,rates:[]};return f().forEach(_,s=>{s.pg_status=this.transformPgStatus(s.pg_status);const c={};f().forEach(t,d=>{c[d]=s.stats&&s.stats[d]?s.stats[d]:n}),s.stats=c,s.usage=c.percent_used.latest,!s.cdExecuting&&s.pg_num+s.pg_placement_num!==s.pg_num_target+s.pg_placement_num_target&&(s.cdExecuting="Updating"),["rd_bytes","wr_bytes"].forEach(d=>{s.stats[d].rates=s.stats[d].rates.map(P=>P[1])}),s.cdIsBinary=!0,"erasure"===s.type&&(s.data_protection=this.getErasureCodeProfile(s.erasure_code_profile)),"replicated"===s.type&&(s.data_protection=`replica: \xd7${s.size}`)}),_}transformPgStatus(_){const t=[];return f().forEach(_,(n,s)=>{t.push(`${n} ${s}`)}),t.join(", ")}getSelectionTiers(){if(typeof this.expandedRow<"u"){const _=this.expandedRow.tiers;this.cacheTiers=this.pools.filter(t=>_.includes(t.pool))}}getDisableDesc(){return!this.selection?.hasSelection||!this.monAllowPoolDelete&&"Pool deletion is disabled by the mon_allow_pool_delete configuration setting."}setExpandedRow(_){super.setExpandedRow(_),this.getSelectionTiers()}}return o.\u0275fac=function(_){return new(_||o)(e.Y36(pe.q),e.Y36(ge.P),e.Y36(Fe),e.Y36(qe.j),e.Y36(Qe.j),e.Y36(He.Z),e.Y36(ui.j),e.Y36(gi.n),e.Y36(ve.F),e.Y36(Ri.e),e.Y36(h.p4))},o.\u0275cmp=e.Xpm({type:o,selectors:[["cd-pool-list"]],viewQuery:function(_,t){if(1&_&&(e.Gf(be.a,5),e.Gf(Ii,7),e.Gf(xi,5)),2&_){let n;e.iGM(n=e.CRH())&&(t.table=n.first),e.iGM(n=e.CRH())&&(t.poolUsageTpl=n.first),e.iGM(n=e.CRH())&&(t.poolConfigurationSourceTpl=n.first)}},features:[e._Bn([Qe.j,{provide:ve.F,useValue:new ve.F(De)}]),e.qOj],decls:10,vars:2,consts:function(){let i,_,t;return i="Pools List",_="Overall Performance",t="Ceph pools overview",[["ngbNav","",1,"nav-tabs"],["nav","ngbNav"],["ngbNavItem",""],["ngbNavLink",""],i,["ngbNavContent",""],["ngbNavItem","",4,"cdScope"],[3,"ngbNavOutlet"],["poolUsageTpl",""],["id","pool-list","selectionType","single",3,"data","columns","hasDetails","status","autoReload","fetchData","setExpandedRow","updateSelection"],["table",""],["id","pool-list-actions",1,"table-actions",3,"permission","selection","tableActions"],["cdTableDetail","","id","pool-list-details",3,"selection","permissions","cacheTiers"],_,["title",t,"uid","z99hzWtmk","grafanaStyle","two",3,"grafanaPath","type"],["decimals","2",3,"total","used","title",4,"ngIf"],["decimals","2",3,"total","used","title"]]},template:function(_,t){if(1&_&&(e.TgZ(0,"nav",0,1),e.ynx(2,2),e.TgZ(3,"a",3),e.SDv(4,4),e.qZA(),e.YNc(5,Zi,4,11,"ng-template",5),e.BQk(),e.YNc(6,Ui,4,0,"ng-container",6),e.qZA(),e._UZ(7,"div",7),e.YNc(8,Hi,1,1,"ng-template",null,8,e.W1O)),2&_){const n=e.MAs(1);e.xp6(6),e.Q6J("cdScope","grafana"),e.xp6(1),e.Q6J("ngbNavOutlet",n)}},dependencies:[M.O5,E.uN,E.Pz,E.nv,E.Vx,E.tO,E.Dy,mi.O,Je.F,be.a,Ci.K,Mi.w,$i],styles:["cd-pool-list .pg-clean{color:#008a00}  cd-pool-list .pg-working{color:#25828e}  cd-pool-list .pg-warning{color:#d48200}  cd-pool-list .pg-unknown{color:#dc3545}"]}),o})(),Ve=(()=>{class o{}return o.\u0275fac=function(_){return new(_||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[C_.t,M.ez,E.Oz,R_.m,fe.Bz,l.UX,E.HK,m_.BlockModule]}),o})();const zi=[{path:"",component:qi},{path:h.MQ.CREATE,component:we,data:{breadcrumbs:h.Qn.CREATE}},{path:`${h.MQ.EDIT}/:name`,component:we,data:{breadcrumbs:h.Qn.EDIT}}];let Xi=(()=>{class o{}return o.\u0275fac=function(_){return new(_||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[Ve,fe.Bz.forChild(zi)]}),o})()}}]);