From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: "Thomas Lamprecht" <t.lamprecht@proxmox.com>
Date: Tue, 03 Jun 2024 19:29:25 +0200
Subject: [PATCH] Update RGW Arrow Flight code to adjust to API changes in
 Apache Arrow.

Signed-off-by: J. Eric Ivancich <ivancich@redhat.com>
Signed-off-by: Thomas Lamprecht <t.lamprecht@proxmox.com>
---
 src/s3select/include/s3select_parquet_intrf.h | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/src/s3select/include/s3select_parquet_intrf.h b/src/s3select/include/s3select_parquet_intrf.h
index df04e1618..0543443e2 100644
--- a/src/s3select/include/s3select_parquet_intrf.h
+++ b/src/s3select/include/s3select_parquet_intrf.h
@@ -434,7 +434,7 @@ public:
       #if ARROW_VERSION_MAJOR < 9
       fd_ = -1;
       #else
-      fd_.Close();
+      return fd_.Close();
       #endif
       //RETURN_NOT_OK(::arrow::internal::FileClose(fd));
     }
@@ -1244,9 +1244,13 @@ void SerializedFile::ParseMetaDataOfEncryptedFileWithEncryptedFooter(
                            std::to_string(metadata_buffer->size()) + " bytes)");
   }
 
+#if ARROW_VERSION_MAJOR > 9
+  file_metadata_ =
+	FileMetaData::Make(metadata_buffer->data(), &metadata_len, default_reader_properties(), file_decryptor_);
+#else
   file_metadata_ =
 	FileMetaData::Make(metadata_buffer->data(), &metadata_len, file_decryptor_);
-      	//FileMetaData::Make(metadata_buffer->data(), &metadata_len, default_reader_properties(), file_decryptor_); //version>9
+#endif
 }
 
 void SerializedFile::ParseMetaDataOfEncryptedFileWithPlaintextFooter(
